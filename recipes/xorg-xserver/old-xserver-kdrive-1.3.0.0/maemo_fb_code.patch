diff --git a/composite/compwindow.c b/composite/compwindow.c
index 2c86cdd..8341205 100644
--- a/composite/compwindow.c
+++ b/composite/compwindow.c
@@ -744,16 +744,21 @@ compWindowUpdateAutomatic (WindowPtr pWin)
     /*
      * And paint
      */
-    CompositePicture (PictOpSrc,
+    FbComposeData params = {
+    		.op = PictOpSrc,
+    		.xSrc = 0,
+    		.ySrc = 0,
+    		.xMask = 0,
+    		.yMask = 0,
+    		.xDest = pSrcPixmap->screen_x - pParent->drawable.x,
+    		.yDest = pSrcPixmap->screen_y - pParent->drawable.y,
+    		.width = pSrcPixmap->drawable.width,
+    		.height = pSrcPixmap->drawable.height
+    };
+    CompositePicture (&params,
 		      pSrcPicture,
 		      0,
-		      pDstPicture,
-		      0, 0, /* src_x, src_y */
-		      0, 0, /* msk_x, msk_y */
-		      pSrcPixmap->screen_x - pParent->drawable.x,
-		      pSrcPixmap->screen_y - pParent->drawable.y,
-		      pSrcPixmap->drawable.width,
-		      pSrcPixmap->drawable.height);
+		      pDstPicture);
     FreePicture (pSrcPicture, 0);
     FreePicture (pDstPicture, 0);
     /*
diff --git a/fb/Makefile.am b/fb/Makefile.am
index 11b2d2f..240db82 100644
--- a/fb/Makefile.am
+++ b/fb/Makefile.am
@@ -1,4 +1,4 @@
-noinst_LTLIBRARIES = libfb.la libfbmmx.la
+noinst_LTLIBRARIES = libfb.la libwfb.la libfbmmx.la
 
 INCLUDES = \
 	-I$(top_srcdir)/hw/xfree86/os-support \
@@ -7,11 +7,13 @@ INCLUDES = \
 AM_CFLAGS = $(DIX_CFLAGS)
 
 if XORG
-sdk_HEADERS = fb.h fbrop.h fbpseudocolor.h fboverlay.h
+sdk_HEADERS = fb.h fbrop.h fbpseudocolor.h fboverlay.h wfbrename.h
 endif
 
+libfb_la_CFLAGS = $(AM_CFLAGS)
+
 if MMX_CAPABLE
-AM_CFLAGS += -DUSE_MMX
+libfb_la_CFLAGS += -DUSE_MMX
 
 libfbmmx_la_CFLAGS =				\
 	$(DIX_CFLAGS)				\
@@ -23,6 +25,8 @@ libfbmmx_la_CFLAGS =				\
         --param large-function-growth=10000
 endif
 
+libwfb_la_CFLAGS = $(AM_CFLAGS) -DFB_ACCESS_WRAPPER
+
 libfbmmx_la_SOURCES =	\
 	fbmmx.c		\
 	fbmmx.h
@@ -51,6 +55,9 @@ libfb_la_SOURCES = 	\
 	fboverlay.c	\
 	fboverlay.h	\
 	fbpict.c	\
+	fbarmv6.c	\
+	fbarmv6.h	\
+	fbarmv6_internal.h \
 	fbpict.h	\
 	fbpixmap.c	\
 	fbpoint.c	\
@@ -70,6 +77,8 @@ libfb_la_SOURCES = 	\
 	fbedge.c	\
 	fbedgeimp.h
 
+libwfb_la_SOURCES = $(libfb_la_SOURCES)
+
 libfb_la_LIBADD = libfbmmx.la
 
 EXTRA_DIST = fbcmap.c
diff --git a/fb/Makefile.in b/fb/Makefile.in
index bfab3ce..6088e06 100644
--- a/fb/Makefile.in
+++ b/fb/Makefile.in
@@ -1,8 +1,8 @@
-# Makefile.in generated by automake 1.9.6 from Makefile.am.
+# Makefile.in generated by automake 1.10.1 from Makefile.am.
 # @configure_input@
 
 # Copyright (C) 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001, 2002,
-# 2003, 2004, 2005  Free Software Foundation, Inc.
+# 2003, 2004, 2005, 2006, 2007, 2008  Free Software Foundation, Inc.
 # This Makefile.in is free software; the Free Software Foundation
 # gives unlimited permission to copy and/or distribute it,
 # with or without modifications, as long as this notice is preserved.
@@ -15,15 +15,11 @@
 @SET_MAKE@
 
 
-srcdir = @srcdir@
-top_srcdir = @top_srcdir@
 VPATH = @srcdir@
 pkgdatadir = $(datadir)/@PACKAGE@
 pkglibdir = $(libdir)/@PACKAGE@
 pkgincludedir = $(includedir)/@PACKAGE@
-top_builddir = ..
 am__cd = CDPATH="$${ZSH_VERSION+.}$(PATH_SEPARATOR)" && cd
-INSTALL = @INSTALL@
 install_sh_DATA = $(install_sh) -c -m 644
 install_sh_PROGRAM = $(install_sh) -c
 install_sh_SCRIPT = $(install_sh) -c
@@ -58,31 +54,67 @@ CONFIG_HEADER = $(top_builddir)/include/do-not-use-config.h \
 CONFIG_CLEAN_FILES =
 LTLIBRARIES = $(noinst_LTLIBRARIES)
 libfb_la_DEPENDENCIES = libfbmmx.la
-am_libfb_la_OBJECTS = fb24_32.lo fballpriv.lo fbarc.lo fbbits.lo \
-	fbblt.lo fbbltone.lo fbbstore.lo fbcompose.lo fbcopy.lo \
-	fbfill.lo fbfillrect.lo fbfillsp.lo fbgc.lo fbgetsp.lo \
-	fbglyph.lo fbimage.lo fbline.lo fboverlay.lo fbpict.lo \
-	fbpixmap.lo fbpoint.lo fbpush.lo fbscreen.lo fbseg.lo \
-	fbsetsp.lo fbsolid.lo fbstipple.lo fbtile.lo fbtrap.lo \
-	fbutil.lo fbwindow.lo fbpseudocolor.lo fbedge.lo
+am_libfb_la_OBJECTS = libfb_la-fb24_32.lo libfb_la-fballpriv.lo \
+	libfb_la-fbarc.lo libfb_la-fbbits.lo libfb_la-fbblt.lo \
+	libfb_la-fbbltone.lo libfb_la-fbbstore.lo \
+	libfb_la-fbcompose.lo libfb_la-fbcopy.lo libfb_la-fbfill.lo \
+	libfb_la-fbfillrect.lo libfb_la-fbfillsp.lo libfb_la-fbgc.lo \
+	libfb_la-fbgetsp.lo libfb_la-fbglyph.lo libfb_la-fbimage.lo \
+	libfb_la-fbline.lo libfb_la-fboverlay.lo libfb_la-fbpict.lo \
+	libfb_la-fbarmv6.lo libfb_la-fbpixmap.lo libfb_la-fbpoint.lo \
+	libfb_la-fbpush.lo libfb_la-fbscreen.lo libfb_la-fbseg.lo \
+	libfb_la-fbsetsp.lo libfb_la-fbsolid.lo libfb_la-fbstipple.lo \
+	libfb_la-fbtile.lo libfb_la-fbtrap.lo libfb_la-fbutil.lo \
+	libfb_la-fbwindow.lo libfb_la-fbpseudocolor.lo \
+	libfb_la-fbedge.lo
 libfb_la_OBJECTS = $(am_libfb_la_OBJECTS)
+libfb_la_LINK = $(LIBTOOL) --tag=CC $(AM_LIBTOOLFLAGS) $(LIBTOOLFLAGS) \
+	--mode=link $(CCLD) $(libfb_la_CFLAGS) $(CFLAGS) $(AM_LDFLAGS) \
+	$(LDFLAGS) -o $@
 libfbmmx_la_LIBADD =
 am_libfbmmx_la_OBJECTS = libfbmmx_la-fbmmx.lo
 libfbmmx_la_OBJECTS = $(am_libfbmmx_la_OBJECTS)
-DEFAULT_INCLUDES = -I. -I$(srcdir) -I$(top_builddir)/include -I$(top_builddir)/include -I$(top_builddir)/include -I$(top_builddir)/include -I$(top_builddir)/include -I$(top_builddir)/include -I$(top_builddir)/include -I$(top_builddir)/include
+libfbmmx_la_LINK = $(LIBTOOL) --tag=CC $(AM_LIBTOOLFLAGS) \
+	$(LIBTOOLFLAGS) --mode=link $(CCLD) $(libfbmmx_la_CFLAGS) \
+	$(CFLAGS) $(AM_LDFLAGS) $(LDFLAGS) -o $@
+libwfb_la_LIBADD =
+am__objects_1 = libwfb_la-fb24_32.lo libwfb_la-fballpriv.lo \
+	libwfb_la-fbarc.lo libwfb_la-fbbits.lo libwfb_la-fbblt.lo \
+	libwfb_la-fbbltone.lo libwfb_la-fbbstore.lo \
+	libwfb_la-fbcompose.lo libwfb_la-fbcopy.lo libwfb_la-fbfill.lo \
+	libwfb_la-fbfillrect.lo libwfb_la-fbfillsp.lo \
+	libwfb_la-fbgc.lo libwfb_la-fbgetsp.lo libwfb_la-fbglyph.lo \
+	libwfb_la-fbimage.lo libwfb_la-fbline.lo \
+	libwfb_la-fboverlay.lo libwfb_la-fbpict.lo \
+	libwfb_la-fbarmv6.lo libwfb_la-fbpixmap.lo \
+	libwfb_la-fbpoint.lo libwfb_la-fbpush.lo libwfb_la-fbscreen.lo \
+	libwfb_la-fbseg.lo libwfb_la-fbsetsp.lo libwfb_la-fbsolid.lo \
+	libwfb_la-fbstipple.lo libwfb_la-fbtile.lo libwfb_la-fbtrap.lo \
+	libwfb_la-fbutil.lo libwfb_la-fbwindow.lo \
+	libwfb_la-fbpseudocolor.lo libwfb_la-fbedge.lo
+am_libwfb_la_OBJECTS = $(am__objects_1)
+libwfb_la_OBJECTS = $(am_libwfb_la_OBJECTS)
+libwfb_la_LINK = $(LIBTOOL) --tag=CC $(AM_LIBTOOLFLAGS) \
+	$(LIBTOOLFLAGS) --mode=link $(CCLD) $(libwfb_la_CFLAGS) \
+	$(CFLAGS) $(AM_LDFLAGS) $(LDFLAGS) -o $@
+DEFAULT_INCLUDES = -I.@am__isrc@ -I$(top_builddir)/include
 depcomp = $(SHELL) $(top_srcdir)/depcomp
 am__depfiles_maybe = depfiles
 COMPILE = $(CC) $(DEFS) $(DEFAULT_INCLUDES) $(INCLUDES) $(AM_CPPFLAGS) \
 	$(CPPFLAGS) $(AM_CFLAGS) $(CFLAGS)
-LTCOMPILE = $(LIBTOOL) --tag=CC --mode=compile $(CC) $(DEFS) \
-	$(DEFAULT_INCLUDES) $(INCLUDES) $(AM_CPPFLAGS) $(CPPFLAGS) \
-	$(AM_CFLAGS) $(CFLAGS)
+LTCOMPILE = $(LIBTOOL) --tag=CC $(AM_LIBTOOLFLAGS) $(LIBTOOLFLAGS) \
+	--mode=compile $(CC) $(DEFS) $(DEFAULT_INCLUDES) $(INCLUDES) \
+	$(AM_CPPFLAGS) $(CPPFLAGS) $(AM_CFLAGS) $(CFLAGS)
 CCLD = $(CC)
-LINK = $(LIBTOOL) --tag=CC --mode=link $(CCLD) $(AM_CFLAGS) $(CFLAGS) \
-	$(AM_LDFLAGS) $(LDFLAGS) -o $@
-SOURCES = $(libfb_la_SOURCES) $(libfbmmx_la_SOURCES)
-DIST_SOURCES = $(libfb_la_SOURCES) $(libfbmmx_la_SOURCES)
-am__sdk_HEADERS_DIST = fb.h fbrop.h fbpseudocolor.h fboverlay.h
+LINK = $(LIBTOOL) --tag=CC $(AM_LIBTOOLFLAGS) $(LIBTOOLFLAGS) \
+	--mode=link $(CCLD) $(AM_CFLAGS) $(CFLAGS) $(AM_LDFLAGS) \
+	$(LDFLAGS) -o $@
+SOURCES = $(libfb_la_SOURCES) $(libfbmmx_la_SOURCES) \
+	$(libwfb_la_SOURCES)
+DIST_SOURCES = $(libfb_la_SOURCES) $(libfbmmx_la_SOURCES) \
+	$(libwfb_la_SOURCES)
+am__sdk_HEADERS_DIST = fb.h fbrop.h fbpseudocolor.h fboverlay.h \
+	wfbrename.h
 am__vpath_adj_setup = srcdirstrip=`echo "$(srcdir)" | sed 's|.|.|g'`;
 am__vpath_adj = case $$p in \
     $(srcdir)/*) f=`echo "$$p" | sed "s|^$$srcdirstrip/||"`;; \
@@ -98,75 +130,44 @@ DISTFILES = $(DIST_COMMON) $(DIST_SOURCES) $(TEXINFOS) $(EXTRA_DIST)
 ACLOCAL = @ACLOCAL@
 ADMIN_MAN_DIR = @ADMIN_MAN_DIR@
 ADMIN_MAN_SUFFIX = @ADMIN_MAN_SUFFIX@
-AFB_FALSE = @AFB_FALSE@
-AFB_TRUE = @AFB_TRUE@
-AGP_FALSE = @AGP_FALSE@
-AGP_TRUE = @AGP_TRUE@
-AIGLX_FALSE = @AIGLX_FALSE@
-AIGLX_TRUE = @AIGLX_TRUE@
 ALLOCA = @ALLOCA@
-ALPHA_VIDEO_FALSE = @ALPHA_VIDEO_FALSE@
-ALPHA_VIDEO_TRUE = @ALPHA_VIDEO_TRUE@
-AMDEP_FALSE = @AMDEP_FALSE@
-AMDEP_TRUE = @AMDEP_TRUE@
 AMTAR = @AMTAR@
 APPDEFAULTDIR = @APPDEFAULTDIR@
-APPGROUP_FALSE = @APPGROUP_FALSE@
-APPGROUP_TRUE = @APPGROUP_TRUE@
+APPLE_APPLICATIONS_DIR = @APPLE_APPLICATIONS_DIR@
 APP_MAN_DIR = @APP_MAN_DIR@
 APP_MAN_SUFFIX = @APP_MAN_SUFFIX@
 AR = @AR@
-ARM_VIDEO_FALSE = @ARM_VIDEO_FALSE@
-ARM_VIDEO_TRUE = @ARM_VIDEO_TRUE@
 AS = @AS@
 AUTOCONF = @AUTOCONF@
 AUTOHEADER = @AUTOHEADER@
 AUTOMAKE = @AUTOMAKE@
 AWK = @AWK@
 BASE_FONT_PATH = @BASE_FONT_PATH@
-BSD_KBD_MODE_FALSE = @BSD_KBD_MODE_FALSE@
-BSD_KBD_MODE_TRUE = @BSD_KBD_MODE_TRUE@
-BUILDDOCS_FALSE = @BUILDDOCS_FALSE@
-BUILDDOCS_TRUE = @BUILDDOCS_TRUE@
 BUILD_DATE = @BUILD_DATE@
-BUILD_KBD_MODE_FALSE = @BUILD_KBD_MODE_FALSE@
-BUILD_KBD_MODE_TRUE = @BUILD_KBD_MODE_TRUE@
-BUILD_LINUXDOC_FALSE = @BUILD_LINUXDOC_FALSE@
-BUILD_LINUXDOC_TRUE = @BUILD_LINUXDOC_TRUE@
-BUILD_PDFDOC_FALSE = @BUILD_PDFDOC_FALSE@
-BUILD_PDFDOC_TRUE = @BUILD_PDFDOC_TRUE@
-BUILD_XORGCFG_FALSE = @BUILD_XORGCFG_FALSE@
-BUILD_XORGCFG_TRUE = @BUILD_XORGCFG_TRUE@
 CC = @CC@
 CCAS = @CCAS@
+CCASDEPMODE = @CCASDEPMODE@
 CCASFLAGS = @CCASFLAGS@
 CCDEPMODE = @CCDEPMODE@
-CFB_FALSE = @CFB_FALSE@
-CFB_TRUE = @CFB_TRUE@
 CFLAGS = @CFLAGS@
 COMPILEDDEFAULTFONTPATH = @COMPILEDDEFAULTFONTPATH@
-COMPOSITE_FALSE = @COMPOSITE_FALSE@
-COMPOSITE_TRUE = @COMPOSITE_TRUE@
 CPP = @CPP@
 CPPFLAGS = @CPPFLAGS@
-CUP_FALSE = @CUP_FALSE@
-CUP_TRUE = @CUP_TRUE@
 CXX = @CXX@
 CXXCPP = @CXXCPP@
 CXXDEPMODE = @CXXDEPMODE@
 CXXFLAGS = @CXXFLAGS@
 CYGPATH_W = @CYGPATH_W@
-DBE_FALSE = @DBE_FALSE@
-DBE_TRUE = @DBE_TRUE@
-DEBUG_FALSE = @DEBUG_FALSE@
-DEBUG_TRUE = @DEBUG_TRUE@
+DARWIN_LIBS = @DARWIN_LIBS@
+DBUS_CFLAGS = @DBUS_CFLAGS@
+DBUS_LIBS = @DBUS_LIBS@
 DEFAULT_LIBRARY_PATH = @DEFAULT_LIBRARY_PATH@
 DEFAULT_LOGPREFIX = @DEFAULT_LOGPREFIX@
 DEFAULT_MODULE_PATH = @DEFAULT_MODULE_PATH@
 DEFS = @DEFS@
 DEPDIR = @DEPDIR@
-DGA_FALSE = @DGA_FALSE@
-DGA_TRUE = @DGA_TRUE@
+DGA_CFLAGS = @DGA_CFLAGS@
+DGA_LIBS = @DGA_LIBS@
 DIX_CFLAGS = @DIX_CFLAGS@
 DLLTOOL = @DLLTOOL@
 DMXEXAMPLES_DEP_CFLAGS = @DMXEXAMPLES_DEP_CFLAGS@
@@ -177,81 +178,42 @@ DMXXIEXAMPLES_DEP_CFLAGS = @DMXXIEXAMPLES_DEP_CFLAGS@
 DMXXIEXAMPLES_DEP_LIBS = @DMXXIEXAMPLES_DEP_LIBS@
 DMXXMUEXAMPLES_DEP_CFLAGS = @DMXXMUEXAMPLES_DEP_CFLAGS@
 DMXXMUEXAMPLES_DEP_LIBS = @DMXXMUEXAMPLES_DEP_LIBS@
-DMX_BUILD_LNX_FALSE = @DMX_BUILD_LNX_FALSE@
-DMX_BUILD_LNX_TRUE = @DMX_BUILD_LNX_TRUE@
-DMX_BUILD_USB_FALSE = @DMX_BUILD_USB_FALSE@
-DMX_BUILD_USB_TRUE = @DMX_BUILD_USB_TRUE@
-DMX_FALSE = @DMX_FALSE@
-DMX_TRUE = @DMX_TRUE@
-DPMSExtension_FALSE = @DPMSExtension_FALSE@
-DPMSExtension_TRUE = @DPMSExtension_TRUE@
 DRIPROTO_CFLAGS = @DRIPROTO_CFLAGS@
 DRIPROTO_LIBS = @DRIPROTO_LIBS@
 DRIVER_MAN_DIR = @DRIVER_MAN_DIR@
 DRIVER_MAN_SUFFIX = @DRIVER_MAN_SUFFIX@
 DRI_DRIVER_PATH = @DRI_DRIVER_PATH@
-DRI_FALSE = @DRI_FALSE@
-DRI_TRUE = @DRI_TRUE@
+DSYMUTIL = @DSYMUTIL@
+DTRACE = @DTRACE@
 ECHO = @ECHO@
 ECHO_C = @ECHO_C@
 ECHO_N = @ECHO_N@
 ECHO_T = @ECHO_T@
 EGREP = @EGREP@
-EVI_FALSE = @EVI_FALSE@
-EVI_TRUE = @EVI_TRUE@
 EXEEXT = @EXEEXT@
 F77 = @F77@
-FBDEVHW_FALSE = @FBDEVHW_FALSE@
-FBDEVHW_TRUE = @FBDEVHW_TRUE@
 FFLAGS = @FFLAGS@
 FILE_MAN_DIR = @FILE_MAN_DIR@
 FILE_MAN_SUFFIX = @FILE_MAN_SUFFIX@
-FONTCACHE_FALSE = @FONTCACHE_FALSE@
-FONTCACHE_TRUE = @FONTCACHE_TRUE@
-FREEBSD_KLDLOAD_FALSE = @FREEBSD_KLDLOAD_FALSE@
-FREEBSD_KLDLOAD_TRUE = @FREEBSD_KLDLOAD_TRUE@
 FREETYPE_CFLAGS = @FREETYPE_CFLAGS@
 FREETYPE_LIBS = @FREETYPE_LIBS@
 FREETYPE_REQUIRES = @FREETYPE_REQUIRES@
 GLX_DEFINES = @GLX_DEFINES@
-GLX_FALSE = @GLX_FALSE@
-GLX_TRUE = @GLX_TRUE@
 GL_CFLAGS = @GL_CFLAGS@
 GL_LIBS = @GL_LIBS@
 GREP = @GREP@
-H3600_TS_FALSE = @H3600_TS_FALSE@
-H3600_TS_TRUE = @H3600_TS_TRUE@
-I386_VIDEO_FALSE = @I386_VIDEO_FALSE@
-I386_VIDEO_TRUE = @I386_VIDEO_TRUE@
+HAL_CFLAGS = @HAL_CFLAGS@
+HAL_LIBS = @HAL_LIBS@
+INSTALL = @INSTALL@
 INSTALL_DATA = @INSTALL_DATA@
-INSTALL_LIBXF86CONFIG_FALSE = @INSTALL_LIBXF86CONFIG_FALSE@
-INSTALL_LIBXF86CONFIG_TRUE = @INSTALL_LIBXF86CONFIG_TRUE@
 INSTALL_PROGRAM = @INSTALL_PROGRAM@
 INSTALL_SCRIPT = @INSTALL_SCRIPT@
-INSTALL_SETUID_FALSE = @INSTALL_SETUID_FALSE@
-INSTALL_SETUID_TRUE = @INSTALL_SETUID_TRUE@
 INSTALL_STRIP_PROGRAM = @INSTALL_STRIP_PROGRAM@
-INT10_STUB_FALSE = @INT10_STUB_FALSE@
-INT10_STUB_TRUE = @INT10_STUB_TRUE@
-INT10_VM86_FALSE = @INT10_VM86_FALSE@
-INT10_VM86_TRUE = @INT10_VM86_TRUE@
-INT10_X86EMU_FALSE = @INT10_X86EMU_FALSE@
-INT10_X86EMU_TRUE = @INT10_X86EMU_TRUE@
-KDRIVEFBDEV_FALSE = @KDRIVEFBDEV_FALSE@
-KDRIVEFBDEV_TRUE = @KDRIVEFBDEV_TRUE@
-KDRIVELINUX_FALSE = @KDRIVELINUX_FALSE@
-KDRIVELINUX_TRUE = @KDRIVELINUX_TRUE@
-KDRIVEVESA_FALSE = @KDRIVEVESA_FALSE@
-KDRIVEVESA_TRUE = @KDRIVEVESA_TRUE@
 KDRIVE_CFLAGS = @KDRIVE_CFLAGS@
-KDRIVE_FALSE = @KDRIVE_FALSE@
-KDRIVE_HW_FALSE = @KDRIVE_HW_FALSE@
-KDRIVE_HW_TRUE = @KDRIVE_HW_TRUE@
 KDRIVE_INCS = @KDRIVE_INCS@
 KDRIVE_LIBS = @KDRIVE_LIBS@
 KDRIVE_PURE_INCS = @KDRIVE_PURE_INCS@
 KDRIVE_PURE_LIBS = @KDRIVE_PURE_LIBS@
-KDRIVE_TRUE = @KDRIVE_TRUE@
 LDFLAGS = @LDFLAGS@
 LD_EXPORT_SYMBOLS_FLAG = @LD_EXPORT_SYMBOLS_FLAG@
 LEX = @LEX@
@@ -265,41 +227,26 @@ LIBTOOL = @LIBTOOL@
 LIB_MAN_DIR = @LIB_MAN_DIR@
 LIB_MAN_SUFFIX = @LIB_MAN_SUFFIX@
 LINUXDOC = @LINUXDOC@
-LINUX_ALPHA_FALSE = @LINUX_ALPHA_FALSE@
-LINUX_ALPHA_TRUE = @LINUX_ALPHA_TRUE@
-LINUX_IA64_FALSE = @LINUX_IA64_FALSE@
-LINUX_IA64_TRUE = @LINUX_IA64_TRUE@
-LNXACPI_FALSE = @LNXACPI_FALSE@
-LNXACPI_TRUE = @LNXACPI_TRUE@
-LNXAPM_FALSE = @LNXAPM_FALSE@
-LNXAPM_TRUE = @LNXAPM_TRUE@
 LN_S = @LN_S@
 LTLIBOBJS = @LTLIBOBJS@
 MAINT = @MAINT@
-MAINTAINER_MODE_FALSE = @MAINTAINER_MODE_FALSE@
-MAINTAINER_MODE_TRUE = @MAINTAINER_MODE_TRUE@
 MAKEINFO = @MAKEINFO@
 MAKE_HTML = @MAKE_HTML@
 MAKE_PDF = @MAKE_PDF@
 MAKE_PS = @MAKE_PS@
 MAKE_TEXT = @MAKE_TEXT@
 MESA_SOURCE = @MESA_SOURCE@
-MFB_FALSE = @MFB_FALSE@
-MFB_TRUE = @MFB_TRUE@
 MISC_MAN_DIR = @MISC_MAN_DIR@
 MISC_MAN_SUFFIX = @MISC_MAN_SUFFIX@
-MITSHM_FALSE = @MITSHM_FALSE@
-MITSHM_TRUE = @MITSHM_TRUE@
+MKDIR_P = @MKDIR_P@
 MKFONTDIR = @MKFONTDIR@
 MKFONTSCALE = @MKFONTSCALE@
-MMX_CAPABLE_FALSE = @MMX_CAPABLE_FALSE@
-MMX_CAPABLE_TRUE = @MMX_CAPABLE_TRUE@
-MULTIBUFFER_FALSE = @MULTIBUFFER_FALSE@
-MULTIBUFFER_TRUE = @MULTIBUFFER_TRUE@
-NEED_STRLCAT_FALSE = @NEED_STRLCAT_FALSE@
-NEED_STRLCAT_TRUE = @NEED_STRLCAT_TRUE@
-NEED_VSNPRINTF_FALSE = @NEED_VSNPRINTF_FALSE@
-NEED_VSNPRINTF_TRUE = @NEED_VSNPRINTF_TRUE@
+NMEDIT = @NMEDIT@
+OBJC = @OBJC@
+OBJCCLD = @OBJCCLD@
+OBJCDEPMODE = @OBJCDEPMODE@
+OBJCFLAGS = @OBJCFLAGS@
+OBJCLINK = @OBJCLINK@
 OBJDUMP = @OBJDUMP@
 OBJEXT = @OBJEXT@
 PACKAGE = @PACKAGE@
@@ -311,42 +258,23 @@ PACKAGE_VERSION = @PACKAGE_VERSION@
 PATH_SEPARATOR = @PATH_SEPARATOR@
 PERL = @PERL@
 PKG_CONFIG = @PKG_CONFIG@
-PPC_VIDEO_FALSE = @PPC_VIDEO_FALSE@
-PPC_VIDEO_TRUE = @PPC_VIDEO_TRUE@
+PLIST_VENDOR_WEB = @PLIST_VENDOR_WEB@
+PLIST_VERSION_STRING = @PLIST_VERSION_STRING@
 PROJECTROOT = @PROJECTROOT@
 PS2PDF = @PS2PDF@
 RANLIB = @RANLIB@
 RAWCPP = @RAWCPP@
 RAWCPPFLAGS = @RAWCPPFLAGS@
-RECORD_FALSE = @RECORD_FALSE@
-RECORD_TRUE = @RECORD_TRUE@
-RES_FALSE = @RES_FALSE@
-RES_TRUE = @RES_TRUE@
 RGB_DB = @RGB_DB@
-SCREENSAVER_FALSE = @SCREENSAVER_FALSE@
-SCREENSAVER_TRUE = @SCREENSAVER_TRUE@
+SED = @SED@
 SET_MAKE = @SET_MAKE@
 SHELL = @SHELL@
 SOLARIS_ASM_CFLAGS = @SOLARIS_ASM_CFLAGS@
-SOLARIS_ASM_INLINE_FALSE = @SOLARIS_ASM_INLINE_FALSE@
-SOLARIS_ASM_INLINE_TRUE = @SOLARIS_ASM_INLINE_TRUE@
 SOLARIS_INOUT_ARCH = @SOLARIS_INOUT_ARCH@
-SOLARIS_USL_CONSOLE_FALSE = @SOLARIS_USL_CONSOLE_FALSE@
-SOLARIS_USL_CONSOLE_TRUE = @SOLARIS_USL_CONSOLE_TRUE@
-SPARC64_VIDEO_FALSE = @SPARC64_VIDEO_FALSE@
-SPARC64_VIDEO_TRUE = @SPARC64_VIDEO_TRUE@
 STRIP = @STRIP@
-SUN_KBD_MODE_FALSE = @SUN_KBD_MODE_FALSE@
-SUN_KBD_MODE_TRUE = @SUN_KBD_MODE_TRUE@
 SYS_LIBS = @SYS_LIBS@
 TSLIB_CFLAGS = @TSLIB_CFLAGS@
-TSLIB_FALSE = @TSLIB_FALSE@
 TSLIB_LIBS = @TSLIB_LIBS@
-TSLIB_TRUE = @TSLIB_TRUE@
-USE_CURSES_FALSE = @USE_CURSES_FALSE@
-USE_CURSES_TRUE = @USE_CURSES_TRUE@
-USE_RGB_BUILTIN_FALSE = @USE_RGB_BUILTIN_FALSE@
-USE_RGB_BUILTIN_TRUE = @USE_RGB_BUILTIN_TRUE@
 VENDOR_MAN_VERSION = @VENDOR_MAN_VERSION@
 VENDOR_RELEASE = @VENDOR_RELEASE@
 VENDOR_STRING = @VENDOR_STRING@
@@ -354,53 +282,30 @@ VENDOR_STRING_SHORT = @VENDOR_STRING_SHORT@
 VERSION = @VERSION@
 X11EXAMPLES_DEP_CFLAGS = @X11EXAMPLES_DEP_CFLAGS@
 X11EXAMPLES_DEP_LIBS = @X11EXAMPLES_DEP_LIBS@
-XACE_FALSE = @XACE_FALSE@
-XACE_TRUE = @XACE_TRUE@
-XCALIBRATE_FALSE = @XCALIBRATE_FALSE@
-XCALIBRATE_TRUE = @XCALIBRATE_TRUE@
-XCSECURITY_FALSE = @XCSECURITY_FALSE@
-XCSECURITY_TRUE = @XCSECURITY_TRUE@
-XDMAUTH_FALSE = @XDMAUTH_FALSE@
-XDMAUTH_TRUE = @XDMAUTH_TRUE@
 XDMCP_CFLAGS = @XDMCP_CFLAGS@
-XDMCP_FALSE = @XDMCP_FALSE@
 XDMCP_LIBS = @XDMCP_LIBS@
-XDMCP_TRUE = @XDMCP_TRUE@
 XDMXCONFIG_DEP_CFLAGS = @XDMXCONFIG_DEP_CFLAGS@
 XDMXCONFIG_DEP_LIBS = @XDMXCONFIG_DEP_LIBS@
 XDMX_LIBS = @XDMX_LIBS@
 XEGLMODULES_CFLAGS = @XEGLMODULES_CFLAGS@
 XEGLMODULES_LIBS = @XEGLMODULES_LIBS@
-XEGL_FALSE = @XEGL_FALSE@
 XEGL_LIBS = @XEGL_LIBS@
-XEGL_TRUE = @XEGL_TRUE@
 XEPHYR_CFLAGS = @XEPHYR_CFLAGS@
-XEPHYR_FALSE = @XEPHYR_FALSE@
 XEPHYR_INCS = @XEPHYR_INCS@
 XEPHYR_LIBS = @XEPHYR_LIBS@
-XEPHYR_TRUE = @XEPHYR_TRUE@
-XEVIE_FALSE = @XEVIE_FALSE@
-XEVIE_TRUE = @XEVIE_TRUE@
-XF86BIGFONT_FALSE = @XF86BIGFONT_FALSE@
-XF86BIGFONT_TRUE = @XF86BIGFONT_TRUE@
+XERRORDB_PATH = @XERRORDB_PATH@
 XF86CONFIGFILE = @XF86CONFIGFILE@
-XF86UTILS_FALSE = @XF86UTILS_FALSE@
-XF86UTILS_TRUE = @XF86UTILS_TRUE@
+XF86MISC_CFLAGS = @XF86MISC_CFLAGS@
+XF86MISC_LIBS = @XF86MISC_LIBS@
+XF86VIDMODE_CFLAGS = @XF86VIDMODE_CFLAGS@
+XF86VIDMODE_LIBS = @XF86VIDMODE_LIBS@
 XGLMODULES_CFLAGS = @XGLMODULES_CFLAGS@
 XGLMODULES_LIBS = @XGLMODULES_LIBS@
 XGLXMODULES_CFLAGS = @XGLXMODULES_CFLAGS@
 XGLXMODULES_LIBS = @XGLXMODULES_LIBS@
-XGLX_FALSE = @XGLX_FALSE@
 XGLX_LIBS = @XGLX_LIBS@
-XGLX_TRUE = @XGLX_TRUE@
-XGL_FALSE = @XGL_FALSE@
 XGL_LIBS = @XGL_LIBS@
 XGL_MODULE_PATH = @XGL_MODULE_PATH@
-XGL_TRUE = @XGL_TRUE@
-XINERAMA_FALSE = @XINERAMA_FALSE@
-XINERAMA_TRUE = @XINERAMA_TRUE@
-XINPUT_FALSE = @XINPUT_FALSE@
-XINPUT_TRUE = @XINPUT_TRUE@
 XKB_BASE_DIRECTORY = @XKB_BASE_DIRECTORY@
 XKB_BIN_DIRECTORY = @XKB_BIN_DIRECTORY@
 XKB_COMPILED_DIR = @XKB_COMPILED_DIR@
@@ -409,50 +314,25 @@ XLIB_CFLAGS = @XLIB_CFLAGS@
 XLIB_LIBS = @XLIB_LIBS@
 XNESTMODULES_CFLAGS = @XNESTMODULES_CFLAGS@
 XNESTMODULES_LIBS = @XNESTMODULES_LIBS@
-XNEST_FALSE = @XNEST_FALSE@
 XNEST_LIBS = @XNEST_LIBS@
-XNEST_TRUE = @XNEST_TRUE@
 XORGCFG_DEP_CFLAGS = @XORGCFG_DEP_CFLAGS@
 XORGCFG_DEP_LIBS = @XORGCFG_DEP_LIBS@
 XORGCONFIG_DEP_CFLAGS = @XORGCONFIG_DEP_CFLAGS@
 XORGCONFIG_DEP_LIBS = @XORGCONFIG_DEP_LIBS@
-XORG_BUS_FREEBSDPCI_FALSE = @XORG_BUS_FREEBSDPCI_FALSE@
-XORG_BUS_FREEBSDPCI_TRUE = @XORG_BUS_FREEBSDPCI_TRUE@
-XORG_BUS_IX86PCI_FALSE = @XORG_BUS_IX86PCI_FALSE@
-XORG_BUS_IX86PCI_TRUE = @XORG_BUS_IX86PCI_TRUE@
-XORG_BUS_LINUXPCI_FALSE = @XORG_BUS_LINUXPCI_FALSE@
-XORG_BUS_LINUXPCI_TRUE = @XORG_BUS_LINUXPCI_TRUE@
-XORG_BUS_NETBSDPCI_FALSE = @XORG_BUS_NETBSDPCI_FALSE@
-XORG_BUS_NETBSDPCI_TRUE = @XORG_BUS_NETBSDPCI_TRUE@
-XORG_BUS_PPCPCI_FALSE = @XORG_BUS_PPCPCI_FALSE@
-XORG_BUS_PPCPCI_TRUE = @XORG_BUS_PPCPCI_TRUE@
-XORG_BUS_SPARCPCI_FALSE = @XORG_BUS_SPARCPCI_FALSE@
-XORG_BUS_SPARCPCI_TRUE = @XORG_BUS_SPARCPCI_TRUE@
-XORG_BUS_SPARC_FALSE = @XORG_BUS_SPARC_FALSE@
-XORG_BUS_SPARC_TRUE = @XORG_BUS_SPARC_TRUE@
 XORG_CFLAGS = @XORG_CFLAGS@
 XORG_CORE_LIBS = @XORG_CORE_LIBS@
-XORG_FALSE = @XORG_FALSE@
 XORG_INCS = @XORG_INCS@
 XORG_LIBS = @XORG_LIBS@
-XORG_LOADER_SPARC_FALSE = @XORG_LOADER_SPARC_FALSE@
-XORG_LOADER_SPARC_TRUE = @XORG_LOADER_SPARC_TRUE@
+XORG_MODULES_CFLAGS = @XORG_MODULES_CFLAGS@
+XORG_MODULES_LIBS = @XORG_MODULES_LIBS@
 XORG_OS = @XORG_OS@
-XORG_OS_KBD = @XORG_OS_KBD@
 XORG_OS_SUBDIR = @XORG_OS_SUBDIR@
-XORG_TRUE = @XORG_TRUE@
 XPRINTPROTO_CFLAGS = @XPRINTPROTO_CFLAGS@
 XPRINTPROTO_LIBS = @XPRINTPROTO_LIBS@
 XPRINT_CFLAGS = @XPRINT_CFLAGS@
-XPRINT_FALSE = @XPRINT_FALSE@
 XPRINT_LIBS = @XPRINT_LIBS@
-XPRINT_TRUE = @XPRINT_TRUE@
-XP_USE_FREETYPE_FALSE = @XP_USE_FREETYPE_FALSE@
-XP_USE_FREETYPE_TRUE = @XP_USE_FREETYPE_TRUE@
 XRESEXAMPLES_DEP_CFLAGS = @XRESEXAMPLES_DEP_CFLAGS@
 XRESEXAMPLES_DEP_LIBS = @XRESEXAMPLES_DEP_LIBS@
-XSDLSERVER_FALSE = @XSDLSERVER_FALSE@
-XSDLSERVER_TRUE = @XSDLSERVER_TRUE@
 XSDL_INCS = @XSDL_INCS@
 XSDL_LIBS = @XSDL_LIBS@
 XSERVERCFLAGS_CFLAGS = @XSERVERCFLAGS_CFLAGS@
@@ -460,50 +340,26 @@ XSERVERCFLAGS_LIBS = @XSERVERCFLAGS_LIBS@
 XSERVERLIBS_CFLAGS = @XSERVERLIBS_CFLAGS@
 XSERVERLIBS_LIBS = @XSERVERLIBS_LIBS@
 XSERVER_LIBS = @XSERVER_LIBS@
-XTRAP_FALSE = @XTRAP_FALSE@
-XTRAP_TRUE = @XTRAP_TRUE@
+XSP_CFLAGS = @XSP_CFLAGS@
+XSP_LIBS = @XSP_LIBS@
 XTSTEXAMPLES_DEP_CFLAGS = @XTSTEXAMPLES_DEP_CFLAGS@
 XTSTEXAMPLES_DEP_LIBS = @XTSTEXAMPLES_DEP_LIBS@
-XVFB_FALSE = @XVFB_FALSE@
 XVFB_LIBS = @XVFB_LIBS@
-XVFB_TRUE = @XVFB_TRUE@
-XVMC_FALSE = @XVMC_FALSE@
-XVMC_TRUE = @XVMC_TRUE@
-XV_FALSE = @XV_FALSE@
-XV_TRUE = @XV_TRUE@
 XWINMODULES_CFLAGS = @XWINMODULES_CFLAGS@
 XWINMODULES_LIBS = @XWINMODULES_LIBS@
-XWIN_CLIPBOARD_FALSE = @XWIN_CLIPBOARD_FALSE@
-XWIN_CLIPBOARD_TRUE = @XWIN_CLIPBOARD_TRUE@
-XWIN_FALSE = @XWIN_FALSE@
-XWIN_GLX_WINDOWS_FALSE = @XWIN_GLX_WINDOWS_FALSE@
-XWIN_GLX_WINDOWS_TRUE = @XWIN_GLX_WINDOWS_TRUE@
 XWIN_LIBS = @XWIN_LIBS@
-XWIN_MULTIWINDOWEXTWM_FALSE = @XWIN_MULTIWINDOWEXTWM_FALSE@
-XWIN_MULTIWINDOWEXTWM_TRUE = @XWIN_MULTIWINDOWEXTWM_TRUE@
-XWIN_MULTIWINDOW_FALSE = @XWIN_MULTIWINDOW_FALSE@
-XWIN_MULTIWINDOW_TRUE = @XWIN_MULTIWINDOW_TRUE@
-XWIN_NATIVEGDI_FALSE = @XWIN_NATIVEGDI_FALSE@
-XWIN_NATIVEGDI_TRUE = @XWIN_NATIVEGDI_TRUE@
-XWIN_PRIMARYFB_FALSE = @XWIN_PRIMARYFB_FALSE@
-XWIN_PRIMARYFB_TRUE = @XWIN_PRIMARYFB_TRUE@
-XWIN_RANDR_FALSE = @XWIN_RANDR_FALSE@
-XWIN_RANDR_TRUE = @XWIN_RANDR_TRUE@
 XWIN_SERVER_NAME = @XWIN_SERVER_NAME@
 XWIN_SYSTEM_LIBS = @XWIN_SYSTEM_LIBS@
-XWIN_TRUE = @XWIN_TRUE@
-XWIN_XV_FALSE = @XWIN_XV_FALSE@
-XWIN_XV_TRUE = @XWIN_XV_TRUE@
 YACC = @YACC@
 YFLAGS = @YFLAGS@
 __XCONFIGFILE__ = @__XCONFIGFILE__@
+abs_builddir = @abs_builddir@
+abs_srcdir = @abs_srcdir@
+abs_top_builddir = @abs_top_builddir@
+abs_top_srcdir = @abs_top_srcdir@
 ac_ct_CC = @ac_ct_CC@
 ac_ct_CXX = @ac_ct_CXX@
 ac_ct_F77 = @ac_ct_F77@
-am__fastdepCC_FALSE = @am__fastdepCC_FALSE@
-am__fastdepCC_TRUE = @am__fastdepCC_TRUE@
-am__fastdepCXX_FALSE = @am__fastdepCXX_FALSE@
-am__fastdepCXX_TRUE = @am__fastdepCXX_TRUE@
 am__include = @am__include@
 am__leading_dot = @am__leading_dot@
 am__quote = @am__quote@
@@ -515,6 +371,7 @@ build_alias = @build_alias@
 build_cpu = @build_cpu@
 build_os = @build_os@
 build_vendor = @build_vendor@
+builddir = @builddir@
 datadir = @datadir@
 datarootdir = @datarootdir@
 docdir = @docdir@
@@ -548,18 +405,22 @@ psdir = @psdir@
 sbindir = @sbindir@
 sdkdir = @sdkdir@
 sharedstatedir = @sharedstatedir@
+srcdir = @srcdir@
 sysconfdir = @sysconfdir@
 target_alias = @target_alias@
+top_builddir = @top_builddir@
+top_srcdir = @top_srcdir@
 xglmoduledir = @xglmoduledir@
 xpconfigdir = @xpconfigdir@
-noinst_LTLIBRARIES = libfb.la libfbmmx.la
+noinst_LTLIBRARIES = libfb.la libwfb.la libfbmmx.la
 INCLUDES = \
 	-I$(top_srcdir)/hw/xfree86/os-support \
 	-I$(top_srcdir)/hw/xfree86/os-support/bus \
 	-I$(top_srcdir)/hw/xfree86/common
 
-AM_CFLAGS = $(DIX_CFLAGS) $(am__append_1)
-@XORG_TRUE@sdk_HEADERS = fb.h fbrop.h fbpseudocolor.h fboverlay.h
+AM_CFLAGS = $(DIX_CFLAGS)
+@XORG_TRUE@sdk_HEADERS = fb.h fbrop.h fbpseudocolor.h fboverlay.h wfbrename.h
+libfb_la_CFLAGS = $(AM_CFLAGS) $(am__append_1)
 @MMX_CAPABLE_TRUE@libfbmmx_la_CFLAGS = \
 @MMX_CAPABLE_TRUE@	$(DIX_CFLAGS)				\
 @MMX_CAPABLE_TRUE@	-DUSE_MMX				\
@@ -569,6 +430,7 @@ AM_CFLAGS = $(DIX_CFLAGS) $(am__append_1)
 @MMX_CAPABLE_TRUE@	--param inline-unit-growth=10000	\
 @MMX_CAPABLE_TRUE@        --param large-function-growth=10000
 
+libwfb_la_CFLAGS = $(AM_CFLAGS) -DFB_ACCESS_WRAPPER
 libfbmmx_la_SOURCES = \
 	fbmmx.c		\
 	fbmmx.h
@@ -597,6 +459,9 @@ libfb_la_SOURCES = \
 	fboverlay.c	\
 	fboverlay.h	\
 	fbpict.c	\
+	fbarmv6.c	\
+	fbarmv6.h	\
+	fbarmv6_internal.h \
 	fbpict.h	\
 	fbpixmap.c	\
 	fbpoint.c	\
@@ -616,6 +481,7 @@ libfb_la_SOURCES = \
 	fbedge.c	\
 	fbedgeimp.h
 
+libwfb_la_SOURCES = $(libfb_la_SOURCES)
 libfb_la_LIBADD = libfbmmx.la
 EXTRA_DIST = fbcmap.c
 all: all-am
@@ -661,9 +527,11 @@ clean-noinstLTLIBRARIES:
 	  rm -f "$${dir}/so_locations"; \
 	done
 libfb.la: $(libfb_la_OBJECTS) $(libfb_la_DEPENDENCIES) 
-	$(LINK)  $(libfb_la_LDFLAGS) $(libfb_la_OBJECTS) $(libfb_la_LIBADD) $(LIBS)
+	$(libfb_la_LINK)  $(libfb_la_OBJECTS) $(libfb_la_LIBADD) $(LIBS)
 libfbmmx.la: $(libfbmmx_la_OBJECTS) $(libfbmmx_la_DEPENDENCIES) 
-	$(LINK)  $(libfbmmx_la_LDFLAGS) $(libfbmmx_la_OBJECTS) $(libfbmmx_la_LIBADD) $(LIBS)
+	$(libfbmmx_la_LINK)  $(libfbmmx_la_OBJECTS) $(libfbmmx_la_LIBADD) $(LIBS)
+libwfb.la: $(libwfb_la_OBJECTS) $(libwfb_la_DEPENDENCIES) 
+	$(libwfb_la_LINK)  $(libwfb_la_OBJECTS) $(libwfb_la_LIBADD) $(LIBS)
 
 mostlyclean-compile:
 	-rm -f *.$(OBJEXT)
@@ -671,81 +539,588 @@ mostlyclean-compile:
 distclean-compile:
 	-rm -f *.tab.c
 
-@AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/fb24_32.Plo@am__quote@
-@AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/fballpriv.Plo@am__quote@
-@AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/fbarc.Plo@am__quote@
-@AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/fbbits.Plo@am__quote@
-@AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/fbblt.Plo@am__quote@
-@AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/fbbltone.Plo@am__quote@
-@AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/fbbstore.Plo@am__quote@
-@AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/fbcompose.Plo@am__quote@
-@AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/fbcopy.Plo@am__quote@
-@AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/fbedge.Plo@am__quote@
-@AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/fbfill.Plo@am__quote@
-@AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/fbfillrect.Plo@am__quote@
-@AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/fbfillsp.Plo@am__quote@
-@AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/fbgc.Plo@am__quote@
-@AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/fbgetsp.Plo@am__quote@
-@AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/fbglyph.Plo@am__quote@
-@AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/fbimage.Plo@am__quote@
-@AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/fbline.Plo@am__quote@
-@AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/fboverlay.Plo@am__quote@
-@AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/fbpict.Plo@am__quote@
-@AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/fbpixmap.Plo@am__quote@
-@AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/fbpoint.Plo@am__quote@
-@AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/fbpseudocolor.Plo@am__quote@
-@AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/fbpush.Plo@am__quote@
-@AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/fbscreen.Plo@am__quote@
-@AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/fbseg.Plo@am__quote@
-@AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/fbsetsp.Plo@am__quote@
-@AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/fbsolid.Plo@am__quote@
-@AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/fbstipple.Plo@am__quote@
-@AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/fbtile.Plo@am__quote@
-@AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/fbtrap.Plo@am__quote@
-@AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/fbutil.Plo@am__quote@
-@AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/fbwindow.Plo@am__quote@
+@AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/libfb_la-fb24_32.Plo@am__quote@
+@AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/libfb_la-fballpriv.Plo@am__quote@
+@AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/libfb_la-fbarc.Plo@am__quote@
+@AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/libfb_la-fbarmv6.Plo@am__quote@
+@AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/libfb_la-fbbits.Plo@am__quote@
+@AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/libfb_la-fbblt.Plo@am__quote@
+@AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/libfb_la-fbbltone.Plo@am__quote@
+@AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/libfb_la-fbbstore.Plo@am__quote@
+@AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/libfb_la-fbcompose.Plo@am__quote@
+@AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/libfb_la-fbcopy.Plo@am__quote@
+@AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/libfb_la-fbedge.Plo@am__quote@
+@AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/libfb_la-fbfill.Plo@am__quote@
+@AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/libfb_la-fbfillrect.Plo@am__quote@
+@AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/libfb_la-fbfillsp.Plo@am__quote@
+@AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/libfb_la-fbgc.Plo@am__quote@
+@AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/libfb_la-fbgetsp.Plo@am__quote@
+@AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/libfb_la-fbglyph.Plo@am__quote@
+@AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/libfb_la-fbimage.Plo@am__quote@
+@AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/libfb_la-fbline.Plo@am__quote@
+@AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/libfb_la-fboverlay.Plo@am__quote@
+@AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/libfb_la-fbpict.Plo@am__quote@
+@AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/libfb_la-fbpixmap.Plo@am__quote@
+@AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/libfb_la-fbpoint.Plo@am__quote@
+@AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/libfb_la-fbpseudocolor.Plo@am__quote@
+@AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/libfb_la-fbpush.Plo@am__quote@
+@AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/libfb_la-fbscreen.Plo@am__quote@
+@AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/libfb_la-fbseg.Plo@am__quote@
+@AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/libfb_la-fbsetsp.Plo@am__quote@
+@AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/libfb_la-fbsolid.Plo@am__quote@
+@AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/libfb_la-fbstipple.Plo@am__quote@
+@AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/libfb_la-fbtile.Plo@am__quote@
+@AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/libfb_la-fbtrap.Plo@am__quote@
+@AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/libfb_la-fbutil.Plo@am__quote@
+@AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/libfb_la-fbwindow.Plo@am__quote@
 @AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/libfbmmx_la-fbmmx.Plo@am__quote@
+@AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/libwfb_la-fb24_32.Plo@am__quote@
+@AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/libwfb_la-fballpriv.Plo@am__quote@
+@AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/libwfb_la-fbarc.Plo@am__quote@
+@AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/libwfb_la-fbarmv6.Plo@am__quote@
+@AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/libwfb_la-fbbits.Plo@am__quote@
+@AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/libwfb_la-fbblt.Plo@am__quote@
+@AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/libwfb_la-fbbltone.Plo@am__quote@
+@AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/libwfb_la-fbbstore.Plo@am__quote@
+@AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/libwfb_la-fbcompose.Plo@am__quote@
+@AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/libwfb_la-fbcopy.Plo@am__quote@
+@AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/libwfb_la-fbedge.Plo@am__quote@
+@AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/libwfb_la-fbfill.Plo@am__quote@
+@AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/libwfb_la-fbfillrect.Plo@am__quote@
+@AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/libwfb_la-fbfillsp.Plo@am__quote@
+@AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/libwfb_la-fbgc.Plo@am__quote@
+@AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/libwfb_la-fbgetsp.Plo@am__quote@
+@AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/libwfb_la-fbglyph.Plo@am__quote@
+@AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/libwfb_la-fbimage.Plo@am__quote@
+@AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/libwfb_la-fbline.Plo@am__quote@
+@AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/libwfb_la-fboverlay.Plo@am__quote@
+@AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/libwfb_la-fbpict.Plo@am__quote@
+@AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/libwfb_la-fbpixmap.Plo@am__quote@
+@AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/libwfb_la-fbpoint.Plo@am__quote@
+@AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/libwfb_la-fbpseudocolor.Plo@am__quote@
+@AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/libwfb_la-fbpush.Plo@am__quote@
+@AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/libwfb_la-fbscreen.Plo@am__quote@
+@AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/libwfb_la-fbseg.Plo@am__quote@
+@AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/libwfb_la-fbsetsp.Plo@am__quote@
+@AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/libwfb_la-fbsolid.Plo@am__quote@
+@AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/libwfb_la-fbstipple.Plo@am__quote@
+@AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/libwfb_la-fbtile.Plo@am__quote@
+@AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/libwfb_la-fbtrap.Plo@am__quote@
+@AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/libwfb_la-fbutil.Plo@am__quote@
+@AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/libwfb_la-fbwindow.Plo@am__quote@
 
 .c.o:
-@am__fastdepCC_TRUE@	if $(COMPILE) -MT $@ -MD -MP -MF "$(DEPDIR)/$*.Tpo" -c -o $@ $<; \
-@am__fastdepCC_TRUE@	then mv -f "$(DEPDIR)/$*.Tpo" "$(DEPDIR)/$*.Po"; else rm -f "$(DEPDIR)/$*.Tpo"; exit 1; fi
+@am__fastdepCC_TRUE@	$(COMPILE) -MT $@ -MD -MP -MF $(DEPDIR)/$*.Tpo -c -o $@ $<
+@am__fastdepCC_TRUE@	mv -f $(DEPDIR)/$*.Tpo $(DEPDIR)/$*.Po
 @AMDEP_TRUE@@am__fastdepCC_FALSE@	source='$<' object='$@' libtool=no @AMDEPBACKSLASH@
 @AMDEP_TRUE@@am__fastdepCC_FALSE@	DEPDIR=$(DEPDIR) $(CCDEPMODE) $(depcomp) @AMDEPBACKSLASH@
 @am__fastdepCC_FALSE@	$(COMPILE) -c $<
 
 .c.obj:
-@am__fastdepCC_TRUE@	if $(COMPILE) -MT $@ -MD -MP -MF "$(DEPDIR)/$*.Tpo" -c -o $@ `$(CYGPATH_W) '$<'`; \
-@am__fastdepCC_TRUE@	then mv -f "$(DEPDIR)/$*.Tpo" "$(DEPDIR)/$*.Po"; else rm -f "$(DEPDIR)/$*.Tpo"; exit 1; fi
+@am__fastdepCC_TRUE@	$(COMPILE) -MT $@ -MD -MP -MF $(DEPDIR)/$*.Tpo -c -o $@ `$(CYGPATH_W) '$<'`
+@am__fastdepCC_TRUE@	mv -f $(DEPDIR)/$*.Tpo $(DEPDIR)/$*.Po
 @AMDEP_TRUE@@am__fastdepCC_FALSE@	source='$<' object='$@' libtool=no @AMDEPBACKSLASH@
 @AMDEP_TRUE@@am__fastdepCC_FALSE@	DEPDIR=$(DEPDIR) $(CCDEPMODE) $(depcomp) @AMDEPBACKSLASH@
 @am__fastdepCC_FALSE@	$(COMPILE) -c `$(CYGPATH_W) '$<'`
 
 .c.lo:
-@am__fastdepCC_TRUE@	if $(LTCOMPILE) -MT $@ -MD -MP -MF "$(DEPDIR)/$*.Tpo" -c -o $@ $<; \
-@am__fastdepCC_TRUE@	then mv -f "$(DEPDIR)/$*.Tpo" "$(DEPDIR)/$*.Plo"; else rm -f "$(DEPDIR)/$*.Tpo"; exit 1; fi
+@am__fastdepCC_TRUE@	$(LTCOMPILE) -MT $@ -MD -MP -MF $(DEPDIR)/$*.Tpo -c -o $@ $<
+@am__fastdepCC_TRUE@	mv -f $(DEPDIR)/$*.Tpo $(DEPDIR)/$*.Plo
 @AMDEP_TRUE@@am__fastdepCC_FALSE@	source='$<' object='$@' libtool=yes @AMDEPBACKSLASH@
 @AMDEP_TRUE@@am__fastdepCC_FALSE@	DEPDIR=$(DEPDIR) $(CCDEPMODE) $(depcomp) @AMDEPBACKSLASH@
 @am__fastdepCC_FALSE@	$(LTCOMPILE) -c -o $@ $<
 
+libfb_la-fb24_32.lo: fb24_32.c
+@am__fastdepCC_TRUE@	$(LIBTOOL) --tag=CC $(AM_LIBTOOLFLAGS) $(LIBTOOLFLAGS) --mode=compile $(CC) $(DEFS) $(DEFAULT_INCLUDES) $(INCLUDES) $(AM_CPPFLAGS) $(CPPFLAGS) $(libfb_la_CFLAGS) $(CFLAGS) -MT libfb_la-fb24_32.lo -MD -MP -MF $(DEPDIR)/libfb_la-fb24_32.Tpo -c -o libfb_la-fb24_32.lo `test -f 'fb24_32.c' || echo '$(srcdir)/'`fb24_32.c
+@am__fastdepCC_TRUE@	mv -f $(DEPDIR)/libfb_la-fb24_32.Tpo $(DEPDIR)/libfb_la-fb24_32.Plo
+@AMDEP_TRUE@@am__fastdepCC_FALSE@	source='fb24_32.c' object='libfb_la-fb24_32.lo' libtool=yes @AMDEPBACKSLASH@
+@AMDEP_TRUE@@am__fastdepCC_FALSE@	DEPDIR=$(DEPDIR) $(CCDEPMODE) $(depcomp) @AMDEPBACKSLASH@
+@am__fastdepCC_FALSE@	$(LIBTOOL) --tag=CC $(AM_LIBTOOLFLAGS) $(LIBTOOLFLAGS) --mode=compile $(CC) $(DEFS) $(DEFAULT_INCLUDES) $(INCLUDES) $(AM_CPPFLAGS) $(CPPFLAGS) $(libfb_la_CFLAGS) $(CFLAGS) -c -o libfb_la-fb24_32.lo `test -f 'fb24_32.c' || echo '$(srcdir)/'`fb24_32.c
+
+libfb_la-fballpriv.lo: fballpriv.c
+@am__fastdepCC_TRUE@	$(LIBTOOL) --tag=CC $(AM_LIBTOOLFLAGS) $(LIBTOOLFLAGS) --mode=compile $(CC) $(DEFS) $(DEFAULT_INCLUDES) $(INCLUDES) $(AM_CPPFLAGS) $(CPPFLAGS) $(libfb_la_CFLAGS) $(CFLAGS) -MT libfb_la-fballpriv.lo -MD -MP -MF $(DEPDIR)/libfb_la-fballpriv.Tpo -c -o libfb_la-fballpriv.lo `test -f 'fballpriv.c' || echo '$(srcdir)/'`fballpriv.c
+@am__fastdepCC_TRUE@	mv -f $(DEPDIR)/libfb_la-fballpriv.Tpo $(DEPDIR)/libfb_la-fballpriv.Plo
+@AMDEP_TRUE@@am__fastdepCC_FALSE@	source='fballpriv.c' object='libfb_la-fballpriv.lo' libtool=yes @AMDEPBACKSLASH@
+@AMDEP_TRUE@@am__fastdepCC_FALSE@	DEPDIR=$(DEPDIR) $(CCDEPMODE) $(depcomp) @AMDEPBACKSLASH@
+@am__fastdepCC_FALSE@	$(LIBTOOL) --tag=CC $(AM_LIBTOOLFLAGS) $(LIBTOOLFLAGS) --mode=compile $(CC) $(DEFS) $(DEFAULT_INCLUDES) $(INCLUDES) $(AM_CPPFLAGS) $(CPPFLAGS) $(libfb_la_CFLAGS) $(CFLAGS) -c -o libfb_la-fballpriv.lo `test -f 'fballpriv.c' || echo '$(srcdir)/'`fballpriv.c
+
+libfb_la-fbarc.lo: fbarc.c
+@am__fastdepCC_TRUE@	$(LIBTOOL) --tag=CC $(AM_LIBTOOLFLAGS) $(LIBTOOLFLAGS) --mode=compile $(CC) $(DEFS) $(DEFAULT_INCLUDES) $(INCLUDES) $(AM_CPPFLAGS) $(CPPFLAGS) $(libfb_la_CFLAGS) $(CFLAGS) -MT libfb_la-fbarc.lo -MD -MP -MF $(DEPDIR)/libfb_la-fbarc.Tpo -c -o libfb_la-fbarc.lo `test -f 'fbarc.c' || echo '$(srcdir)/'`fbarc.c
+@am__fastdepCC_TRUE@	mv -f $(DEPDIR)/libfb_la-fbarc.Tpo $(DEPDIR)/libfb_la-fbarc.Plo
+@AMDEP_TRUE@@am__fastdepCC_FALSE@	source='fbarc.c' object='libfb_la-fbarc.lo' libtool=yes @AMDEPBACKSLASH@
+@AMDEP_TRUE@@am__fastdepCC_FALSE@	DEPDIR=$(DEPDIR) $(CCDEPMODE) $(depcomp) @AMDEPBACKSLASH@
+@am__fastdepCC_FALSE@	$(LIBTOOL) --tag=CC $(AM_LIBTOOLFLAGS) $(LIBTOOLFLAGS) --mode=compile $(CC) $(DEFS) $(DEFAULT_INCLUDES) $(INCLUDES) $(AM_CPPFLAGS) $(CPPFLAGS) $(libfb_la_CFLAGS) $(CFLAGS) -c -o libfb_la-fbarc.lo `test -f 'fbarc.c' || echo '$(srcdir)/'`fbarc.c
+
+libfb_la-fbbits.lo: fbbits.c
+@am__fastdepCC_TRUE@	$(LIBTOOL) --tag=CC $(AM_LIBTOOLFLAGS) $(LIBTOOLFLAGS) --mode=compile $(CC) $(DEFS) $(DEFAULT_INCLUDES) $(INCLUDES) $(AM_CPPFLAGS) $(CPPFLAGS) $(libfb_la_CFLAGS) $(CFLAGS) -MT libfb_la-fbbits.lo -MD -MP -MF $(DEPDIR)/libfb_la-fbbits.Tpo -c -o libfb_la-fbbits.lo `test -f 'fbbits.c' || echo '$(srcdir)/'`fbbits.c
+@am__fastdepCC_TRUE@	mv -f $(DEPDIR)/libfb_la-fbbits.Tpo $(DEPDIR)/libfb_la-fbbits.Plo
+@AMDEP_TRUE@@am__fastdepCC_FALSE@	source='fbbits.c' object='libfb_la-fbbits.lo' libtool=yes @AMDEPBACKSLASH@
+@AMDEP_TRUE@@am__fastdepCC_FALSE@	DEPDIR=$(DEPDIR) $(CCDEPMODE) $(depcomp) @AMDEPBACKSLASH@
+@am__fastdepCC_FALSE@	$(LIBTOOL) --tag=CC $(AM_LIBTOOLFLAGS) $(LIBTOOLFLAGS) --mode=compile $(CC) $(DEFS) $(DEFAULT_INCLUDES) $(INCLUDES) $(AM_CPPFLAGS) $(CPPFLAGS) $(libfb_la_CFLAGS) $(CFLAGS) -c -o libfb_la-fbbits.lo `test -f 'fbbits.c' || echo '$(srcdir)/'`fbbits.c
+
+libfb_la-fbblt.lo: fbblt.c
+@am__fastdepCC_TRUE@	$(LIBTOOL) --tag=CC $(AM_LIBTOOLFLAGS) $(LIBTOOLFLAGS) --mode=compile $(CC) $(DEFS) $(DEFAULT_INCLUDES) $(INCLUDES) $(AM_CPPFLAGS) $(CPPFLAGS) $(libfb_la_CFLAGS) $(CFLAGS) -MT libfb_la-fbblt.lo -MD -MP -MF $(DEPDIR)/libfb_la-fbblt.Tpo -c -o libfb_la-fbblt.lo `test -f 'fbblt.c' || echo '$(srcdir)/'`fbblt.c
+@am__fastdepCC_TRUE@	mv -f $(DEPDIR)/libfb_la-fbblt.Tpo $(DEPDIR)/libfb_la-fbblt.Plo
+@AMDEP_TRUE@@am__fastdepCC_FALSE@	source='fbblt.c' object='libfb_la-fbblt.lo' libtool=yes @AMDEPBACKSLASH@
+@AMDEP_TRUE@@am__fastdepCC_FALSE@	DEPDIR=$(DEPDIR) $(CCDEPMODE) $(depcomp) @AMDEPBACKSLASH@
+@am__fastdepCC_FALSE@	$(LIBTOOL) --tag=CC $(AM_LIBTOOLFLAGS) $(LIBTOOLFLAGS) --mode=compile $(CC) $(DEFS) $(DEFAULT_INCLUDES) $(INCLUDES) $(AM_CPPFLAGS) $(CPPFLAGS) $(libfb_la_CFLAGS) $(CFLAGS) -c -o libfb_la-fbblt.lo `test -f 'fbblt.c' || echo '$(srcdir)/'`fbblt.c
+
+libfb_la-fbbltone.lo: fbbltone.c
+@am__fastdepCC_TRUE@	$(LIBTOOL) --tag=CC $(AM_LIBTOOLFLAGS) $(LIBTOOLFLAGS) --mode=compile $(CC) $(DEFS) $(DEFAULT_INCLUDES) $(INCLUDES) $(AM_CPPFLAGS) $(CPPFLAGS) $(libfb_la_CFLAGS) $(CFLAGS) -MT libfb_la-fbbltone.lo -MD -MP -MF $(DEPDIR)/libfb_la-fbbltone.Tpo -c -o libfb_la-fbbltone.lo `test -f 'fbbltone.c' || echo '$(srcdir)/'`fbbltone.c
+@am__fastdepCC_TRUE@	mv -f $(DEPDIR)/libfb_la-fbbltone.Tpo $(DEPDIR)/libfb_la-fbbltone.Plo
+@AMDEP_TRUE@@am__fastdepCC_FALSE@	source='fbbltone.c' object='libfb_la-fbbltone.lo' libtool=yes @AMDEPBACKSLASH@
+@AMDEP_TRUE@@am__fastdepCC_FALSE@	DEPDIR=$(DEPDIR) $(CCDEPMODE) $(depcomp) @AMDEPBACKSLASH@
+@am__fastdepCC_FALSE@	$(LIBTOOL) --tag=CC $(AM_LIBTOOLFLAGS) $(LIBTOOLFLAGS) --mode=compile $(CC) $(DEFS) $(DEFAULT_INCLUDES) $(INCLUDES) $(AM_CPPFLAGS) $(CPPFLAGS) $(libfb_la_CFLAGS) $(CFLAGS) -c -o libfb_la-fbbltone.lo `test -f 'fbbltone.c' || echo '$(srcdir)/'`fbbltone.c
+
+libfb_la-fbbstore.lo: fbbstore.c
+@am__fastdepCC_TRUE@	$(LIBTOOL) --tag=CC $(AM_LIBTOOLFLAGS) $(LIBTOOLFLAGS) --mode=compile $(CC) $(DEFS) $(DEFAULT_INCLUDES) $(INCLUDES) $(AM_CPPFLAGS) $(CPPFLAGS) $(libfb_la_CFLAGS) $(CFLAGS) -MT libfb_la-fbbstore.lo -MD -MP -MF $(DEPDIR)/libfb_la-fbbstore.Tpo -c -o libfb_la-fbbstore.lo `test -f 'fbbstore.c' || echo '$(srcdir)/'`fbbstore.c
+@am__fastdepCC_TRUE@	mv -f $(DEPDIR)/libfb_la-fbbstore.Tpo $(DEPDIR)/libfb_la-fbbstore.Plo
+@AMDEP_TRUE@@am__fastdepCC_FALSE@	source='fbbstore.c' object='libfb_la-fbbstore.lo' libtool=yes @AMDEPBACKSLASH@
+@AMDEP_TRUE@@am__fastdepCC_FALSE@	DEPDIR=$(DEPDIR) $(CCDEPMODE) $(depcomp) @AMDEPBACKSLASH@
+@am__fastdepCC_FALSE@	$(LIBTOOL) --tag=CC $(AM_LIBTOOLFLAGS) $(LIBTOOLFLAGS) --mode=compile $(CC) $(DEFS) $(DEFAULT_INCLUDES) $(INCLUDES) $(AM_CPPFLAGS) $(CPPFLAGS) $(libfb_la_CFLAGS) $(CFLAGS) -c -o libfb_la-fbbstore.lo `test -f 'fbbstore.c' || echo '$(srcdir)/'`fbbstore.c
+
+libfb_la-fbcompose.lo: fbcompose.c
+@am__fastdepCC_TRUE@	$(LIBTOOL) --tag=CC $(AM_LIBTOOLFLAGS) $(LIBTOOLFLAGS) --mode=compile $(CC) $(DEFS) $(DEFAULT_INCLUDES) $(INCLUDES) $(AM_CPPFLAGS) $(CPPFLAGS) $(libfb_la_CFLAGS) $(CFLAGS) -MT libfb_la-fbcompose.lo -MD -MP -MF $(DEPDIR)/libfb_la-fbcompose.Tpo -c -o libfb_la-fbcompose.lo `test -f 'fbcompose.c' || echo '$(srcdir)/'`fbcompose.c
+@am__fastdepCC_TRUE@	mv -f $(DEPDIR)/libfb_la-fbcompose.Tpo $(DEPDIR)/libfb_la-fbcompose.Plo
+@AMDEP_TRUE@@am__fastdepCC_FALSE@	source='fbcompose.c' object='libfb_la-fbcompose.lo' libtool=yes @AMDEPBACKSLASH@
+@AMDEP_TRUE@@am__fastdepCC_FALSE@	DEPDIR=$(DEPDIR) $(CCDEPMODE) $(depcomp) @AMDEPBACKSLASH@
+@am__fastdepCC_FALSE@	$(LIBTOOL) --tag=CC $(AM_LIBTOOLFLAGS) $(LIBTOOLFLAGS) --mode=compile $(CC) $(DEFS) $(DEFAULT_INCLUDES) $(INCLUDES) $(AM_CPPFLAGS) $(CPPFLAGS) $(libfb_la_CFLAGS) $(CFLAGS) -c -o libfb_la-fbcompose.lo `test -f 'fbcompose.c' || echo '$(srcdir)/'`fbcompose.c
+
+libfb_la-fbcopy.lo: fbcopy.c
+@am__fastdepCC_TRUE@	$(LIBTOOL) --tag=CC $(AM_LIBTOOLFLAGS) $(LIBTOOLFLAGS) --mode=compile $(CC) $(DEFS) $(DEFAULT_INCLUDES) $(INCLUDES) $(AM_CPPFLAGS) $(CPPFLAGS) $(libfb_la_CFLAGS) $(CFLAGS) -MT libfb_la-fbcopy.lo -MD -MP -MF $(DEPDIR)/libfb_la-fbcopy.Tpo -c -o libfb_la-fbcopy.lo `test -f 'fbcopy.c' || echo '$(srcdir)/'`fbcopy.c
+@am__fastdepCC_TRUE@	mv -f $(DEPDIR)/libfb_la-fbcopy.Tpo $(DEPDIR)/libfb_la-fbcopy.Plo
+@AMDEP_TRUE@@am__fastdepCC_FALSE@	source='fbcopy.c' object='libfb_la-fbcopy.lo' libtool=yes @AMDEPBACKSLASH@
+@AMDEP_TRUE@@am__fastdepCC_FALSE@	DEPDIR=$(DEPDIR) $(CCDEPMODE) $(depcomp) @AMDEPBACKSLASH@
+@am__fastdepCC_FALSE@	$(LIBTOOL) --tag=CC $(AM_LIBTOOLFLAGS) $(LIBTOOLFLAGS) --mode=compile $(CC) $(DEFS) $(DEFAULT_INCLUDES) $(INCLUDES) $(AM_CPPFLAGS) $(CPPFLAGS) $(libfb_la_CFLAGS) $(CFLAGS) -c -o libfb_la-fbcopy.lo `test -f 'fbcopy.c' || echo '$(srcdir)/'`fbcopy.c
+
+libfb_la-fbfill.lo: fbfill.c
+@am__fastdepCC_TRUE@	$(LIBTOOL) --tag=CC $(AM_LIBTOOLFLAGS) $(LIBTOOLFLAGS) --mode=compile $(CC) $(DEFS) $(DEFAULT_INCLUDES) $(INCLUDES) $(AM_CPPFLAGS) $(CPPFLAGS) $(libfb_la_CFLAGS) $(CFLAGS) -MT libfb_la-fbfill.lo -MD -MP -MF $(DEPDIR)/libfb_la-fbfill.Tpo -c -o libfb_la-fbfill.lo `test -f 'fbfill.c' || echo '$(srcdir)/'`fbfill.c
+@am__fastdepCC_TRUE@	mv -f $(DEPDIR)/libfb_la-fbfill.Tpo $(DEPDIR)/libfb_la-fbfill.Plo
+@AMDEP_TRUE@@am__fastdepCC_FALSE@	source='fbfill.c' object='libfb_la-fbfill.lo' libtool=yes @AMDEPBACKSLASH@
+@AMDEP_TRUE@@am__fastdepCC_FALSE@	DEPDIR=$(DEPDIR) $(CCDEPMODE) $(depcomp) @AMDEPBACKSLASH@
+@am__fastdepCC_FALSE@	$(LIBTOOL) --tag=CC $(AM_LIBTOOLFLAGS) $(LIBTOOLFLAGS) --mode=compile $(CC) $(DEFS) $(DEFAULT_INCLUDES) $(INCLUDES) $(AM_CPPFLAGS) $(CPPFLAGS) $(libfb_la_CFLAGS) $(CFLAGS) -c -o libfb_la-fbfill.lo `test -f 'fbfill.c' || echo '$(srcdir)/'`fbfill.c
+
+libfb_la-fbfillrect.lo: fbfillrect.c
+@am__fastdepCC_TRUE@	$(LIBTOOL) --tag=CC $(AM_LIBTOOLFLAGS) $(LIBTOOLFLAGS) --mode=compile $(CC) $(DEFS) $(DEFAULT_INCLUDES) $(INCLUDES) $(AM_CPPFLAGS) $(CPPFLAGS) $(libfb_la_CFLAGS) $(CFLAGS) -MT libfb_la-fbfillrect.lo -MD -MP -MF $(DEPDIR)/libfb_la-fbfillrect.Tpo -c -o libfb_la-fbfillrect.lo `test -f 'fbfillrect.c' || echo '$(srcdir)/'`fbfillrect.c
+@am__fastdepCC_TRUE@	mv -f $(DEPDIR)/libfb_la-fbfillrect.Tpo $(DEPDIR)/libfb_la-fbfillrect.Plo
+@AMDEP_TRUE@@am__fastdepCC_FALSE@	source='fbfillrect.c' object='libfb_la-fbfillrect.lo' libtool=yes @AMDEPBACKSLASH@
+@AMDEP_TRUE@@am__fastdepCC_FALSE@	DEPDIR=$(DEPDIR) $(CCDEPMODE) $(depcomp) @AMDEPBACKSLASH@
+@am__fastdepCC_FALSE@	$(LIBTOOL) --tag=CC $(AM_LIBTOOLFLAGS) $(LIBTOOLFLAGS) --mode=compile $(CC) $(DEFS) $(DEFAULT_INCLUDES) $(INCLUDES) $(AM_CPPFLAGS) $(CPPFLAGS) $(libfb_la_CFLAGS) $(CFLAGS) -c -o libfb_la-fbfillrect.lo `test -f 'fbfillrect.c' || echo '$(srcdir)/'`fbfillrect.c
+
+libfb_la-fbfillsp.lo: fbfillsp.c
+@am__fastdepCC_TRUE@	$(LIBTOOL) --tag=CC $(AM_LIBTOOLFLAGS) $(LIBTOOLFLAGS) --mode=compile $(CC) $(DEFS) $(DEFAULT_INCLUDES) $(INCLUDES) $(AM_CPPFLAGS) $(CPPFLAGS) $(libfb_la_CFLAGS) $(CFLAGS) -MT libfb_la-fbfillsp.lo -MD -MP -MF $(DEPDIR)/libfb_la-fbfillsp.Tpo -c -o libfb_la-fbfillsp.lo `test -f 'fbfillsp.c' || echo '$(srcdir)/'`fbfillsp.c
+@am__fastdepCC_TRUE@	mv -f $(DEPDIR)/libfb_la-fbfillsp.Tpo $(DEPDIR)/libfb_la-fbfillsp.Plo
+@AMDEP_TRUE@@am__fastdepCC_FALSE@	source='fbfillsp.c' object='libfb_la-fbfillsp.lo' libtool=yes @AMDEPBACKSLASH@
+@AMDEP_TRUE@@am__fastdepCC_FALSE@	DEPDIR=$(DEPDIR) $(CCDEPMODE) $(depcomp) @AMDEPBACKSLASH@
+@am__fastdepCC_FALSE@	$(LIBTOOL) --tag=CC $(AM_LIBTOOLFLAGS) $(LIBTOOLFLAGS) --mode=compile $(CC) $(DEFS) $(DEFAULT_INCLUDES) $(INCLUDES) $(AM_CPPFLAGS) $(CPPFLAGS) $(libfb_la_CFLAGS) $(CFLAGS) -c -o libfb_la-fbfillsp.lo `test -f 'fbfillsp.c' || echo '$(srcdir)/'`fbfillsp.c
+
+libfb_la-fbgc.lo: fbgc.c
+@am__fastdepCC_TRUE@	$(LIBTOOL) --tag=CC $(AM_LIBTOOLFLAGS) $(LIBTOOLFLAGS) --mode=compile $(CC) $(DEFS) $(DEFAULT_INCLUDES) $(INCLUDES) $(AM_CPPFLAGS) $(CPPFLAGS) $(libfb_la_CFLAGS) $(CFLAGS) -MT libfb_la-fbgc.lo -MD -MP -MF $(DEPDIR)/libfb_la-fbgc.Tpo -c -o libfb_la-fbgc.lo `test -f 'fbgc.c' || echo '$(srcdir)/'`fbgc.c
+@am__fastdepCC_TRUE@	mv -f $(DEPDIR)/libfb_la-fbgc.Tpo $(DEPDIR)/libfb_la-fbgc.Plo
+@AMDEP_TRUE@@am__fastdepCC_FALSE@	source='fbgc.c' object='libfb_la-fbgc.lo' libtool=yes @AMDEPBACKSLASH@
+@AMDEP_TRUE@@am__fastdepCC_FALSE@	DEPDIR=$(DEPDIR) $(CCDEPMODE) $(depcomp) @AMDEPBACKSLASH@
+@am__fastdepCC_FALSE@	$(LIBTOOL) --tag=CC $(AM_LIBTOOLFLAGS) $(LIBTOOLFLAGS) --mode=compile $(CC) $(DEFS) $(DEFAULT_INCLUDES) $(INCLUDES) $(AM_CPPFLAGS) $(CPPFLAGS) $(libfb_la_CFLAGS) $(CFLAGS) -c -o libfb_la-fbgc.lo `test -f 'fbgc.c' || echo '$(srcdir)/'`fbgc.c
+
+libfb_la-fbgetsp.lo: fbgetsp.c
+@am__fastdepCC_TRUE@	$(LIBTOOL) --tag=CC $(AM_LIBTOOLFLAGS) $(LIBTOOLFLAGS) --mode=compile $(CC) $(DEFS) $(DEFAULT_INCLUDES) $(INCLUDES) $(AM_CPPFLAGS) $(CPPFLAGS) $(libfb_la_CFLAGS) $(CFLAGS) -MT libfb_la-fbgetsp.lo -MD -MP -MF $(DEPDIR)/libfb_la-fbgetsp.Tpo -c -o libfb_la-fbgetsp.lo `test -f 'fbgetsp.c' || echo '$(srcdir)/'`fbgetsp.c
+@am__fastdepCC_TRUE@	mv -f $(DEPDIR)/libfb_la-fbgetsp.Tpo $(DEPDIR)/libfb_la-fbgetsp.Plo
+@AMDEP_TRUE@@am__fastdepCC_FALSE@	source='fbgetsp.c' object='libfb_la-fbgetsp.lo' libtool=yes @AMDEPBACKSLASH@
+@AMDEP_TRUE@@am__fastdepCC_FALSE@	DEPDIR=$(DEPDIR) $(CCDEPMODE) $(depcomp) @AMDEPBACKSLASH@
+@am__fastdepCC_FALSE@	$(LIBTOOL) --tag=CC $(AM_LIBTOOLFLAGS) $(LIBTOOLFLAGS) --mode=compile $(CC) $(DEFS) $(DEFAULT_INCLUDES) $(INCLUDES) $(AM_CPPFLAGS) $(CPPFLAGS) $(libfb_la_CFLAGS) $(CFLAGS) -c -o libfb_la-fbgetsp.lo `test -f 'fbgetsp.c' || echo '$(srcdir)/'`fbgetsp.c
+
+libfb_la-fbglyph.lo: fbglyph.c
+@am__fastdepCC_TRUE@	$(LIBTOOL) --tag=CC $(AM_LIBTOOLFLAGS) $(LIBTOOLFLAGS) --mode=compile $(CC) $(DEFS) $(DEFAULT_INCLUDES) $(INCLUDES) $(AM_CPPFLAGS) $(CPPFLAGS) $(libfb_la_CFLAGS) $(CFLAGS) -MT libfb_la-fbglyph.lo -MD -MP -MF $(DEPDIR)/libfb_la-fbglyph.Tpo -c -o libfb_la-fbglyph.lo `test -f 'fbglyph.c' || echo '$(srcdir)/'`fbglyph.c
+@am__fastdepCC_TRUE@	mv -f $(DEPDIR)/libfb_la-fbglyph.Tpo $(DEPDIR)/libfb_la-fbglyph.Plo
+@AMDEP_TRUE@@am__fastdepCC_FALSE@	source='fbglyph.c' object='libfb_la-fbglyph.lo' libtool=yes @AMDEPBACKSLASH@
+@AMDEP_TRUE@@am__fastdepCC_FALSE@	DEPDIR=$(DEPDIR) $(CCDEPMODE) $(depcomp) @AMDEPBACKSLASH@
+@am__fastdepCC_FALSE@	$(LIBTOOL) --tag=CC $(AM_LIBTOOLFLAGS) $(LIBTOOLFLAGS) --mode=compile $(CC) $(DEFS) $(DEFAULT_INCLUDES) $(INCLUDES) $(AM_CPPFLAGS) $(CPPFLAGS) $(libfb_la_CFLAGS) $(CFLAGS) -c -o libfb_la-fbglyph.lo `test -f 'fbglyph.c' || echo '$(srcdir)/'`fbglyph.c
+
+libfb_la-fbimage.lo: fbimage.c
+@am__fastdepCC_TRUE@	$(LIBTOOL) --tag=CC $(AM_LIBTOOLFLAGS) $(LIBTOOLFLAGS) --mode=compile $(CC) $(DEFS) $(DEFAULT_INCLUDES) $(INCLUDES) $(AM_CPPFLAGS) $(CPPFLAGS) $(libfb_la_CFLAGS) $(CFLAGS) -MT libfb_la-fbimage.lo -MD -MP -MF $(DEPDIR)/libfb_la-fbimage.Tpo -c -o libfb_la-fbimage.lo `test -f 'fbimage.c' || echo '$(srcdir)/'`fbimage.c
+@am__fastdepCC_TRUE@	mv -f $(DEPDIR)/libfb_la-fbimage.Tpo $(DEPDIR)/libfb_la-fbimage.Plo
+@AMDEP_TRUE@@am__fastdepCC_FALSE@	source='fbimage.c' object='libfb_la-fbimage.lo' libtool=yes @AMDEPBACKSLASH@
+@AMDEP_TRUE@@am__fastdepCC_FALSE@	DEPDIR=$(DEPDIR) $(CCDEPMODE) $(depcomp) @AMDEPBACKSLASH@
+@am__fastdepCC_FALSE@	$(LIBTOOL) --tag=CC $(AM_LIBTOOLFLAGS) $(LIBTOOLFLAGS) --mode=compile $(CC) $(DEFS) $(DEFAULT_INCLUDES) $(INCLUDES) $(AM_CPPFLAGS) $(CPPFLAGS) $(libfb_la_CFLAGS) $(CFLAGS) -c -o libfb_la-fbimage.lo `test -f 'fbimage.c' || echo '$(srcdir)/'`fbimage.c
+
+libfb_la-fbline.lo: fbline.c
+@am__fastdepCC_TRUE@	$(LIBTOOL) --tag=CC $(AM_LIBTOOLFLAGS) $(LIBTOOLFLAGS) --mode=compile $(CC) $(DEFS) $(DEFAULT_INCLUDES) $(INCLUDES) $(AM_CPPFLAGS) $(CPPFLAGS) $(libfb_la_CFLAGS) $(CFLAGS) -MT libfb_la-fbline.lo -MD -MP -MF $(DEPDIR)/libfb_la-fbline.Tpo -c -o libfb_la-fbline.lo `test -f 'fbline.c' || echo '$(srcdir)/'`fbline.c
+@am__fastdepCC_TRUE@	mv -f $(DEPDIR)/libfb_la-fbline.Tpo $(DEPDIR)/libfb_la-fbline.Plo
+@AMDEP_TRUE@@am__fastdepCC_FALSE@	source='fbline.c' object='libfb_la-fbline.lo' libtool=yes @AMDEPBACKSLASH@
+@AMDEP_TRUE@@am__fastdepCC_FALSE@	DEPDIR=$(DEPDIR) $(CCDEPMODE) $(depcomp) @AMDEPBACKSLASH@
+@am__fastdepCC_FALSE@	$(LIBTOOL) --tag=CC $(AM_LIBTOOLFLAGS) $(LIBTOOLFLAGS) --mode=compile $(CC) $(DEFS) $(DEFAULT_INCLUDES) $(INCLUDES) $(AM_CPPFLAGS) $(CPPFLAGS) $(libfb_la_CFLAGS) $(CFLAGS) -c -o libfb_la-fbline.lo `test -f 'fbline.c' || echo '$(srcdir)/'`fbline.c
+
+libfb_la-fboverlay.lo: fboverlay.c
+@am__fastdepCC_TRUE@	$(LIBTOOL) --tag=CC $(AM_LIBTOOLFLAGS) $(LIBTOOLFLAGS) --mode=compile $(CC) $(DEFS) $(DEFAULT_INCLUDES) $(INCLUDES) $(AM_CPPFLAGS) $(CPPFLAGS) $(libfb_la_CFLAGS) $(CFLAGS) -MT libfb_la-fboverlay.lo -MD -MP -MF $(DEPDIR)/libfb_la-fboverlay.Tpo -c -o libfb_la-fboverlay.lo `test -f 'fboverlay.c' || echo '$(srcdir)/'`fboverlay.c
+@am__fastdepCC_TRUE@	mv -f $(DEPDIR)/libfb_la-fboverlay.Tpo $(DEPDIR)/libfb_la-fboverlay.Plo
+@AMDEP_TRUE@@am__fastdepCC_FALSE@	source='fboverlay.c' object='libfb_la-fboverlay.lo' libtool=yes @AMDEPBACKSLASH@
+@AMDEP_TRUE@@am__fastdepCC_FALSE@	DEPDIR=$(DEPDIR) $(CCDEPMODE) $(depcomp) @AMDEPBACKSLASH@
+@am__fastdepCC_FALSE@	$(LIBTOOL) --tag=CC $(AM_LIBTOOLFLAGS) $(LIBTOOLFLAGS) --mode=compile $(CC) $(DEFS) $(DEFAULT_INCLUDES) $(INCLUDES) $(AM_CPPFLAGS) $(CPPFLAGS) $(libfb_la_CFLAGS) $(CFLAGS) -c -o libfb_la-fboverlay.lo `test -f 'fboverlay.c' || echo '$(srcdir)/'`fboverlay.c
+
+libfb_la-fbpict.lo: fbpict.c
+@am__fastdepCC_TRUE@	$(LIBTOOL) --tag=CC $(AM_LIBTOOLFLAGS) $(LIBTOOLFLAGS) --mode=compile $(CC) $(DEFS) $(DEFAULT_INCLUDES) $(INCLUDES) $(AM_CPPFLAGS) $(CPPFLAGS) $(libfb_la_CFLAGS) $(CFLAGS) -MT libfb_la-fbpict.lo -MD -MP -MF $(DEPDIR)/libfb_la-fbpict.Tpo -c -o libfb_la-fbpict.lo `test -f 'fbpict.c' || echo '$(srcdir)/'`fbpict.c
+@am__fastdepCC_TRUE@	mv -f $(DEPDIR)/libfb_la-fbpict.Tpo $(DEPDIR)/libfb_la-fbpict.Plo
+@AMDEP_TRUE@@am__fastdepCC_FALSE@	source='fbpict.c' object='libfb_la-fbpict.lo' libtool=yes @AMDEPBACKSLASH@
+@AMDEP_TRUE@@am__fastdepCC_FALSE@	DEPDIR=$(DEPDIR) $(CCDEPMODE) $(depcomp) @AMDEPBACKSLASH@
+@am__fastdepCC_FALSE@	$(LIBTOOL) --tag=CC $(AM_LIBTOOLFLAGS) $(LIBTOOLFLAGS) --mode=compile $(CC) $(DEFS) $(DEFAULT_INCLUDES) $(INCLUDES) $(AM_CPPFLAGS) $(CPPFLAGS) $(libfb_la_CFLAGS) $(CFLAGS) -c -o libfb_la-fbpict.lo `test -f 'fbpict.c' || echo '$(srcdir)/'`fbpict.c
+
+libfb_la-fbarmv6.lo: fbarmv6.c
+@am__fastdepCC_TRUE@	$(LIBTOOL) --tag=CC $(AM_LIBTOOLFLAGS) $(LIBTOOLFLAGS) --mode=compile $(CC) $(DEFS) $(DEFAULT_INCLUDES) $(INCLUDES) $(AM_CPPFLAGS) $(CPPFLAGS) $(libfb_la_CFLAGS) $(CFLAGS) -MT libfb_la-fbarmv6.lo -MD -MP -MF $(DEPDIR)/libfb_la-fbarmv6.Tpo -c -o libfb_la-fbarmv6.lo `test -f 'fbarmv6.c' || echo '$(srcdir)/'`fbarmv6.c
+@am__fastdepCC_TRUE@	mv -f $(DEPDIR)/libfb_la-fbarmv6.Tpo $(DEPDIR)/libfb_la-fbarmv6.Plo
+@AMDEP_TRUE@@am__fastdepCC_FALSE@	source='fbarmv6.c' object='libfb_la-fbarmv6.lo' libtool=yes @AMDEPBACKSLASH@
+@AMDEP_TRUE@@am__fastdepCC_FALSE@	DEPDIR=$(DEPDIR) $(CCDEPMODE) $(depcomp) @AMDEPBACKSLASH@
+@am__fastdepCC_FALSE@	$(LIBTOOL) --tag=CC $(AM_LIBTOOLFLAGS) $(LIBTOOLFLAGS) --mode=compile $(CC) $(DEFS) $(DEFAULT_INCLUDES) $(INCLUDES) $(AM_CPPFLAGS) $(CPPFLAGS) $(libfb_la_CFLAGS) $(CFLAGS) -c -o libfb_la-fbarmv6.lo `test -f 'fbarmv6.c' || echo '$(srcdir)/'`fbarmv6.c
+
+libfb_la-fbpixmap.lo: fbpixmap.c
+@am__fastdepCC_TRUE@	$(LIBTOOL) --tag=CC $(AM_LIBTOOLFLAGS) $(LIBTOOLFLAGS) --mode=compile $(CC) $(DEFS) $(DEFAULT_INCLUDES) $(INCLUDES) $(AM_CPPFLAGS) $(CPPFLAGS) $(libfb_la_CFLAGS) $(CFLAGS) -MT libfb_la-fbpixmap.lo -MD -MP -MF $(DEPDIR)/libfb_la-fbpixmap.Tpo -c -o libfb_la-fbpixmap.lo `test -f 'fbpixmap.c' || echo '$(srcdir)/'`fbpixmap.c
+@am__fastdepCC_TRUE@	mv -f $(DEPDIR)/libfb_la-fbpixmap.Tpo $(DEPDIR)/libfb_la-fbpixmap.Plo
+@AMDEP_TRUE@@am__fastdepCC_FALSE@	source='fbpixmap.c' object='libfb_la-fbpixmap.lo' libtool=yes @AMDEPBACKSLASH@
+@AMDEP_TRUE@@am__fastdepCC_FALSE@	DEPDIR=$(DEPDIR) $(CCDEPMODE) $(depcomp) @AMDEPBACKSLASH@
+@am__fastdepCC_FALSE@	$(LIBTOOL) --tag=CC $(AM_LIBTOOLFLAGS) $(LIBTOOLFLAGS) --mode=compile $(CC) $(DEFS) $(DEFAULT_INCLUDES) $(INCLUDES) $(AM_CPPFLAGS) $(CPPFLAGS) $(libfb_la_CFLAGS) $(CFLAGS) -c -o libfb_la-fbpixmap.lo `test -f 'fbpixmap.c' || echo '$(srcdir)/'`fbpixmap.c
+
+libfb_la-fbpoint.lo: fbpoint.c
+@am__fastdepCC_TRUE@	$(LIBTOOL) --tag=CC $(AM_LIBTOOLFLAGS) $(LIBTOOLFLAGS) --mode=compile $(CC) $(DEFS) $(DEFAULT_INCLUDES) $(INCLUDES) $(AM_CPPFLAGS) $(CPPFLAGS) $(libfb_la_CFLAGS) $(CFLAGS) -MT libfb_la-fbpoint.lo -MD -MP -MF $(DEPDIR)/libfb_la-fbpoint.Tpo -c -o libfb_la-fbpoint.lo `test -f 'fbpoint.c' || echo '$(srcdir)/'`fbpoint.c
+@am__fastdepCC_TRUE@	mv -f $(DEPDIR)/libfb_la-fbpoint.Tpo $(DEPDIR)/libfb_la-fbpoint.Plo
+@AMDEP_TRUE@@am__fastdepCC_FALSE@	source='fbpoint.c' object='libfb_la-fbpoint.lo' libtool=yes @AMDEPBACKSLASH@
+@AMDEP_TRUE@@am__fastdepCC_FALSE@	DEPDIR=$(DEPDIR) $(CCDEPMODE) $(depcomp) @AMDEPBACKSLASH@
+@am__fastdepCC_FALSE@	$(LIBTOOL) --tag=CC $(AM_LIBTOOLFLAGS) $(LIBTOOLFLAGS) --mode=compile $(CC) $(DEFS) $(DEFAULT_INCLUDES) $(INCLUDES) $(AM_CPPFLAGS) $(CPPFLAGS) $(libfb_la_CFLAGS) $(CFLAGS) -c -o libfb_la-fbpoint.lo `test -f 'fbpoint.c' || echo '$(srcdir)/'`fbpoint.c
+
+libfb_la-fbpush.lo: fbpush.c
+@am__fastdepCC_TRUE@	$(LIBTOOL) --tag=CC $(AM_LIBTOOLFLAGS) $(LIBTOOLFLAGS) --mode=compile $(CC) $(DEFS) $(DEFAULT_INCLUDES) $(INCLUDES) $(AM_CPPFLAGS) $(CPPFLAGS) $(libfb_la_CFLAGS) $(CFLAGS) -MT libfb_la-fbpush.lo -MD -MP -MF $(DEPDIR)/libfb_la-fbpush.Tpo -c -o libfb_la-fbpush.lo `test -f 'fbpush.c' || echo '$(srcdir)/'`fbpush.c
+@am__fastdepCC_TRUE@	mv -f $(DEPDIR)/libfb_la-fbpush.Tpo $(DEPDIR)/libfb_la-fbpush.Plo
+@AMDEP_TRUE@@am__fastdepCC_FALSE@	source='fbpush.c' object='libfb_la-fbpush.lo' libtool=yes @AMDEPBACKSLASH@
+@AMDEP_TRUE@@am__fastdepCC_FALSE@	DEPDIR=$(DEPDIR) $(CCDEPMODE) $(depcomp) @AMDEPBACKSLASH@
+@am__fastdepCC_FALSE@	$(LIBTOOL) --tag=CC $(AM_LIBTOOLFLAGS) $(LIBTOOLFLAGS) --mode=compile $(CC) $(DEFS) $(DEFAULT_INCLUDES) $(INCLUDES) $(AM_CPPFLAGS) $(CPPFLAGS) $(libfb_la_CFLAGS) $(CFLAGS) -c -o libfb_la-fbpush.lo `test -f 'fbpush.c' || echo '$(srcdir)/'`fbpush.c
+
+libfb_la-fbscreen.lo: fbscreen.c
+@am__fastdepCC_TRUE@	$(LIBTOOL) --tag=CC $(AM_LIBTOOLFLAGS) $(LIBTOOLFLAGS) --mode=compile $(CC) $(DEFS) $(DEFAULT_INCLUDES) $(INCLUDES) $(AM_CPPFLAGS) $(CPPFLAGS) $(libfb_la_CFLAGS) $(CFLAGS) -MT libfb_la-fbscreen.lo -MD -MP -MF $(DEPDIR)/libfb_la-fbscreen.Tpo -c -o libfb_la-fbscreen.lo `test -f 'fbscreen.c' || echo '$(srcdir)/'`fbscreen.c
+@am__fastdepCC_TRUE@	mv -f $(DEPDIR)/libfb_la-fbscreen.Tpo $(DEPDIR)/libfb_la-fbscreen.Plo
+@AMDEP_TRUE@@am__fastdepCC_FALSE@	source='fbscreen.c' object='libfb_la-fbscreen.lo' libtool=yes @AMDEPBACKSLASH@
+@AMDEP_TRUE@@am__fastdepCC_FALSE@	DEPDIR=$(DEPDIR) $(CCDEPMODE) $(depcomp) @AMDEPBACKSLASH@
+@am__fastdepCC_FALSE@	$(LIBTOOL) --tag=CC $(AM_LIBTOOLFLAGS) $(LIBTOOLFLAGS) --mode=compile $(CC) $(DEFS) $(DEFAULT_INCLUDES) $(INCLUDES) $(AM_CPPFLAGS) $(CPPFLAGS) $(libfb_la_CFLAGS) $(CFLAGS) -c -o libfb_la-fbscreen.lo `test -f 'fbscreen.c' || echo '$(srcdir)/'`fbscreen.c
+
+libfb_la-fbseg.lo: fbseg.c
+@am__fastdepCC_TRUE@	$(LIBTOOL) --tag=CC $(AM_LIBTOOLFLAGS) $(LIBTOOLFLAGS) --mode=compile $(CC) $(DEFS) $(DEFAULT_INCLUDES) $(INCLUDES) $(AM_CPPFLAGS) $(CPPFLAGS) $(libfb_la_CFLAGS) $(CFLAGS) -MT libfb_la-fbseg.lo -MD -MP -MF $(DEPDIR)/libfb_la-fbseg.Tpo -c -o libfb_la-fbseg.lo `test -f 'fbseg.c' || echo '$(srcdir)/'`fbseg.c
+@am__fastdepCC_TRUE@	mv -f $(DEPDIR)/libfb_la-fbseg.Tpo $(DEPDIR)/libfb_la-fbseg.Plo
+@AMDEP_TRUE@@am__fastdepCC_FALSE@	source='fbseg.c' object='libfb_la-fbseg.lo' libtool=yes @AMDEPBACKSLASH@
+@AMDEP_TRUE@@am__fastdepCC_FALSE@	DEPDIR=$(DEPDIR) $(CCDEPMODE) $(depcomp) @AMDEPBACKSLASH@
+@am__fastdepCC_FALSE@	$(LIBTOOL) --tag=CC $(AM_LIBTOOLFLAGS) $(LIBTOOLFLAGS) --mode=compile $(CC) $(DEFS) $(DEFAULT_INCLUDES) $(INCLUDES) $(AM_CPPFLAGS) $(CPPFLAGS) $(libfb_la_CFLAGS) $(CFLAGS) -c -o libfb_la-fbseg.lo `test -f 'fbseg.c' || echo '$(srcdir)/'`fbseg.c
+
+libfb_la-fbsetsp.lo: fbsetsp.c
+@am__fastdepCC_TRUE@	$(LIBTOOL) --tag=CC $(AM_LIBTOOLFLAGS) $(LIBTOOLFLAGS) --mode=compile $(CC) $(DEFS) $(DEFAULT_INCLUDES) $(INCLUDES) $(AM_CPPFLAGS) $(CPPFLAGS) $(libfb_la_CFLAGS) $(CFLAGS) -MT libfb_la-fbsetsp.lo -MD -MP -MF $(DEPDIR)/libfb_la-fbsetsp.Tpo -c -o libfb_la-fbsetsp.lo `test -f 'fbsetsp.c' || echo '$(srcdir)/'`fbsetsp.c
+@am__fastdepCC_TRUE@	mv -f $(DEPDIR)/libfb_la-fbsetsp.Tpo $(DEPDIR)/libfb_la-fbsetsp.Plo
+@AMDEP_TRUE@@am__fastdepCC_FALSE@	source='fbsetsp.c' object='libfb_la-fbsetsp.lo' libtool=yes @AMDEPBACKSLASH@
+@AMDEP_TRUE@@am__fastdepCC_FALSE@	DEPDIR=$(DEPDIR) $(CCDEPMODE) $(depcomp) @AMDEPBACKSLASH@
+@am__fastdepCC_FALSE@	$(LIBTOOL) --tag=CC $(AM_LIBTOOLFLAGS) $(LIBTOOLFLAGS) --mode=compile $(CC) $(DEFS) $(DEFAULT_INCLUDES) $(INCLUDES) $(AM_CPPFLAGS) $(CPPFLAGS) $(libfb_la_CFLAGS) $(CFLAGS) -c -o libfb_la-fbsetsp.lo `test -f 'fbsetsp.c' || echo '$(srcdir)/'`fbsetsp.c
+
+libfb_la-fbsolid.lo: fbsolid.c
+@am__fastdepCC_TRUE@	$(LIBTOOL) --tag=CC $(AM_LIBTOOLFLAGS) $(LIBTOOLFLAGS) --mode=compile $(CC) $(DEFS) $(DEFAULT_INCLUDES) $(INCLUDES) $(AM_CPPFLAGS) $(CPPFLAGS) $(libfb_la_CFLAGS) $(CFLAGS) -MT libfb_la-fbsolid.lo -MD -MP -MF $(DEPDIR)/libfb_la-fbsolid.Tpo -c -o libfb_la-fbsolid.lo `test -f 'fbsolid.c' || echo '$(srcdir)/'`fbsolid.c
+@am__fastdepCC_TRUE@	mv -f $(DEPDIR)/libfb_la-fbsolid.Tpo $(DEPDIR)/libfb_la-fbsolid.Plo
+@AMDEP_TRUE@@am__fastdepCC_FALSE@	source='fbsolid.c' object='libfb_la-fbsolid.lo' libtool=yes @AMDEPBACKSLASH@
+@AMDEP_TRUE@@am__fastdepCC_FALSE@	DEPDIR=$(DEPDIR) $(CCDEPMODE) $(depcomp) @AMDEPBACKSLASH@
+@am__fastdepCC_FALSE@	$(LIBTOOL) --tag=CC $(AM_LIBTOOLFLAGS) $(LIBTOOLFLAGS) --mode=compile $(CC) $(DEFS) $(DEFAULT_INCLUDES) $(INCLUDES) $(AM_CPPFLAGS) $(CPPFLAGS) $(libfb_la_CFLAGS) $(CFLAGS) -c -o libfb_la-fbsolid.lo `test -f 'fbsolid.c' || echo '$(srcdir)/'`fbsolid.c
+
+libfb_la-fbstipple.lo: fbstipple.c
+@am__fastdepCC_TRUE@	$(LIBTOOL) --tag=CC $(AM_LIBTOOLFLAGS) $(LIBTOOLFLAGS) --mode=compile $(CC) $(DEFS) $(DEFAULT_INCLUDES) $(INCLUDES) $(AM_CPPFLAGS) $(CPPFLAGS) $(libfb_la_CFLAGS) $(CFLAGS) -MT libfb_la-fbstipple.lo -MD -MP -MF $(DEPDIR)/libfb_la-fbstipple.Tpo -c -o libfb_la-fbstipple.lo `test -f 'fbstipple.c' || echo '$(srcdir)/'`fbstipple.c
+@am__fastdepCC_TRUE@	mv -f $(DEPDIR)/libfb_la-fbstipple.Tpo $(DEPDIR)/libfb_la-fbstipple.Plo
+@AMDEP_TRUE@@am__fastdepCC_FALSE@	source='fbstipple.c' object='libfb_la-fbstipple.lo' libtool=yes @AMDEPBACKSLASH@
+@AMDEP_TRUE@@am__fastdepCC_FALSE@	DEPDIR=$(DEPDIR) $(CCDEPMODE) $(depcomp) @AMDEPBACKSLASH@
+@am__fastdepCC_FALSE@	$(LIBTOOL) --tag=CC $(AM_LIBTOOLFLAGS) $(LIBTOOLFLAGS) --mode=compile $(CC) $(DEFS) $(DEFAULT_INCLUDES) $(INCLUDES) $(AM_CPPFLAGS) $(CPPFLAGS) $(libfb_la_CFLAGS) $(CFLAGS) -c -o libfb_la-fbstipple.lo `test -f 'fbstipple.c' || echo '$(srcdir)/'`fbstipple.c
+
+libfb_la-fbtile.lo: fbtile.c
+@am__fastdepCC_TRUE@	$(LIBTOOL) --tag=CC $(AM_LIBTOOLFLAGS) $(LIBTOOLFLAGS) --mode=compile $(CC) $(DEFS) $(DEFAULT_INCLUDES) $(INCLUDES) $(AM_CPPFLAGS) $(CPPFLAGS) $(libfb_la_CFLAGS) $(CFLAGS) -MT libfb_la-fbtile.lo -MD -MP -MF $(DEPDIR)/libfb_la-fbtile.Tpo -c -o libfb_la-fbtile.lo `test -f 'fbtile.c' || echo '$(srcdir)/'`fbtile.c
+@am__fastdepCC_TRUE@	mv -f $(DEPDIR)/libfb_la-fbtile.Tpo $(DEPDIR)/libfb_la-fbtile.Plo
+@AMDEP_TRUE@@am__fastdepCC_FALSE@	source='fbtile.c' object='libfb_la-fbtile.lo' libtool=yes @AMDEPBACKSLASH@
+@AMDEP_TRUE@@am__fastdepCC_FALSE@	DEPDIR=$(DEPDIR) $(CCDEPMODE) $(depcomp) @AMDEPBACKSLASH@
+@am__fastdepCC_FALSE@	$(LIBTOOL) --tag=CC $(AM_LIBTOOLFLAGS) $(LIBTOOLFLAGS) --mode=compile $(CC) $(DEFS) $(DEFAULT_INCLUDES) $(INCLUDES) $(AM_CPPFLAGS) $(CPPFLAGS) $(libfb_la_CFLAGS) $(CFLAGS) -c -o libfb_la-fbtile.lo `test -f 'fbtile.c' || echo '$(srcdir)/'`fbtile.c
+
+libfb_la-fbtrap.lo: fbtrap.c
+@am__fastdepCC_TRUE@	$(LIBTOOL) --tag=CC $(AM_LIBTOOLFLAGS) $(LIBTOOLFLAGS) --mode=compile $(CC) $(DEFS) $(DEFAULT_INCLUDES) $(INCLUDES) $(AM_CPPFLAGS) $(CPPFLAGS) $(libfb_la_CFLAGS) $(CFLAGS) -MT libfb_la-fbtrap.lo -MD -MP -MF $(DEPDIR)/libfb_la-fbtrap.Tpo -c -o libfb_la-fbtrap.lo `test -f 'fbtrap.c' || echo '$(srcdir)/'`fbtrap.c
+@am__fastdepCC_TRUE@	mv -f $(DEPDIR)/libfb_la-fbtrap.Tpo $(DEPDIR)/libfb_la-fbtrap.Plo
+@AMDEP_TRUE@@am__fastdepCC_FALSE@	source='fbtrap.c' object='libfb_la-fbtrap.lo' libtool=yes @AMDEPBACKSLASH@
+@AMDEP_TRUE@@am__fastdepCC_FALSE@	DEPDIR=$(DEPDIR) $(CCDEPMODE) $(depcomp) @AMDEPBACKSLASH@
+@am__fastdepCC_FALSE@	$(LIBTOOL) --tag=CC $(AM_LIBTOOLFLAGS) $(LIBTOOLFLAGS) --mode=compile $(CC) $(DEFS) $(DEFAULT_INCLUDES) $(INCLUDES) $(AM_CPPFLAGS) $(CPPFLAGS) $(libfb_la_CFLAGS) $(CFLAGS) -c -o libfb_la-fbtrap.lo `test -f 'fbtrap.c' || echo '$(srcdir)/'`fbtrap.c
+
+libfb_la-fbutil.lo: fbutil.c
+@am__fastdepCC_TRUE@	$(LIBTOOL) --tag=CC $(AM_LIBTOOLFLAGS) $(LIBTOOLFLAGS) --mode=compile $(CC) $(DEFS) $(DEFAULT_INCLUDES) $(INCLUDES) $(AM_CPPFLAGS) $(CPPFLAGS) $(libfb_la_CFLAGS) $(CFLAGS) -MT libfb_la-fbutil.lo -MD -MP -MF $(DEPDIR)/libfb_la-fbutil.Tpo -c -o libfb_la-fbutil.lo `test -f 'fbutil.c' || echo '$(srcdir)/'`fbutil.c
+@am__fastdepCC_TRUE@	mv -f $(DEPDIR)/libfb_la-fbutil.Tpo $(DEPDIR)/libfb_la-fbutil.Plo
+@AMDEP_TRUE@@am__fastdepCC_FALSE@	source='fbutil.c' object='libfb_la-fbutil.lo' libtool=yes @AMDEPBACKSLASH@
+@AMDEP_TRUE@@am__fastdepCC_FALSE@	DEPDIR=$(DEPDIR) $(CCDEPMODE) $(depcomp) @AMDEPBACKSLASH@
+@am__fastdepCC_FALSE@	$(LIBTOOL) --tag=CC $(AM_LIBTOOLFLAGS) $(LIBTOOLFLAGS) --mode=compile $(CC) $(DEFS) $(DEFAULT_INCLUDES) $(INCLUDES) $(AM_CPPFLAGS) $(CPPFLAGS) $(libfb_la_CFLAGS) $(CFLAGS) -c -o libfb_la-fbutil.lo `test -f 'fbutil.c' || echo '$(srcdir)/'`fbutil.c
+
+libfb_la-fbwindow.lo: fbwindow.c
+@am__fastdepCC_TRUE@	$(LIBTOOL) --tag=CC $(AM_LIBTOOLFLAGS) $(LIBTOOLFLAGS) --mode=compile $(CC) $(DEFS) $(DEFAULT_INCLUDES) $(INCLUDES) $(AM_CPPFLAGS) $(CPPFLAGS) $(libfb_la_CFLAGS) $(CFLAGS) -MT libfb_la-fbwindow.lo -MD -MP -MF $(DEPDIR)/libfb_la-fbwindow.Tpo -c -o libfb_la-fbwindow.lo `test -f 'fbwindow.c' || echo '$(srcdir)/'`fbwindow.c
+@am__fastdepCC_TRUE@	mv -f $(DEPDIR)/libfb_la-fbwindow.Tpo $(DEPDIR)/libfb_la-fbwindow.Plo
+@AMDEP_TRUE@@am__fastdepCC_FALSE@	source='fbwindow.c' object='libfb_la-fbwindow.lo' libtool=yes @AMDEPBACKSLASH@
+@AMDEP_TRUE@@am__fastdepCC_FALSE@	DEPDIR=$(DEPDIR) $(CCDEPMODE) $(depcomp) @AMDEPBACKSLASH@
+@am__fastdepCC_FALSE@	$(LIBTOOL) --tag=CC $(AM_LIBTOOLFLAGS) $(LIBTOOLFLAGS) --mode=compile $(CC) $(DEFS) $(DEFAULT_INCLUDES) $(INCLUDES) $(AM_CPPFLAGS) $(CPPFLAGS) $(libfb_la_CFLAGS) $(CFLAGS) -c -o libfb_la-fbwindow.lo `test -f 'fbwindow.c' || echo '$(srcdir)/'`fbwindow.c
+
+libfb_la-fbpseudocolor.lo: fbpseudocolor.c
+@am__fastdepCC_TRUE@	$(LIBTOOL) --tag=CC $(AM_LIBTOOLFLAGS) $(LIBTOOLFLAGS) --mode=compile $(CC) $(DEFS) $(DEFAULT_INCLUDES) $(INCLUDES) $(AM_CPPFLAGS) $(CPPFLAGS) $(libfb_la_CFLAGS) $(CFLAGS) -MT libfb_la-fbpseudocolor.lo -MD -MP -MF $(DEPDIR)/libfb_la-fbpseudocolor.Tpo -c -o libfb_la-fbpseudocolor.lo `test -f 'fbpseudocolor.c' || echo '$(srcdir)/'`fbpseudocolor.c
+@am__fastdepCC_TRUE@	mv -f $(DEPDIR)/libfb_la-fbpseudocolor.Tpo $(DEPDIR)/libfb_la-fbpseudocolor.Plo
+@AMDEP_TRUE@@am__fastdepCC_FALSE@	source='fbpseudocolor.c' object='libfb_la-fbpseudocolor.lo' libtool=yes @AMDEPBACKSLASH@
+@AMDEP_TRUE@@am__fastdepCC_FALSE@	DEPDIR=$(DEPDIR) $(CCDEPMODE) $(depcomp) @AMDEPBACKSLASH@
+@am__fastdepCC_FALSE@	$(LIBTOOL) --tag=CC $(AM_LIBTOOLFLAGS) $(LIBTOOLFLAGS) --mode=compile $(CC) $(DEFS) $(DEFAULT_INCLUDES) $(INCLUDES) $(AM_CPPFLAGS) $(CPPFLAGS) $(libfb_la_CFLAGS) $(CFLAGS) -c -o libfb_la-fbpseudocolor.lo `test -f 'fbpseudocolor.c' || echo '$(srcdir)/'`fbpseudocolor.c
+
+libfb_la-fbedge.lo: fbedge.c
+@am__fastdepCC_TRUE@	$(LIBTOOL) --tag=CC $(AM_LIBTOOLFLAGS) $(LIBTOOLFLAGS) --mode=compile $(CC) $(DEFS) $(DEFAULT_INCLUDES) $(INCLUDES) $(AM_CPPFLAGS) $(CPPFLAGS) $(libfb_la_CFLAGS) $(CFLAGS) -MT libfb_la-fbedge.lo -MD -MP -MF $(DEPDIR)/libfb_la-fbedge.Tpo -c -o libfb_la-fbedge.lo `test -f 'fbedge.c' || echo '$(srcdir)/'`fbedge.c
+@am__fastdepCC_TRUE@	mv -f $(DEPDIR)/libfb_la-fbedge.Tpo $(DEPDIR)/libfb_la-fbedge.Plo
+@AMDEP_TRUE@@am__fastdepCC_FALSE@	source='fbedge.c' object='libfb_la-fbedge.lo' libtool=yes @AMDEPBACKSLASH@
+@AMDEP_TRUE@@am__fastdepCC_FALSE@	DEPDIR=$(DEPDIR) $(CCDEPMODE) $(depcomp) @AMDEPBACKSLASH@
+@am__fastdepCC_FALSE@	$(LIBTOOL) --tag=CC $(AM_LIBTOOLFLAGS) $(LIBTOOLFLAGS) --mode=compile $(CC) $(DEFS) $(DEFAULT_INCLUDES) $(INCLUDES) $(AM_CPPFLAGS) $(CPPFLAGS) $(libfb_la_CFLAGS) $(CFLAGS) -c -o libfb_la-fbedge.lo `test -f 'fbedge.c' || echo '$(srcdir)/'`fbedge.c
+
 libfbmmx_la-fbmmx.lo: fbmmx.c
-@am__fastdepCC_TRUE@	if $(LIBTOOL) --tag=CC --mode=compile $(CC) $(DEFS) $(DEFAULT_INCLUDES) $(INCLUDES) $(AM_CPPFLAGS) $(CPPFLAGS) $(libfbmmx_la_CFLAGS) $(CFLAGS) -MT libfbmmx_la-fbmmx.lo -MD -MP -MF "$(DEPDIR)/libfbmmx_la-fbmmx.Tpo" -c -o libfbmmx_la-fbmmx.lo `test -f 'fbmmx.c' || echo '$(srcdir)/'`fbmmx.c; \
-@am__fastdepCC_TRUE@	then mv -f "$(DEPDIR)/libfbmmx_la-fbmmx.Tpo" "$(DEPDIR)/libfbmmx_la-fbmmx.Plo"; else rm -f "$(DEPDIR)/libfbmmx_la-fbmmx.Tpo"; exit 1; fi
+@am__fastdepCC_TRUE@	$(LIBTOOL) --tag=CC $(AM_LIBTOOLFLAGS) $(LIBTOOLFLAGS) --mode=compile $(CC) $(DEFS) $(DEFAULT_INCLUDES) $(INCLUDES) $(AM_CPPFLAGS) $(CPPFLAGS) $(libfbmmx_la_CFLAGS) $(CFLAGS) -MT libfbmmx_la-fbmmx.lo -MD -MP -MF $(DEPDIR)/libfbmmx_la-fbmmx.Tpo -c -o libfbmmx_la-fbmmx.lo `test -f 'fbmmx.c' || echo '$(srcdir)/'`fbmmx.c
+@am__fastdepCC_TRUE@	mv -f $(DEPDIR)/libfbmmx_la-fbmmx.Tpo $(DEPDIR)/libfbmmx_la-fbmmx.Plo
 @AMDEP_TRUE@@am__fastdepCC_FALSE@	source='fbmmx.c' object='libfbmmx_la-fbmmx.lo' libtool=yes @AMDEPBACKSLASH@
 @AMDEP_TRUE@@am__fastdepCC_FALSE@	DEPDIR=$(DEPDIR) $(CCDEPMODE) $(depcomp) @AMDEPBACKSLASH@
-@am__fastdepCC_FALSE@	$(LIBTOOL) --tag=CC --mode=compile $(CC) $(DEFS) $(DEFAULT_INCLUDES) $(INCLUDES) $(AM_CPPFLAGS) $(CPPFLAGS) $(libfbmmx_la_CFLAGS) $(CFLAGS) -c -o libfbmmx_la-fbmmx.lo `test -f 'fbmmx.c' || echo '$(srcdir)/'`fbmmx.c
+@am__fastdepCC_FALSE@	$(LIBTOOL) --tag=CC $(AM_LIBTOOLFLAGS) $(LIBTOOLFLAGS) --mode=compile $(CC) $(DEFS) $(DEFAULT_INCLUDES) $(INCLUDES) $(AM_CPPFLAGS) $(CPPFLAGS) $(libfbmmx_la_CFLAGS) $(CFLAGS) -c -o libfbmmx_la-fbmmx.lo `test -f 'fbmmx.c' || echo '$(srcdir)/'`fbmmx.c
+
+libwfb_la-fb24_32.lo: fb24_32.c
+@am__fastdepCC_TRUE@	$(LIBTOOL) --tag=CC $(AM_LIBTOOLFLAGS) $(LIBTOOLFLAGS) --mode=compile $(CC) $(DEFS) $(DEFAULT_INCLUDES) $(INCLUDES) $(AM_CPPFLAGS) $(CPPFLAGS) $(libwfb_la_CFLAGS) $(CFLAGS) -MT libwfb_la-fb24_32.lo -MD -MP -MF $(DEPDIR)/libwfb_la-fb24_32.Tpo -c -o libwfb_la-fb24_32.lo `test -f 'fb24_32.c' || echo '$(srcdir)/'`fb24_32.c
+@am__fastdepCC_TRUE@	mv -f $(DEPDIR)/libwfb_la-fb24_32.Tpo $(DEPDIR)/libwfb_la-fb24_32.Plo
+@AMDEP_TRUE@@am__fastdepCC_FALSE@	source='fb24_32.c' object='libwfb_la-fb24_32.lo' libtool=yes @AMDEPBACKSLASH@
+@AMDEP_TRUE@@am__fastdepCC_FALSE@	DEPDIR=$(DEPDIR) $(CCDEPMODE) $(depcomp) @AMDEPBACKSLASH@
+@am__fastdepCC_FALSE@	$(LIBTOOL) --tag=CC $(AM_LIBTOOLFLAGS) $(LIBTOOLFLAGS) --mode=compile $(CC) $(DEFS) $(DEFAULT_INCLUDES) $(INCLUDES) $(AM_CPPFLAGS) $(CPPFLAGS) $(libwfb_la_CFLAGS) $(CFLAGS) -c -o libwfb_la-fb24_32.lo `test -f 'fb24_32.c' || echo '$(srcdir)/'`fb24_32.c
+
+libwfb_la-fballpriv.lo: fballpriv.c
+@am__fastdepCC_TRUE@	$(LIBTOOL) --tag=CC $(AM_LIBTOOLFLAGS) $(LIBTOOLFLAGS) --mode=compile $(CC) $(DEFS) $(DEFAULT_INCLUDES) $(INCLUDES) $(AM_CPPFLAGS) $(CPPFLAGS) $(libwfb_la_CFLAGS) $(CFLAGS) -MT libwfb_la-fballpriv.lo -MD -MP -MF $(DEPDIR)/libwfb_la-fballpriv.Tpo -c -o libwfb_la-fballpriv.lo `test -f 'fballpriv.c' || echo '$(srcdir)/'`fballpriv.c
+@am__fastdepCC_TRUE@	mv -f $(DEPDIR)/libwfb_la-fballpriv.Tpo $(DEPDIR)/libwfb_la-fballpriv.Plo
+@AMDEP_TRUE@@am__fastdepCC_FALSE@	source='fballpriv.c' object='libwfb_la-fballpriv.lo' libtool=yes @AMDEPBACKSLASH@
+@AMDEP_TRUE@@am__fastdepCC_FALSE@	DEPDIR=$(DEPDIR) $(CCDEPMODE) $(depcomp) @AMDEPBACKSLASH@
+@am__fastdepCC_FALSE@	$(LIBTOOL) --tag=CC $(AM_LIBTOOLFLAGS) $(LIBTOOLFLAGS) --mode=compile $(CC) $(DEFS) $(DEFAULT_INCLUDES) $(INCLUDES) $(AM_CPPFLAGS) $(CPPFLAGS) $(libwfb_la_CFLAGS) $(CFLAGS) -c -o libwfb_la-fballpriv.lo `test -f 'fballpriv.c' || echo '$(srcdir)/'`fballpriv.c
+
+libwfb_la-fbarc.lo: fbarc.c
+@am__fastdepCC_TRUE@	$(LIBTOOL) --tag=CC $(AM_LIBTOOLFLAGS) $(LIBTOOLFLAGS) --mode=compile $(CC) $(DEFS) $(DEFAULT_INCLUDES) $(INCLUDES) $(AM_CPPFLAGS) $(CPPFLAGS) $(libwfb_la_CFLAGS) $(CFLAGS) -MT libwfb_la-fbarc.lo -MD -MP -MF $(DEPDIR)/libwfb_la-fbarc.Tpo -c -o libwfb_la-fbarc.lo `test -f 'fbarc.c' || echo '$(srcdir)/'`fbarc.c
+@am__fastdepCC_TRUE@	mv -f $(DEPDIR)/libwfb_la-fbarc.Tpo $(DEPDIR)/libwfb_la-fbarc.Plo
+@AMDEP_TRUE@@am__fastdepCC_FALSE@	source='fbarc.c' object='libwfb_la-fbarc.lo' libtool=yes @AMDEPBACKSLASH@
+@AMDEP_TRUE@@am__fastdepCC_FALSE@	DEPDIR=$(DEPDIR) $(CCDEPMODE) $(depcomp) @AMDEPBACKSLASH@
+@am__fastdepCC_FALSE@	$(LIBTOOL) --tag=CC $(AM_LIBTOOLFLAGS) $(LIBTOOLFLAGS) --mode=compile $(CC) $(DEFS) $(DEFAULT_INCLUDES) $(INCLUDES) $(AM_CPPFLAGS) $(CPPFLAGS) $(libwfb_la_CFLAGS) $(CFLAGS) -c -o libwfb_la-fbarc.lo `test -f 'fbarc.c' || echo '$(srcdir)/'`fbarc.c
+
+libwfb_la-fbbits.lo: fbbits.c
+@am__fastdepCC_TRUE@	$(LIBTOOL) --tag=CC $(AM_LIBTOOLFLAGS) $(LIBTOOLFLAGS) --mode=compile $(CC) $(DEFS) $(DEFAULT_INCLUDES) $(INCLUDES) $(AM_CPPFLAGS) $(CPPFLAGS) $(libwfb_la_CFLAGS) $(CFLAGS) -MT libwfb_la-fbbits.lo -MD -MP -MF $(DEPDIR)/libwfb_la-fbbits.Tpo -c -o libwfb_la-fbbits.lo `test -f 'fbbits.c' || echo '$(srcdir)/'`fbbits.c
+@am__fastdepCC_TRUE@	mv -f $(DEPDIR)/libwfb_la-fbbits.Tpo $(DEPDIR)/libwfb_la-fbbits.Plo
+@AMDEP_TRUE@@am__fastdepCC_FALSE@	source='fbbits.c' object='libwfb_la-fbbits.lo' libtool=yes @AMDEPBACKSLASH@
+@AMDEP_TRUE@@am__fastdepCC_FALSE@	DEPDIR=$(DEPDIR) $(CCDEPMODE) $(depcomp) @AMDEPBACKSLASH@
+@am__fastdepCC_FALSE@	$(LIBTOOL) --tag=CC $(AM_LIBTOOLFLAGS) $(LIBTOOLFLAGS) --mode=compile $(CC) $(DEFS) $(DEFAULT_INCLUDES) $(INCLUDES) $(AM_CPPFLAGS) $(CPPFLAGS) $(libwfb_la_CFLAGS) $(CFLAGS) -c -o libwfb_la-fbbits.lo `test -f 'fbbits.c' || echo '$(srcdir)/'`fbbits.c
+
+libwfb_la-fbblt.lo: fbblt.c
+@am__fastdepCC_TRUE@	$(LIBTOOL) --tag=CC $(AM_LIBTOOLFLAGS) $(LIBTOOLFLAGS) --mode=compile $(CC) $(DEFS) $(DEFAULT_INCLUDES) $(INCLUDES) $(AM_CPPFLAGS) $(CPPFLAGS) $(libwfb_la_CFLAGS) $(CFLAGS) -MT libwfb_la-fbblt.lo -MD -MP -MF $(DEPDIR)/libwfb_la-fbblt.Tpo -c -o libwfb_la-fbblt.lo `test -f 'fbblt.c' || echo '$(srcdir)/'`fbblt.c
+@am__fastdepCC_TRUE@	mv -f $(DEPDIR)/libwfb_la-fbblt.Tpo $(DEPDIR)/libwfb_la-fbblt.Plo
+@AMDEP_TRUE@@am__fastdepCC_FALSE@	source='fbblt.c' object='libwfb_la-fbblt.lo' libtool=yes @AMDEPBACKSLASH@
+@AMDEP_TRUE@@am__fastdepCC_FALSE@	DEPDIR=$(DEPDIR) $(CCDEPMODE) $(depcomp) @AMDEPBACKSLASH@
+@am__fastdepCC_FALSE@	$(LIBTOOL) --tag=CC $(AM_LIBTOOLFLAGS) $(LIBTOOLFLAGS) --mode=compile $(CC) $(DEFS) $(DEFAULT_INCLUDES) $(INCLUDES) $(AM_CPPFLAGS) $(CPPFLAGS) $(libwfb_la_CFLAGS) $(CFLAGS) -c -o libwfb_la-fbblt.lo `test -f 'fbblt.c' || echo '$(srcdir)/'`fbblt.c
+
+libwfb_la-fbbltone.lo: fbbltone.c
+@am__fastdepCC_TRUE@	$(LIBTOOL) --tag=CC $(AM_LIBTOOLFLAGS) $(LIBTOOLFLAGS) --mode=compile $(CC) $(DEFS) $(DEFAULT_INCLUDES) $(INCLUDES) $(AM_CPPFLAGS) $(CPPFLAGS) $(libwfb_la_CFLAGS) $(CFLAGS) -MT libwfb_la-fbbltone.lo -MD -MP -MF $(DEPDIR)/libwfb_la-fbbltone.Tpo -c -o libwfb_la-fbbltone.lo `test -f 'fbbltone.c' || echo '$(srcdir)/'`fbbltone.c
+@am__fastdepCC_TRUE@	mv -f $(DEPDIR)/libwfb_la-fbbltone.Tpo $(DEPDIR)/libwfb_la-fbbltone.Plo
+@AMDEP_TRUE@@am__fastdepCC_FALSE@	source='fbbltone.c' object='libwfb_la-fbbltone.lo' libtool=yes @AMDEPBACKSLASH@
+@AMDEP_TRUE@@am__fastdepCC_FALSE@	DEPDIR=$(DEPDIR) $(CCDEPMODE) $(depcomp) @AMDEPBACKSLASH@
+@am__fastdepCC_FALSE@	$(LIBTOOL) --tag=CC $(AM_LIBTOOLFLAGS) $(LIBTOOLFLAGS) --mode=compile $(CC) $(DEFS) $(DEFAULT_INCLUDES) $(INCLUDES) $(AM_CPPFLAGS) $(CPPFLAGS) $(libwfb_la_CFLAGS) $(CFLAGS) -c -o libwfb_la-fbbltone.lo `test -f 'fbbltone.c' || echo '$(srcdir)/'`fbbltone.c
+
+libwfb_la-fbbstore.lo: fbbstore.c
+@am__fastdepCC_TRUE@	$(LIBTOOL) --tag=CC $(AM_LIBTOOLFLAGS) $(LIBTOOLFLAGS) --mode=compile $(CC) $(DEFS) $(DEFAULT_INCLUDES) $(INCLUDES) $(AM_CPPFLAGS) $(CPPFLAGS) $(libwfb_la_CFLAGS) $(CFLAGS) -MT libwfb_la-fbbstore.lo -MD -MP -MF $(DEPDIR)/libwfb_la-fbbstore.Tpo -c -o libwfb_la-fbbstore.lo `test -f 'fbbstore.c' || echo '$(srcdir)/'`fbbstore.c
+@am__fastdepCC_TRUE@	mv -f $(DEPDIR)/libwfb_la-fbbstore.Tpo $(DEPDIR)/libwfb_la-fbbstore.Plo
+@AMDEP_TRUE@@am__fastdepCC_FALSE@	source='fbbstore.c' object='libwfb_la-fbbstore.lo' libtool=yes @AMDEPBACKSLASH@
+@AMDEP_TRUE@@am__fastdepCC_FALSE@	DEPDIR=$(DEPDIR) $(CCDEPMODE) $(depcomp) @AMDEPBACKSLASH@
+@am__fastdepCC_FALSE@	$(LIBTOOL) --tag=CC $(AM_LIBTOOLFLAGS) $(LIBTOOLFLAGS) --mode=compile $(CC) $(DEFS) $(DEFAULT_INCLUDES) $(INCLUDES) $(AM_CPPFLAGS) $(CPPFLAGS) $(libwfb_la_CFLAGS) $(CFLAGS) -c -o libwfb_la-fbbstore.lo `test -f 'fbbstore.c' || echo '$(srcdir)/'`fbbstore.c
+
+libwfb_la-fbcompose.lo: fbcompose.c
+@am__fastdepCC_TRUE@	$(LIBTOOL) --tag=CC $(AM_LIBTOOLFLAGS) $(LIBTOOLFLAGS) --mode=compile $(CC) $(DEFS) $(DEFAULT_INCLUDES) $(INCLUDES) $(AM_CPPFLAGS) $(CPPFLAGS) $(libwfb_la_CFLAGS) $(CFLAGS) -MT libwfb_la-fbcompose.lo -MD -MP -MF $(DEPDIR)/libwfb_la-fbcompose.Tpo -c -o libwfb_la-fbcompose.lo `test -f 'fbcompose.c' || echo '$(srcdir)/'`fbcompose.c
+@am__fastdepCC_TRUE@	mv -f $(DEPDIR)/libwfb_la-fbcompose.Tpo $(DEPDIR)/libwfb_la-fbcompose.Plo
+@AMDEP_TRUE@@am__fastdepCC_FALSE@	source='fbcompose.c' object='libwfb_la-fbcompose.lo' libtool=yes @AMDEPBACKSLASH@
+@AMDEP_TRUE@@am__fastdepCC_FALSE@	DEPDIR=$(DEPDIR) $(CCDEPMODE) $(depcomp) @AMDEPBACKSLASH@
+@am__fastdepCC_FALSE@	$(LIBTOOL) --tag=CC $(AM_LIBTOOLFLAGS) $(LIBTOOLFLAGS) --mode=compile $(CC) $(DEFS) $(DEFAULT_INCLUDES) $(INCLUDES) $(AM_CPPFLAGS) $(CPPFLAGS) $(libwfb_la_CFLAGS) $(CFLAGS) -c -o libwfb_la-fbcompose.lo `test -f 'fbcompose.c' || echo '$(srcdir)/'`fbcompose.c
+
+libwfb_la-fbcopy.lo: fbcopy.c
+@am__fastdepCC_TRUE@	$(LIBTOOL) --tag=CC $(AM_LIBTOOLFLAGS) $(LIBTOOLFLAGS) --mode=compile $(CC) $(DEFS) $(DEFAULT_INCLUDES) $(INCLUDES) $(AM_CPPFLAGS) $(CPPFLAGS) $(libwfb_la_CFLAGS) $(CFLAGS) -MT libwfb_la-fbcopy.lo -MD -MP -MF $(DEPDIR)/libwfb_la-fbcopy.Tpo -c -o libwfb_la-fbcopy.lo `test -f 'fbcopy.c' || echo '$(srcdir)/'`fbcopy.c
+@am__fastdepCC_TRUE@	mv -f $(DEPDIR)/libwfb_la-fbcopy.Tpo $(DEPDIR)/libwfb_la-fbcopy.Plo
+@AMDEP_TRUE@@am__fastdepCC_FALSE@	source='fbcopy.c' object='libwfb_la-fbcopy.lo' libtool=yes @AMDEPBACKSLASH@
+@AMDEP_TRUE@@am__fastdepCC_FALSE@	DEPDIR=$(DEPDIR) $(CCDEPMODE) $(depcomp) @AMDEPBACKSLASH@
+@am__fastdepCC_FALSE@	$(LIBTOOL) --tag=CC $(AM_LIBTOOLFLAGS) $(LIBTOOLFLAGS) --mode=compile $(CC) $(DEFS) $(DEFAULT_INCLUDES) $(INCLUDES) $(AM_CPPFLAGS) $(CPPFLAGS) $(libwfb_la_CFLAGS) $(CFLAGS) -c -o libwfb_la-fbcopy.lo `test -f 'fbcopy.c' || echo '$(srcdir)/'`fbcopy.c
+
+libwfb_la-fbfill.lo: fbfill.c
+@am__fastdepCC_TRUE@	$(LIBTOOL) --tag=CC $(AM_LIBTOOLFLAGS) $(LIBTOOLFLAGS) --mode=compile $(CC) $(DEFS) $(DEFAULT_INCLUDES) $(INCLUDES) $(AM_CPPFLAGS) $(CPPFLAGS) $(libwfb_la_CFLAGS) $(CFLAGS) -MT libwfb_la-fbfill.lo -MD -MP -MF $(DEPDIR)/libwfb_la-fbfill.Tpo -c -o libwfb_la-fbfill.lo `test -f 'fbfill.c' || echo '$(srcdir)/'`fbfill.c
+@am__fastdepCC_TRUE@	mv -f $(DEPDIR)/libwfb_la-fbfill.Tpo $(DEPDIR)/libwfb_la-fbfill.Plo
+@AMDEP_TRUE@@am__fastdepCC_FALSE@	source='fbfill.c' object='libwfb_la-fbfill.lo' libtool=yes @AMDEPBACKSLASH@
+@AMDEP_TRUE@@am__fastdepCC_FALSE@	DEPDIR=$(DEPDIR) $(CCDEPMODE) $(depcomp) @AMDEPBACKSLASH@
+@am__fastdepCC_FALSE@	$(LIBTOOL) --tag=CC $(AM_LIBTOOLFLAGS) $(LIBTOOLFLAGS) --mode=compile $(CC) $(DEFS) $(DEFAULT_INCLUDES) $(INCLUDES) $(AM_CPPFLAGS) $(CPPFLAGS) $(libwfb_la_CFLAGS) $(CFLAGS) -c -o libwfb_la-fbfill.lo `test -f 'fbfill.c' || echo '$(srcdir)/'`fbfill.c
+
+libwfb_la-fbfillrect.lo: fbfillrect.c
+@am__fastdepCC_TRUE@	$(LIBTOOL) --tag=CC $(AM_LIBTOOLFLAGS) $(LIBTOOLFLAGS) --mode=compile $(CC) $(DEFS) $(DEFAULT_INCLUDES) $(INCLUDES) $(AM_CPPFLAGS) $(CPPFLAGS) $(libwfb_la_CFLAGS) $(CFLAGS) -MT libwfb_la-fbfillrect.lo -MD -MP -MF $(DEPDIR)/libwfb_la-fbfillrect.Tpo -c -o libwfb_la-fbfillrect.lo `test -f 'fbfillrect.c' || echo '$(srcdir)/'`fbfillrect.c
+@am__fastdepCC_TRUE@	mv -f $(DEPDIR)/libwfb_la-fbfillrect.Tpo $(DEPDIR)/libwfb_la-fbfillrect.Plo
+@AMDEP_TRUE@@am__fastdepCC_FALSE@	source='fbfillrect.c' object='libwfb_la-fbfillrect.lo' libtool=yes @AMDEPBACKSLASH@
+@AMDEP_TRUE@@am__fastdepCC_FALSE@	DEPDIR=$(DEPDIR) $(CCDEPMODE) $(depcomp) @AMDEPBACKSLASH@
+@am__fastdepCC_FALSE@	$(LIBTOOL) --tag=CC $(AM_LIBTOOLFLAGS) $(LIBTOOLFLAGS) --mode=compile $(CC) $(DEFS) $(DEFAULT_INCLUDES) $(INCLUDES) $(AM_CPPFLAGS) $(CPPFLAGS) $(libwfb_la_CFLAGS) $(CFLAGS) -c -o libwfb_la-fbfillrect.lo `test -f 'fbfillrect.c' || echo '$(srcdir)/'`fbfillrect.c
+
+libwfb_la-fbfillsp.lo: fbfillsp.c
+@am__fastdepCC_TRUE@	$(LIBTOOL) --tag=CC $(AM_LIBTOOLFLAGS) $(LIBTOOLFLAGS) --mode=compile $(CC) $(DEFS) $(DEFAULT_INCLUDES) $(INCLUDES) $(AM_CPPFLAGS) $(CPPFLAGS) $(libwfb_la_CFLAGS) $(CFLAGS) -MT libwfb_la-fbfillsp.lo -MD -MP -MF $(DEPDIR)/libwfb_la-fbfillsp.Tpo -c -o libwfb_la-fbfillsp.lo `test -f 'fbfillsp.c' || echo '$(srcdir)/'`fbfillsp.c
+@am__fastdepCC_TRUE@	mv -f $(DEPDIR)/libwfb_la-fbfillsp.Tpo $(DEPDIR)/libwfb_la-fbfillsp.Plo
+@AMDEP_TRUE@@am__fastdepCC_FALSE@	source='fbfillsp.c' object='libwfb_la-fbfillsp.lo' libtool=yes @AMDEPBACKSLASH@
+@AMDEP_TRUE@@am__fastdepCC_FALSE@	DEPDIR=$(DEPDIR) $(CCDEPMODE) $(depcomp) @AMDEPBACKSLASH@
+@am__fastdepCC_FALSE@	$(LIBTOOL) --tag=CC $(AM_LIBTOOLFLAGS) $(LIBTOOLFLAGS) --mode=compile $(CC) $(DEFS) $(DEFAULT_INCLUDES) $(INCLUDES) $(AM_CPPFLAGS) $(CPPFLAGS) $(libwfb_la_CFLAGS) $(CFLAGS) -c -o libwfb_la-fbfillsp.lo `test -f 'fbfillsp.c' || echo '$(srcdir)/'`fbfillsp.c
+
+libwfb_la-fbgc.lo: fbgc.c
+@am__fastdepCC_TRUE@	$(LIBTOOL) --tag=CC $(AM_LIBTOOLFLAGS) $(LIBTOOLFLAGS) --mode=compile $(CC) $(DEFS) $(DEFAULT_INCLUDES) $(INCLUDES) $(AM_CPPFLAGS) $(CPPFLAGS) $(libwfb_la_CFLAGS) $(CFLAGS) -MT libwfb_la-fbgc.lo -MD -MP -MF $(DEPDIR)/libwfb_la-fbgc.Tpo -c -o libwfb_la-fbgc.lo `test -f 'fbgc.c' || echo '$(srcdir)/'`fbgc.c
+@am__fastdepCC_TRUE@	mv -f $(DEPDIR)/libwfb_la-fbgc.Tpo $(DEPDIR)/libwfb_la-fbgc.Plo
+@AMDEP_TRUE@@am__fastdepCC_FALSE@	source='fbgc.c' object='libwfb_la-fbgc.lo' libtool=yes @AMDEPBACKSLASH@
+@AMDEP_TRUE@@am__fastdepCC_FALSE@	DEPDIR=$(DEPDIR) $(CCDEPMODE) $(depcomp) @AMDEPBACKSLASH@
+@am__fastdepCC_FALSE@	$(LIBTOOL) --tag=CC $(AM_LIBTOOLFLAGS) $(LIBTOOLFLAGS) --mode=compile $(CC) $(DEFS) $(DEFAULT_INCLUDES) $(INCLUDES) $(AM_CPPFLAGS) $(CPPFLAGS) $(libwfb_la_CFLAGS) $(CFLAGS) -c -o libwfb_la-fbgc.lo `test -f 'fbgc.c' || echo '$(srcdir)/'`fbgc.c
+
+libwfb_la-fbgetsp.lo: fbgetsp.c
+@am__fastdepCC_TRUE@	$(LIBTOOL) --tag=CC $(AM_LIBTOOLFLAGS) $(LIBTOOLFLAGS) --mode=compile $(CC) $(DEFS) $(DEFAULT_INCLUDES) $(INCLUDES) $(AM_CPPFLAGS) $(CPPFLAGS) $(libwfb_la_CFLAGS) $(CFLAGS) -MT libwfb_la-fbgetsp.lo -MD -MP -MF $(DEPDIR)/libwfb_la-fbgetsp.Tpo -c -o libwfb_la-fbgetsp.lo `test -f 'fbgetsp.c' || echo '$(srcdir)/'`fbgetsp.c
+@am__fastdepCC_TRUE@	mv -f $(DEPDIR)/libwfb_la-fbgetsp.Tpo $(DEPDIR)/libwfb_la-fbgetsp.Plo
+@AMDEP_TRUE@@am__fastdepCC_FALSE@	source='fbgetsp.c' object='libwfb_la-fbgetsp.lo' libtool=yes @AMDEPBACKSLASH@
+@AMDEP_TRUE@@am__fastdepCC_FALSE@	DEPDIR=$(DEPDIR) $(CCDEPMODE) $(depcomp) @AMDEPBACKSLASH@
+@am__fastdepCC_FALSE@	$(LIBTOOL) --tag=CC $(AM_LIBTOOLFLAGS) $(LIBTOOLFLAGS) --mode=compile $(CC) $(DEFS) $(DEFAULT_INCLUDES) $(INCLUDES) $(AM_CPPFLAGS) $(CPPFLAGS) $(libwfb_la_CFLAGS) $(CFLAGS) -c -o libwfb_la-fbgetsp.lo `test -f 'fbgetsp.c' || echo '$(srcdir)/'`fbgetsp.c
+
+libwfb_la-fbglyph.lo: fbglyph.c
+@am__fastdepCC_TRUE@	$(LIBTOOL) --tag=CC $(AM_LIBTOOLFLAGS) $(LIBTOOLFLAGS) --mode=compile $(CC) $(DEFS) $(DEFAULT_INCLUDES) $(INCLUDES) $(AM_CPPFLAGS) $(CPPFLAGS) $(libwfb_la_CFLAGS) $(CFLAGS) -MT libwfb_la-fbglyph.lo -MD -MP -MF $(DEPDIR)/libwfb_la-fbglyph.Tpo -c -o libwfb_la-fbglyph.lo `test -f 'fbglyph.c' || echo '$(srcdir)/'`fbglyph.c
+@am__fastdepCC_TRUE@	mv -f $(DEPDIR)/libwfb_la-fbglyph.Tpo $(DEPDIR)/libwfb_la-fbglyph.Plo
+@AMDEP_TRUE@@am__fastdepCC_FALSE@	source='fbglyph.c' object='libwfb_la-fbglyph.lo' libtool=yes @AMDEPBACKSLASH@
+@AMDEP_TRUE@@am__fastdepCC_FALSE@	DEPDIR=$(DEPDIR) $(CCDEPMODE) $(depcomp) @AMDEPBACKSLASH@
+@am__fastdepCC_FALSE@	$(LIBTOOL) --tag=CC $(AM_LIBTOOLFLAGS) $(LIBTOOLFLAGS) --mode=compile $(CC) $(DEFS) $(DEFAULT_INCLUDES) $(INCLUDES) $(AM_CPPFLAGS) $(CPPFLAGS) $(libwfb_la_CFLAGS) $(CFLAGS) -c -o libwfb_la-fbglyph.lo `test -f 'fbglyph.c' || echo '$(srcdir)/'`fbglyph.c
+
+libwfb_la-fbimage.lo: fbimage.c
+@am__fastdepCC_TRUE@	$(LIBTOOL) --tag=CC $(AM_LIBTOOLFLAGS) $(LIBTOOLFLAGS) --mode=compile $(CC) $(DEFS) $(DEFAULT_INCLUDES) $(INCLUDES) $(AM_CPPFLAGS) $(CPPFLAGS) $(libwfb_la_CFLAGS) $(CFLAGS) -MT libwfb_la-fbimage.lo -MD -MP -MF $(DEPDIR)/libwfb_la-fbimage.Tpo -c -o libwfb_la-fbimage.lo `test -f 'fbimage.c' || echo '$(srcdir)/'`fbimage.c
+@am__fastdepCC_TRUE@	mv -f $(DEPDIR)/libwfb_la-fbimage.Tpo $(DEPDIR)/libwfb_la-fbimage.Plo
+@AMDEP_TRUE@@am__fastdepCC_FALSE@	source='fbimage.c' object='libwfb_la-fbimage.lo' libtool=yes @AMDEPBACKSLASH@
+@AMDEP_TRUE@@am__fastdepCC_FALSE@	DEPDIR=$(DEPDIR) $(CCDEPMODE) $(depcomp) @AMDEPBACKSLASH@
+@am__fastdepCC_FALSE@	$(LIBTOOL) --tag=CC $(AM_LIBTOOLFLAGS) $(LIBTOOLFLAGS) --mode=compile $(CC) $(DEFS) $(DEFAULT_INCLUDES) $(INCLUDES) $(AM_CPPFLAGS) $(CPPFLAGS) $(libwfb_la_CFLAGS) $(CFLAGS) -c -o libwfb_la-fbimage.lo `test -f 'fbimage.c' || echo '$(srcdir)/'`fbimage.c
+
+libwfb_la-fbline.lo: fbline.c
+@am__fastdepCC_TRUE@	$(LIBTOOL) --tag=CC $(AM_LIBTOOLFLAGS) $(LIBTOOLFLAGS) --mode=compile $(CC) $(DEFS) $(DEFAULT_INCLUDES) $(INCLUDES) $(AM_CPPFLAGS) $(CPPFLAGS) $(libwfb_la_CFLAGS) $(CFLAGS) -MT libwfb_la-fbline.lo -MD -MP -MF $(DEPDIR)/libwfb_la-fbline.Tpo -c -o libwfb_la-fbline.lo `test -f 'fbline.c' || echo '$(srcdir)/'`fbline.c
+@am__fastdepCC_TRUE@	mv -f $(DEPDIR)/libwfb_la-fbline.Tpo $(DEPDIR)/libwfb_la-fbline.Plo
+@AMDEP_TRUE@@am__fastdepCC_FALSE@	source='fbline.c' object='libwfb_la-fbline.lo' libtool=yes @AMDEPBACKSLASH@
+@AMDEP_TRUE@@am__fastdepCC_FALSE@	DEPDIR=$(DEPDIR) $(CCDEPMODE) $(depcomp) @AMDEPBACKSLASH@
+@am__fastdepCC_FALSE@	$(LIBTOOL) --tag=CC $(AM_LIBTOOLFLAGS) $(LIBTOOLFLAGS) --mode=compile $(CC) $(DEFS) $(DEFAULT_INCLUDES) $(INCLUDES) $(AM_CPPFLAGS) $(CPPFLAGS) $(libwfb_la_CFLAGS) $(CFLAGS) -c -o libwfb_la-fbline.lo `test -f 'fbline.c' || echo '$(srcdir)/'`fbline.c
+
+libwfb_la-fboverlay.lo: fboverlay.c
+@am__fastdepCC_TRUE@	$(LIBTOOL) --tag=CC $(AM_LIBTOOLFLAGS) $(LIBTOOLFLAGS) --mode=compile $(CC) $(DEFS) $(DEFAULT_INCLUDES) $(INCLUDES) $(AM_CPPFLAGS) $(CPPFLAGS) $(libwfb_la_CFLAGS) $(CFLAGS) -MT libwfb_la-fboverlay.lo -MD -MP -MF $(DEPDIR)/libwfb_la-fboverlay.Tpo -c -o libwfb_la-fboverlay.lo `test -f 'fboverlay.c' || echo '$(srcdir)/'`fboverlay.c
+@am__fastdepCC_TRUE@	mv -f $(DEPDIR)/libwfb_la-fboverlay.Tpo $(DEPDIR)/libwfb_la-fboverlay.Plo
+@AMDEP_TRUE@@am__fastdepCC_FALSE@	source='fboverlay.c' object='libwfb_la-fboverlay.lo' libtool=yes @AMDEPBACKSLASH@
+@AMDEP_TRUE@@am__fastdepCC_FALSE@	DEPDIR=$(DEPDIR) $(CCDEPMODE) $(depcomp) @AMDEPBACKSLASH@
+@am__fastdepCC_FALSE@	$(LIBTOOL) --tag=CC $(AM_LIBTOOLFLAGS) $(LIBTOOLFLAGS) --mode=compile $(CC) $(DEFS) $(DEFAULT_INCLUDES) $(INCLUDES) $(AM_CPPFLAGS) $(CPPFLAGS) $(libwfb_la_CFLAGS) $(CFLAGS) -c -o libwfb_la-fboverlay.lo `test -f 'fboverlay.c' || echo '$(srcdir)/'`fboverlay.c
+
+libwfb_la-fbpict.lo: fbpict.c
+@am__fastdepCC_TRUE@	$(LIBTOOL) --tag=CC $(AM_LIBTOOLFLAGS) $(LIBTOOLFLAGS) --mode=compile $(CC) $(DEFS) $(DEFAULT_INCLUDES) $(INCLUDES) $(AM_CPPFLAGS) $(CPPFLAGS) $(libwfb_la_CFLAGS) $(CFLAGS) -MT libwfb_la-fbpict.lo -MD -MP -MF $(DEPDIR)/libwfb_la-fbpict.Tpo -c -o libwfb_la-fbpict.lo `test -f 'fbpict.c' || echo '$(srcdir)/'`fbpict.c
+@am__fastdepCC_TRUE@	mv -f $(DEPDIR)/libwfb_la-fbpict.Tpo $(DEPDIR)/libwfb_la-fbpict.Plo
+@AMDEP_TRUE@@am__fastdepCC_FALSE@	source='fbpict.c' object='libwfb_la-fbpict.lo' libtool=yes @AMDEPBACKSLASH@
+@AMDEP_TRUE@@am__fastdepCC_FALSE@	DEPDIR=$(DEPDIR) $(CCDEPMODE) $(depcomp) @AMDEPBACKSLASH@
+@am__fastdepCC_FALSE@	$(LIBTOOL) --tag=CC $(AM_LIBTOOLFLAGS) $(LIBTOOLFLAGS) --mode=compile $(CC) $(DEFS) $(DEFAULT_INCLUDES) $(INCLUDES) $(AM_CPPFLAGS) $(CPPFLAGS) $(libwfb_la_CFLAGS) $(CFLAGS) -c -o libwfb_la-fbpict.lo `test -f 'fbpict.c' || echo '$(srcdir)/'`fbpict.c
+
+libwfb_la-fbarmv6.lo: fbarmv6.c
+@am__fastdepCC_TRUE@	$(LIBTOOL) --tag=CC $(AM_LIBTOOLFLAGS) $(LIBTOOLFLAGS) --mode=compile $(CC) $(DEFS) $(DEFAULT_INCLUDES) $(INCLUDES) $(AM_CPPFLAGS) $(CPPFLAGS) $(libwfb_la_CFLAGS) $(CFLAGS) -MT libwfb_la-fbarmv6.lo -MD -MP -MF $(DEPDIR)/libwfb_la-fbarmv6.Tpo -c -o libwfb_la-fbarmv6.lo `test -f 'fbarmv6.c' || echo '$(srcdir)/'`fbarmv6.c
+@am__fastdepCC_TRUE@	mv -f $(DEPDIR)/libwfb_la-fbarmv6.Tpo $(DEPDIR)/libwfb_la-fbarmv6.Plo
+@AMDEP_TRUE@@am__fastdepCC_FALSE@	source='fbarmv6.c' object='libwfb_la-fbarmv6.lo' libtool=yes @AMDEPBACKSLASH@
+@AMDEP_TRUE@@am__fastdepCC_FALSE@	DEPDIR=$(DEPDIR) $(CCDEPMODE) $(depcomp) @AMDEPBACKSLASH@
+@am__fastdepCC_FALSE@	$(LIBTOOL) --tag=CC $(AM_LIBTOOLFLAGS) $(LIBTOOLFLAGS) --mode=compile $(CC) $(DEFS) $(DEFAULT_INCLUDES) $(INCLUDES) $(AM_CPPFLAGS) $(CPPFLAGS) $(libwfb_la_CFLAGS) $(CFLAGS) -c -o libwfb_la-fbarmv6.lo `test -f 'fbarmv6.c' || echo '$(srcdir)/'`fbarmv6.c
+
+libwfb_la-fbpixmap.lo: fbpixmap.c
+@am__fastdepCC_TRUE@	$(LIBTOOL) --tag=CC $(AM_LIBTOOLFLAGS) $(LIBTOOLFLAGS) --mode=compile $(CC) $(DEFS) $(DEFAULT_INCLUDES) $(INCLUDES) $(AM_CPPFLAGS) $(CPPFLAGS) $(libwfb_la_CFLAGS) $(CFLAGS) -MT libwfb_la-fbpixmap.lo -MD -MP -MF $(DEPDIR)/libwfb_la-fbpixmap.Tpo -c -o libwfb_la-fbpixmap.lo `test -f 'fbpixmap.c' || echo '$(srcdir)/'`fbpixmap.c
+@am__fastdepCC_TRUE@	mv -f $(DEPDIR)/libwfb_la-fbpixmap.Tpo $(DEPDIR)/libwfb_la-fbpixmap.Plo
+@AMDEP_TRUE@@am__fastdepCC_FALSE@	source='fbpixmap.c' object='libwfb_la-fbpixmap.lo' libtool=yes @AMDEPBACKSLASH@
+@AMDEP_TRUE@@am__fastdepCC_FALSE@	DEPDIR=$(DEPDIR) $(CCDEPMODE) $(depcomp) @AMDEPBACKSLASH@
+@am__fastdepCC_FALSE@	$(LIBTOOL) --tag=CC $(AM_LIBTOOLFLAGS) $(LIBTOOLFLAGS) --mode=compile $(CC) $(DEFS) $(DEFAULT_INCLUDES) $(INCLUDES) $(AM_CPPFLAGS) $(CPPFLAGS) $(libwfb_la_CFLAGS) $(CFLAGS) -c -o libwfb_la-fbpixmap.lo `test -f 'fbpixmap.c' || echo '$(srcdir)/'`fbpixmap.c
+
+libwfb_la-fbpoint.lo: fbpoint.c
+@am__fastdepCC_TRUE@	$(LIBTOOL) --tag=CC $(AM_LIBTOOLFLAGS) $(LIBTOOLFLAGS) --mode=compile $(CC) $(DEFS) $(DEFAULT_INCLUDES) $(INCLUDES) $(AM_CPPFLAGS) $(CPPFLAGS) $(libwfb_la_CFLAGS) $(CFLAGS) -MT libwfb_la-fbpoint.lo -MD -MP -MF $(DEPDIR)/libwfb_la-fbpoint.Tpo -c -o libwfb_la-fbpoint.lo `test -f 'fbpoint.c' || echo '$(srcdir)/'`fbpoint.c
+@am__fastdepCC_TRUE@	mv -f $(DEPDIR)/libwfb_la-fbpoint.Tpo $(DEPDIR)/libwfb_la-fbpoint.Plo
+@AMDEP_TRUE@@am__fastdepCC_FALSE@	source='fbpoint.c' object='libwfb_la-fbpoint.lo' libtool=yes @AMDEPBACKSLASH@
+@AMDEP_TRUE@@am__fastdepCC_FALSE@	DEPDIR=$(DEPDIR) $(CCDEPMODE) $(depcomp) @AMDEPBACKSLASH@
+@am__fastdepCC_FALSE@	$(LIBTOOL) --tag=CC $(AM_LIBTOOLFLAGS) $(LIBTOOLFLAGS) --mode=compile $(CC) $(DEFS) $(DEFAULT_INCLUDES) $(INCLUDES) $(AM_CPPFLAGS) $(CPPFLAGS) $(libwfb_la_CFLAGS) $(CFLAGS) -c -o libwfb_la-fbpoint.lo `test -f 'fbpoint.c' || echo '$(srcdir)/'`fbpoint.c
+
+libwfb_la-fbpush.lo: fbpush.c
+@am__fastdepCC_TRUE@	$(LIBTOOL) --tag=CC $(AM_LIBTOOLFLAGS) $(LIBTOOLFLAGS) --mode=compile $(CC) $(DEFS) $(DEFAULT_INCLUDES) $(INCLUDES) $(AM_CPPFLAGS) $(CPPFLAGS) $(libwfb_la_CFLAGS) $(CFLAGS) -MT libwfb_la-fbpush.lo -MD -MP -MF $(DEPDIR)/libwfb_la-fbpush.Tpo -c -o libwfb_la-fbpush.lo `test -f 'fbpush.c' || echo '$(srcdir)/'`fbpush.c
+@am__fastdepCC_TRUE@	mv -f $(DEPDIR)/libwfb_la-fbpush.Tpo $(DEPDIR)/libwfb_la-fbpush.Plo
+@AMDEP_TRUE@@am__fastdepCC_FALSE@	source='fbpush.c' object='libwfb_la-fbpush.lo' libtool=yes @AMDEPBACKSLASH@
+@AMDEP_TRUE@@am__fastdepCC_FALSE@	DEPDIR=$(DEPDIR) $(CCDEPMODE) $(depcomp) @AMDEPBACKSLASH@
+@am__fastdepCC_FALSE@	$(LIBTOOL) --tag=CC $(AM_LIBTOOLFLAGS) $(LIBTOOLFLAGS) --mode=compile $(CC) $(DEFS) $(DEFAULT_INCLUDES) $(INCLUDES) $(AM_CPPFLAGS) $(CPPFLAGS) $(libwfb_la_CFLAGS) $(CFLAGS) -c -o libwfb_la-fbpush.lo `test -f 'fbpush.c' || echo '$(srcdir)/'`fbpush.c
+
+libwfb_la-fbscreen.lo: fbscreen.c
+@am__fastdepCC_TRUE@	$(LIBTOOL) --tag=CC $(AM_LIBTOOLFLAGS) $(LIBTOOLFLAGS) --mode=compile $(CC) $(DEFS) $(DEFAULT_INCLUDES) $(INCLUDES) $(AM_CPPFLAGS) $(CPPFLAGS) $(libwfb_la_CFLAGS) $(CFLAGS) -MT libwfb_la-fbscreen.lo -MD -MP -MF $(DEPDIR)/libwfb_la-fbscreen.Tpo -c -o libwfb_la-fbscreen.lo `test -f 'fbscreen.c' || echo '$(srcdir)/'`fbscreen.c
+@am__fastdepCC_TRUE@	mv -f $(DEPDIR)/libwfb_la-fbscreen.Tpo $(DEPDIR)/libwfb_la-fbscreen.Plo
+@AMDEP_TRUE@@am__fastdepCC_FALSE@	source='fbscreen.c' object='libwfb_la-fbscreen.lo' libtool=yes @AMDEPBACKSLASH@
+@AMDEP_TRUE@@am__fastdepCC_FALSE@	DEPDIR=$(DEPDIR) $(CCDEPMODE) $(depcomp) @AMDEPBACKSLASH@
+@am__fastdepCC_FALSE@	$(LIBTOOL) --tag=CC $(AM_LIBTOOLFLAGS) $(LIBTOOLFLAGS) --mode=compile $(CC) $(DEFS) $(DEFAULT_INCLUDES) $(INCLUDES) $(AM_CPPFLAGS) $(CPPFLAGS) $(libwfb_la_CFLAGS) $(CFLAGS) -c -o libwfb_la-fbscreen.lo `test -f 'fbscreen.c' || echo '$(srcdir)/'`fbscreen.c
+
+libwfb_la-fbseg.lo: fbseg.c
+@am__fastdepCC_TRUE@	$(LIBTOOL) --tag=CC $(AM_LIBTOOLFLAGS) $(LIBTOOLFLAGS) --mode=compile $(CC) $(DEFS) $(DEFAULT_INCLUDES) $(INCLUDES) $(AM_CPPFLAGS) $(CPPFLAGS) $(libwfb_la_CFLAGS) $(CFLAGS) -MT libwfb_la-fbseg.lo -MD -MP -MF $(DEPDIR)/libwfb_la-fbseg.Tpo -c -o libwfb_la-fbseg.lo `test -f 'fbseg.c' || echo '$(srcdir)/'`fbseg.c
+@am__fastdepCC_TRUE@	mv -f $(DEPDIR)/libwfb_la-fbseg.Tpo $(DEPDIR)/libwfb_la-fbseg.Plo
+@AMDEP_TRUE@@am__fastdepCC_FALSE@	source='fbseg.c' object='libwfb_la-fbseg.lo' libtool=yes @AMDEPBACKSLASH@
+@AMDEP_TRUE@@am__fastdepCC_FALSE@	DEPDIR=$(DEPDIR) $(CCDEPMODE) $(depcomp) @AMDEPBACKSLASH@
+@am__fastdepCC_FALSE@	$(LIBTOOL) --tag=CC $(AM_LIBTOOLFLAGS) $(LIBTOOLFLAGS) --mode=compile $(CC) $(DEFS) $(DEFAULT_INCLUDES) $(INCLUDES) $(AM_CPPFLAGS) $(CPPFLAGS) $(libwfb_la_CFLAGS) $(CFLAGS) -c -o libwfb_la-fbseg.lo `test -f 'fbseg.c' || echo '$(srcdir)/'`fbseg.c
+
+libwfb_la-fbsetsp.lo: fbsetsp.c
+@am__fastdepCC_TRUE@	$(LIBTOOL) --tag=CC $(AM_LIBTOOLFLAGS) $(LIBTOOLFLAGS) --mode=compile $(CC) $(DEFS) $(DEFAULT_INCLUDES) $(INCLUDES) $(AM_CPPFLAGS) $(CPPFLAGS) $(libwfb_la_CFLAGS) $(CFLAGS) -MT libwfb_la-fbsetsp.lo -MD -MP -MF $(DEPDIR)/libwfb_la-fbsetsp.Tpo -c -o libwfb_la-fbsetsp.lo `test -f 'fbsetsp.c' || echo '$(srcdir)/'`fbsetsp.c
+@am__fastdepCC_TRUE@	mv -f $(DEPDIR)/libwfb_la-fbsetsp.Tpo $(DEPDIR)/libwfb_la-fbsetsp.Plo
+@AMDEP_TRUE@@am__fastdepCC_FALSE@	source='fbsetsp.c' object='libwfb_la-fbsetsp.lo' libtool=yes @AMDEPBACKSLASH@
+@AMDEP_TRUE@@am__fastdepCC_FALSE@	DEPDIR=$(DEPDIR) $(CCDEPMODE) $(depcomp) @AMDEPBACKSLASH@
+@am__fastdepCC_FALSE@	$(LIBTOOL) --tag=CC $(AM_LIBTOOLFLAGS) $(LIBTOOLFLAGS) --mode=compile $(CC) $(DEFS) $(DEFAULT_INCLUDES) $(INCLUDES) $(AM_CPPFLAGS) $(CPPFLAGS) $(libwfb_la_CFLAGS) $(CFLAGS) -c -o libwfb_la-fbsetsp.lo `test -f 'fbsetsp.c' || echo '$(srcdir)/'`fbsetsp.c
+
+libwfb_la-fbsolid.lo: fbsolid.c
+@am__fastdepCC_TRUE@	$(LIBTOOL) --tag=CC $(AM_LIBTOOLFLAGS) $(LIBTOOLFLAGS) --mode=compile $(CC) $(DEFS) $(DEFAULT_INCLUDES) $(INCLUDES) $(AM_CPPFLAGS) $(CPPFLAGS) $(libwfb_la_CFLAGS) $(CFLAGS) -MT libwfb_la-fbsolid.lo -MD -MP -MF $(DEPDIR)/libwfb_la-fbsolid.Tpo -c -o libwfb_la-fbsolid.lo `test -f 'fbsolid.c' || echo '$(srcdir)/'`fbsolid.c
+@am__fastdepCC_TRUE@	mv -f $(DEPDIR)/libwfb_la-fbsolid.Tpo $(DEPDIR)/libwfb_la-fbsolid.Plo
+@AMDEP_TRUE@@am__fastdepCC_FALSE@	source='fbsolid.c' object='libwfb_la-fbsolid.lo' libtool=yes @AMDEPBACKSLASH@
+@AMDEP_TRUE@@am__fastdepCC_FALSE@	DEPDIR=$(DEPDIR) $(CCDEPMODE) $(depcomp) @AMDEPBACKSLASH@
+@am__fastdepCC_FALSE@	$(LIBTOOL) --tag=CC $(AM_LIBTOOLFLAGS) $(LIBTOOLFLAGS) --mode=compile $(CC) $(DEFS) $(DEFAULT_INCLUDES) $(INCLUDES) $(AM_CPPFLAGS) $(CPPFLAGS) $(libwfb_la_CFLAGS) $(CFLAGS) -c -o libwfb_la-fbsolid.lo `test -f 'fbsolid.c' || echo '$(srcdir)/'`fbsolid.c
+
+libwfb_la-fbstipple.lo: fbstipple.c
+@am__fastdepCC_TRUE@	$(LIBTOOL) --tag=CC $(AM_LIBTOOLFLAGS) $(LIBTOOLFLAGS) --mode=compile $(CC) $(DEFS) $(DEFAULT_INCLUDES) $(INCLUDES) $(AM_CPPFLAGS) $(CPPFLAGS) $(libwfb_la_CFLAGS) $(CFLAGS) -MT libwfb_la-fbstipple.lo -MD -MP -MF $(DEPDIR)/libwfb_la-fbstipple.Tpo -c -o libwfb_la-fbstipple.lo `test -f 'fbstipple.c' || echo '$(srcdir)/'`fbstipple.c
+@am__fastdepCC_TRUE@	mv -f $(DEPDIR)/libwfb_la-fbstipple.Tpo $(DEPDIR)/libwfb_la-fbstipple.Plo
+@AMDEP_TRUE@@am__fastdepCC_FALSE@	source='fbstipple.c' object='libwfb_la-fbstipple.lo' libtool=yes @AMDEPBACKSLASH@
+@AMDEP_TRUE@@am__fastdepCC_FALSE@	DEPDIR=$(DEPDIR) $(CCDEPMODE) $(depcomp) @AMDEPBACKSLASH@
+@am__fastdepCC_FALSE@	$(LIBTOOL) --tag=CC $(AM_LIBTOOLFLAGS) $(LIBTOOLFLAGS) --mode=compile $(CC) $(DEFS) $(DEFAULT_INCLUDES) $(INCLUDES) $(AM_CPPFLAGS) $(CPPFLAGS) $(libwfb_la_CFLAGS) $(CFLAGS) -c -o libwfb_la-fbstipple.lo `test -f 'fbstipple.c' || echo '$(srcdir)/'`fbstipple.c
+
+libwfb_la-fbtile.lo: fbtile.c
+@am__fastdepCC_TRUE@	$(LIBTOOL) --tag=CC $(AM_LIBTOOLFLAGS) $(LIBTOOLFLAGS) --mode=compile $(CC) $(DEFS) $(DEFAULT_INCLUDES) $(INCLUDES) $(AM_CPPFLAGS) $(CPPFLAGS) $(libwfb_la_CFLAGS) $(CFLAGS) -MT libwfb_la-fbtile.lo -MD -MP -MF $(DEPDIR)/libwfb_la-fbtile.Tpo -c -o libwfb_la-fbtile.lo `test -f 'fbtile.c' || echo '$(srcdir)/'`fbtile.c
+@am__fastdepCC_TRUE@	mv -f $(DEPDIR)/libwfb_la-fbtile.Tpo $(DEPDIR)/libwfb_la-fbtile.Plo
+@AMDEP_TRUE@@am__fastdepCC_FALSE@	source='fbtile.c' object='libwfb_la-fbtile.lo' libtool=yes @AMDEPBACKSLASH@
+@AMDEP_TRUE@@am__fastdepCC_FALSE@	DEPDIR=$(DEPDIR) $(CCDEPMODE) $(depcomp) @AMDEPBACKSLASH@
+@am__fastdepCC_FALSE@	$(LIBTOOL) --tag=CC $(AM_LIBTOOLFLAGS) $(LIBTOOLFLAGS) --mode=compile $(CC) $(DEFS) $(DEFAULT_INCLUDES) $(INCLUDES) $(AM_CPPFLAGS) $(CPPFLAGS) $(libwfb_la_CFLAGS) $(CFLAGS) -c -o libwfb_la-fbtile.lo `test -f 'fbtile.c' || echo '$(srcdir)/'`fbtile.c
+
+libwfb_la-fbtrap.lo: fbtrap.c
+@am__fastdepCC_TRUE@	$(LIBTOOL) --tag=CC $(AM_LIBTOOLFLAGS) $(LIBTOOLFLAGS) --mode=compile $(CC) $(DEFS) $(DEFAULT_INCLUDES) $(INCLUDES) $(AM_CPPFLAGS) $(CPPFLAGS) $(libwfb_la_CFLAGS) $(CFLAGS) -MT libwfb_la-fbtrap.lo -MD -MP -MF $(DEPDIR)/libwfb_la-fbtrap.Tpo -c -o libwfb_la-fbtrap.lo `test -f 'fbtrap.c' || echo '$(srcdir)/'`fbtrap.c
+@am__fastdepCC_TRUE@	mv -f $(DEPDIR)/libwfb_la-fbtrap.Tpo $(DEPDIR)/libwfb_la-fbtrap.Plo
+@AMDEP_TRUE@@am__fastdepCC_FALSE@	source='fbtrap.c' object='libwfb_la-fbtrap.lo' libtool=yes @AMDEPBACKSLASH@
+@AMDEP_TRUE@@am__fastdepCC_FALSE@	DEPDIR=$(DEPDIR) $(CCDEPMODE) $(depcomp) @AMDEPBACKSLASH@
+@am__fastdepCC_FALSE@	$(LIBTOOL) --tag=CC $(AM_LIBTOOLFLAGS) $(LIBTOOLFLAGS) --mode=compile $(CC) $(DEFS) $(DEFAULT_INCLUDES) $(INCLUDES) $(AM_CPPFLAGS) $(CPPFLAGS) $(libwfb_la_CFLAGS) $(CFLAGS) -c -o libwfb_la-fbtrap.lo `test -f 'fbtrap.c' || echo '$(srcdir)/'`fbtrap.c
+
+libwfb_la-fbutil.lo: fbutil.c
+@am__fastdepCC_TRUE@	$(LIBTOOL) --tag=CC $(AM_LIBTOOLFLAGS) $(LIBTOOLFLAGS) --mode=compile $(CC) $(DEFS) $(DEFAULT_INCLUDES) $(INCLUDES) $(AM_CPPFLAGS) $(CPPFLAGS) $(libwfb_la_CFLAGS) $(CFLAGS) -MT libwfb_la-fbutil.lo -MD -MP -MF $(DEPDIR)/libwfb_la-fbutil.Tpo -c -o libwfb_la-fbutil.lo `test -f 'fbutil.c' || echo '$(srcdir)/'`fbutil.c
+@am__fastdepCC_TRUE@	mv -f $(DEPDIR)/libwfb_la-fbutil.Tpo $(DEPDIR)/libwfb_la-fbutil.Plo
+@AMDEP_TRUE@@am__fastdepCC_FALSE@	source='fbutil.c' object='libwfb_la-fbutil.lo' libtool=yes @AMDEPBACKSLASH@
+@AMDEP_TRUE@@am__fastdepCC_FALSE@	DEPDIR=$(DEPDIR) $(CCDEPMODE) $(depcomp) @AMDEPBACKSLASH@
+@am__fastdepCC_FALSE@	$(LIBTOOL) --tag=CC $(AM_LIBTOOLFLAGS) $(LIBTOOLFLAGS) --mode=compile $(CC) $(DEFS) $(DEFAULT_INCLUDES) $(INCLUDES) $(AM_CPPFLAGS) $(CPPFLAGS) $(libwfb_la_CFLAGS) $(CFLAGS) -c -o libwfb_la-fbutil.lo `test -f 'fbutil.c' || echo '$(srcdir)/'`fbutil.c
+
+libwfb_la-fbwindow.lo: fbwindow.c
+@am__fastdepCC_TRUE@	$(LIBTOOL) --tag=CC $(AM_LIBTOOLFLAGS) $(LIBTOOLFLAGS) --mode=compile $(CC) $(DEFS) $(DEFAULT_INCLUDES) $(INCLUDES) $(AM_CPPFLAGS) $(CPPFLAGS) $(libwfb_la_CFLAGS) $(CFLAGS) -MT libwfb_la-fbwindow.lo -MD -MP -MF $(DEPDIR)/libwfb_la-fbwindow.Tpo -c -o libwfb_la-fbwindow.lo `test -f 'fbwindow.c' || echo '$(srcdir)/'`fbwindow.c
+@am__fastdepCC_TRUE@	mv -f $(DEPDIR)/libwfb_la-fbwindow.Tpo $(DEPDIR)/libwfb_la-fbwindow.Plo
+@AMDEP_TRUE@@am__fastdepCC_FALSE@	source='fbwindow.c' object='libwfb_la-fbwindow.lo' libtool=yes @AMDEPBACKSLASH@
+@AMDEP_TRUE@@am__fastdepCC_FALSE@	DEPDIR=$(DEPDIR) $(CCDEPMODE) $(depcomp) @AMDEPBACKSLASH@
+@am__fastdepCC_FALSE@	$(LIBTOOL) --tag=CC $(AM_LIBTOOLFLAGS) $(LIBTOOLFLAGS) --mode=compile $(CC) $(DEFS) $(DEFAULT_INCLUDES) $(INCLUDES) $(AM_CPPFLAGS) $(CPPFLAGS) $(libwfb_la_CFLAGS) $(CFLAGS) -c -o libwfb_la-fbwindow.lo `test -f 'fbwindow.c' || echo '$(srcdir)/'`fbwindow.c
+
+libwfb_la-fbpseudocolor.lo: fbpseudocolor.c
+@am__fastdepCC_TRUE@	$(LIBTOOL) --tag=CC $(AM_LIBTOOLFLAGS) $(LIBTOOLFLAGS) --mode=compile $(CC) $(DEFS) $(DEFAULT_INCLUDES) $(INCLUDES) $(AM_CPPFLAGS) $(CPPFLAGS) $(libwfb_la_CFLAGS) $(CFLAGS) -MT libwfb_la-fbpseudocolor.lo -MD -MP -MF $(DEPDIR)/libwfb_la-fbpseudocolor.Tpo -c -o libwfb_la-fbpseudocolor.lo `test -f 'fbpseudocolor.c' || echo '$(srcdir)/'`fbpseudocolor.c
+@am__fastdepCC_TRUE@	mv -f $(DEPDIR)/libwfb_la-fbpseudocolor.Tpo $(DEPDIR)/libwfb_la-fbpseudocolor.Plo
+@AMDEP_TRUE@@am__fastdepCC_FALSE@	source='fbpseudocolor.c' object='libwfb_la-fbpseudocolor.lo' libtool=yes @AMDEPBACKSLASH@
+@AMDEP_TRUE@@am__fastdepCC_FALSE@	DEPDIR=$(DEPDIR) $(CCDEPMODE) $(depcomp) @AMDEPBACKSLASH@
+@am__fastdepCC_FALSE@	$(LIBTOOL) --tag=CC $(AM_LIBTOOLFLAGS) $(LIBTOOLFLAGS) --mode=compile $(CC) $(DEFS) $(DEFAULT_INCLUDES) $(INCLUDES) $(AM_CPPFLAGS) $(CPPFLAGS) $(libwfb_la_CFLAGS) $(CFLAGS) -c -o libwfb_la-fbpseudocolor.lo `test -f 'fbpseudocolor.c' || echo '$(srcdir)/'`fbpseudocolor.c
+
+libwfb_la-fbedge.lo: fbedge.c
+@am__fastdepCC_TRUE@	$(LIBTOOL) --tag=CC $(AM_LIBTOOLFLAGS) $(LIBTOOLFLAGS) --mode=compile $(CC) $(DEFS) $(DEFAULT_INCLUDES) $(INCLUDES) $(AM_CPPFLAGS) $(CPPFLAGS) $(libwfb_la_CFLAGS) $(CFLAGS) -MT libwfb_la-fbedge.lo -MD -MP -MF $(DEPDIR)/libwfb_la-fbedge.Tpo -c -o libwfb_la-fbedge.lo `test -f 'fbedge.c' || echo '$(srcdir)/'`fbedge.c
+@am__fastdepCC_TRUE@	mv -f $(DEPDIR)/libwfb_la-fbedge.Tpo $(DEPDIR)/libwfb_la-fbedge.Plo
+@AMDEP_TRUE@@am__fastdepCC_FALSE@	source='fbedge.c' object='libwfb_la-fbedge.lo' libtool=yes @AMDEPBACKSLASH@
+@AMDEP_TRUE@@am__fastdepCC_FALSE@	DEPDIR=$(DEPDIR) $(CCDEPMODE) $(depcomp) @AMDEPBACKSLASH@
+@am__fastdepCC_FALSE@	$(LIBTOOL) --tag=CC $(AM_LIBTOOLFLAGS) $(LIBTOOLFLAGS) --mode=compile $(CC) $(DEFS) $(DEFAULT_INCLUDES) $(INCLUDES) $(AM_CPPFLAGS) $(CPPFLAGS) $(libwfb_la_CFLAGS) $(CFLAGS) -c -o libwfb_la-fbedge.lo `test -f 'fbedge.c' || echo '$(srcdir)/'`fbedge.c
 
 mostlyclean-libtool:
 	-rm -f *.lo
 
 clean-libtool:
 	-rm -rf .libs _libs
-
-distclean-libtool:
-	-rm -f libtool
-uninstall-info-am:
 install-sdkHEADERS: $(sdk_HEADERS)
 	@$(NORMAL_INSTALL)
-	test -z "$(sdkdir)" || $(mkdir_p) "$(DESTDIR)$(sdkdir)"
+	test -z "$(sdkdir)" || $(MKDIR_P) "$(DESTDIR)$(sdkdir)"
 	@list='$(sdk_HEADERS)'; for p in $$list; do \
 	  if test -f "$$p"; then d=; else d="$(srcdir)/"; fi; \
 	  f=$(am__strip_dir) \
@@ -766,8 +1141,8 @@ ID: $(HEADERS) $(SOURCES) $(LISP) $(TAGS_FILES)
 	unique=`for i in $$list; do \
 	    if test -f "$$i"; then echo $$i; else echo $(srcdir)/$$i; fi; \
 	  done | \
-	  $(AWK) '    { files[$$0] = 1; } \
-	       END { for (i in files) print i; }'`; \
+	  $(AWK) '{ files[$$0] = 1; nonemtpy = 1; } \
+	      END { if (nonempty) { for (i in files) print i; }; }'`; \
 	mkid -fID $$unique
 tags: TAGS
 
@@ -779,8 +1154,8 @@ TAGS:  $(HEADERS) $(SOURCES)  $(TAGS_DEPENDENCIES) \
 	unique=`for i in $$list; do \
 	    if test -f "$$i"; then echo $$i; else echo $(srcdir)/$$i; fi; \
 	  done | \
-	  $(AWK) '    { files[$$0] = 1; } \
-	       END { for (i in files) print i; }'`; \
+	  $(AWK) '{ files[$$0] = 1; nonempty = 1; } \
+	      END { if (nonempty) { for (i in files) print i; }; }'`; \
 	if test -z "$(ETAGS_ARGS)$$tags$$unique"; then :; else \
 	  test -n "$$unique" || unique=$$empty_fix; \
 	  $(ETAGS) $(ETAGSFLAGS) $(AM_ETAGSFLAGS) $(ETAGS_ARGS) \
@@ -790,13 +1165,12 @@ ctags: CTAGS
 CTAGS:  $(HEADERS) $(SOURCES)  $(TAGS_DEPENDENCIES) \
 		$(TAGS_FILES) $(LISP)
 	tags=; \
-	here=`pwd`; \
 	list='$(SOURCES) $(HEADERS)  $(LISP) $(TAGS_FILES)'; \
 	unique=`for i in $$list; do \
 	    if test -f "$$i"; then echo $$i; else echo $(srcdir)/$$i; fi; \
 	  done | \
-	  $(AWK) '    { files[$$0] = 1; } \
-	       END { for (i in files) print i; }'`; \
+	  $(AWK) '{ files[$$0] = 1; nonempty = 1; } \
+	      END { if (nonempty) { for (i in files) print i; }; }'`; \
 	test -z "$(CTAGS_ARGS)$$tags$$unique" \
 	  || $(CTAGS) $(CTAGSFLAGS) $(AM_CTAGSFLAGS) $(CTAGS_ARGS) \
 	     $$tags $$unique
@@ -810,22 +1184,21 @@ distclean-tags:
 	-rm -f TAGS ID GTAGS GRTAGS GSYMS GPATH tags
 
 distdir: $(DISTFILES)
-	@srcdirstrip=`echo "$(srcdir)" | sed 's|.|.|g'`; \
-	topsrcdirstrip=`echo "$(top_srcdir)" | sed 's|.|.|g'`; \
-	list='$(DISTFILES)'; for file in $$list; do \
-	  case $$file in \
-	    $(srcdir)/*) file=`echo "$$file" | sed "s|^$$srcdirstrip/||"`;; \
-	    $(top_srcdir)/*) file=`echo "$$file" | sed "s|^$$topsrcdirstrip/|$(top_builddir)/|"`;; \
-	  esac; \
+	@srcdirstrip=`echo "$(srcdir)" | sed 's/[].[^$$\\*]/\\\\&/g'`; \
+	topsrcdirstrip=`echo "$(top_srcdir)" | sed 's/[].[^$$\\*]/\\\\&/g'`; \
+	list='$(DISTFILES)'; \
+	  dist_files=`for file in $$list; do echo $$file; done | \
+	  sed -e "s|^$$srcdirstrip/||;t" \
+	      -e "s|^$$topsrcdirstrip/|$(top_builddir)/|;t"`; \
+	case $$dist_files in \
+	  */*) $(MKDIR_P) `echo "$$dist_files" | \
+			   sed '/\//!d;s|^|$(distdir)/|;s,/[^/]*$$,,' | \
+			   sort -u` ;; \
+	esac; \
+	for file in $$dist_files; do \
 	  if test -f $$file || test -d $$file; then d=.; else d=$(srcdir); fi; \
-	  dir=`echo "$$file" | sed -e 's,/[^/]*$$,,'`; \
-	  if test "$$dir" != "$$file" && test "$$dir" != "."; then \
-	    dir="/$$dir"; \
-	    $(mkdir_p) "$(distdir)$$dir"; \
-	  else \
-	    dir=''; \
-	  fi; \
 	  if test -d $$d/$$file; then \
+	    dir=`echo "/$$file" | sed -e 's,/[^/]*$$,,'`; \
 	    if test -d $(srcdir)/$$file && test $$d != $(srcdir); then \
 	      cp -pR $(srcdir)/$$file $(distdir)$$dir || exit 1; \
 	    fi; \
@@ -841,7 +1214,7 @@ check: check-am
 all-am: Makefile $(LTLIBRARIES) $(HEADERS)
 installdirs:
 	for dir in "$(DESTDIR)$(sdkdir)"; do \
-	  test -z "$$dir" || $(mkdir_p) "$$dir"; \
+	  test -z "$$dir" || $(MKDIR_P) "$$dir"; \
 	done
 install: install-am
 install-exec: install-exec-am
@@ -876,7 +1249,7 @@ distclean: distclean-am
 	-rm -rf ./$(DEPDIR)
 	-rm -f Makefile
 distclean-am: clean-am distclean-compile distclean-generic \
-	distclean-libtool distclean-tags
+	distclean-tags
 
 dvi: dvi-am
 
@@ -890,12 +1263,20 @@ info-am:
 
 install-data-am: install-sdkHEADERS
 
+install-dvi: install-dvi-am
+
 install-exec-am:
 
+install-html: install-html-am
+
 install-info: install-info-am
 
 install-man:
 
+install-pdf: install-pdf-am
+
+install-ps: install-ps-am
+
 installcheck-am:
 
 maintainer-clean: maintainer-clean-am
@@ -916,19 +1297,23 @@ ps: ps-am
 
 ps-am:
 
-uninstall-am: uninstall-info-am uninstall-sdkHEADERS
+uninstall-am: uninstall-sdkHEADERS
+
+.MAKE: install-am install-strip
 
 .PHONY: CTAGS GTAGS all all-am check check-am clean clean-generic \
 	clean-libtool clean-noinstLTLIBRARIES ctags distclean \
 	distclean-compile distclean-generic distclean-libtool \
 	distclean-tags distdir dvi dvi-am html html-am info info-am \
-	install install-am install-data install-data-am install-exec \
-	install-exec-am install-info install-info-am install-man \
+	install install-am install-data install-data-am install-dvi \
+	install-dvi-am install-exec install-exec-am install-html \
+	install-html-am install-info install-info-am install-man \
+	install-pdf install-pdf-am install-ps install-ps-am \
 	install-sdkHEADERS install-strip installcheck installcheck-am \
 	installdirs maintainer-clean maintainer-clean-generic \
 	mostlyclean mostlyclean-compile mostlyclean-generic \
 	mostlyclean-libtool pdf pdf-am ps ps-am tags uninstall \
-	uninstall-am uninstall-info-am uninstall-sdkHEADERS
+	uninstall-am uninstall-sdkHEADERS
 
 # Tell versions [3.59,3.63) of GNU make to not export all variables.
 # Otherwise a system limit (for SysV at least) may be exceeded.
diff --git a/fb/fb.h b/fb/fb.h
index 3742cf0..c3fa8c4 100644
--- a/fb/fb.h
+++ b/fb/fb.h
@@ -44,6 +44,50 @@
 #include "picture.h"
 #endif
 
+#ifdef FB_ACCESS_WRAPPER
+
+#include "wfbrename.h"
+#define FBPREFIX(x) wfb##x
+#define WRITE(ptr, val) ((*wfbWriteMemory)((ptr), (val), sizeof(*(ptr))))
+#define READ(ptr) ((*wfbReadMemory)((ptr), sizeof(*(ptr))))
+
+#define MEMCPY_WRAPPED(dst, src, size) do {                       \
+    size_t _i;                                                    \
+    CARD8 *_dst = (CARD8*)(dst), *_src = (CARD8*)(src);           \
+    for(_i = 0; _i < size; _i++) {                                \
+        WRITE(_dst +_i, READ(_src + _i));                         \
+    }                                                             \
+} while(0)
+
+#define MEMMOVE_WRAPPED MEMCPY_WRAPPED
+
+#define MEMSET_WRAPPED(dst, val, size) do {                       \
+    size_t _i;                                                    \
+    CARD8 *_dst = (CARD8*)(dst);                                  \
+    for(_i = 0; _i < size; _i++) {                                \
+        WRITE(_dst +_i, (val));                                   \
+    }                                                             \
+} while(0)
+
+#else
+
+#define FBPREFIX(x) fb##x
+#define WRITE(ptr, val) (*(ptr) = (val))
+#define READ(ptr) (*(ptr))
+
+#if defined(__arm__)
+#include "fbarmv6.h"
+#define MEMCPY_WRAPPED(dst, src, size) fbmemcpy_arm((dst), (src), (size))
+#define MEMMOVE_WRAPPED(dst, src, size) fbmemcpy_arm((dst), (src), (size))
+#else
+#define MEMCPY_WRAPPED(dst, src, size) memcpy((dst), (src), (size))
+#define MEMMOVE_WRAPPED(dst, src, size) memcpy((dst), (src), (size))
+#endif
+
+#define MEMSET_WRAPPED(dst, val, size) memset((dst), (val), (size))
+
+#endif
+
 /*
  * This single define controls the basic size of data manipulated
  * by this software; it must be log2(sizeof (FbBits) * 8)
@@ -222,8 +266,8 @@ extern void fbSetBits (FbStip *bits, int stride, FbStip data);
 
 #define FbPtrOffset(p,o,t)		((t *) ((CARD8 *) (p) + (o)))
 #define FbSelectPatternPart(xor,o,t)	((xor) >> (FbPatternOffset (o,t) << 3))
-#define FbStorePart(dst,off,t,xor)	(*FbPtrOffset(dst,off,t) = \
-					 FbSelectPart(xor,off,t))
+#define FbStorePart(dst,off,t,xor)	(WRITE(FbPtrOffset(dst,off,t), \
+					 FbSelectPart(xor,off,t)))
 #ifndef FbSelectPart
 #define FbSelectPart(x,o,t) FbSelectPatternPart(x,o,t)
 #endif
@@ -403,7 +447,7 @@ extern void fbSetBits (FbStip *bits, int stride, FbStip data);
 	FbStorePart(dst,sizeof (FbBits) - 1,CARD8,xor); \
 	break; \
     default: \
-	*dst = FbDoMaskRRop(*dst, and, xor, l); \
+	WRITE(dst, FbDoMaskRRop(READ(dst), and, xor, l)); \
 	break; \
     } \
 }
@@ -423,7 +467,7 @@ extern void fbSetBits (FbStip *bits, int stride, FbStip data);
 	break; \
     FbDoRightMaskByteRRop6Cases(dst,xor) \
     default: \
-	*dst = FbDoMaskRRop (*dst, and, xor, r); \
+	WRITE(dst, FbDoMaskRRop (READ(dst), and, xor, r)); \
     } \
 }
 #endif
@@ -455,20 +499,20 @@ extern void fbSetBits (FbStip *bits, int stride, FbStip data);
  * The term "lane" comes from the hardware term "byte-lane" which
  */
 
-#define FbLaneCase1(n,a,o)  ((n) == 0x01 ? \
-			     (*(CARD8 *) ((a)+FbPatternOffset(o,CARD8)) = \
-			      fgxor) : 0)
-#define FbLaneCase2(n,a,o)  ((n) == 0x03 ? \
-			     (*(CARD16 *) ((a)+FbPatternOffset(o,CARD16)) = \
+#define FbLaneCase1(n,a,o)  ((n) == 0x01 ? (void) \
+			     WRITE((CARD8 *) ((a)+FbPatternOffset(o,CARD8)), \
+			      fgxor) : (void) 0)
+#define FbLaneCase2(n,a,o)  ((n) == 0x03 ? (void) \
+			     WRITE((CARD16 *) ((a)+FbPatternOffset(o,CARD16)), \
 			      fgxor) : \
 			     ((void)FbLaneCase1((n)&1,a,o), \
 				    FbLaneCase1((n)>>1,a,(o)+1)))
-#define FbLaneCase4(n,a,o)  ((n) == 0x0f ? \
-			     (*(CARD32 *) ((a)+FbPatternOffset(o,CARD32)) = \
+#define FbLaneCase4(n,a,o)  ((n) == 0x0f ? (void) \
+			     WRITE((CARD32 *) ((a)+FbPatternOffset(o,CARD32)), \
 			      fgxor) : \
 			     ((void)FbLaneCase2((n)&3,a,o), \
 				    FbLaneCase2((n)>>2,a,(o)+2)))
-#define FbLaneCase8(n,a,o)  ((n) == 0x0ff ? (*(FbBits *) ((a)+(o)) = fgxor) : \
+#define FbLaneCase8(n,a,o)  ((n) == 0x0ff ? (void) (*(FbBits *) ((a)+(o)) = fgxor) : \
 			     ((void)FbLaneCase4((n)&15,a,o), \
 				    FbLaneCase4((n)>>4,a,(o)+4)))
 
@@ -588,6 +632,32 @@ extern WindowPtr    *WindowTable;
 #define FB_SCREEN_PRIVATE
 #endif
 
+/* Framebuffer access wrapper */
+typedef FbBits (*ReadMemoryProcPtr)(const void *src, int size);
+typedef void (*WriteMemoryProcPtr)(void *dst, FbBits value, int size);
+typedef void (*SetupWrapProcPtr)(ReadMemoryProcPtr  *pRead,
+                                 WriteMemoryProcPtr *pWrite,
+                                 DrawablePtr         pDraw);
+typedef void (*FinishWrapProcPtr)(DrawablePtr pDraw);
+
+#ifdef FB_ACCESS_WRAPPER
+
+#define fbPrepareAccess(pDraw) \
+	fbGetScreenPrivate((pDraw)->pScreen)->setupWrap( \
+		&wfbReadMemory, \
+		&wfbWriteMemory, \
+		(pDraw))
+#define fbFinishAccess(pDraw) \
+	fbGetScreenPrivate((pDraw)->pScreen)->finishWrap(pDraw)
+
+#else
+
+#define fbPrepareAccess(pPix)
+#define fbFinishAccess(pDraw)
+
+#endif
+
+
 #ifdef FB_SCREEN_PRIVATE
 extern int	fbScreenPrivateIndex;
 extern int	fbGetScreenPrivateIndex(void);
@@ -596,6 +666,10 @@ extern int	fbGetScreenPrivateIndex(void);
 typedef struct {
     unsigned char	win32bpp;	/* window bpp for 32-bpp images */
     unsigned char	pix32bpp;	/* pixmap bpp for 32-bpp images */
+#ifdef FB_ACCESS_WRAPPER
+    SetupWrapProcPtr	setupWrap;	/* driver hook to set pixmap access wrapping */
+    FinishWrapProcPtr	finishWrap;	/* driver hook to clean up pixmap access wrapping */
+#endif
 } FbScreenPrivRec, *FbScreenPrivPtr;
 
 #define fbGetScreenPrivate(pScreen) ((FbScreenPrivPtr) \
@@ -674,6 +748,7 @@ typedef struct {
 	(xoff) = __fbPixOffXPix(_pPix); \
 	(yoff) = __fbPixOffYPix(_pPix); \
     } \
+    fbPrepareAccess(pDrawable); \
     (pointer) = (FbBits *) _pPix->devPrivate.ptr; \
     (stride) = ((int) _pPix->devKind) / sizeof (FbBits); (void)(stride); \
     (bpp) = _pPix->drawable.bitsPerPixel;  (void)(bpp); \
@@ -690,6 +765,7 @@ typedef struct {
 	(xoff) = __fbPixOffXPix(_pPix); \
 	(yoff) = __fbPixOffYPix(_pPix); \
     } \
+    fbPrepareAccess(pDrawable); \
     (pointer) = (FbStip *) _pPix->devPrivate.ptr; \
     (stride) = ((int) _pPix->devKind) / sizeof (FbStip); (void)(stride); \
     (bpp) = _pPix->drawable.bitsPerPixel; (void)(bpp); \
@@ -1277,6 +1353,9 @@ void
 fbClearVisualTypes(void);
 
 Bool
+fbHasVisualTypes (int depth);
+
+Bool
 fbSetVisualTypes (int depth, int visuals, int bitsPerRGB);
 
 Bool
@@ -1739,6 +1818,30 @@ fbSetupScreen(ScreenPtr	pScreen,
 	      int	bpp);		/* bits per pixel of frame buffer */
 
 Bool
+wfbFinishScreenInit(ScreenPtr	pScreen,
+		    pointer	pbits,
+		    int		xsize,
+		    int		ysize,
+		    int		dpix,
+		    int		dpiy,
+		    int		width,
+		    int		bpp,
+		    SetupWrapProcPtr setupWrap,
+		    FinishWrapProcPtr finishWrap);
+
+Bool
+wfbScreenInit(ScreenPtr	pScreen,
+	      pointer	pbits,
+	      int	xsize,
+	      int	ysize,
+	      int	dpix,
+	      int	dpiy,
+	      int	width,
+	      int	bpp,
+	      SetupWrapProcPtr setupWrap,
+	      FinishWrapProcPtr finishWrap);
+
+Bool
 fbFinishScreenInit(ScreenPtr	pScreen,
 		   pointer	pbits,
 		   int		xsize,
@@ -1994,6 +2097,11 @@ fbReplicatePixel (Pixel p, int bpp);
 void
 fbReduceRasterOp (int rop, FbBits fg, FbBits pm, FbBits *andp, FbBits *xorp);
 
+#ifdef FB_ACCESS_WRAPPER
+extern ReadMemoryProcPtr wfbReadMemory;
+extern WriteMemoryProcPtr wfbWriteMemory;
+#endif
+
 /*
  * fbwindow.c
  */
diff --git a/fb/fb24_32.c b/fb/fb24_32.c
index 572da48..00b739b 100644
--- a/fb/fb24_32.c
+++ b/fb/fb24_32.c
@@ -38,18 +38,18 @@
  * by reading/writing aligned CARD32s where it's easy
  */
 
-#define Get8(a)	((CARD32) *(a))
+#define Get8(a)	((CARD32) READ(a))
 
 #if BITMAP_BIT_ORDER == MSBFirst
 #define Get24(a)    ((Get8(a) << 16) | (Get8((a)+1) << 8) | Get8((a)+2))
-#define Put24(a,p)  (((a)[0] = (CARD8) ((p) >> 16)), \
-		     ((a)[1] = (CARD8) ((p) >> 8)), \
-		     ((a)[2] = (CARD8) (p)))
+#define Put24(a,p)  ((WRITE((a+0), (CARD8) ((p) >> 16))), \
+		     (WRITE((a+1), (CARD8) ((p) >> 8))), \
+		     (WRITE((a+2), (CARD8) (p))))
 #else
 #define Get24(a)    (Get8(a) | (Get8((a)+1) << 8) | (Get8((a)+2)<<16))
-#define Put24(a,p)  (((a)[0] = (CARD8) (p)), \
-		     ((a)[1] = (CARD8) ((p) >> 8)), \
-		     ((a)[2] = (CARD8) ((p) >> 16)))
+#define Put24(a,p)  ((WRITE((a+0), (CARD8) (p))), \
+		     (WRITE((a+1), (CARD8) ((p) >> 8))), \
+		     (WRITE((a+2), (CARD8) ((p) >> 16))))
 #endif
 
 typedef void (*fb24_32BltFunc) (CARD8	    *srcLine,
@@ -106,7 +106,7 @@ fb24_32BltDown (CARD8	    *srcLine,
 	    while (((long) dst & 3) && w)
 	    {
 		w--;
-		pixel = *src++;
+		pixel = READ(src++);
 		pixel = FbDoDestInvarientMergeRop(pixel);
 		Put24 (dst, pixel);
 		dst += 3;
@@ -115,35 +115,35 @@ fb24_32BltDown (CARD8	    *srcLine,
 	    while (w >= 4)
 	    {
 		CARD32  s0, s1;
-		s0 = *src++;
+		s0 = READ(src++);
 		s0 = FbDoDestInvarientMergeRop(s0);
-		s1 = *src++;
+		s1 = READ(src++);
 		s1 = FbDoDestInvarientMergeRop(s1);
 #if BITMAP_BIT_ORDER == LSBFirst
-		*(CARD32 *)(dst) = (s0 & 0xffffff) | (s1 << 24);
+		WRITE((CARD32 *)dst, (s0 & 0xffffff) | (s1 << 24));
 #else
-		*(CARD32 *)(dst) = (s0 << 8) | ((s1 & 0xffffff) >> 16);
+		WRITE((CARD32 *)dst, (s0 << 8) | ((s1 & 0xffffff) >> 16));
 #endif
-		s0 = *src++;
+		s0 = READ(src++);
 		s0 = FbDoDestInvarientMergeRop(s0);
 #if BITMAP_BIT_ORDER == LSBFirst
-		*(CARD32 *)(dst+4) = ((s1 & 0xffffff) >> 8) | (s0 << 16);
+		WRITE((CARD32 *)(dst+4), ((s1 & 0xffffff) >> 8) | (s0 << 16));
 #else
-		*(CARD32 *)(dst+4) = (s1 << 16) | ((s0 & 0xffffff) >> 8);
+		WRITE((CARD32 *)(dst+4), (s1 << 16) | ((s0 & 0xffffff) >> 8));
 #endif
-		s1 = *src++;
+		s1 = READ(src++);
 		s1 = FbDoDestInvarientMergeRop(s1);
 #if BITMAP_BIT_ORDER == LSBFirst
-		*(CARD32 *)(dst+8) = ((s0 & 0xffffff) >> 16) | (s1 << 8);
+		WRITE((CARD32 *)(dst+8), ((s0 & 0xffffff) >> 16) | (s1 << 8));
 #else
-		*(CARD32 *)(dst+8) = (s0 << 24) | (s1 & 0xffffff);
+		WRITE((CARD32 *)(dst+8), (s0 << 24) | (s1 & 0xffffff));
 #endif
 		dst += 12;
 		w -= 4;
 	    }
 	    while (w--)
 	    {
-		pixel = *src++;
+		pixel = READ(src++);
 		pixel = FbDoDestInvarientMergeRop(pixel);
 		Put24 (dst, pixel);
 		dst += 3;
@@ -153,7 +153,7 @@ fb24_32BltDown (CARD8	    *srcLine,
 	{
 	    while (w--)
 	    {
-		pixel = *src++;
+		pixel = READ(src++);
 		dpixel = Get24 (dst);
 		pixel = FbDoMergeRop(pixel, dpixel);
 		Put24 (dst, pixel);
@@ -205,40 +205,40 @@ fb24_32BltUp (CARD8	    *srcLine,
 		w--;
 		pixel = Get24(src);
 		src += 3;
-		*dst++ = FbDoDestInvarientMergeRop(pixel);
+		WRITE(dst++, FbDoDestInvarientMergeRop(pixel));
 	    }
 	    /* Do four aligned pixels at a time */
 	    while (w >= 4)
 	    {
 		CARD32  s0, s1;
 
-		s0 = *(CARD32 *)(src);
+		s0 = READ((CARD32 *)src);
 #if BITMAP_BIT_ORDER == LSBFirst
 		pixel = s0 & 0xffffff;
 #else
 		pixel = s0 >> 8;
 #endif
-		*dst++ = FbDoDestInvarientMergeRop(pixel);
-		s1 = *(CARD32 *)(src+4);
+		WRITE(dst++, FbDoDestInvarientMergeRop(pixel));
+		s1 = READ((CARD32 *)(src+4));
 #if BITMAP_BIT_ORDER == LSBFirst
 		pixel = (s0 >> 24) | ((s1 << 8) & 0xffffff);
 #else
 		pixel = ((s0 << 16) & 0xffffff) | (s1 >> 16);
 #endif
-		*dst++ = FbDoDestInvarientMergeRop(pixel);
-		s0 = *(CARD32 *)(src+8);
+		WRITE(dst++, FbDoDestInvarientMergeRop(pixel));
+		s0 = READ((CARD32 *)(src+8));
 #if BITMAP_BIT_ORDER == LSBFirst
 		pixel = (s1 >> 16) | ((s0 << 16) & 0xffffff);
 #else
 		pixel = ((s1 << 8) & 0xffffff) | (s0 >> 24);
 #endif
-		*dst++ = FbDoDestInvarientMergeRop(pixel);
+		WRITE(dst++, FbDoDestInvarientMergeRop(pixel));
 #if BITMAP_BIT_ORDER == LSBFirst
 		pixel = s0 >> 8;
 #else
 		pixel = s0 & 0xffffff;
 #endif
-		*dst++ = FbDoDestInvarientMergeRop(pixel);
+		WRITE(dst++, FbDoDestInvarientMergeRop(pixel));
 		src += 12;
 		w -= 4;
 	    }
@@ -247,7 +247,7 @@ fb24_32BltUp (CARD8	    *srcLine,
 		w--;
 		pixel = Get24(src);
 		src += 3;
-		*dst++ = FbDoDestInvarientMergeRop(pixel);
+		WRITE(dst++, FbDoDestInvarientMergeRop(pixel));
 	    }
 	}
 	else
@@ -256,7 +256,7 @@ fb24_32BltUp (CARD8	    *srcLine,
 	    {
 		pixel = Get24(src);
 		src += 3;
-		*dst = FbDoMergeRop(pixel, *dst);
+		WRITE(dst, FbDoMergeRop(pixel, READ(dst)));
 		dst++;
 	    }
 	}
@@ -305,6 +305,8 @@ fb24_32GetSpans(DrawablePtr	pDrawable,
 	ppt++;
 	pwidth++;
     }
+
+    fbFinishAccess (pDrawable);
 }
 
 void
@@ -366,6 +368,8 @@ fb24_32SetSpans (DrawablePtr	    pDrawable,
 	ppt++;
 	pwidth++;
     }
+
+    fbFinishAccess (pDrawable);
 }
 
 /*
@@ -429,6 +433,8 @@ fb24_32PutZImage (DrawablePtr	pDrawable,
 			alu,
 			pm);
     }
+
+    fbFinishAccess (pDrawable);
 }
 
 void
@@ -463,6 +469,8 @@ fb24_32GetImage (DrawablePtr     pDrawable,
     fb24_32BltUp (src + (y + srcYoff) * srcStride, srcStride, x + srcXoff,
 		  (CARD8 *) d, dstStride, 0,
 		  w, h, GXcopy, pm);
+
+    fbFinishAccess (pDrawable);
 }
 
 void
@@ -519,6 +527,9 @@ fb24_32CopyMtoN (DrawablePtr pSrcDrawable,
 		pPriv->pm);
 	pbox++;
     }
+
+    fbFinishAccess (pSrcDrawable);
+    fbFinishAccess (pDstDrawable);
 }
 
 PixmapPtr
@@ -563,6 +574,9 @@ fb24_32ReformatTile(PixmapPtr pOldTile, int bitsPerPixel)
 	    GXcopy,
 	    FB_ALLONES);
 
+    fbFinishAccess (&pOldTile->drawable);
+    fbFinishAccess (&pNewTile->drawable);
+
     return pNewTile;
 }
 
diff --git a/fb/fballpriv.c b/fb/fballpriv.c
index 3c05ff3..4f807ed 100644
--- a/fb/fballpriv.c
+++ b/fb/fballpriv.c
@@ -90,3 +90,8 @@ fbAllocatePrivates(ScreenPtr pScreen, int *pGCIndex)
 #endif
     return TRUE;
 }
+
+#ifdef FB_ACCESS_WRAPPER
+ReadMemoryProcPtr wfbReadMemory;
+WriteMemoryProcPtr wfbWriteMemory;
+#endif
diff --git a/fb/fbarc.c b/fb/fbarc.c
index 8f4d296..d2c1a76 100644
--- a/fb/fbarc.c
+++ b/fb/fbarc.c
@@ -109,6 +109,7 @@ fbPolyArc (DrawablePtr	pDrawable,
 		    miPolyArc(pDrawable, pGC, 1, parcs);
 		parcs++;
 	    }
+	    fbFinishAccess (pDrawable);
 	}
 	else
 #endif
diff --git a/fb/fbarmv6.c b/fb/fbarmv6.c
new file mode 100644
index 0000000..5ffd712
--- /dev/null
+++ b/fb/fbarmv6.c
@@ -0,0 +1,322 @@
+/*
+ * Copyright  2008 Nokia Corporation
+ *
+ * Permission to use, copy, modify, distribute and sell this software and its
+ * documentation for any purpose is hereby granted without fee, provided that
+ * the above copyright notice appear in all copies and that both that
+ * copyright notice and this permission notice appear in supporting
+ * documentation, and that the names of the authors and/or copyright holders
+ * not be used in advertising or publicity pertaining to distribution of the
+ * software without specific, written prior permission.  The authors and
+ * copyright holders make no representations about the suitability of this
+ * software for any purpose.  It is provided "as is" without any express
+ * or implied warranty.
+ *
+ * THE AUTHORS AND COPYRIGHT HOLDERS DISCLAIM ALL WARRANTIES WITH REGARD TO
+ * THIS SOFTWARE, INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY AND
+ * FITNESS, IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR
+ * ANY SPECIAL, INDIRECT OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER
+ * RESULTING FROM LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF
+ * CONTRACT, NEGLIGENCE OR OTHER TORTIOUS ACTION, ARISING OUT OF OR IN
+ * CONNECTION WITH THE USE OR PERFORMANCE OF THIS SOFTWARE.
+ *
+ * Author: Siarhei Siamashka <siarhei.siamashka@nokia.com>
+ *
+ * Portions based on fbpict.c
+ */
+ 
+#include "fbarmv6.h"
+#include "fb.h"
+#include "fbpict.h"
+#define USE_ARMV6
+#ifdef USE_ARMV6
+
+#include "fbarmv6_internal.h"
+
+void fbCompositeSolidMask_nx8x0565_armv6 (FbComposeData *params)
+{
+    CARD32  src, srca;
+    CARD16  *dstLine, *dst;
+    CARD8   *maskLine, *mask;
+    FbStride    dstStride, maskStride;
+    CARD16  w, h;
+
+    fbComposeGetSolid(params->src, src, params->dest->format);
+
+    srca = src >> 24;
+    if (src == 0)
+    return;
+
+    fbComposeGetStart (params->dest, params->xDest, params->yDest, CARD16,
+                       dstStride, dstLine, 1);
+    fbComposeGetStart (params->mask, params->xMask, params->yMask, CARD8,
+                       maskStride, maskLine, 1);
+
+    dst = dstLine;
+    mask = maskLine;
+    h = params->height;
+    w = params->width;
+
+    fbCompositeSolidMask_nx8x0565_internal_armv6(dst, mask, src, w,
+                                                 dstStride - w, maskStride - w, h);
+
+    fbFinishAccess (params->mask->pDrawable);
+    fbFinishAccess (params->dest->pDrawable);
+}
+
+void fbCompositeSrcAdd_8000x8000_armv6 (FbComposeData *params)
+{
+    CARD8   *dstLine, *dst;
+    CARD8   *srcLine, *src;
+    FbStride    dstStride, srcStride;
+    CARD16  w, h;
+
+    fbComposeGetStart (params->src, params->xSrc, params->ySrc, CARD8,
+                       srcStride, srcLine, 1);
+    fbComposeGetStart (params->dest, params->xDest, params->yDest, CARD8,
+                       dstStride, dstLine, 1);
+
+    dst = dstLine;
+    src = srcLine;
+    h = params->height;
+    w = params->width;
+
+    fbCompositeSrcAdd_8000x8000_internal_armv6(dst, src, w, dstStride, srcStride, h);
+
+    fbFinishAccess (params->dest->pDrawable);
+    fbFinishAccess (params->src->pDrawable);
+}
+
+void fbComposite_x8r8g8b8_src_r5g6b5_armv6 (FbComposeData *params)
+{
+    CARD16	*dstLine, *dst;
+    CARD32	*srcLine, *src;
+    FbStride	dstStride, srcStride;
+    CARD16	w, h;
+
+    fbComposeGetStart (params->src, params->xSrc, params->ySrc, CARD32,
+                       srcStride, srcLine, 1);
+    fbComposeGetStart (params->dest, params->xDest, params->yDest, CARD16,
+                       dstStride, dstLine, 1);
+
+    dst = dstLine;
+    src = srcLine;
+    h = params->height;
+    w = params->width;
+
+    if (w < 7)
+        fbComposite_x8r8g8b8_src_r5g6b5_internal_mixed_armv6_c(dst, src, w, dstStride, srcStride, h);
+    else
+        fbComposite_x8r8g8b8_src_r5g6b5_internal_armv6(dst, src, w, dstStride, srcStride, h);
+
+    fbFinishAccess (params->dest->pDrawable);
+    fbFinishAccess (params->src->pDrawable);
+}
+
+#if defined(__ARMEL__) && defined(__ARM_EABI__) && defined(__linux__)
+
+void __attribute__((naked)) fbmemcpy_arm(void *dst, void *src, int w)
+{
+    asm volatile(
+        /**
+        * Helper macro for memcpy function, it can copy data from source (r1) to 
+        * destination (r0) buffers fixing alignment in the process. Destination
+        * buffer should be aligned already (4 bytes alignment is required.
+        * Size of the block to copy is in r2 register
+        */
+        ".macro  UNALIGNED_MEMCPY shift\n"
+        "        sub     r1, #(\\shift)\n"
+        "        ldr     ip, [r1], #4\n"
+
+        "        tst     r0, #4\n"
+        "        movne   r3, ip, lsr #(\\shift * 8)\n"
+        "        ldrne   ip, [r1], #4\n"
+        "        subne   r2, r2, #4\n"
+        "        orrne   r3, r3, ip, asl #(32 - \\shift * 8)\n"
+        "        strne   r3, [r0], #4\n"
+
+        "        tst     r0, #8\n"
+        "        movne   r3, ip, lsr #(\\shift * 8)\n"
+        "        ldmneia r1!, {r4, ip}\n"
+        "        subne   r2, r2, #8\n"
+        "        orrne   r3, r3, r4, asl #(32 - \\shift * 8)\n"
+        "        movne   r4, r4, lsr #(\\shift * 8)\n"
+        "        orrne   r4, r4, ip, asl #(32 - \\shift * 8)\n"
+        "        stmneia r0!, {r3-r4}\n"
+        "        cmp     r2, #32\n"
+        "        blt     3f\n"
+        "        pld     [r1, #48]\n"
+        "        stmfd   sp!, {r7, r8, r10, r11}\n"
+        "1:\n"
+        "        pld     [r1, #80]\n"
+        "        subs    r2, r2, #32\n"
+        "        movge   r3, ip, lsr #(\\shift * 8)\n"
+        "        ldmgeia r1!, {r4-r6, r7, r8, r10, r11, ip}\n"
+        "        orrge   r3, r3, r4, asl #(32 - \\shift * 8)\n"
+        "        movge   r4, r4, lsr #(\\shift * 8)\n"
+        "        orrge   r4, r4, r5, asl #(32 - \\shift * 8)\n"
+        "        movge   r5, r5, lsr #(\\shift * 8)\n"
+        "        orrge   r5, r5, r6, asl #(32 - \\shift * 8)\n"
+        "        movge   r6, r6, lsr #(\\shift * 8)\n"
+        "        orrge   r6, r6, r7, asl #(32 - \\shift * 8)\n"
+        "        stmgeia r0!, {r3-r6}\n"
+        "        movge   r7, r7, lsr #(\\shift * 8)\n"
+        "        orrge   r7, r7, r8, asl #(32 - \\shift * 8)\n"
+        "        movge   r8, r8, lsr #(\\shift * 8)\n"
+        "        orrge   r8, r8, r10, asl #(32 - \\shift * 8)\n"
+        "        movge   r10, r10, lsr #(\\shift * 8)\n"
+        "        orrge   r10, r10, r11, asl #(32 - \\shift * 8)\n"
+        "        movge   r11, r11, lsr #(\\shift * 8)\n"
+        "        orrge   r11, r11, ip, asl #(32 - \\shift * 8)\n"
+        "        stmgeia r0!, {r7, r8, r10, r11}\n"
+        "        bgt     1b\n"
+        "2:\n"
+        "        ldmfd   sp!, {r7, r8, r10, r11}\n"
+        "3:\n"   /* copy remaining data */
+        "        tst     r2, #16\n"
+        "        movne   r3, ip, lsr #(\\shift * 8)\n"
+        "        ldmneia r1!, {r4-r6, ip}\n"
+        "        orrne   r3, r3, r4, asl #(32 - \\shift * 8)\n"
+        "        movne   r4, r4, lsr #(\\shift * 8)\n"
+        "        orrne   r4, r4, r5, asl #(32 - \\shift * 8)\n"
+        "        movge   r5, r5, lsr #(\\shift * 8)\n"
+        "        orrge   r5, r5, r6, asl #(32 - \\shift * 8)\n"
+        "        movge   r6, r6, lsr #(\\shift * 8)\n"
+        "        orrge   r6, r6, ip, asl #(32 - \\shift * 8)\n"
+        "        stmneia r0!, {r3-r6}\n"
+
+        "        tst     r2, #8\n"
+        "        movne   r3, ip, lsr #(\\shift * 8)\n"
+        "        ldmneia r1!, {r4, ip}\n"
+        "        orrne   r3, r3, r4, asl #(32 - \\shift * 8)\n"
+        "        movne   r4, r4, lsr #(\\shift * 8)\n"
+        "        orrne   r4, r4, ip, asl #(32 - \\shift * 8)\n"
+        "        stmneia r0!, {r3-r4}\n"
+
+        "        tst     r2, #4\n"
+        "        movne   r3, ip, lsr #(\\shift * 8)\n"
+        "        ldrne   ip, [r1], #4\n"
+        "        sub     r1, r1, #(4 - \\shift)\n"
+        "        orrne   r3, r3, ip, asl #(32 - \\shift * 8)\n"
+        "        strne   r3, [r0], #4\n"
+
+        "        tst     r2, #2\n"
+        "        ldrneb  r3, [r1], #1\n"
+        "        ldrneb  r4, [r1], #1\n"
+        "        ldr     r5, [sp], #4\n"
+        "        strneb  r3, [r0], #1\n"
+        "        strneb  r4, [r0], #1\n"
+
+        "        tst     r2, #1\n"
+        "        ldrneb  r3, [r1], #1\n"
+        "        ldr     r6, [sp], #4\n"
+        "        strneb  r3, [r0], #1\n"
+
+        "        ldmfd   sp!, {r0, r4}\n"
+
+        "        bx      lr\n"
+        ".endm\n"
+
+        "    cmp     r2, #20\n"
+        "    blt     9f\n"
+             /* copy data until destination address is 4 bytes aligned */
+        "    tst     r0, #1\n"
+        "    ldrneb  r3, [r1], #1\n"
+        "    stmfd   sp!, {r0, r4}\n"
+        "    subne   r2, r2, #1\n"
+        "    strneb  r3, [r0], #1\n"
+        "    tst     r0, #2\n"
+        "    ldrneb  r3, [r1], #1\n"
+        "    ldrneb  r4, [r1], #1\n"
+        "    stmfd   sp!, {r5, r6}\n"
+        "    subne   r2, r2, #2\n"
+        "    orrne   r3, r3, r4, asl #8\n"
+        "    strneh  r3, [r0], #2\n"
+             /* destination address is 4 bytes aligned */
+             /* now we should handle 4 cases of source address alignment */
+        "    tst     r1, #1\n"
+        "    bne     6f\n"
+        "    tst     r1, #2\n"
+        "    bne     7f\n"
+
+             /* both source and destination are 4 bytes aligned */
+        "    stmfd   sp!, {r7, r8, r10, r11}\n"
+        "    tst     r0, #4\n"
+        "    ldrne   r4, [r1], #4\n"
+        "    subne   r2, r2, #4\n"
+        "    strne   r4, [r0], #4\n"
+        "    tst     r0, #8\n"
+        "    ldmneia r1!, {r3-r4}\n"
+        "    subne   r2, r2, #8\n"
+        "    stmneia r0!, {r3-r4}\n"
+    "1:\n"
+        "    subs    r2, r2, #32\n"
+        "    ldmgeia r1!, {r3-r6, r7, r8, r10, r11}\n"
+        "    pld     [r1, #48]\n"
+        "    stmgeia r0!, {r3-r6}\n"
+        "    stmgeia r0!, {r7, r8, r10, r11}\n"
+        "    bgt     1b\n"
+    "2:\n"
+        "    ldmfd   sp!, {r7, r8, r10, r11}\n"
+        "    tst     r2, #16\n"
+        "    ldmneia r1!, {r3-r6}\n"
+        "    stmneia r0!, {r3-r6}\n"
+        "    tst     r2, #8\n"
+        "    ldmneia r1!, {r3-r4}\n"
+        "    stmneia r0!, {r3-r4}\n"
+        "    tst     r2, #4\n"
+        "    ldrne   r3, [r1], #4\n"
+        "    mov     ip, r0\n"
+        "    strne   r3, [ip], #4\n"
+        "    tst     r2, #2\n"
+        "    ldrneh  r3, [r1], #2\n"
+        "    ldmfd   sp!, {r5, r6}\n"
+        "    strneh  r3, [ip], #2\n"
+        "    tst     r2, #1\n"
+        "    ldrneb  r3, [r1], #1\n"
+        "    ldmfd   sp!, {r0, r4}\n"
+        "    strneb  r3, [ip], #1\n"
+
+        "    bx      lr\n"
+
+    "6:\n"
+        "    tst    r1, #2\n"
+        "    bne    8f\n"
+        "    UNALIGNED_MEMCPY 1\n"
+    "7:\n"
+        "    UNALIGNED_MEMCPY 2\n"
+    "8:\n"
+        "    UNALIGNED_MEMCPY 3\n"
+    "9:\n"
+        "    stmfd  sp!, {r0, r4}\n"
+    "1:      subs   r2, r2, #3\n"
+        "    ldrgeb ip, [r0]\n"
+        "    ldrgeb r3, [r1], #1\n"
+        "    ldrgeb r4, [r1], #1\n"
+        "    ldrgeb ip, [r1], #1\n"
+        "    strgeb r3, [r0], #1\n"
+        "    strgeb r4, [r0], #1\n"
+        "    strgeb ip, [r0], #1\n"
+        "    bge    1b\n"
+        "    adds   r2, r2, #2\n"
+        "    ldrgeb r3, [r1], #1\n"
+        "    mov    ip, r0\n"
+        "    ldr    r0, [sp], #4\n"
+        "    strgeb r3, [ip], #1\n"
+        "    ldrgtb r3, [r1], #1\n"
+        "    ldr    r4, [sp], #4\n"
+        "    strgtb r3, [ip], #1\n"
+        "    bx     lr\n"
+    );
+}
+
+#else
+
+void fbmemcpy_arm(void *dst, void *src, int w)
+{
+    memcpy(dst, src, w);
+}
+
+#endif
+
+#endif
diff --git a/fb/fbarmv6.h b/fb/fbarmv6.h
new file mode 100644
index 0000000..03b2619
--- /dev/null
+++ b/fb/fbarmv6.h
@@ -0,0 +1,95 @@
+/*
+ * Copyright  2008 Nokia Corporation
+ *
+ * Permission to use, copy, modify, distribute and sell this software and its
+ * documentation for any purpose is hereby granted without fee, provided that
+ * the above copyright notice appear in all copies and that both that
+ * copyright notice and this permission notice appear in supporting
+ * documentation, and that the names of the authors and/or copyright holders
+ * not be used in advertising or publicity pertaining to distribution of the
+ * software without specific, written prior permission.  The authors and
+ * copyright holders make no representations about the suitability of this
+ * software for any purpose.  It is provided "as is" without any express
+ * or implied warranty.
+ *
+ * THE AUTHORS AND COPYRIGHT HOLDERS DISCLAIM ALL WARRANTIES WITH REGARD TO
+ * THIS SOFTWARE, INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY AND
+ * FITNESS, IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR
+ * ANY SPECIAL, INDIRECT OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER
+ * RESULTING FROM LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF
+ * CONTRACT, NEGLIGENCE OR OTHER TORTIOUS ACTION, ARISING OUT OF OR IN
+ * CONNECTION WITH THE USE OR PERFORMANCE OF THIS SOFTWARE.
+ *
+ * Author: Siarhei Siamashka <siarhei.siamashka@nokia.com>
+ *
+ * Portions based on fbpict.c
+ */
+
+#ifndef _FBARMV6_H_
+#define _FBARMV6_H_
+
+/* a very simple test for ARMv6 instructions support availability, probably it is
+   better to integrate something into configure script instead */
+#if defined(__ARM_ARCH_6__) || defined(__ARM_ARCH_6J__)
+#define USE_ARMV6
+#endif
+
+#ifdef USE_ARMV6
+
+#define FbByteMulAdd_store_r5g6b5_armv6(x, a, y) do {                         \
+        unsigned int t = ((x & 0xff00ff) * a) + 0x800080;                     \
+        x = (((x >> 8) & 0xff) * a) + 0x80;                                   \
+        t = (t + ((t >> 8) & 0xff00ff));                                      \
+        x = (x + ((x >> 8)));                                                 \
+        asm(".arch iwmmxt\n\t"	\
+        	".cpu iwmmxt\n\t"	\
+			"tmcrr wr0, %1, %2\n\t" 										  \
+        	"wunpckehuw wr1, wr0\n\t"                                          \
+        	"waddbus wr2, wr0, wr1\n\t"	                                      \
+    		"textrmsw %0, wr0, #0\n\t"											  \
+			: "=r" (t)                                                        \
+			: "r" (t), "r" (y << 8)											  \
+			);       					              						  \
+		asm(".arch iwmmxt\n\t"	\
+			".cpu iwmmxt\n\t"	\
+			"tmcrr wr0, %1, %2\n\t" 										  \
+        	"wunpckehuw wr1, wr0\n\t"                                          \
+        	"waddbus wr2, wr0, wr1\n\t"	                                      \
+    		"textrmsw %0, wr0, #0\n\t"											  \
+			: "=r" (x)                                                        \
+			: "r" (x), "r" (y)												  \
+			);       					              						  \
+        x = ((t >> (3 + 8)) & 0x001F)                                         \
+                | ((t >> (8 + 8)) & 0xF800) | ((x >> 5) & 0x07E0);            \
+    } while (0)
+
+#define FbByteMulAdd_store_x8r8g8b8_armv6(x, a, y) do {                       \
+        unsigned int t = ((x & 0xff00ff) * a) + 0x800080;                     \
+        x = (((x >> 8) & 0xff) * a) + 0x80;                                   \
+        t = (t + ((t >> 8) & 0xff00ff));                                      \
+        x = (x + ((x >> 8)));                                                 \
+        t = (t >> 8) & 0xff00ff;                                              \
+        x &= 0xff00;                                                          \
+        x += t;                                                               \
+        asm(".arch iwmmxt\n\t" \
+        	".cpu iwmmxt\n\t" \
+			"tmcrr wr0, %1, %2\n\t" 										  \
+        	"wunpckehuw wr1, wr0\n\t"                                          \
+        	"waddbus wr2, wr0, wr1\n\t"	                                      \
+    		"textrmsw %0, wr0, #0\n\t"											  \
+			: "=r" (x)                                                        \
+			: "r" (x), "r" (y & 0xffffff)									  \
+			);  														      \
+    } while (0)
+
+#endif
+
+struct _FbComposeData;
+
+void fbCompositeSolidMask_nx8x0565_armv6 (struct _FbComposeData *params);
+void fbCompositeSrcAdd_8000x8000_armv6 (struct _FbComposeData *params);
+void fbComposite_x8r8g8b8_src_r5g6b5_armv6 (struct _FbComposeData *params);
+
+void fbmemcpy_arm(void *dst, void *src, int w);
+
+#endif
diff --git a/fb/fbarmv6_internal.h b/fb/fbarmv6_internal.h
new file mode 100644
index 0000000..84517f7
--- /dev/null
+++ b/fb/fbarmv6_internal.h
@@ -0,0 +1,740 @@
+/*
+ * Copyright  2008 Nokia Corporation
+ *
+ * Permission to use, copy, modify, distribute and sell this software and its
+ * documentation for any purpose is hereby granted without fee, provided that
+ * the above copyright notice appear in all copies and that both that
+ * copyright notice and this permission notice appear in supporting
+ * documentation, and that the names of the authors and/or copyright holders
+ * not be used in advertising or publicity pertaining to distribution of the
+ * software without specific, written prior permission.  The authors and
+ * copyright holders make no representations about the suitability of this
+ * software for any purpose.  It is provided "as is" without any express
+ * or implied warranty.
+ *
+ * THE AUTHORS AND COPYRIGHT HOLDERS DISCLAIM ALL WARRANTIES WITH REGARD TO
+ * THIS SOFTWARE, INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY AND
+ * FITNESS, IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR
+ * ANY SPECIAL, INDIRECT OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER
+ * RESULTING FROM LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF
+ * CONTRACT, NEGLIGENCE OR OTHER TORTIOUS ACTION, ARISING OUT OF OR IN
+ * CONNECTION WITH THE USE OR PERFORMANCE OF THIS SOFTWARE.
+ *
+ * Author: Siarhei Siamashka <siarhei.siamashka@nokia.com>
+ *
+ * Portions based on fbpict.c
+ */
+
+#ifndef _FBARMV6_INTERNAL_H_
+#define _FBARMV6_INTERNAL_H_
+
+#include <stdint.h>
+#define USE_ARMV6
+#ifdef USE_ARMV6
+
+static inline uint32_t iwmmxt_wadd8(uint32_t a, uint32_t b)
+{
+    uint32_t result;
+    asm (
+    	".arch iwmmxt\n\t"
+    	".cpu iwmmxt\n\t"
+    	"tmcrr wr0, r0, r1\n\t"
+        "wunpckehuw wr1, wr0\n\t"
+        "waddbus wr2, wr0, wr1\n\t"
+    	"textrmsw %0, wr2, #0\n\t"
+    	: "=r" (result)
+    );
+    return result;
+}
+#endif
+
+/*
+ * A 'reference' C code of optimized 'fbCompositeSolidMask_nx8x0565' function, the use
+ * of assembly is minimal (restricted to the use of 'uqadd8' instruction only).
+ * 
+ * Note: 'dst_stride_delta' and 'mask_stride_delta' are not strides, but need
+ *       be initialized with 'stride - width'
+ */
+static inline void fbCompositeSolidMask_nx8x0565_internal_mixed_armv6_c_helper(
+    uint16_t *dst, uint8_t *mask, uint32_t src, int w,
+    int dst_stride_delta, int mask_stride_delta, int h, const int opaquesrc)
+{
+    int backup_w = w;
+    uint8_t a;
+    uint32_t tmp1, tmp2, tmp3, tmp4, d;
+    register const uint32_t unpacked_src_20 = src & 0x00FF00FF;
+    register const uint32_t unpacked_src_31 = (src >> 8) & 0x00FF00FF;
+    register const uint16_t src16 = ((src >> 3) & 0x001F) | ((src >> 5) & 0x07E0) | ((src >> 8) & 0xF800);
+    while (--h >= 0)
+    {
+        while (--w >= 0)
+        {
+            a = *mask++;
+
+            if (a == 0) { dst++; continue; }
+
+            if (opaquesrc && a == 0xFF) { *dst++ = src16; continue; }
+
+            tmp1 = unpacked_src_20 * a + 0x800080;
+            tmp2 = unpacked_src_31 * a + 0x800080;
+            d = *dst;
+            tmp1 += (tmp1 & 0xFF00FFFF) >> 8;
+            tmp2 += (tmp2 & 0xFF00FFFF) >> 8;
+
+            a = ~tmp2 >> 24;
+
+            tmp3 = (((d) << 3) & 0xF8) | (((d) << 8) & 0xF80000);
+            tmp3 |= ((tmp3 >> 5) & 0x70007);
+
+            tmp4 = (((d) >> 3) & 0xFC);
+            tmp4 |= (tmp4 >> 6) & 0x3;
+
+            tmp3 *= a;
+            tmp4 *= a;
+            tmp3 += 0x800080;
+            tmp4 += 0x800080;
+            tmp3 += (tmp3 & 0xFF00FFFF) >> 8;
+            tmp4 += (tmp4 & 0xFF00FFFF) >> 8;
+
+            tmp1 = iwmmxt_wadd8(tmp1, tmp3);
+            tmp2 = iwmmxt_wadd8(tmp2, tmp4);
+
+            d = ((tmp1 >> (3 + 8)) & 0x001F);
+            d |= ((tmp1 >> (8 + 8)) & 0xF800);
+            d |= (tmp2 >> 5) & 0x07E0;
+
+            *dst++ = d;
+        }
+        w = backup_w;
+        dst += dst_stride_delta;
+        mask += mask_stride_delta;
+    }
+}
+
+static inline void fbCompositeSolidMask_nx8x0565_internal_mixed_armv6_c(
+    uint16_t *dst, uint8_t *mask, uint32_t src, int w,
+    int dst_stride_delta, int mask_stride_delta, int h)
+{
+    if ((src >> 24) == 0xFF)
+        fbCompositeSolidMask_nx8x0565_internal_mixed_armv6_c_helper(dst, mask, src, w,
+            dst_stride_delta, mask_stride_delta, h, 1);
+    else
+        fbCompositeSolidMask_nx8x0565_internal_mixed_armv6_c_helper(dst, mask, src, w,
+            dst_stride_delta, mask_stride_delta, h, 0);
+}
+
+#if defined(__ARM_EABI__) && defined(__linux__)
+/*
+ * ARMv6 assembly optimized version of 'fbCompositeSolidMask_nx8x0565'. It is
+ * a bare metal 'naked' function which uses all the available CPU registers and
+ * is compatible with ARM EABI. It might (or might not) break when used with a
+ * different ABI, anyway better be safe than sorry.
+ */
+static void __attribute__((naked)) fbCompositeSolidMask_nx8x0565_internal_armv6(
+    uint16_t *dst, uint8_t *mask, uint32_t src, int w,
+    int dst_stride_delta, int mask_stride_delta, int h)
+{
+    asm volatile(
+    		".arch iwmmxt\n"
+    		".cpu iwmmxt\n"
+        ".macro fbCompositeSolidMask_nx8x0565_internal_armv6_asm opaque_flag\n"
+            /* save all registers (8 words) to stack */
+            "stmdb   sp!, {r4-r11, ip, lr}\n" 
+            /* some register aliases for better readability */
+            "DST     .req  r0\n"
+            "MASK    .req  r1\n"
+            "S       .req  r2\n"
+            "W       .req  r3\n"
+            "A       .req  r8\n"
+            "D       .req  r10\n"
+            "C0000FF .req  r11\n"
+            "C00001F .req  r9\n"
+            "C800080 .req  ip\n"
+            "CE000E0 .req  lr\n"
+            /* precalculate some stuff and put it on stack */
+            "mov     r6, #0xF8\n"
+            "mov     r7, #0xFC\n"
+
+            "str     W, [sp, #-8]!\n"
+
+            ".if \\opaque_flag\n"
+                /* ((src >> 3) & 0x001F) | ((src >> 5) & 0x07E0) | ((src >> 8) & 0xF800) */
+                /* precalculate and save it to stack for later use */
+                "mov     A, #0x1F\n"
+                "and     D, A, S, lsr #3\n"
+                "and     r4, S, #0xF80000\n"
+                "and     r5, S, #0xFC00\n"
+                "orr     D, r4, lsr #8\n"
+                "orr     D, r5, lsr #5\n"
+                "str     D, [sp, #4]\n"
+            ".endif\n"
+
+            "ldr     D, [sp, #(8 + 10*4 + 8)]\n" /* h */
+            "ldr     A, =0xFF00FF\n"
+            "ldr     C800080, =0x800080\n"
+            "ldr     CE000E0, =0xE000E0\n"
+            "ldr     C0000FF, =0xFF\n"
+            "ldr     C00001F, =0x1F\n"
+            "and     r4, A, S\n"           /* r4 = src & 0x00FF00FF */
+            "and     r5, A, S, lsr #8\n"   /* r5 = (src >> 8) & 0x00FF00FF */
+            "stmdb   sp!, {r4, r5, r6, r7}\n"
+        "0:\n"
+            "subs    D, D, #1\n"
+            "blt     6f\n"
+        "1:\n"
+            "subs    W, W, #1\n"
+            "blt     5f\n"
+        "2:\n"
+            "ldrb    A, [MASK], #1\n"
+            "ldmia   sp, {r4, r5, r6, r7}\n" /* load a set of constants from stack */
+            "add     DST, DST, #2\n"
+            "cmp     A, #0\n"
+            "beq     1b\n"
+
+            ".if \\opaque_flag\n"
+                "cmp     A, #0xFF\n"
+                "bne     3f\n"
+                "ldr     D, [sp, #(4*4 + 4)]\n" /* load precalculated value */
+                "subs    W, #1\n"
+                "strh    D, [DST, #-2]\n"
+                "bge     2b\n"
+            ".endif\n"
+
+        "3:\n"
+            "ldrh    D, [DST, #-2]\n"
+            "mla     r4, A, r4, C800080\n"
+            "mla     r5, A, r5, C800080\n"
+            "and     r6, r6, D, lsl #3\n" /* & 0xF8 */
+            "and     r7, r7, D, lsr #3\n" /* & 0xFC */
+            "and     D, D, #0xF800\n"
+            "bic     S, r4, #0xFF0000\n"
+            "bic     A, r5, #0xFF0000\n"
+            "add     r4, r4, S, lsr #8\n"
+            "add     r5, r5, A, lsr #8\n"
+
+            "and     S, r7, #0xC0\n"
+            "orr     r6, r6, D, lsl #8\n"
+            "and     D, r6, CE000E0\n"
+            "eor     A, C0000FF, r5, lsr #24\n"
+            "orr     r6, D, lsr #5\n"
+            "orr     r7, S, lsr #6\n"
+
+            "mla     r6, A, r6, C800080\n"
+            "mla     r7, A, r7, C800080\n"
+            "subs    W, #1\n"
+            "bic     D, r6, #0xFF0000\n"
+            "bic     A, r7, #0xFF0000\n"
+            "add     r6, r6, D, lsr #8\n"
+            /*iwmmxt uqadd8 substitute code start */
+               "tmcrr	 wr0, r4, r6\n"
+               "wunpckehuw wr1, wr0\n"
+               "waddbus wr2, wr0, wr1\n"
+               "textrmsw r4, wr2, #0\n"
+            /* "uqadd8  r4, r4, r6\n" */
+               "add     r7, r7, A, lsr #8\n"
+               "tmcrr	 wr0, r5, r7\n"
+               "wunpckehuw wr1, wr0\n"
+               "waddbus wr2, wr0, wr1\n"
+               "textrmsw r5, wr2, #0\n"
+            /* "uqadd8  r5, r5, r7\n" */
+            /*iwmmxt uqadd8 substitute code end */
+            "and     D, C00001F, r4, lsr #11\n"
+            "and     r4, r4, #0xF8000000\n"
+            "and     r5, r5, #0xFC00\n"
+            "orr     D, r4, lsr #16\n"
+            "orr     D, r5, lsr #5\n"
+            "strh    D, [DST, #-2]\n"
+            "bge     2b\n"
+        "5:\n"
+            "ldr     r6, [sp, #(4*4 + 8 + 10*4 + 8)]\n" /* h */
+            "ldr     r4, [sp, #(4*4 + 8 + 10*4 + 4)]\n" /* mask stride */
+            "ldr     r5, [sp, #(4*4 + 8 + 10*4 + 0)]\n" /* dst stride */
+            "ldr     W, [sp, #(4*4)]\n"
+            "subs    r6, r6, #1\n" /* h */
+            "str     r6, [sp, #(4*4 + 8 + 10*4 + 8)]\n" /* h */
+            "add     MASK, MASK, r4\n"
+            "add     DST, DST, r5, lsl #1\n"
+            "bgt     1b\n"
+        "6:\n"
+            "add     sp, sp, #(4*4 + 8)\n"
+            "ldmia   sp!, {r4-r11, ip, pc}\n" /* restore all registers and return */
+            ".unreq DST\n"
+            ".unreq MASK\n"
+            ".unreq S\n"
+            ".unreq W\n"
+            ".unreq A\n"
+            ".unreq D\n"
+            ".unreq C0000FF\n"
+            ".unreq C00001F\n"
+            ".unreq C800080\n"
+            ".unreq CE000E0\n"
+        ".endm\n"
+
+        "mov     ip, r2, lsr #24\n"
+        "cmp     ip, #0xFF\n"
+        "beq     9f\n"
+        "fbCompositeSolidMask_nx8x0565_internal_armv6_asm 0\n"
+    "9:\n"
+        "fbCompositeSolidMask_nx8x0565_internal_armv6_asm 1\n"
+        ".ltorg\n"
+    );
+}
+
+#else
+
+#define fbCompositeSolidMask_nx8x0565_internal_armv6(a, b, c, d, e, f, g) \
+    fbCompositeSolidMask_nx8x0565_internal_mixed_armv6_c((a), (b), (c), (d), (e), (f), (g))
+
+#endif
+
+/**
+ * A 'reference' C code of optimized 'fbCompositeSrcAdd_8000x8000' function, the 
+ * use of assembly is minimal (restricted to the use of 'uqadd8' instruction only).
+ *
+ * Code is implemented by processing two rows simultaneously for better handling 
+ * of the common use cases (operations with fonts glyphs) where width is quite small
+ * (typically only 6-13 pixels).
+ */
+static inline void fbCompositeSrcAdd_8000x8000_internal_mixed_armv6_c(
+    uint8_t *dst, uint8_t *src, int w, int dst_stride,
+    int src_stride, int h)
+{
+    int backup_w = w;
+    uint32_t s1, s2, d1, d2;
+
+    /* process two rows at once */
+    while ((h -= 2) >= 0)
+    {
+        w = backup_w;
+        if (w >= 3)
+        {
+            if ((uintptr_t)dst & 1)
+            {
+                s1 = *(uint8_t *)(src + src_stride);
+                s2 = *(uint8_t *)src;
+                src += 1;
+                d1 = *(uint8_t *)(dst + dst_stride);
+                d2 = *(uint8_t *)dst;
+                d1 = iwmmxt_wadd8(d1, s1);
+                d2 = iwmmxt_wadd8(d2, s2);
+                *(uint8_t *)(dst + dst_stride) = d1;
+                *(uint8_t *)(dst) = d2;
+                dst += 1;
+                w -= 1;
+            }
+            if ((uintptr_t)dst & 2)
+            {
+                s1 = *(uint16_t *)(src + src_stride);
+                s2 = *(uint16_t *)src;
+                src += 2;
+                d1 = *(uint16_t *)(dst + dst_stride);
+                d2 = *(uint16_t *)dst;
+                d1 = iwmmxt_wadd8(d1, s1);
+                d2 = iwmmxt_wadd8(d2, s2);
+                *(uint16_t *)(dst + dst_stride) = d1;
+                *(uint16_t *)(dst) = d2;
+                dst += 2;
+                w -= 2;
+            }
+        }
+
+        while ((w -= 4) >= 0)
+        {
+            s1 = *(uint32_t *)(src + src_stride);
+            s2 = *(uint32_t *)src;
+            src += 4;
+            d1 = *(uint32_t *)(dst + dst_stride);
+            d2 = *(uint32_t *)dst;
+            d1 = iwmmxt_wadd8(d1, s1);
+            d2 = iwmmxt_wadd8(d2, s2);
+            *(uint32_t *)(dst + dst_stride) = d1;
+            *(uint32_t *)(dst) = d2;
+            dst += 4;
+        }
+
+        if (w & 2)
+        {
+            s1 = *(uint16_t *)(src + src_stride);
+            s2 = *(uint16_t *)src;
+            src += 2;
+            d1 = *(uint16_t *)(dst + dst_stride);
+            d2 = *(uint16_t *)dst;
+            d1 = iwmmxt_wadd8(d1, s1);
+            d2 = iwmmxt_wadd8(d2, s2);
+            *(uint16_t *)(dst + dst_stride) = d1;
+            *(uint16_t *)(dst) = d2;
+            dst += 2;
+        }
+        if (w & 1)
+        {
+            s1 = *(uint8_t *)(src + src_stride);
+            s2 = *(uint8_t *)src;
+            src += 1;
+            d1 = *(uint8_t *)(dst + dst_stride);
+            d2 = *(uint8_t *)dst;
+            d1 = iwmmxt_wadd8(d1, s1);
+            d2 = iwmmxt_wadd8(d2, s2);
+            *(uint8_t *)(dst + dst_stride) = d1;
+            *(uint8_t *)(dst) = d2;
+            dst += 1;
+        }
+
+        src += src_stride * 2 - backup_w;
+        dst += dst_stride * 2 - backup_w;
+    }
+
+    /* process the last remaining row if needed */
+    if (h == -1)
+    {
+        w = backup_w;
+        if (w >= 3)
+        {
+            if ((uintptr_t)dst & 1)
+            {
+                s2 = *(uint8_t *)src;
+                src += 1;
+                d2 = *(uint8_t *)dst;
+                d2 = iwmmxt_wadd8(d2, s2);
+                *(uint8_t *)(dst) = d2;
+                dst += 1;
+                w -= 1;
+            }
+            if ((uintptr_t)dst & 2)
+            {
+                s2 = *(uint16_t *)src;
+                src += 2;
+                d2 = *(uint16_t *)dst;
+                d2 = iwmmxt_wadd8(d2, s2);
+                *(uint16_t *)(dst) = d2;
+                dst += 2;
+                w -= 2;
+            }
+        }
+
+        while ((w -= 4) >= 0)
+        {
+            s2 = *(uint32_t *)src;
+            src += 4;
+            d2 = *(uint32_t *)dst;
+            d2 = iwmmxt_wadd8(d2, s2);
+            *(uint32_t *)(dst) = d2;
+            dst += 4;
+        }
+
+        if (w & 2)
+        {
+            s2 = *(uint16_t *)src;
+            src += 2;
+            d2 = *(uint16_t *)dst;
+            d2 = iwmmxt_wadd8(d2, s2);
+            *(uint16_t *)(dst) = d2;
+            dst += 2;
+        }
+        if (w & 1)
+        {
+            s2 = *(uint8_t *)src;
+            src += 1;
+            d2 = *(uint8_t *)dst;
+            d2 = iwmmxt_wadd8(d2, s2);
+            *(uint8_t *)(dst) = d2;
+            dst += 1;
+        }
+    }
+}
+
+/**
+ * Conversion x8r8g8b8 -> r5g6b5
+ *
+ * TODO: implement an fully ARMv6 assembly optimized version of this function
+ */
+#define fbCompositeSrcAdd_8000x8000_internal_armv6(a, b, c, d, e, f) \
+    fbCompositeSrcAdd_8000x8000_internal_mixed_armv6_c((a), (b), (c), (d), (e), (f))
+
+static inline void fbComposite_x8r8g8b8_src_r5g6b5_internal_c(
+    uint16_t *dst, uint32_t *src, int w, int dst_stride,
+    int src_stride, int h)
+{
+    uint32_t a, b, s;
+    int backup_w = w;
+    while (h--)
+    {
+        w = backup_w;
+        while (w--)
+        {
+            s = *src++;
+
+            a = (s >> 3) & 0x1F001F;
+            b = s & 0xFC00;
+            a |= a >> 5;
+            a |= b >> 5;
+
+            *dst++ = a;
+        }
+        src += src_stride - backup_w;
+        dst += dst_stride - backup_w;
+    }
+}
+
+/**
+ * Conversion x8r8g8b8 -> r5g6b5
+ *
+ * TODO: optimize more, eliminate stalls, try to use burst writes (4 words aligned 
+ * at 16 byte boundary)
+ */
+static inline void fbComposite_x8r8g8b8_src_r5g6b5_internal_mixed_armv6_c(
+    uint16_t *dst, uint32_t *src, int w, int dst_stride,
+    int src_stride, int h)
+{
+    uint32_t a, x, y, c1F001F = 0x1F001F;
+    int backup_w = w;
+    while (h--)
+    {
+        w = backup_w;
+        if (w > 0 && (uintptr_t)dst & 2)
+        {
+            x = *src++;
+
+            a = (x >> 3) & c1F001F;
+            x &= 0xFC00;
+            a |= a >> 5;
+            a |= x >> 5;
+
+            *dst++ = a;
+            w--;
+        }
+
+        asm volatile(
+        	".arch iwmmxt\n"
+        	".cpu iwmmxt\n"
+            "subs  %[w], %[w], #2\n"
+            "blt   2f\n"
+        "1:\n"
+            "ldr   %[x], [%[src]], #4\n"
+            "ldr   %[y], [%[src]], #4\n"
+            "subs  %[w], %[w], #2\n"
+            
+            "and   %[a], %[c1F001F], %[x], lsr #3\n"
+            "and   %[x], %[x], #0xFC00\n\n"
+            "orr   %[a], %[a], %[a], lsr #5\n"
+            "orr   %[x], %[a], %[x], lsr #5\n"
+
+            "and   %[a], %[c1F001F], %[y], lsr #3\n"
+            "and   %[y], %[y], #0xFC00\n\n"
+            "orr   %[a], %[a], %[a], lsr #5\n"
+            "orr   %[y], %[a], %[y], lsr #5\n"
+        	/* pkhbt iwmmxt replacement code start */
+        	"tinsrh wr0, %[x], #0\n"
+        	"tinsrh wr0, %[y], #1\n"
+        	"textrmsw %[x], wr0, #0\n"
+            /* "pkhbt %[x], %[x], %[y], lsl #16\n" */
+        	/* pkhbt iwmmxt replacement code end */
+            "str   %[x], [%[dst]], #4\n"
+            "bge   1b\n"
+        "2:\n"
+        : [c1F001F] "+&r" (c1F001F), [src] "+&r" (src), [dst] "+&r" (dst), [a] "=&r" (a), 
+          [x] "=&r" (x), [y] "=&r" (y), [w] "+&r" (w)
+        );
+
+        if (w & 1)
+        {
+            x = *src++;
+
+            a = (x >> 3) & c1F001F;
+            x = x & 0xFC00;
+            a |= a >> 5;
+            a |= x >> 5;
+
+            *dst++ = a;
+        }
+
+        src += src_stride - backup_w;
+        dst += dst_stride - backup_w;
+    }
+}
+
+#if defined(__ARMEL__) && defined(__ARM_EABI__) && defined(__linux__)
+
+/**
+ * Conversion x8r8g8b8 -> r5g6b5
+ *
+ * Note: 'w' must be >= 7
+ */
+static void __attribute__((naked)) fbComposite_x8r8g8b8_src_r5g6b5_internal_armv6(
+    uint16_t *dst, uint32_t *src, int w, int dst_stride,
+    int src_stride, int h)
+{
+    asm volatile(
+    	".arch iwmmxt\n"
+    	".cpu iwmmxt\n"
+        /* define supplementary macros */
+        ".macro cvt8888to565 PIX\n"
+            "and   A, C1F001F, \\PIX, lsr #3\n"
+            "and   \\PIX, \\PIX, #0xFC00\n\n"
+            "orr   A, A, A, lsr #5\n"
+            "orr   \\PIX, A, \\PIX, lsr #5\n"
+        ".endm\n"
+
+        ".macro combine_pixels_pair PIX1, PIX2\n"
+        	/* pkhbt iwmmxt replacement code start */
+        	"tinsrh wr0, \\PIX1, #0\n"
+        	"tinsrh wr0, \\PIX2, #1\n"
+        	"textrmsw \\PIX1, wr0, #0\n"
+            /*"pkhbt \\PIX1, \\PIX1, \\PIX2, lsl #16\n" */
+        	/* pkhbt iwmmxt replacement code end */
+        ".endm\n"
+
+        /* function entry, save all registers (10 words) to stack */
+        "stmdb   sp!, {r4-r11, ip, lr}\n"
+        
+        /* define some aliases */
+        "DST     .req  r0\n"
+        "SRC     .req  r1\n"
+        "W       .req  r2\n"
+        "H       .req  r3\n"
+
+        "TMP1    .req  r4\n"
+        "TMP2    .req  r5\n"
+        "TMP3    .req  r6\n"
+        "TMP4    .req  r7\n"
+        "TMP5    .req  r8\n"
+        "TMP6    .req  r9\n"
+        "TMP7    .req  r10\n"
+        "TMP8    .req  r11\n"
+
+        "C1F001F .req  ip\n"
+        "A       .req  lr\n"
+        
+        "ldr     TMP1, [sp, #(10*4+0)]\n" /* load src_stride */
+        "ldr     C1F001F, =0x1F001F\n"
+        "sub     r3, r3, W\n"
+        "str     r3, [sp, #(10*4+0)]\n" /* store (dst_stride-w) */
+        "ldr     r3, [sp, #(10*4+4)]\n" /* load h */
+        "sub     TMP1, TMP1, W\n"
+        "str     TMP1, [sp, #(10*4+4)]\n" /* store (src_stride-w) */
+        
+        "str     W, [sp, #(8*4)]\n" /* saved ip = W */
+
+    "0:\n"
+        "subs    H, H, #1\n"
+        "blt     6f\n"
+    "1:\n"
+        /* align DST at 4 byte boundary */
+        "tst     DST, #2\n"
+        "beq     2f\n"
+        "ldr     TMP1, [SRC], #4\n"
+        "sub     W, W, #1\n"
+        "cvt8888to565 TMP1\n"
+        "strh    TMP1, [DST], #2\n"
+    "2:"
+        /* align DST at 8 byte boundary */
+        "tst     DST, #4\n"
+        "beq     2f\n"
+        "ldmia   SRC!, {TMP1, TMP2}\n"
+        "sub     W, W, #2\n"
+        "cvt8888to565 TMP1\n"
+        "cvt8888to565 TMP2\n"
+        "combine_pixels_pair TMP1, TMP2\n"
+        "str     TMP1, [DST], #4\n"
+    "2:"
+        /* align DST at 16 byte boundary */
+        "tst     DST, #8\n"
+        "beq     2f\n"
+        "ldmia   SRC!, {TMP1, TMP2, TMP3, TMP4}\n"
+        "sub     W, W, #4\n"
+        "cvt8888to565 TMP1\n"
+        "cvt8888to565 TMP2\n"
+        "cvt8888to565 TMP3\n"
+        "cvt8888to565 TMP4\n"
+        "combine_pixels_pair TMP1, TMP2\n"
+        "combine_pixels_pair TMP3, TMP4\n"
+        "stmia DST!, {TMP1, TMP3}\n"
+    "2:"
+        /* inner loop, process 8 pixels per iteration */
+        "subs    W, W, #8\n"
+        "blt     4f\n"
+    "3:\n"
+        "ldmia   SRC!, {TMP1, TMP2, TMP3, TMP4, TMP5, TMP6, TMP7, TMP8}\n"
+        "subs    W, W, #8\n"
+        "cvt8888to565 TMP1\n"
+        "cvt8888to565 TMP2\n"
+        "cvt8888to565 TMP3\n"
+        "cvt8888to565 TMP4\n"
+        "cvt8888to565 TMP5\n"
+        "cvt8888to565 TMP6\n"
+        "cvt8888to565 TMP7\n"
+        "cvt8888to565 TMP8\n"
+        "combine_pixels_pair TMP1, TMP2\n"
+        "combine_pixels_pair TMP3, TMP4\n"
+        "combine_pixels_pair TMP5, TMP6\n"
+        "combine_pixels_pair TMP7, TMP8\n"
+        "stmia   DST!, {TMP1, TMP3, TMP5, TMP7}\n"
+        "bge     3b\n"
+    "4:\n"
+
+        /* process the remaining pixels */
+        "tst     W, #4\n"
+        "beq     4f\n"
+        "ldmia   SRC!, {TMP1, TMP2, TMP3, TMP4}\n"
+        "cvt8888to565 TMP1\n"
+        "cvt8888to565 TMP2\n"
+        "cvt8888to565 TMP3\n"
+        "cvt8888to565 TMP4\n"
+        "combine_pixels_pair TMP1, TMP2\n"
+        "combine_pixels_pair TMP3, TMP4\n"
+        "stmia   DST!, {TMP1, TMP3}\n"
+    "4:\n"
+        "tst     W, #2\n"
+        "beq     4f\n"
+        "ldmia   SRC!, {TMP1, TMP2}\n"
+        "cvt8888to565 TMP1\n"
+        "cvt8888to565 TMP2\n"
+        "combine_pixels_pair TMP1, TMP2\n"
+        "str     TMP1, [DST], #4\n"
+    "4:\n"
+        "tst     W, #1\n"
+        "beq     4f\n"
+        "ldr     TMP1, [SRC], #4\n"
+        "cvt8888to565 TMP1\n"
+        "strh    TMP1, [DST], #2\n"
+    "4:\n"
+        "ldr     TMP1, [sp, #(10*4+0)]\n" /* (dst_stride-w) */
+        "ldr     TMP2, [sp, #(10*4+4)]\n" /* (src_stride-w) */
+        "ldr     W, [sp, #(8*4)]\n"
+        "subs    H, H, #1\n"
+        "add     DST, DST, TMP1, lsl #1\n"
+        "add     SRC, SRC, TMP2, lsl #2\n"
+        "bge     1b\n"
+    "6:\n"
+        "ldmia   sp!, {r4-r11, ip, pc}\n" /* restore all registers and return */
+        ".ltorg\n"
+
+        ".unreq   DST\n"
+        ".unreq   SRC\n"
+        ".unreq   W\n"
+        ".unreq   H\n"
+
+        ".unreq   TMP1\n"
+        ".unreq   TMP2\n"
+        ".unreq   TMP3\n"
+        ".unreq   TMP4\n"
+        ".unreq   TMP5\n"
+        ".unreq   TMP6\n"
+        ".unreq   TMP7\n"
+        ".unreq   TMP8\n"
+
+        ".unreq   C1F001F\n"
+        ".unreq   A\n"
+
+        ".purgem  cvt8888to565\n"
+        ".purgem  combine_pixels_pair\n"
+    );
+}
+
+#else
+
+#define fbComposite_x8r8g8b8_src_r5g6b5_internal_armv6(a, b, c, d, e, f) \
+    fbComposite_x8r8g8b8_src_r5g6b5_internal_mixed_armv6_c((a), (b), (c), (d), (e), (f))
+
+#endif
+
+#endif
diff --git a/fb/fbbits.c b/fb/fbbits.c
index 56b58df..cefe943 100644
--- a/fb/fbbits.c
+++ b/fb/fbbits.c
@@ -103,14 +103,14 @@
 #define BITSUNIT    BYTE
 #define BITSMUL	    3
 
-#define FbDoTypeStore(b,t,x,s)	(*((t *) (b)) = (x) >> (s))
-#define FbDoTypeRRop(b,t,a,x,s) (*((t *) (b)) = FbDoRRop(*((t *) (b)),\
-							 (a) >> (s), \
-							 (x) >> (s)))
-#define FbDoTypeMaskRRop(b,t,a,x,m,s) (*((t *) (b)) = FbDoMaskRRop(*((t *) (b)),\
-								   (a) >> (s), \
-								   (x) >> (s), \
-								   (m) >> (s))
+#define FbDoTypeStore(b,t,x,s)	WRITE(((t *) (b)), (x) >> (s))
+#define FbDoTypeRRop(b,t,a,x,s) WRITE((t *) (b), FbDoRRop(READ((t *) (b)),\
+							  (a) >> (s), \
+							  (x) >> (s)))
+#define FbDoTypeMaskRRop(b,t,a,x,m,s) WRITE((t *) (b), FbDoMaskRRop(READ((t *) (b)),\
+								    (a) >> (s), \
+								    (x) >> (s), \
+								    (m) >> (s)))
 #if BITMAP_BIT_ORDER == LSBFirst
 #define BITSSTORE(b,x)	((unsigned long) (b) & 1 ? \
 			 (FbDoTypeStore (b, CARD8, x, 0), \
diff --git a/fb/fbbits.h b/fb/fbbits.h
index e5c006d..603c029 100644
--- a/fb/fbbits.h
+++ b/fb/fbbits.h
@@ -42,13 +42,13 @@
 #ifdef BITSSTORE
 #define STORE(b,x)  BITSSTORE(b,x)
 #else
-#define STORE(b,x)  (*(b) = (x))
+#define STORE(b,x)  WRITE((b), (x))
 #endif
 
 #ifdef BITSRROP
 #define RROP(b,a,x)	BITSRROP(b,a,x)
 #else
-#define RROP(b,a,x)	(*(b) = FbDoRRop (*(b), (a), (x)))
+#define RROP(b,a,x)	WRITE((b), FbDoRRop (READ(b), (a), (x)))
 #endif
 
 #ifdef BITSUNIT
@@ -119,6 +119,8 @@ BRESSOLID (DrawablePtr	pDrawable,
 	    e += e3;
 	}
     }
+
+    fbFinishAccess (pDrawable);
 }
 #endif
 
@@ -263,6 +265,8 @@ onOffOdd:
 		dashlen = len;
 	}
     }
+
+    fbFinishAccess (pDrawable);
 }
 #endif
 
@@ -541,18 +545,18 @@ ARC (FbBits	*dst,
 # define WRITE_ADDR4(n)	    ((n))
 #endif
 
-#define WRITE1(d,n,fg)	    ((d)[WRITE_ADDR1(n)] = (BITS) (fg))
+#define WRITE1(d,n,fg)	    WRITE(d + WRITE_ADDR1(n), (BITS) (fg))
 
 #ifdef BITS2
-# define WRITE2(d,n,fg)	    (*((BITS2 *) &((d)[WRITE_ADDR2(n)])) = (BITS2) (fg))
+# define WRITE2(d,n,fg)	    WRITE((BITS2 *) &((d)[WRITE_ADDR2(n)]), (BITS2) (fg))
 #else
-# define WRITE2(d,n,fg)	    WRITE1(d,(n)+1,WRITE1(d,n,fg))
+# define WRITE2(d,n,fg)	    (WRITE1(d,n,fg), WRITE1(d,(n)+1,fg))
 #endif
 
 #ifdef BITS4
-# define WRITE4(d,n,fg)	    (*((BITS4 *) &((d)[WRITE_ADDR4(n)])) = (BITS4) (fg))
+# define WRITE4(d,n,fg)	    WRITE((BITS4 *) &((d)[WRITE_ADDR4(n)]), (BITS4) (fg))
 #else
-# define WRITE4(d,n,fg)	    WRITE2(d,(n)+2,WRITE2(d,n,fg))
+# define WRITE4(d,n,fg)	    (WRITE2(d,n,fg), WRITE2(d,(n)+2,fg))
 #endif
 
 void
@@ -710,8 +714,10 @@ POLYLINE (DrawablePtr	pDrawable,
 		       intToX(pt2) + xoff, intToY(pt2) + yoff,
 		       npt == 0 && pGC->capStyle != CapNotLast,
 		       &dashoffset);
-	    if (!npt)
+	    if (!npt) {
+		fbFinishAccess (pDrawable);
 		return;
+	    }
 	    pt1 = pt2;
 	    pt2 = *pts++;
 	    npt--;
@@ -776,6 +782,7 @@ POLYLINE (DrawablePtr	pDrawable,
 		    {
 			RROP(bits,and,xor);
 		    }
+		    fbFinishAccess (pDrawable);
 		    return;
 		}
 		pt1 = pt2;
@@ -786,6 +793,8 @@ POLYLINE (DrawablePtr	pDrawable,
     	    }
 	}
     }
+
+    fbFinishAccess (pDrawable);
 }
 #endif
 
@@ -883,20 +892,20 @@ POLYSEGMENT (DrawablePtr    pDrawable,
 		FbMaskBits (dstX, width, startmask, nmiddle, endmask);
 		if (startmask)
 		{
-		    *dstLine = FbDoMaskRRop (*dstLine, andBits, xorBits, startmask);
+		    WRITE(dstLine, FbDoMaskRRop (READ(dstLine), andBits, xorBits, startmask));
 		    dstLine++;
 		}
 		if (!andBits)
 		    while (nmiddle--)
-			*dstLine++ = xorBits;
+			WRITE(dstLine++, xorBits);
 		else
 		    while (nmiddle--)
 		    {
-			*dstLine = FbDoRRop (*dstLine, andBits, xorBits);
+			WRITE(dstLine, FbDoRRop (READ(dstLine), andBits, xorBits));
 			dstLine++;
 		    }
 		if (endmask)
-		    *dstLine = FbDoMaskRRop (*dstLine, andBits, xorBits, endmask);
+		    WRITE(dstLine, FbDoMaskRRop (READ(dstLine), andBits, xorBits, endmask));
 	    }
 	    else
 	    {
@@ -950,6 +959,8 @@ POLYSEGMENT (DrawablePtr    pDrawable,
 	    }
 	}
     }
+
+    fbFinishAccess (pDrawable);
 }
 #endif
 
diff --git a/fb/fbblt.c b/fb/fbblt.c
index d176a7c..5bd7526 100644
--- a/fb/fbblt.c
+++ b/fb/fbblt.c
@@ -92,10 +92,10 @@ fbBlt (FbBits   *srcLine,
 
         if (!upsidedown)
             for (i = 0; i < height; i++)
-                memcpy(dst + i * dstStride, src + i * srcStride, width);
+                MEMMOVE_WRAPPED(dst + i * dstStride, src + i * srcStride, width);
         else
             for (i = height - 1; i >= 0; i--)
-                memcpy(dst + i * dstStride, src + i * srcStride, width);
+                MEMMOVE_WRAPPED(dst + i * dstStride, src + i * srcStride, width);
 
         return;
     }
@@ -137,7 +137,7 @@ fbBlt (FbBits   *srcLine,
 	    {
 		if (endmask)
 		{
-		    bits = *--src;
+		    bits = READ(--src);
 		    --dst;
 		    FbDoRightMaskByteMergeRop(dst, bits, endbyte, endmask);
 		}
@@ -145,20 +145,20 @@ fbBlt (FbBits   *srcLine,
 		if (destInvarient)
 		{
 		    while (n--)
-			*--dst = FbDoDestInvarientMergeRop(*--src);
+			WRITE(--dst, FbDoDestInvarientMergeRop(READ(--src)));
 		}
 		else
 		{
 		    while (n--)
 		    {
-			bits = *--src;
+			bits = READ(--src);
 			--dst;
-			*dst = FbDoMergeRop (bits, *dst);
+			WRITE(dst, FbDoMergeRop (bits, READ(dst)));
 		    }
 		}
 		if (startmask)
 		{
-		    bits = *--src;
+		    bits = READ(--src);
 		    --dst;
 		    FbDoLeftMaskByteMergeRop(dst, bits, startbyte, startmask);
 		}
@@ -167,7 +167,7 @@ fbBlt (FbBits   *srcLine,
 	    {
 		if (startmask)
 		{
-		    bits = *src++;
+		    bits = READ(src++);
 		    FbDoLeftMaskByteMergeRop(dst, bits, startbyte, startmask);
 		    dst++;
 		}
@@ -198,20 +198,20 @@ fbBlt (FbBits   *srcLine,
 		    }
 #endif
 		    while (n--)
-			*dst++ = FbDoDestInvarientMergeRop(*src++);
+			WRITE(dst++, FbDoDestInvarientMergeRop(READ(src++)));
 		}
 		else
 		{
 		    while (n--)
 		    {
-			bits = *src++;
-			*dst = FbDoMergeRop (bits, *dst);
+			bits = READ(src++);
+			WRITE(dst, FbDoMergeRop (bits, READ(dst)));
 			dst++;
 		    }
 		}
 		if (endmask)
 		{
-		    bits = *src;
+		    bits = READ(src);
 		    FbDoRightMaskByteMergeRop(dst, bits, endbyte, endmask);
 		}
 	    }
@@ -240,13 +240,13 @@ fbBlt (FbBits   *srcLine,
 	    if (reverse)
 	    {
 		if (srcX < dstX)
-		    bits1 = *--src;
+		    bits1 = READ(--src);
 		if (endmask)
 		{
 		    bits = FbScrRight(bits1, rightShift); 
 		    if (FbScrRight(endmask, leftShift))
 		    {
-			bits1 = *--src;
+			bits1 = READ(--src);
 			bits |= FbScrLeft(bits1, leftShift);
 		    }
 		    --dst;
@@ -258,10 +258,10 @@ fbBlt (FbBits   *srcLine,
 		    while (n--)
 		    {
 			bits = FbScrRight(bits1, rightShift); 
-			bits1 = *--src;
+			bits1 = READ(--src);
 			bits |= FbScrLeft(bits1, leftShift);
 			--dst;
-			*dst = FbDoDestInvarientMergeRop(bits);
+			WRITE(dst, FbDoDestInvarientMergeRop(bits));
 		    }
 		}
 		else
@@ -269,10 +269,10 @@ fbBlt (FbBits   *srcLine,
 		    while (n--)
 		    {
 			bits = FbScrRight(bits1, rightShift); 
-			bits1 = *--src;
+			bits1 = READ(--src);
 			bits |= FbScrLeft(bits1, leftShift);
 			--dst;
-			*dst = FbDoMergeRop(bits, *dst);
+			WRITE(dst, FbDoMergeRop(bits, READ(dst)));
 		    }
 		}
 		if (startmask)
@@ -280,7 +280,7 @@ fbBlt (FbBits   *srcLine,
 		    bits = FbScrRight(bits1, rightShift); 
 		    if (FbScrRight(startmask, leftShift))
 		    {
-			bits1 = *--src;
+			bits1 = READ(--src);
 			bits |= FbScrLeft(bits1, leftShift);
 		    }
 		    --dst;
@@ -290,13 +290,13 @@ fbBlt (FbBits   *srcLine,
 	    else
 	    {
 		if (srcX > dstX)
-		    bits1 = *src++;
+		    bits1 = READ(src++);
 		if (startmask)
 		{
 		    bits = FbScrLeft(bits1, leftShift); 
 		    if (FbScrLeft(startmask, rightShift))
 		    {
-			bits1 = *src++;
+			bits1 = READ(src++);
 			bits |= FbScrRight(bits1, rightShift);
 		    }
 		    FbDoLeftMaskByteMergeRop (dst, bits, startbyte, startmask);
@@ -308,9 +308,9 @@ fbBlt (FbBits   *srcLine,
 		    while (n--)
 		    {
 			bits = FbScrLeft(bits1, leftShift); 
-			bits1 = *src++;
+			bits1 = READ(src++);
 			bits |= FbScrRight(bits1, rightShift);
-			*dst = FbDoDestInvarientMergeRop(bits);
+			WRITE(dst, FbDoDestInvarientMergeRop(bits));
 			dst++;
 		    }
 		}
@@ -319,9 +319,9 @@ fbBlt (FbBits   *srcLine,
 		    while (n--)
 		    {
 			bits = FbScrLeft(bits1, leftShift); 
-			bits1 = *src++;
+			bits1 = READ(src++);
 			bits |= FbScrRight(bits1, rightShift);
-			*dst = FbDoMergeRop(bits, *dst);
+			WRITE(dst, FbDoMergeRop(bits, READ(dst)));
 			dst++;
 		    }
 		}
@@ -330,7 +330,7 @@ fbBlt (FbBits   *srcLine,
 		    bits = FbScrLeft(bits1, leftShift); 
 		    if (FbScrLeft(endmask, rightShift))
 		    {
-			bits1 = *src;
+			bits1 = READ(src);
 			bits |= FbScrRight(bits1, rightShift);
 		    }
 		    FbDoRightMaskByteMergeRop (dst, bits, endbyte, endmask);
@@ -425,45 +425,45 @@ fbBlt24Line (FbBits	    *src,
 	{
 	    if (endmask)
 	    {
-		bits = *--src;
+		bits = READ(--src);
 		--dst;
-		*dst = FbDoMaskMergeRop (bits, *dst, mask & endmask);
+		WRITE(dst, FbDoMaskMergeRop (bits, READ(dst), mask & endmask));
 		mask = FbPrev24Pix (mask);
 	    }
 	    while (n--)
 	    {
-		bits = *--src;
+		bits = READ(--src);
 		--dst;
-		*dst = FbDoMaskMergeRop (bits, *dst, mask);
+		WRITE(dst, FbDoMaskMergeRop (bits, READ(dst), mask));
 		mask = FbPrev24Pix (mask);
 	    }
 	    if (startmask)
 	    {
-		bits = *--src;
+		bits = READ(--src);
 		--dst;
-		*dst = FbDoMaskMergeRop(bits, *dst, mask & startmask);
+		WRITE(dst, FbDoMaskMergeRop(bits, READ(dst), mask & startmask));
 	    }
 	}
 	else
 	{
 	    if (startmask)
 	    {
-		bits = *src++;
-		*dst = FbDoMaskMergeRop (bits, *dst, mask & startmask);
+		bits = READ(src++);
+		WRITE(dst, FbDoMaskMergeRop (bits, READ(dst), mask & startmask));
 		dst++;
 		mask = FbNext24Pix(mask);
 	    }
 	    while (n--)
 	    {
-		bits = *src++;
-		*dst = FbDoMaskMergeRop (bits, *dst, mask);
+		bits = READ(src++);
+		WRITE(dst, FbDoMaskMergeRop (bits, READ(dst), mask));
 		dst++;
 		mask = FbNext24Pix(mask);
 	    }
 	    if (endmask)
 	    {
-		bits = *src;
-		*dst = FbDoMaskMergeRop(bits, *dst, mask & endmask);
+		bits = READ(src);
+		WRITE(dst, FbDoMaskMergeRop(bits, READ(dst), mask & endmask));
 	    }
 	}
     }
@@ -484,26 +484,26 @@ fbBlt24Line (FbBits	    *src,
 	if (reverse)
 	{
 	    if (srcX < dstX)
-		bits1 = *--src;
+		bits1 = READ(--src);
 	    if (endmask)
 	    {
 		bits = FbScrRight(bits1, rightShift); 
 		if (FbScrRight(endmask, leftShift))
 		{
-		    bits1 = *--src;
+		    bits1 = READ(--src);
 		    bits |= FbScrLeft(bits1, leftShift);
 		}
 		--dst;
-		*dst = FbDoMaskMergeRop (bits, *dst, mask & endmask);
+		WRITE(dst, FbDoMaskMergeRop (bits, READ(dst), mask & endmask));
 		mask = FbPrev24Pix(mask);
 	    }
 	    while (n--)
 	    {
 		bits = FbScrRight(bits1, rightShift); 
-		bits1 = *--src;
+		bits1 = READ(--src);
 		bits |= FbScrLeft(bits1, leftShift);
 		--dst;
-		*dst = FbDoMaskMergeRop(bits, *dst, mask);
+		WRITE(dst, FbDoMaskMergeRop(bits, READ(dst), mask));
 		mask = FbPrev24Pix(mask);
 	    }
 	    if (startmask)
@@ -511,32 +511,32 @@ fbBlt24Line (FbBits	    *src,
 		bits = FbScrRight(bits1, rightShift); 
 		if (FbScrRight(startmask, leftShift))
 		{
-		    bits1 = *--src;
+		    bits1 = READ(--src);
 		    bits |= FbScrLeft(bits1, leftShift);
 		}
 		--dst;
-		*dst = FbDoMaskMergeRop (bits, *dst, mask & startmask);
+		WRITE(dst, FbDoMaskMergeRop (bits, READ(dst), mask & startmask));
 	    }
 	}
 	else
 	{
 	    if (srcX > dstX)
-		bits1 = *src++;
+		bits1 = READ(src++);
 	    if (startmask)
 	    {
 		bits = FbScrLeft(bits1, leftShift); 
-		bits1 = *src++;
+		bits1 = READ(src++);
 		bits |= FbScrRight(bits1, rightShift);
-		*dst = FbDoMaskMergeRop (bits, *dst, mask & startmask);
+		WRITE(dst, FbDoMaskMergeRop (bits, READ(dst), mask & startmask));
 		dst++;
 		mask = FbNext24Pix(mask);
 	    }
 	    while (n--)
 	    {
 		bits = FbScrLeft(bits1, leftShift); 
-		bits1 = *src++;
+		bits1 = READ(src++);
 		bits |= FbScrRight(bits1, rightShift);
-		*dst = FbDoMaskMergeRop(bits, *dst, mask);
+		WRITE(dst, FbDoMaskMergeRop(bits, READ(dst), mask));
 		dst++;
 		mask = FbNext24Pix(mask);
 	    }
@@ -545,10 +545,10 @@ fbBlt24Line (FbBits	    *src,
 		bits = FbScrLeft(bits1, leftShift); 
 		if (FbScrLeft(endmask, rightShift))
 		{
-		    bits1 = *src;
+		    bits1 = READ(src);
 		    bits |= FbScrRight(bits1, rightShift);
 		}
-		*dst = FbDoMaskMergeRop (bits, *dst, mask & endmask);
+		WRITE(dst, FbDoMaskMergeRop (bits, READ(dst), mask & endmask));
 	    }
 	}
     }
@@ -707,8 +707,8 @@ fbBltOdd (FbBits    *srcLine,
 	{
 	    if (startmask)
 	    {
-		bits = *src++;
-		*dst = FbDoMaskMergeRop (bits, *dst, startmask);
+		bits = READ(src++);
+		WRITE(dst, FbDoMaskMergeRop (bits, READ(dst), startmask));
 		dst++;
 	    }
 	    n = nmiddle;
@@ -716,8 +716,8 @@ fbBltOdd (FbBits    *srcLine,
 	    {
 		while (n--)
 		{
-		    bits = *src++;
-		    *dst = FbDoDestInvarientMergeRop(bits);
+		    bits = READ(src++);
+		    WRITE(dst, FbDoDestInvarientMergeRop(bits));
 		    dst++;
 		}
 	    }
@@ -725,28 +725,28 @@ fbBltOdd (FbBits    *srcLine,
 	    {
 		while (n--)
 		{
-		    bits = *src++;
-		    *dst = FbDoMergeRop (bits, *dst);
+		    bits = READ(src++);
+		    WRITE(dst, FbDoMergeRop (bits, READ(dst)));
 		    dst++;
 		}
 	    }
 	    if (endmask)
 	    {
-		bits = *src;
-		*dst = FbDoMaskMergeRop(bits, *dst, endmask);
+		bits = READ(src);
+		WRITE(dst, FbDoMaskMergeRop(bits, READ(dst), endmask));
 	    }
 	}
 	else
 	{
 	    bits = 0;
 	    if (srcX > dstX)
-		bits = *src++;
+		bits = READ(src++);
 	    if (startmask)
 	    {
 		bits1 = FbScrLeft(bits, leftShift);
-		bits = *src++;
+		bits = READ(src++);
 		bits1 |= FbScrRight(bits, rightShift);
-		*dst = FbDoMaskMergeRop (bits1, *dst, startmask);
+		WRITE(dst, FbDoMaskMergeRop (bits1, READ(dst), startmask));
 		dst++;
 	    }
 	    n = nmiddle;
@@ -755,9 +755,9 @@ fbBltOdd (FbBits    *srcLine,
 		while (n--)
 		{
 		    bits1 = FbScrLeft(bits, leftShift);
-		    bits = *src++;
+		    bits = READ(src++);
 		    bits1 |= FbScrRight(bits, rightShift);
-		    *dst = FbDoDestInvarientMergeRop(bits1);
+		    WRITE(dst, FbDoDestInvarientMergeRop(bits1));
 		    dst++;
 		}
 	    }
@@ -766,9 +766,9 @@ fbBltOdd (FbBits    *srcLine,
 		while (n--)
 		{
 		    bits1 = FbScrLeft(bits, leftShift);
-		    bits = *src++;
+		    bits = READ(src++);
 		    bits1 |= FbScrRight(bits, rightShift);
-		    *dst = FbDoMergeRop(bits1, *dst);
+		    WRITE(dst, FbDoMergeRop(bits1, READ(dst)));
 		    dst++;
 		}
 	    }
@@ -777,10 +777,10 @@ fbBltOdd (FbBits    *srcLine,
 		bits1 = FbScrLeft(bits, leftShift);
 		if (FbScrLeft(endmask, rightShift))
 		{
-		    bits = *src;
+		    bits = READ(src);
 		    bits1 |= FbScrRight(bits, rightShift);
 		}
-		*dst = FbDoMaskMergeRop (bits1, *dst, endmask);
+		WRITE(dst, FbDoMaskMergeRop (bits1, READ(dst), endmask));
 	    }
 	}
     }
diff --git a/fb/fbbltone.c b/fb/fbbltone.c
index f06357a..d2c180f 100644
--- a/fb/fbbltone.c
+++ b/fb/fbbltone.c
@@ -51,12 +51,12 @@
 
 #define LoadBits {\
     if (leftShift) { \
-	bitsRight = (src < srcEnd ? *src++ : 0); \
+	bitsRight = (src < srcEnd ? READ(src++) : 0); \
 	bits = (FbStipLeft (bitsLeft, leftShift) | \
 		FbStipRight(bitsRight, rightShift)); \
 	bitsLeft = bitsRight; \
     } else \
-	bits = (src < srcEnd ? *src++ : 0); \
+	bits = (src < srcEnd ? READ(src++) : 0); \
 }
     
 #ifndef FBNOPIXADDR
@@ -285,7 +285,7 @@ fbBltOne (FbStip    *src,
 	
 	bitsLeft = 0;
 	if (srcX > dstS)
-	    bitsLeft = *src++;
+	    bitsLeft = READ(src++);
 	if (n)
 	{
 	    /*
@@ -338,7 +338,7 @@ fbBltOne (FbStip    *src,
 			else
 #endif
 			    mask = fbBits[FbLeftStipBits(bits,pixelsPerDst)];
-			*dst = FbOpaqueStipple (mask, fgxor, bgxor);
+			WRITE(dst, FbOpaqueStipple (mask, fgxor, bgxor));
 			dst++;
 			bits = FbStipLeft(bits, pixelsPerDst);
 		    }
@@ -368,8 +368,8 @@ fbBltOne (FbStip    *src,
 			    if (left || !transparent)
 			    {
 				mask = fbBits[left];
-				*dst = FbStippleRRop (*dst, mask,
-						      fgand, fgxor, bgand, bgxor);
+				WRITE(dst, FbStippleRRop (READ(dst), mask,
+						          fgand, fgxor, bgand, bgxor));
 			    }
 			    dst++;
 			    bits = FbStipLeft(bits, pixelsPerDst);
@@ -537,7 +537,7 @@ const FbBits	fbStipple24Bits[3][1 << FbStip24Len] = {
 	stip = FbLeftStipBits(bits, len); \
     } else { \
 	stip = FbLeftStipBits(bits, remain); \
-	bits = (src < srcEnd ? *src++ : 0); \
+	bits = (src < srcEnd ? READ(src++) : 0); \
 	__len = (len) - remain; \
 	stip = FbMergePartStip24Bits(stip, FbLeftStipBits(bits, __len), \
 				     remain, __len); \
@@ -548,7 +548,7 @@ const FbBits	fbStipple24Bits[3][1 << FbStip24Len] = {
 }
 
 #define fbInitStipBits(offset,len,stip) {\
-    bits = FbStipLeft (*src++,offset); \
+    bits = FbStipLeft (READ(src++),offset); \
     remain = FB_STIP_UNIT - offset; \
     fbFirstStipBits(len,stip); \
     stip = FbMergeStip24Bits (0, stip, len); \
@@ -631,10 +631,11 @@ fbBltOne24 (FbStip	*srcLine,
 	    if (leftMask)
 	    {
 		mask = fbStipple24Bits[rot >> 3][stip];
-		*dst = (*dst & ~leftMask) | (FbOpaqueStipple (mask,
-							      FbRot24(fgxor, rot),
-							      FbRot24(bgxor, rot))
-					     & leftMask);
+		WRITE(dst, (READ(dst) & ~leftMask) |
+			    (FbOpaqueStipple (mask,
+					      FbRot24(fgxor, rot),
+					      FbRot24(bgxor, rot))
+			     & leftMask));
 		dst++;
 		fbNextStipBits(rot,stip);
 	    }
@@ -642,19 +643,20 @@ fbBltOne24 (FbStip	*srcLine,
 	    while (nl--)
 	    {
 		mask = fbStipple24Bits[rot>>3][stip];
-		*dst = FbOpaqueStipple (mask, 
-					FbRot24(fgxor, rot),
-					FbRot24(bgxor, rot));
+		WRITE(dst, FbOpaqueStipple (mask,
+					    FbRot24(fgxor, rot),
+					    FbRot24(bgxor, rot)));
 		dst++;
 		fbNextStipBits(rot,stip);
 	    }
 	    if (rightMask)
 	    {
 		mask = fbStipple24Bits[rot >> 3][stip];
-		*dst = (*dst & ~rightMask) | (FbOpaqueStipple (mask,
-							       FbRot24(fgxor, rot),
-							       FbRot24(bgxor, rot))
-					      & rightMask);
+		WRITE(dst, (READ(dst) & ~rightMask) |
+			    (FbOpaqueStipple (mask,
+					      FbRot24(fgxor, rot),
+					      FbRot24(bgxor, rot))
+			     & rightMask));
 	    }
 	    dst += dstStride;
 	    src += srcStride;
@@ -674,7 +676,7 @@ fbBltOne24 (FbStip	*srcLine,
 		if (stip)
 		{
 		    mask = fbStipple24Bits[rot >> 3][stip] & leftMask;
-		    *dst = (*dst & ~mask) | (FbRot24(fgxor, rot) & mask);
+		    WRITE(dst, (READ(dst) & ~mask) | (FbRot24(fgxor, rot) & mask));
 		}
 		dst++;
 		fbNextStipBits (rot, stip);
@@ -685,7 +687,7 @@ fbBltOne24 (FbStip	*srcLine,
 		if (stip)
 		{
 		    mask = fbStipple24Bits[rot>>3][stip];
-		    *dst = (*dst & ~mask) | (FbRot24(fgxor,rot) & mask);
+		    WRITE(dst, (READ(dst) & ~mask) | (FbRot24(fgxor,rot) & mask));
 		}
 		dst++;
 		fbNextStipBits (rot, stip);
@@ -695,7 +697,7 @@ fbBltOne24 (FbStip	*srcLine,
 		if (stip)
 		{
 		    mask = fbStipple24Bits[rot >> 3][stip] & rightMask;
-		    *dst = (*dst & ~mask) | (FbRot24(fgxor, rot) & mask);
+		    WRITE(dst, (READ(dst) & ~mask) | (FbRot24(fgxor, rot) & mask));
 		}
 	    }
 	    dst += dstStride;
@@ -712,12 +714,12 @@ fbBltOne24 (FbStip	*srcLine,
 	    if (leftMask)
 	    {
 		mask = fbStipple24Bits[rot >> 3][stip];
-		*dst = FbStippleRRopMask (*dst, mask,
-					  FbRot24(fgand, rot),
-					  FbRot24(fgxor, rot),
-					  FbRot24(bgand, rot),
-					  FbRot24(bgxor, rot),
-					  leftMask);
+		WRITE(dst, FbStippleRRopMask (READ(dst), mask,
+					      FbRot24(fgand, rot),
+					      FbRot24(fgxor, rot),
+					      FbRot24(bgand, rot),
+					      FbRot24(bgxor, rot),
+					      leftMask));
 		dst++;
 		fbNextStipBits(rot,stip);
 	    }
@@ -725,23 +727,23 @@ fbBltOne24 (FbStip	*srcLine,
 	    while (nl--)
 	    {
 		mask = fbStipple24Bits[rot >> 3][stip];
-		*dst = FbStippleRRop (*dst, mask,
-				      FbRot24(fgand, rot),
-				      FbRot24(fgxor, rot),
-				      FbRot24(bgand, rot),
-				      FbRot24(bgxor, rot));
+		WRITE(dst, FbStippleRRop (READ(dst), mask,
+					  FbRot24(fgand, rot),
+					  FbRot24(fgxor, rot),
+					  FbRot24(bgand, rot),
+					  FbRot24(bgxor, rot)));
 		dst++;
 		fbNextStipBits(rot,stip);
 	    }
 	    if (rightMask)
 	    {
 		mask = fbStipple24Bits[rot >> 3][stip];
-		*dst = FbStippleRRopMask (*dst, mask,
-					  FbRot24(fgand, rot),
-					  FbRot24(fgxor, rot),
-					  FbRot24(bgand, rot),
-					  FbRot24(bgxor, rot),
-					  rightMask);
+		WRITE(dst, FbStippleRRopMask (READ(dst), mask,
+					      FbRot24(fgand, rot),
+					      FbRot24(fgxor, rot),
+					      FbRot24(bgand, rot),
+					      FbRot24(bgxor, rot),
+					      rightMask));
 	    }
 	    dst += dstStride;
 	}
@@ -832,7 +834,7 @@ fbBltPlane (FbBits	    *src,
 	if (srcBpp == 24)
 	    srcMask0 = FbRot24(pm,rot0) & FbBitsMask(0, srcBpp);
 #endif
-    	srcBits = *s++;
+    	srcBits = READ(s++);
 
 	dstMask = dstMaskFirst;
 	dstUnion = 0;
@@ -844,7 +846,7 @@ fbBltPlane (FbBits	    *src,
 	{
 	    if (!srcMask)
 	    {
-		srcBits = *s++;
+		srcBits = READ(s++);
 #ifdef FB_24BIT
 		if (srcBpp == 24)
 		    srcMask0 = FbNext24Pix(srcMask0) & FbBitsMask(0,24);
@@ -853,9 +855,9 @@ fbBltPlane (FbBits	    *src,
 	    }
 	    if (!dstMask)
 	    {
-		*d = FbStippleRRopMask(*d, dstBits,
-				       fgand, fgxor, bgand, bgxor,
-				       dstUnion);
+		WRITE(d, FbStippleRRopMask(READ(d), dstBits,
+					   fgand, fgxor, bgand, bgxor,
+					   dstUnion));
 		d++;
 		dstMask = FbStipMask(0,1);
 		dstUnion = 0;
@@ -871,9 +873,9 @@ fbBltPlane (FbBits	    *src,
 	    dstMask = FbStipRight(dstMask,1);
 	}
 	if (dstUnion)
-	    *d = FbStippleRRopMask(*d,dstBits,
-				   fgand, fgxor, bgand, bgxor,
-				   dstUnion);
+	    WRITE(d, FbStippleRRopMask(READ(d),dstBits,
+				       fgand, fgxor, bgand, bgxor,
+				       dstUnion));
     }
 }
 
diff --git a/fb/fbcompose.c b/fb/fbcompose.c
index b1903e9..10370cd 100644
--- a/fb/fbcompose.c
+++ b/fb/fbcompose.c
@@ -53,7 +53,7 @@ typedef FASTCALL void (*fetchProc)(const FbBits *bits, int x, int width, CARD32
 static FASTCALL void
 fbFetch_a8r8g8b8 (const FbBits *bits, int x, int width, CARD32 *buffer, miIndexedPtr indexed)
 {
-    memcpy(buffer, (const CARD32 *)bits + x, width*sizeof(CARD32));
+    MEMCPY_WRAPPED(buffer, (const CARD32 *)bits + x, width*sizeof(CARD32));
 }
 
 static FASTCALL void
@@ -62,7 +62,7 @@ fbFetch_x8r8g8b8 (const FbBits *bits, int x, int width, CARD32 *buffer, miIndexe
     const CARD32 *pixel = (const CARD32 *)bits + x;
     const CARD32 *end = pixel + width;
     while (pixel < end) {
-        *buffer++ = *pixel++ | 0xff000000;
+        WRITE(buffer++, READ(pixel++) | 0xff000000);
     }
 }
 
@@ -72,9 +72,9 @@ fbFetch_a8b8g8r8 (const FbBits *bits, int x, int width, CARD32 *buffer, miIndexe
     const CARD32 *pixel = (CARD32 *)bits + x;
     const CARD32 *end = pixel + width;
     while (pixel < end) {
-        *buffer++ =  ((*pixel & 0xff00ff00) |
-                      ((*pixel >> 16) & 0xff) |
-                      ((*pixel & 0xff) << 16));
+        WRITE(buffer++, ((READ(pixel) & 0xff00ff00) |
+                         ((READ(pixel) >> 16) & 0xff) |
+                         ((READ(pixel) & 0xff) << 16)));
         ++pixel;
     }
 }
@@ -85,10 +85,10 @@ fbFetch_x8b8g8r8 (const FbBits *bits, int x, int width, CARD32 *buffer, miIndexe
     const CARD32 *pixel = (CARD32 *)bits + x;
     const CARD32 *end = pixel + width;
     while (pixel < end) {
-        *buffer++ =  0xff000000 |
-                     ((*pixel & 0x0000ff00) |
-                      ((*pixel >> 16) & 0xff) |
-                      ((*pixel & 0xff) << 16));
+        WRITE(buffer++, 0xff000000 |
+                        ((READ(pixel) & 0x0000ff00) |
+                         ((READ(pixel) >> 16) & 0xff) |
+                         ((READ(pixel) & 0xff) << 16)));
         ++pixel;
     }
 }
@@ -101,7 +101,7 @@ fbFetch_r8g8b8 (const FbBits *bits, int x, int width, CARD32 *buffer, miIndexedP
     while (pixel < end) {
         CARD32 b = Fetch24(pixel) | 0xff000000;
         pixel += 3;
-        *buffer++ = b;
+        WRITE(buffer++, b);
     }
 }
 
@@ -113,13 +113,13 @@ fbFetch_b8g8r8 (const FbBits *bits, int x, int width, CARD32 *buffer, miIndexedP
     while (pixel < end) {
         CARD32 b = 0xff000000;
 #if IMAGE_BYTE_ORDER == MSBFirst
-        b |= (*pixel++);
-        b |= (*pixel++ << 8);
-        b |= (*pixel++ << 16);
+        b |= (READ(pixel++));
+        b |= (READ(pixel++) << 8);
+        b |= (READ(pixel++) << 16);
 #else
-        b |= (*pixel++ << 16);
-        b |= (*pixel++ << 8);
-        b |= (*pixel++);
+        b |= (READ(pixel++) << 16);
+        b |= (READ(pixel++) << 8);
+        b |= (READ(pixel++));
 #endif
     }
 }
@@ -130,13 +130,13 @@ fbFetch_r5g6b5 (const FbBits *bits, int x, int width, CARD32 *buffer, miIndexedP
     const CARD16 *pixel = (const CARD16 *)bits + x;
     const CARD16 *end = pixel + width;
     while (pixel < end) {
-        CARD32  p = *pixel++;
+        CARD32  p = READ(pixel++);
         CARD32 r = (((p) << 3) & 0xf8) | 
                    (((p) << 5) & 0xfc00) |
                    (((p) << 8) & 0xf80000);
         r |= (r >> 5) & 0x70007;
         r |= (r >> 6) & 0x300;
-        *buffer++ = 0xff000000 | r;
+        WRITE(buffer++, 0xff000000 | r);
     }
 }
 
@@ -146,13 +146,13 @@ fbFetch_b5g6r5 (const FbBits *bits, int x, int width, CARD32 *buffer, miIndexedP
     const CARD16 *pixel = (const CARD16 *)bits + x;
     const CARD16 *end = pixel + width;
     while (pixel < end) {
-        CARD32  p = *pixel++;
+        CARD32  p = READ(pixel++);
         CARD32  r,g,b;
 
         b = ((p & 0xf800) | ((p & 0xe000) >> 5)) >> 8;
         g = ((p & 0x07e0) | ((p & 0x0600) >> 6)) << 5;
         r = ((p & 0x001c) | ((p & 0x001f) << 5)) << 14;
-        *buffer++ = (0xff000000 | r | g | b);
+        WRITE(buffer++, (0xff000000 | r | g | b));
     }
 }
 
@@ -162,14 +162,14 @@ fbFetch_a1r5g5b5 (const FbBits *bits, int x, int width, CARD32 *buffer, miIndexe
     const CARD16 *pixel = (const CARD16 *)bits + x;
     const CARD16 *end = pixel + width;
     while (pixel < end) {
-        CARD32  p = *pixel++;
+        CARD32  p = READ(pixel++);
         CARD32  r,g,b, a;
 
         a = (CARD32) ((CARD8) (0 - ((p & 0x8000) >> 15))) << 24;
         r = ((p & 0x7c00) | ((p & 0x7000) >> 5)) << 9;
         g = ((p & 0x03e0) | ((p & 0x0380) >> 5)) << 6;
         b = ((p & 0x001c) | ((p & 0x001f) << 5)) >> 2;
-        *buffer++ = (a | r | g | b);
+        WRITE(buffer++, (a | r | g | b));
     }
 }
 
@@ -179,13 +179,13 @@ fbFetch_x1r5g5b5 (const FbBits *bits, int x, int width, CARD32 *buffer, miIndexe
     const CARD16 *pixel = (const CARD16 *)bits + x;
     const CARD16 *end = pixel + width;
     while (pixel < end) {
-        CARD32  p = *pixel++;
+        CARD32  p = READ(pixel++);
         CARD32  r,g,b;
 
         r = ((p & 0x7c00) | ((p & 0x7000) >> 5)) << 9;
         g = ((p & 0x03e0) | ((p & 0x0380) >> 5)) << 6;
         b = ((p & 0x001c) | ((p & 0x001f) << 5)) >> 2;
-        *buffer++ = (0xff000000 | r | g | b);
+        WRITE(buffer++, (0xff000000 | r | g | b));
     }
 }
 
@@ -195,14 +195,14 @@ fbFetch_a1b5g5r5 (const FbBits *bits, int x, int width, CARD32 *buffer, miIndexe
     const CARD16 *pixel = (const CARD16 *)bits + x;
     const CARD16 *end = pixel + width;
     while (pixel < end) {
-        CARD32  p = *pixel++;
+        CARD32  p = READ(pixel++);
         CARD32  r,g,b, a;
 
         a = (CARD32) ((CARD8) (0 - ((p & 0x8000) >> 15))) << 24;
         b = ((p & 0x7c00) | ((p & 0x7000) >> 5)) >> 7;
         g = ((p & 0x03e0) | ((p & 0x0380) >> 5)) << 6;
         r = ((p & 0x001c) | ((p & 0x001f) << 5)) << 14;
-        *buffer++ = (a | r | g | b);
+        WRITE(buffer++, (a | r | g | b));
     }
 }
 
@@ -212,13 +212,13 @@ fbFetch_x1b5g5r5 (const FbBits *bits, int x, int width, CARD32 *buffer, miIndexe
     const CARD16 *pixel = (const CARD16 *)bits + x;
     const CARD16 *end = pixel + width;
     while (pixel < end) {
-        CARD32  p = *pixel++;
+        CARD32  p = READ(pixel++);
         CARD32  r,g,b;
 
         b = ((p & 0x7c00) | ((p & 0x7000) >> 5)) >> 7;
         g = ((p & 0x03e0) | ((p & 0x0380) >> 5)) << 6;
         r = ((p & 0x001c) | ((p & 0x001f) << 5)) << 14;
-        *buffer++ = (0xff000000 | r | g | b);
+        WRITE(buffer++, (0xff000000 | r | g | b));
     }
 }
 
@@ -228,14 +228,14 @@ fbFetch_a4r4g4b4 (const FbBits *bits, int x, int width, CARD32 *buffer, miIndexe
     const CARD16 *pixel = (const CARD16 *)bits + x;
     const CARD16 *end = pixel + width;
     while (pixel < end) {
-        CARD32  p = *pixel++;
+        CARD32  p = READ(pixel++);
         CARD32  r,g,b, a;
 
         a = ((p & 0xf000) | ((p & 0xf000) >> 4)) << 16;
         r = ((p & 0x0f00) | ((p & 0x0f00) >> 4)) << 12;
         g = ((p & 0x00f0) | ((p & 0x00f0) >> 4)) << 8;
         b = ((p & 0x000f) | ((p & 0x000f) << 4));
-        *buffer++ = (a | r | g | b);
+        WRITE(buffer++, (a | r | g | b));
     }
 }
 
@@ -245,13 +245,13 @@ fbFetch_x4r4g4b4 (const FbBits *bits, int x, int width, CARD32 *buffer, miIndexe
     const CARD16 *pixel = (const CARD16 *)bits + x;
     const CARD16 *end = pixel + width;
     while (pixel < end) {
-        CARD32  p = *pixel++;
+        CARD32  p = READ(pixel++);
         CARD32  r,g,b;
 
         r = ((p & 0x0f00) | ((p & 0x0f00) >> 4)) << 12;
         g = ((p & 0x00f0) | ((p & 0x00f0) >> 4)) << 8;
         b = ((p & 0x000f) | ((p & 0x000f) << 4));
-        *buffer++ = (0xff000000 | r | g | b);
+        WRITE(buffer++, (0xff000000 | r | g | b));
     }
 }
 
@@ -261,14 +261,14 @@ fbFetch_a4b4g4r4 (const FbBits *bits, int x, int width, CARD32 *buffer, miIndexe
     const CARD16 *pixel = (const CARD16 *)bits + x;
     const CARD16 *end = pixel + width;
     while (pixel < end) {
-        CARD32  p = *pixel++;
+        CARD32  p = READ(pixel++);
         CARD32  r,g,b, a;
 
         a = ((p & 0xf000) | ((p & 0xf000) >> 4)) << 16;
         b = ((p & 0x0f00) | ((p & 0x0f00) >> 4)) >> 4;
         g = ((p & 0x00f0) | ((p & 0x00f0) >> 4)) << 8;
         r = ((p & 0x000f) | ((p & 0x000f) << 4)) << 16;
-        *buffer++ = (a | r | g | b);
+        WRITE(buffer++, (a | r | g | b));
     }
 }
 
@@ -278,13 +278,13 @@ fbFetch_x4b4g4r4 (const FbBits *bits, int x, int width, CARD32 *buffer, miIndexe
     const CARD16 *pixel = (const CARD16 *)bits + x;
     const CARD16 *end = pixel + width;
     while (pixel < end) {
-        CARD32  p = *pixel++;
+        CARD32  p = READ(pixel++);
         CARD32  r,g,b;
 
         b = ((p & 0x0f00) | ((p & 0x0f00) >> 4)) >> 4;
         g = ((p & 0x00f0) | ((p & 0x00f0) >> 4)) << 8;
         r = ((p & 0x000f) | ((p & 0x000f) << 4)) << 16;
-        *buffer++ = (0xff000000 | r | g | b);
+        WRITE(buffer++, (0xff000000 | r | g | b));
     }
 }
 
@@ -294,7 +294,7 @@ fbFetch_a8 (const FbBits *bits, int x, int width, CARD32 *buffer, miIndexedPtr i
     const CARD8 *pixel = (const CARD8 *)bits + x;
     const CARD8 *end = pixel + width;
     while (pixel < end) {
-        *buffer++ = (*pixel++) << 24;
+        WRITE(buffer++, READ(pixel++) << 24);
     }
 }
 
@@ -304,7 +304,7 @@ fbFetch_r3g3b2 (const FbBits *bits, int x, int width, CARD32 *buffer, miIndexedP
     const CARD8 *pixel = (const CARD8 *)bits + x;
     const CARD8 *end = pixel + width;
     while (pixel < end) {
-        CARD32  p = *pixel++;
+        CARD32  p = READ(pixel++);
         CARD32  r,g,b;
 
         r = ((p & 0xe0) | ((p & 0xe0) >> 3) | ((p & 0xc0) >> 6)) << 16;
@@ -313,7 +313,7 @@ fbFetch_r3g3b2 (const FbBits *bits, int x, int width, CARD32 *buffer, miIndexedP
              ((p & 0x03) << 2) |
              ((p & 0x03) << 4) |
              ((p & 0x03) << 6));
-        *buffer++ = (0xff000000 | r | g | b);
+        WRITE(buffer++, (0xff000000 | r | g | b));
     }
 }
 
@@ -323,7 +323,7 @@ fbFetch_b2g3r3 (const FbBits *bits, int x, int width, CARD32 *buffer, miIndexedP
     const CARD8 *pixel = (const CARD8 *)bits + x;
     const CARD8 *end = pixel + width;
     while (pixel < end) {
-        CARD32  p = *pixel++;
+        CARD32  p = READ(pixel++);
         CARD32  r,g,b;
 
         b = (((p & 0xc0)     ) |
@@ -334,7 +334,7 @@ fbFetch_b2g3r3 (const FbBits *bits, int x, int width, CARD32 *buffer, miIndexedP
         r = (((p & 0x07)     ) |
              ((p & 0x07) << 3) |
              ((p & 0x06) << 6)) << 16;
-        *buffer++ = (0xff000000 | r | g | b);
+        WRITE(buffer++, (0xff000000 | r | g | b));
 	}
 }
 
@@ -344,14 +344,14 @@ fbFetch_a2r2g2b2 (const FbBits *bits, int x, int width, CARD32 *buffer, miIndexe
     const CARD8 *pixel = (const CARD8 *)bits + x;
     const CARD8 *end = pixel + width;
     while (pixel < end) {
-        CARD32  p = *pixel++;
+        CARD32  p = READ(pixel++);
         CARD32   a,r,g,b;
 
         a = ((p & 0xc0) * 0x55) << 18;
         r = ((p & 0x30) * 0x55) << 12;
         g = ((p & 0x0c) * 0x55) << 6;
         b = ((p & 0x03) * 0x55);
-        *buffer++ = a|r|g|b;
+        WRITE(buffer++, a|r|g|b);
     }
 }
 
@@ -361,14 +361,14 @@ fbFetch_a2b2g2r2 (const FbBits *bits, int x, int width, CARD32 *buffer, miIndexe
     const CARD8 *pixel = (const CARD8 *)bits + x;
     const CARD8 *end = pixel + width;
     while (pixel < end) {
-        CARD32  p = *pixel++;
+        CARD32  p = READ(pixel++);
         CARD32   a,r,g,b;
 
         a = ((p & 0xc0) * 0x55) << 18;
         b = ((p & 0x30) * 0x55) >> 6;
         g = ((p & 0x0c) * 0x55) << 6;
         r = ((p & 0x03) * 0x55) << 16;
-        *buffer++ = a|r|g|b;
+        WRITE(buffer++, a|r|g|b);
     }
 }
 
@@ -378,8 +378,8 @@ fbFetch_c8 (const FbBits *bits, int x, int width, CARD32 *buffer, miIndexedPtr i
     const CARD8 *pixel = (const CARD8 *)bits + x;
     const CARD8 *end = pixel + width;
     while (pixel < end) {
-        CARD32  p = *pixel++;
-        *buffer++ = indexed->rgba[p];
+        CARD32  p = READ(pixel++);
+        WRITE(buffer++, indexed->rgba[p]);
     }
 }
 
@@ -389,8 +389,8 @@ fbFetch_x4a4 (const FbBits *bits, int x, int width, CARD32 *buffer, miIndexedPtr
     const CARD8 *pixel = (const CARD8 *)bits + x;
     const CARD8 *end = pixel + width;
     while (pixel < end) {
-	CARD8 p = (*pixel++) & 0xf;
-        *buffer++ = (p | (p << 4)) << 24;
+	CARD8 p = READ(pixel++) & 0xf;
+        WRITE(buffer++, (p | (p << 4)) << 24);
     }
 }
 
@@ -409,7 +409,7 @@ fbFetch_a4 (const FbBits *bits, int x, int width, CARD32 *buffer, miIndexedPtr i
         CARD32  p = Fetch4(bits, i + x);
 
         p |= p << 4;
-        *buffer++ = p << 24;
+        WRITE(buffer++, p << 24);
     }
 }
 
@@ -424,7 +424,7 @@ fbFetch_r1g2b1 (const FbBits *bits, int x, int width, CARD32 *buffer, miIndexedP
         r = ((p & 0x8) * 0xff) << 13;
         g = ((p & 0x6) * 0x55) << 7;
         b = ((p & 0x1) * 0xff);
-        *buffer++ = 0xff000000|r|g|b;
+        WRITE(buffer++, 0xff000000|r|g|b);
     }
 }
 
@@ -439,7 +439,7 @@ fbFetch_b1g2r1 (const FbBits *bits, int x, int width, CARD32 *buffer, miIndexedP
         b = ((p & 0x8) * 0xff) >> 3;
         g = ((p & 0x6) * 0x55) << 7;
         r = ((p & 0x1) * 0xff) << 16;
-        *buffer++ = 0xff000000|r|g|b;
+        WRITE(buffer++, 0xff000000|r|g|b);
     }
 }
 
@@ -455,7 +455,7 @@ fbFetch_a1r1g1b1 (const FbBits *bits, int x, int width, CARD32 *buffer, miIndexe
         r = ((p & 0x4) * 0xff) << 14;
         g = ((p & 0x2) * 0xff) << 7;
         b = ((p & 0x1) * 0xff);
-        *buffer++ = a|r|g|b;
+        WRITE(buffer++, a|r|g|b);
     }
 }
 
@@ -471,7 +471,7 @@ fbFetch_a1b1g1r1 (const FbBits *bits, int x, int width, CARD32 *buffer, miIndexe
         r = ((p & 0x4) * 0xff) >> 3;
         g = ((p & 0x2) * 0xff) << 7;
         b = ((p & 0x1) * 0xff) << 16;
-        *buffer++ = a|r|g|b;
+        WRITE(buffer++, a|r|g|b);
     }
 }
 
@@ -482,7 +482,7 @@ fbFetch_c4 (const FbBits *bits, int x, int width, CARD32 *buffer, miIndexedPtr i
     for (i = 0; i < width; ++i) {
         CARD32  p = Fetch4(bits, i + x);
 
-        *buffer++ = indexed->rgba[p];
+        WRITE(buffer++, indexed->rgba[p]);
     }
 }
 
@@ -503,7 +503,7 @@ fbFetch_a1 (const FbBits *bits, int x, int width, CARD32 *buffer, miIndexedPtr i
         a |= a << 1;
         a |= a << 2;
         a |= a << 4;
-        *buffer++ = a << 24;
+        WRITE(buffer++, a << 24);
     }
 }
 
@@ -520,7 +520,7 @@ fbFetch_g1 (const FbBits *bits, int x, int width, CARD32 *buffer, miIndexedPtr i
         a = p >> ((i+x) & 0x1f);
 #endif
         a = a & 1;
-        *buffer++ = indexed->rgba[a];
+        WRITE(buffer++, indexed->rgba[a]);
     }
 }
 
@@ -585,19 +585,19 @@ typedef FASTCALL CARD32 (*fetchPixelProc)(const FbBits *bits, int offset, miInde
 static FASTCALL CARD32
 fbFetchPixel_a8r8g8b8 (const FbBits *bits, int offset, miIndexedPtr indexed)
 {
-    return ((CARD32 *)bits)[offset];
+    return READ((CARD32 *)bits + offset);
 }
 
 static FASTCALL CARD32
 fbFetchPixel_x8r8g8b8 (const FbBits *bits, int offset, miIndexedPtr indexed)
 {
-    return ((CARD32 *)bits)[offset] | 0xff000000;
+    return READ((CARD32 *)bits + offset) | 0xff000000;
 }
 
 static FASTCALL CARD32
 fbFetchPixel_a8b8g8r8 (const FbBits *bits, int offset, miIndexedPtr indexed)
 {
-    CARD32  pixel = ((CARD32 *)bits)[offset];
+    CARD32  pixel = READ((CARD32 *)bits + offset);
 
     return ((pixel & 0xff000000) |
 	    ((pixel >> 16) & 0xff) |
@@ -608,7 +608,7 @@ fbFetchPixel_a8b8g8r8 (const FbBits *bits, int offset, miIndexedPtr indexed)
 static FASTCALL CARD32
 fbFetchPixel_x8b8g8r8 (const FbBits *bits, int offset, miIndexedPtr indexed)
 {
-    CARD32  pixel = ((CARD32 *)bits)[offset];
+    CARD32  pixel = READ((CARD32 *)bits + offset);
 
     return ((0xff000000) |
 	    ((pixel >> 16) & 0xff) |
@@ -622,14 +622,14 @@ fbFetchPixel_r8g8b8 (const FbBits *bits, int offset, miIndexedPtr indexed)
     CARD8   *pixel = ((CARD8 *) bits) + (offset*3);
 #if IMAGE_BYTE_ORDER == MSBFirst
     return (0xff000000 |
-	    (pixel[0] << 16) |
-	    (pixel[1] << 8) |
-	    (pixel[2]));
+	    (READ(pixel + 0) << 16) |
+	    (READ(pixel + 1) << 8) |
+	    (READ(pixel + 2)));
 #else
     return (0xff000000 |
-            (pixel[2] << 16) |
-            (pixel[1] << 8) |
-            (pixel[0]));
+            (READ(pixel + 2) << 16) |
+            (READ(pixel + 1) << 8) |
+            (READ(pixel + 0)));
 #endif
 }
 
@@ -639,21 +639,21 @@ fbFetchPixel_b8g8r8 (const FbBits *bits, int offset, miIndexedPtr indexed)
     CARD8   *pixel = ((CARD8 *) bits) + (offset*3);
 #if IMAGE_BYTE_ORDER == MSBFirst
     return (0xff000000 |
-	    (pixel[2] << 16) |
-	    (pixel[1] << 8) |
-	    (pixel[0]));
+	    (READ(pixel + 2) << 16) |
+	    (READ(pixel + 1) << 8) |
+	    (READ(pixel + 0)));
 #else
     return (0xff000000 |
-	    (pixel[0] << 16) |
-	    (pixel[1] << 8) |
-	    (pixel[2]));
+	    (READ(pixel + 0) << 16) |
+	    (READ(pixel + 1) << 8) |
+	    (READ(pixel + 2)));
 #endif
 }
 
 static FASTCALL CARD32
 fbFetchPixel_r5g6b5 (const FbBits *bits, int offset, miIndexedPtr indexed)
 {
-    CARD32  pixel = ((CARD16 *) bits)[offset];
+    CARD32  pixel = READ((CARD16 *) bits + offset);
     CARD32  r,g,b;
 
     r = ((pixel & 0xf800) | ((pixel & 0xe000) >> 5)) << 8;
@@ -665,7 +665,7 @@ fbFetchPixel_r5g6b5 (const FbBits *bits, int offset, miIndexedPtr indexed)
 static FASTCALL CARD32
 fbFetchPixel_b5g6r5 (const FbBits *bits, int offset, miIndexedPtr indexed)
 {
-    CARD32  pixel = ((CARD16 *) bits)[offset];
+    CARD32  pixel = READ((CARD16 *) bits + offset);
     CARD32  r,g,b;
 
     b = ((pixel & 0xf800) | ((pixel & 0xe000) >> 5)) >> 8;
@@ -677,7 +677,7 @@ fbFetchPixel_b5g6r5 (const FbBits *bits, int offset, miIndexedPtr indexed)
 static FASTCALL CARD32
 fbFetchPixel_a1r5g5b5 (const FbBits *bits, int offset, miIndexedPtr indexed)
 {
-    CARD32  pixel = ((CARD16 *) bits)[offset];
+    CARD32  pixel = READ((CARD16 *) bits + offset);
     CARD32  a,r,g,b;
 
     a = (CARD32) ((CARD8) (0 - ((pixel & 0x8000) >> 15))) << 24;
@@ -690,7 +690,7 @@ fbFetchPixel_a1r5g5b5 (const FbBits *bits, int offset, miIndexedPtr indexed)
 static FASTCALL CARD32
 fbFetchPixel_x1r5g5b5 (const FbBits *bits, int offset, miIndexedPtr indexed)
 {
-    CARD32  pixel = ((CARD16 *) bits)[offset];
+    CARD32  pixel = READ((CARD16 *) bits + offset);
     CARD32  r,g,b;
 
     r = ((pixel & 0x7c00) | ((pixel & 0x7000) >> 5)) << 9;
@@ -702,7 +702,7 @@ fbFetchPixel_x1r5g5b5 (const FbBits *bits, int offset, miIndexedPtr indexed)
 static FASTCALL CARD32
 fbFetchPixel_a1b5g5r5 (const FbBits *bits, int offset, miIndexedPtr indexed)
 {
-    CARD32  pixel = ((CARD16 *) bits)[offset];
+    CARD32  pixel = READ((CARD16 *) bits + offset);
     CARD32  a,r,g,b;
 
     a = (CARD32) ((CARD8) (0 - ((pixel & 0x8000) >> 15))) << 24;
@@ -715,7 +715,7 @@ fbFetchPixel_a1b5g5r5 (const FbBits *bits, int offset, miIndexedPtr indexed)
 static FASTCALL CARD32
 fbFetchPixel_x1b5g5r5 (const FbBits *bits, int offset, miIndexedPtr indexed)
 {
-    CARD32  pixel = ((CARD16 *) bits)[offset];
+    CARD32  pixel = READ((CARD16 *) bits + offset);
     CARD32  r,g,b;
 
     b = ((pixel & 0x7c00) | ((pixel & 0x7000) >> 5)) >> 7;
@@ -727,7 +727,7 @@ fbFetchPixel_x1b5g5r5 (const FbBits *bits, int offset, miIndexedPtr indexed)
 static FASTCALL CARD32
 fbFetchPixel_a4r4g4b4 (const FbBits *bits, int offset, miIndexedPtr indexed)
 {
-    CARD32  pixel = ((CARD16 *) bits)[offset];
+    CARD32  pixel = READ((CARD16 *) bits + offset);
     CARD32  a,r,g,b;
 
     a = ((pixel & 0xf000) | ((pixel & 0xf000) >> 4)) << 16;
@@ -740,7 +740,7 @@ fbFetchPixel_a4r4g4b4 (const FbBits *bits, int offset, miIndexedPtr indexed)
 static FASTCALL CARD32
 fbFetchPixel_x4r4g4b4 (const FbBits *bits, int offset, miIndexedPtr indexed)
 {
-    CARD32  pixel = ((CARD16 *) bits)[offset];
+    CARD32  pixel = READ((CARD16 *) bits + offset);
     CARD32  r,g,b;
 
     r = ((pixel & 0x0f00) | ((pixel & 0x0f00) >> 4)) << 12;
@@ -752,7 +752,7 @@ fbFetchPixel_x4r4g4b4 (const FbBits *bits, int offset, miIndexedPtr indexed)
 static FASTCALL CARD32
 fbFetchPixel_a4b4g4r4 (const FbBits *bits, int offset, miIndexedPtr indexed)
 {
-    CARD32  pixel = ((CARD16 *) bits)[offset];
+    CARD32  pixel = READ((CARD16 *) bits + offset);
     CARD32  a,r,g,b;
 
     a = ((pixel & 0xf000) | ((pixel & 0xf000) >> 4)) << 16;
@@ -765,7 +765,7 @@ fbFetchPixel_a4b4g4r4 (const FbBits *bits, int offset, miIndexedPtr indexed)
 static FASTCALL CARD32
 fbFetchPixel_x4b4g4r4 (const FbBits *bits, int offset, miIndexedPtr indexed)
 {
-    CARD32  pixel = ((CARD16 *) bits)[offset];
+    CARD32  pixel = READ((CARD16 *) bits + offset);
     CARD32  r,g,b;
 
     b = ((pixel & 0x0f00) | ((pixel & 0x0f00) >> 4)) >> 4;
@@ -777,7 +777,7 @@ fbFetchPixel_x4b4g4r4 (const FbBits *bits, int offset, miIndexedPtr indexed)
 static FASTCALL CARD32
 fbFetchPixel_a8 (const FbBits *bits, int offset, miIndexedPtr indexed)
 {
-    CARD32   pixel = ((CARD8 *) bits)[offset];
+    CARD32   pixel = READ((CARD8 *) bits + offset);
 
     return pixel << 24;
 }
@@ -785,7 +785,7 @@ fbFetchPixel_a8 (const FbBits *bits, int offset, miIndexedPtr indexed)
 static FASTCALL CARD32
 fbFetchPixel_r3g3b2 (const FbBits *bits, int offset, miIndexedPtr indexed)
 {
-    CARD32   pixel = ((CARD8 *) bits)[offset];
+    CARD32   pixel = READ((CARD8 *) bits + offset);
     CARD32  r,g,b;
 
     r = ((pixel & 0xe0) | ((pixel & 0xe0) >> 3) | ((pixel & 0xc0) >> 6)) << 16;
@@ -800,7 +800,7 @@ fbFetchPixel_r3g3b2 (const FbBits *bits, int offset, miIndexedPtr indexed)
 static FASTCALL CARD32
 fbFetchPixel_b2g3r3 (const FbBits *bits, int offset, miIndexedPtr indexed)
 {
-    CARD32   pixel = ((CARD8 *) bits)[offset];
+    CARD32   pixel = READ((CARD8 *) bits + offset);
     CARD32  r,g,b;
 
     b = (((pixel & 0xc0)     ) |
@@ -817,7 +817,7 @@ fbFetchPixel_b2g3r3 (const FbBits *bits, int offset, miIndexedPtr indexed)
 static FASTCALL CARD32
 fbFetchPixel_a2r2g2b2 (const FbBits *bits, int offset, miIndexedPtr indexed)
 {
-    CARD32   pixel = ((CARD8 *) bits)[offset];
+    CARD32   pixel = READ((CARD8 *) bits + offset);
     CARD32   a,r,g,b;
 
     a = ((pixel & 0xc0) * 0x55) << 18;
@@ -830,7 +830,7 @@ fbFetchPixel_a2r2g2b2 (const FbBits *bits, int offset, miIndexedPtr indexed)
 static FASTCALL CARD32
 fbFetchPixel_a2b2g2r2 (const FbBits *bits, int offset, miIndexedPtr indexed)
 {
-    CARD32   pixel = ((CARD8 *) bits)[offset];
+    CARD32   pixel = READ((CARD8 *) bits + offset);
     CARD32   a,r,g,b;
 
     a = ((pixel & 0xc0) * 0x55) << 18;
@@ -843,14 +843,14 @@ fbFetchPixel_a2b2g2r2 (const FbBits *bits, int offset, miIndexedPtr indexed)
 static FASTCALL CARD32
 fbFetchPixel_c8 (const FbBits *bits, int offset, miIndexedPtr indexed)
 {
-    CARD32   pixel = ((CARD8 *) bits)[offset];
+    CARD32   pixel = READ((CARD8 *) bits + offset);
     return indexed->rgba[pixel];
 }
 
 static FASTCALL CARD32
 fbFetchPixel_x4a4 (const FbBits *bits, int offset, miIndexedPtr indexed)
 {
-    CARD32   pixel = ((CARD8 *) bits)[offset];
+    CARD32   pixel = READ((CARD8 *) bits + offset);
 
     return ((pixel & 0xf) | ((pixel & 0xf) << 4)) << 24;
 }
@@ -1027,7 +1027,7 @@ typedef FASTCALL void (*storeProc) (FbBits *bits, const CARD32 *values, int x, i
 static FASTCALL void
 fbStore_a8r8g8b8 (FbBits *bits, const CARD32 *values, int x, int width, miIndexedPtr indexed)
 {
-    memcpy(((CARD32 *)bits) + x, values, width*sizeof(CARD32));
+    MEMCPY_WRAPPED(((CARD32 *)bits) + x, values, width*sizeof(CARD32));
 }
 
 static FASTCALL void
@@ -1036,7 +1036,7 @@ fbStore_x8r8g8b8 (FbBits *bits, const CARD32 *values, int x, int width, miIndexe
     int i;
     CARD32 *pixel = (CARD32 *)bits + x;
     for (i = 0; i < width; ++i)
-        *pixel++ = values[i] & 0xffffff;
+        WRITE(pixel++, READ(values + i) & 0xffffff);
 }
 
 static FASTCALL void
@@ -1045,7 +1045,7 @@ fbStore_a8b8g8r8 (FbBits *bits, const CARD32 *values, int x, int width, miIndexe
     int i;
     CARD32 *pixel = (CARD32 *)bits + x;
     for (i = 0; i < width; ++i)
-        *pixel++ = (values[i] & 0xff00ff00) | ((values[i] >> 16) & 0xff) | ((values[i] & 0xff) << 16);
+        WRITE(pixel++, (READ(values + i) & 0xff00ff00) | ((READ(values + i) >> 16) & 0xff) | ((READ(values + i) & 0xff) << 16));
 }
 
 static FASTCALL void
@@ -1054,7 +1054,7 @@ fbStore_x8b8g8r8 (FbBits *bits, const CARD32 *values, int x, int width, miIndexe
     int i;
     CARD32 *pixel = (CARD32 *)bits + x;
     for (i = 0; i < width; ++i)
-        *pixel++ = (values[i] & 0x0000ff00) | ((values[i] >> 16) & 0xff) | ((values[i] & 0xff) << 16);
+        WRITE(pixel++, (READ(values + i) & 0x0000ff00) | ((READ(values + i) >> 16) & 0xff) | ((READ(values + i) & 0xff) << 16));
 }
 
 static FASTCALL void
@@ -1063,7 +1063,7 @@ fbStore_r8g8b8 (FbBits *bits, const CARD32 *values, int x, int width, miIndexedP
     int i;
     CARD8 *pixel = ((CARD8 *) bits) + 3*x;
     for (i = 0; i < width; ++i) {
-        Store24(pixel, values[i]);
+        Store24(pixel, READ(values + i));
         pixel += 3;
     }
 }
@@ -1074,14 +1074,15 @@ fbStore_b8g8r8 (FbBits *bits, const CARD32 *values, int x, int width, miIndexedP
     int i;
     CARD8 *pixel = ((CARD8 *) bits) + 3*x;
     for (i = 0; i < width; ++i) {
+        CARD32 val = READ(values + i);
 #if IMAGE_BYTE_ORDER == MSBFirst
-        *pixel++ = Blue(values[i]);
-        *pixel++ = Green(values[i]);
-        *pixel++ = Red(values[i]);
+        WRITE(pixel++, Blue(val));
+        WRITE(pixel++, Green(val));
+        WRITE(pixel++, Red(val));
 #else
-        *pixel++ = Red(values[i]);
-        *pixel++ = Green(values[i]);
-        *pixel++ = Blue(values[i]);
+        WRITE(pixel++, Red(val));
+        WRITE(pixel++, Green(val));
+        WRITE(pixel++, Blue(val));
 #endif
     }
 }
@@ -1092,10 +1093,10 @@ fbStore_r5g6b5 (FbBits *bits, const CARD32 *values, int x, int width, miIndexedP
     int i;
     CARD16 *pixel = ((CARD16 *) bits) + x;
     for (i = 0; i < width; ++i) {
-        CARD32 s = values[i];
-        *pixel++ = ((s >> 3) & 0x001f) |
-                   ((s >> 5) & 0x07e0) |
-                   ((s >> 8) & 0xf800);
+        CARD32 s = READ(values + i);
+        WRITE(pixel++, ((s >> 3) & 0x001f) |
+                       ((s >> 5) & 0x07e0) |
+                       ((s >> 8) & 0xf800));
     }
 }
 
@@ -1105,10 +1106,10 @@ fbStore_b5g6r5 (FbBits *bits, const CARD32 *values, int x, int width, miIndexedP
     int i;
     CARD16  *pixel = ((CARD16 *) bits) + x;
     for (i = 0; i < width; ++i) {
-        Split(values[i]);
-        *pixel++ = (((b << 8) & 0xf800) |
-                    ((g << 3) & 0x07e0) |
-                    ((r >> 3)         ));
+        Split(READ(values + i));
+        WRITE(pixel++, ((b << 8) & 0xf800) |
+                       ((g << 3) & 0x07e0) |
+                       ((r >> 3)         ));
     }
 }
 
@@ -1118,11 +1119,11 @@ fbStore_a1r5g5b5 (FbBits *bits, const CARD32 *values, int x, int width, miIndexe
     int i;
     CARD16  *pixel = ((CARD16 *) bits) + x;
     for (i = 0; i < width; ++i) {
-        Splita(values[i]);
-        *pixel++ = (((a << 8) & 0x8000) |
-                    ((r << 7) & 0x7c00) |
-                    ((g << 2) & 0x03e0) |
-                    ((b >> 3)         ));
+        Splita(READ(values + i));
+        WRITE(pixel++, ((a << 8) & 0x8000) |
+                       ((r << 7) & 0x7c00) |
+                       ((g << 2) & 0x03e0) |
+                       ((b >> 3)         ));
     }
 }
 
@@ -1132,10 +1133,10 @@ fbStore_x1r5g5b5 (FbBits *bits, const CARD32 *values, int x, int width, miIndexe
     int i;
     CARD16  *pixel = ((CARD16 *) bits) + x;
     for (i = 0; i < width; ++i) {
-        Split(values[i]);
-        *pixel++ = (((r << 7) & 0x7c00) |
-                    ((g << 2) & 0x03e0) |
-                    ((b >> 3)         ));
+        Split(READ(values + i));
+        WRITE(pixel++, ((r << 7) & 0x7c00) |
+                       ((g << 2) & 0x03e0) |
+                       ((b >> 3)         ));
     }
 }
 
@@ -1145,11 +1146,11 @@ fbStore_a1b5g5r5 (FbBits *bits, const CARD32 *values, int x, int width, miIndexe
     int i;
     CARD16  *pixel = ((CARD16 *) bits) + x;
     for (i = 0; i < width; ++i) {
-        Splita(values[i]);
-        *pixel++ = (((a << 8) & 0x8000) |
-                    ((b << 7) & 0x7c00) |
-                    ((g << 2) & 0x03e0) |
-                    ((r >> 3)         ));
+        Splita(READ(values + i));
+        WRITE(pixel++, ((a << 8) & 0x8000) |
+                       ((b << 7) & 0x7c00) |
+                       ((g << 2) & 0x03e0) |
+                       ((r >> 3)         ));
 	}
 }
 
@@ -1159,10 +1160,10 @@ fbStore_x1b5g5r5 (FbBits *bits, const CARD32 *values, int x, int width, miIndexe
     int i;
     CARD16  *pixel = ((CARD16 *) bits) + x;
     for (i = 0; i < width; ++i) {
-        Split(values[i]);
-        *pixel++ = (((b << 7) & 0x7c00) |
-                    ((g << 2) & 0x03e0) |
-                    ((r >> 3)         ));
+        Split(READ(values + i));
+        WRITE(pixel++, ((b << 7) & 0x7c00) |
+                       ((g << 2) & 0x03e0) |
+                       ((r >> 3)         ));
     }
 }
 
@@ -1172,11 +1173,11 @@ fbStore_a4r4g4b4 (FbBits *bits, const CARD32 *values, int x, int width, miIndexe
     int i;
     CARD16  *pixel = ((CARD16 *) bits) + x;
     for (i = 0; i < width; ++i) {
-        Splita(values[i]);
-        *pixel++ = (((a << 8) & 0xf000) |
-                    ((r << 4) & 0x0f00) |
-                    ((g     ) & 0x00f0) |
-                    ((b >> 4)         ));
+        Splita(READ(values + i));
+        WRITE(pixel++, ((a << 8) & 0xf000) |
+                       ((r << 4) & 0x0f00) |
+                       ((g     ) & 0x00f0) |
+                       ((b >> 4)         ));
     }
 }
 
@@ -1186,10 +1187,10 @@ fbStore_x4r4g4b4 (FbBits *bits, const CARD32 *values, int x, int width, miIndexe
     int i;
     CARD16  *pixel = ((CARD16 *) bits) + x;
     for (i = 0; i < width; ++i) {
-        Split(values[i]);
-        *pixel++ = (((r << 4) & 0x0f00) |
-                    ((g     ) & 0x00f0) |
-                    ((b >> 4)         ));
+        Split(READ(values + i));
+        WRITE(pixel++, ((r << 4) & 0x0f00) |
+                       ((g     ) & 0x00f0) |
+                       ((b >> 4)         ));
     }
 }
 
@@ -1199,11 +1200,11 @@ fbStore_a4b4g4r4 (FbBits *bits, const CARD32 *values, int x, int width, miIndexe
     int i;
     CARD16  *pixel = ((CARD16 *) bits) + x;
     for (i = 0; i < width; ++i) {
-        Splita(values[i]);
-        *pixel++ = (((a << 8) & 0xf000) |
-                    ((b << 4) & 0x0f00) |
-                    ((g     ) & 0x00f0) |
-                    ((r >> 4)         ));
+        Splita(READ(values + i));
+        WRITE(pixel++, ((a << 8) & 0xf000) |
+                       ((b << 4) & 0x0f00) |
+                       ((g     ) & 0x00f0) |
+                       ((r >> 4)         ));
     }
 }
 
@@ -1213,10 +1214,10 @@ fbStore_x4b4g4r4 (FbBits *bits, const CARD32 *values, int x, int width, miIndexe
     int i;
     CARD16  *pixel = ((CARD16 *) bits) + x;
     for (i = 0; i < width; ++i) {
-        Split(values[i]);
-        *pixel++ = (((b << 4) & 0x0f00) |
-                    ((g     ) & 0x00f0) |
-                    ((r >> 4)         ));
+        Split(READ(values + i));
+        WRITE(pixel++, ((b << 4) & 0x0f00) |
+                       ((g     ) & 0x00f0) |
+                       ((r >> 4)         ));
     }
 }
 
@@ -1226,7 +1227,7 @@ fbStore_a8 (FbBits *bits, const CARD32 *values, int x, int width, miIndexedPtr i
     int i;
     CARD8   *pixel = ((CARD8 *) bits) + x;
     for (i = 0; i < width; ++i) {
-        *pixel++ = values[i] >> 24;
+        WRITE(pixel++, READ(values + i) >> 24);
     }
 }
 
@@ -1236,10 +1237,10 @@ fbStore_r3g3b2 (FbBits *bits, const CARD32 *values, int x, int width, miIndexedP
     int i;
     CARD8   *pixel = ((CARD8 *) bits) + x;
     for (i = 0; i < width; ++i) {
-        Split(values[i]);
-        *pixel++ = (((r     ) & 0xe0) |
-                    ((g >> 3) & 0x1c) |
-                    ((b >> 6)       ));
+        Split(READ(values + i));
+        WRITE(pixel++, ((r     ) & 0xe0) |
+                       ((g >> 3) & 0x1c) |
+                       ((b >> 6)       ));
     }
 }
 
@@ -1249,10 +1250,10 @@ fbStore_b2g3r3 (FbBits *bits, const CARD32 *values, int x, int width, miIndexedP
     int i;
     CARD8   *pixel = ((CARD8 *) bits) + x;
     for (i = 0; i < width; ++i) {
-        Split(values[i]);
-        *pixel++ = (((b     ) & 0xe0) |
-                    ((g >> 3) & 0x1c) |
-                    ((r >> 6)       ));
+        Split(READ(values + i));
+        WRITE(pixel++, ((b     ) & 0xe0) |
+                       ((g >> 3) & 0x1c) |
+                       ((r >> 6)       ));
     }
 }
 
@@ -1262,11 +1263,11 @@ fbStore_a2r2g2b2 (FbBits *bits, const CARD32 *values, int x, int width, miIndexe
     int i;
     CARD8   *pixel = ((CARD8 *) bits) + x;
     for (i = 0; i < width; ++i) {
-        Splita(values[i]);
-        *pixel++ = (((a     ) & 0xc0) |
-                    ((r >> 2) & 0x30) |
-                    ((g >> 4) & 0x0c) |
-                    ((b >> 6)       ));
+        Splita(READ(values + i));
+        WRITE(pixel++, ((a     ) & 0xc0) |
+                       ((r >> 2) & 0x30) |
+                       ((g >> 4) & 0x0c) |
+                       ((b >> 6)       ));
     }
 }
 
@@ -1276,7 +1277,7 @@ fbStore_c8 (FbBits *bits, const CARD32 *values, int x, int width, miIndexedPtr i
     int i;
     CARD8   *pixel = ((CARD8 *) bits) + x;
     for (i = 0; i < width; ++i) {
-        *pixel++ = miIndexToEnt24(indexed,values[i]);
+        WRITE(pixel++, miIndexToEnt24(indexed,READ(values + i)));
     }
 }
 
@@ -1286,7 +1287,7 @@ fbStore_x4a4 (FbBits *bits, const CARD32 *values, int x, int width, miIndexedPtr
     int i;
     CARD8   *pixel = ((CARD8 *) bits) + x;
     for (i = 0; i < width; ++i) {
-        *pixel++ = values[i] >> 28;
+        WRITE(pixel++, READ(values + i) >> 28);
     }
 }
 
@@ -1306,7 +1307,7 @@ fbStore_a4 (FbBits *bits, const CARD32 *values, int x, int width, miIndexedPtr i
 {
     int i;
     for (i = 0; i < width; ++i) {
-        Store4(bits, i + x, values[i]>>28);
+        Store4(bits, i + x, READ(values + i)>>28);
     }
 }
 
@@ -1317,7 +1318,7 @@ fbStore_r1g2b1 (FbBits *bits, const CARD32 *values, int x, int width, miIndexedP
     for (i = 0; i < width; ++i) {
         CARD32  pixel;
 
-        Split(values[i]);
+        Split(READ(values + i));
         pixel = (((r >> 4) & 0x8) |
                  ((g >> 5) & 0x6) |
                  ((b >> 7)      ));
@@ -1332,7 +1333,7 @@ fbStore_b1g2r1 (FbBits *bits, const CARD32 *values, int x, int width, miIndexedP
     for (i = 0; i < width; ++i) {
         CARD32  pixel;
 
-        Split(values[i]);
+        Split(READ(values + i));
         pixel = (((b >> 4) & 0x8) |
                  ((g >> 5) & 0x6) |
                  ((r >> 7)      ));
@@ -1346,7 +1347,7 @@ fbStore_a1r1g1b1 (FbBits *bits, const CARD32 *values, int x, int width, miIndexe
     int i;
     for (i = 0; i < width; ++i) {
         CARD32  pixel;
-        Splita(values[i]);
+        Splita(READ(values + i));
         pixel = (((a >> 4) & 0x8) |
                  ((r >> 5) & 0x4) |
                  ((g >> 6) & 0x2) |
@@ -1361,7 +1362,7 @@ fbStore_a1b1g1r1 (FbBits *bits, const CARD32 *values, int x, int width, miIndexe
     int i;
     for (i = 0; i < width; ++i) {
         CARD32  pixel;
-        Splita(values[i]);
+        Splita(READ(values + i));
         pixel = (((a >> 4) & 0x8) |
                  ((b >> 5) & 0x4) |
                  ((g >> 6) & 0x2) |
@@ -1377,7 +1378,7 @@ fbStore_c4 (FbBits *bits, const CARD32 *values, int x, int width, miIndexedPtr i
     for (i = 0; i < width; ++i) {
         CARD32  pixel;
 
-        pixel = miIndexToEnt24(indexed, values[i]);
+        pixel = miIndexToEnt24(indexed, READ(values + i));
         Store4(bits, i + x, pixel);
     }
 }
@@ -1390,8 +1391,8 @@ fbStore_a1 (FbBits *bits, const CARD32 *values, int x, int width, miIndexedPtr i
         CARD32  *pixel = ((CARD32 *) bits) + ((i+x) >> 5);
         CARD32  mask = FbStipMask((i+x) & 0x1f, 1);
 
-        CARD32 v = values[i] & 0x80000000 ? mask : 0;
-        *pixel = (*pixel & ~mask) | v;
+        CARD32 v = READ(values + i) & 0x80000000 ? mask : 0;
+        WRITE(pixel, (READ(pixel) & ~mask) | v);
     }
 }
 
@@ -1403,8 +1404,8 @@ fbStore_g1 (FbBits *bits, const CARD32 *values, int x, int width, miIndexedPtr i
         CARD32  *pixel = ((CARD32 *) bits) + ((i+x) >> 5);
         CARD32  mask = FbStipMask((i+x) & 0x1f, 1);
 
-        CARD32 v = miIndexToEntY24(indexed,values[i]) ? mask : 0;
-        *pixel = (*pixel & ~mask) | v;
+        CARD32 v = miIndexToEntY24(indexed,READ(values + i)) ? mask : 0;
+        WRITE(pixel, (READ(pixel) & ~mask) | v);
     }
 }
 
@@ -1469,10 +1470,10 @@ fbCombineMaskU (CARD32 *src, const CARD32 *mask, int width)
 {
     int i;
     for (i = 0; i < width; ++i) {
-        CARD32 a = mask[i] >> 24;
-        CARD32 s = src[i];
+        CARD32 a = READ(mask + i) >> 24;
+        CARD32 s = READ(src + i);
         FbByteMul(s, a);
-        src[i] = s;
+        WRITE(src + i, s);
     }
 }
 
@@ -1483,13 +1484,13 @@ fbCombineMaskU (CARD32 *src, const CARD32 *mask, int width)
 static FASTCALL void
 fbCombineClear (CARD32 *dest, const CARD32 *src, int width)
 {
-    memset(dest, 0, width*sizeof(CARD32));
+    MEMSET_WRAPPED(dest, 0, width*sizeof(CARD32));
 }
 
 static FASTCALL void
 fbCombineSrcU (CARD32 *dest, const CARD32 *src, int width)
 {
-    memcpy(dest, src, width*sizeof(CARD32));
+    MEMCPY_WRAPPED(dest, src, width*sizeof(CARD32));
 }
 
 
@@ -1498,12 +1499,12 @@ fbCombineOverU (CARD32 *dest, const CARD32 *src, int width)
 {
     int i;
     for (i = 0; i < width; ++i) {
-        CARD32 s = src[i];
-        CARD32 d = dest[i];
+        CARD32 s = READ(src + i);
+        CARD32 d = READ(dest + i);
         CARD32 ia = Alpha(~s);
 
         FbByteMulAdd(d, ia, s);
-        dest[i] = d;
+        WRITE(dest + i, d);
     }
 }
 
@@ -1512,11 +1513,11 @@ fbCombineOverReverseU (CARD32 *dest, const CARD32 *src, int width)
 {
     int i;
     for (i = 0; i < width; ++i) {
-        CARD32 s = src[i];
-        CARD32 d = dest[i];
-        CARD32 ia = Alpha(~dest[i]);
+        CARD32 s = READ(src + i);
+        CARD32 d = READ(dest + i);
+        CARD32 ia = Alpha(~READ(dest + i));
         FbByteMulAdd(s, ia, d);
-        dest[i] = s;
+        WRITE(dest + i, s);
     }
 }
 
@@ -1525,10 +1526,10 @@ fbCombineInU (CARD32 *dest, const CARD32 *src, int width)
 {
     int i;
     for (i = 0; i < width; ++i) {
-        CARD32 s = src[i];
-        CARD32 a = Alpha(dest[i]);
+        CARD32 s = READ(src + i);
+        CARD32 a = Alpha(READ(dest + i));
         FbByteMul(s, a);
-        dest[i] = s;
+        WRITE(dest + i, s);
     }
 }
 
@@ -1537,10 +1538,10 @@ fbCombineInReverseU (CARD32 *dest, const CARD32 *src, int width)
 {
     int i;
     for (i = 0; i < width; ++i) {
-        CARD32 d = dest[i];
-        CARD32 a = Alpha(src[i]);
+        CARD32 d = READ(dest + i);
+        CARD32 a = Alpha(READ(src + i));
         FbByteMul(d, a);
-        dest[i] = d;
+        WRITE(dest + i, d);
     }
 }
 
@@ -1549,10 +1550,10 @@ fbCombineOutU (CARD32 *dest, const CARD32 *src, int width)
 {
     int i;
     for (i = 0; i < width; ++i) {
-        CARD32 s = src[i];
-        CARD32 a = Alpha(~dest[i]);
+        CARD32 s = READ(src + i);
+        CARD32 a = Alpha(~READ(dest + i));
         FbByteMul(s, a);
-        dest[i] = s;
+        WRITE(dest + i, s);
     }
 }
 
@@ -1561,10 +1562,10 @@ fbCombineOutReverseU (CARD32 *dest, const CARD32 *src, int width)
 {
     int i;
     for (i = 0; i < width; ++i) {
-        CARD32 d = dest[i];
-        CARD32 a = Alpha(~src[i]);
+        CARD32 d = READ(dest + i);
+        CARD32 a = Alpha(~READ(src + i));
         FbByteMul(d, a);
-        dest[i] = d;
+        WRITE(dest + i, d);
     }
 }
 
@@ -1573,13 +1574,13 @@ fbCombineAtopU (CARD32 *dest, const CARD32 *src, int width)
 {
     int i;
     for (i = 0; i < width; ++i) {
-        CARD32 s = src[i];
-        CARD32 d = dest[i];
+        CARD32 s = READ(src + i);
+        CARD32 d = READ(dest + i);
         CARD32 dest_a = Alpha(d);
         CARD32 src_ia = Alpha(~s);
 
         FbByteAddMul(s, dest_a, d, src_ia);
-        dest[i] = s;
+        WRITE(dest + i, s);
     }
 }
 
@@ -1588,13 +1589,13 @@ fbCombineAtopReverseU (CARD32 *dest, const CARD32 *src, int width)
 {
     int i;
     for (i = 0; i < width; ++i) {
-        CARD32 s = src[i];
-        CARD32 d = dest[i];
+        CARD32 s = READ(src + i);
+        CARD32 d = READ(dest + i);
         CARD32 src_a = Alpha(s);
         CARD32 dest_ia = Alpha(~d);
 
         FbByteAddMul(s, dest_ia, d, src_a);
-        dest[i] = s;
+        WRITE(dest + i, s);
     }
 }
 
@@ -1603,13 +1604,13 @@ fbCombineXorU (CARD32 *dest, const CARD32 *src, int width)
 {
     int i;
     for (i = 0; i < width; ++i) {
-        CARD32 s = src[i];
-        CARD32 d = dest[i];
+        CARD32 s = READ(src + i);
+        CARD32 d = READ(dest + i);
         CARD32 src_ia = Alpha(~s);
         CARD32 dest_ia = Alpha(~d);
 
         FbByteAddMul(s, dest_ia, d, src_ia);
-        dest[i] = s;
+        WRITE(dest + i, s);
     }
 }
 
@@ -1618,10 +1619,10 @@ fbCombineAddU (CARD32 *dest, const CARD32 *src, int width)
 {
     int i;
     for (i = 0; i < width; ++i) {
-        CARD32 s = src[i];
-        CARD32 d = dest[i];
+        CARD32 s = READ(src + i);
+        CARD32 d = READ(dest + i);
         FbByteAdd(d, s);
-        dest[i] = d;
+        WRITE(dest + i, d);
     }
 }
 
@@ -1630,8 +1631,8 @@ fbCombineSaturateU (CARD32 *dest, const CARD32 *src, int width)
 {
     int i;
     for (i = 0; i < width; ++i) {
-        CARD32  s = src[i];
-        CARD32 d = dest[i];
+        CARD32  s = READ(src + i);
+        CARD32 d = READ(dest + i);
         CARD16  sa, da;
 
         sa = s >> 24;
@@ -1642,7 +1643,7 @@ fbCombineSaturateU (CARD32 *dest, const CARD32 *src, int width)
             FbByteMul(s, sa);
         }
         FbByteAdd(d, s);
-        dest[i] = d;
+        WRITE(dest + i, d);
     }
 }
 
@@ -1716,8 +1717,8 @@ fbCombineDisjointGeneralU (CARD32 *dest, const CARD32 *src, int width, CARD8 com
 {
     int i;
     for (i = 0; i < width; ++i) {
-        CARD32 s = src[i];
-        CARD32 d = dest[i];
+        CARD32 s = READ(src + i);
+        CARD32 d = READ(dest + i);
         CARD32 m,n,o,p;
         CARD16 Fa, Fb, t, u, v;
         CARD8 sa = s >> 24;
@@ -1757,7 +1758,7 @@ fbCombineDisjointGeneralU (CARD32 *dest, const CARD32 *src, int width, CARD8 com
         o = FbGen (s,d,16,Fa,Fb,t, u, v);
         p = FbGen (s,d,24,Fa,Fb,t, u, v);
         s = m|n|o|p;
-        dest[i] = s;
+        WRITE(dest + i, s);
     }
 }
 
@@ -1766,19 +1767,19 @@ fbCombineDisjointOverU (CARD32 *dest, const CARD32 *src, int width)
 {
     int i;
     for (i = 0; i < width; ++i) {
-        CARD32  s = src[i];
+        CARD32  s = READ(src + i);
         CARD16  a = s >> 24;
 
         if (a != 0x00)
         {
             if (a != 0xff)
             {
-                CARD32 d = dest[i];
+                CARD32 d = READ(dest + i);
                 a = fbCombineDisjointOutPart (d >> 24, a);
                 FbByteMulAdd(d, a, s);
                 s = d;
             }
-            dest[i] = s;
+            WRITE(dest + i, s);
         }
     }
 }
@@ -1855,8 +1856,8 @@ fbCombineConjointGeneralU (CARD32 *dest, const CARD32 *src, int width, CARD8 com
 {
     int i;
     for (i = 0; i < width; ++i) {
-        CARD32  s = src[i];
-        CARD32 d = dest[i];
+        CARD32  s = READ(src + i);
+        CARD32 d = READ(dest + i);
         CARD32  m,n,o,p;
         CARD16  Fa, Fb, t, u, v;
         CARD8 sa = s >> 24;
@@ -1896,7 +1897,7 @@ fbCombineConjointGeneralU (CARD32 *dest, const CARD32 *src, int width, CARD8 com
         o = FbGen (s,d,16,Fa,Fb,t, u, v);
         p = FbGen (s,d,24,Fa,Fb,t, u, v);
         s = m|n|o|p;
-        dest[i] = s;
+        WRITE(dest + i, s);
     }
 }
 
@@ -2009,32 +2010,32 @@ fbCombineMaskC (CARD32 *src, CARD32 *mask, int width)
 {
     int i;
     for (i = 0; i < width; ++i) {
-        CARD32 a = mask[i];
+        CARD32 a = READ(mask + i);
 
         CARD32	x;
         CARD16	xa;
 
         if (!a)
         {
-            src[i] = 0;
+            WRITE(src + i, 0);
             continue;
         }
 
-        x = src[i];
+        x = READ(src + i);
         if (a == 0xffffffff)
         {
             x = x >> 24;
             x |= x << 8;
             x |= x << 16;
-            mask[i] = x;
+            WRITE(mask + i, x);
             continue;
         }
 
         xa = x >> 24;
         FbByteMulC(x, a);
-        src[i] = x;
+        WRITE(src + i, x);
         FbByteMul(a, xa);
-        mask[i] = a;
+        WRITE(mask + i, a);
     }
 }
 
@@ -2043,21 +2044,21 @@ fbCombineMaskValueC (CARD32 *src, const CARD32 *mask, int width)
 {
     int i;
     for (i = 0; i < width; ++i) {
-        CARD32 a = mask[i];
+        CARD32 a = READ(mask + i);
         CARD32	x;
 
         if (!a)
         {
-            src[i] = 0;
+            WRITE(src + i, 0);
             continue;
         }
 
         if (a == 0xffffffff)
             continue;
 
-        x = src[i];
+        x = READ(src + i);
         FbByteMulC(x, a);
-        src[i] = x;
+        WRITE(src + i, x);
     }
 }
 
@@ -2067,13 +2068,13 @@ fbCombineMaskAlphaC (const CARD32 *src, CARD32 *mask, int width)
 {
     int i;
     for (i = 0; i < width; ++i) {
-        CARD32 a = mask[i];
+        CARD32 a = READ(mask + i);
         CARD32	x;
 
         if (!a)
             continue;
 
-        x = src[i] >> 24;
+        x = READ(src + i) >> 24;
         if (x == 0xff)
             continue;
         if (a == 0xffffffff)
@@ -2081,12 +2082,12 @@ fbCombineMaskAlphaC (const CARD32 *src, CARD32 *mask, int width)
             x = x >> 24;
             x |= x << 8;
             x |= x << 16;
-            mask[i] = x;
+            WRITE(mask + i, x);
             continue;
         }
 
         FbByteMul(a, x);
-        mask[i] = a;
+        WRITE(mask + i, a);
     }
 }
 
@@ -2100,7 +2101,7 @@ static FASTCALL void
 fbCombineSrcC (CARD32 *dest, CARD32 *src, CARD32 *mask, int width)
 {
     fbCombineMaskValueC(src, mask, width);
-    memcpy(dest, src, width*sizeof(CARD32));
+    MEMCPY_WRAPPED(dest, src, width*sizeof(CARD32));
 }
 
 static FASTCALL void
@@ -2109,18 +2110,18 @@ fbCombineOverC (CARD32 *dest, CARD32 *src, CARD32 *mask, int width)
     int i;
     fbCombineMaskC(src, mask, width);
     for (i = 0; i < width; ++i) {
-        CARD32  s = src[i];
-        CARD32  a = ~mask[i];
+        CARD32  s = READ(src + i);
+        CARD32  a = ~READ(mask + i);
 
         if (a != 0xffffffff)
         {
             if (a)
             {
-                CARD32 d = dest[i];
+                CARD32 d = READ(dest + i);
                 FbByteMulAddC(d, a, s);
                 s = d;
             }
-            dest[i] = s;
+            WRITE(dest + i, s);
         }
     }
 }
@@ -2131,17 +2132,17 @@ fbCombineOverReverseC (CARD32 *dest, CARD32 *src, CARD32 *mask, int width)
     int i;
     fbCombineMaskValueC(src, mask, width);
     for (i = 0; i < width; ++i) {
-        CARD32 d = dest[i];
+        CARD32 d = READ(dest + i);
         CARD32 a = ~d >> 24;
 
         if (a)
         {
-            CARD32 s = src[i];
+            CARD32 s = READ(src + i);
             if (a != 0xff)
             {
                 FbByteMulAdd(s, a, d);
             }
-            dest[i] = s;
+            WRITE(dest + i, s);
         }
     }
 }
@@ -2152,18 +2153,18 @@ fbCombineInC (CARD32 *dest, CARD32 *src, CARD32 *mask, int width)
     int i;
     fbCombineMaskValueC(src, mask, width);
     for (i = 0; i < width; ++i) {
-        CARD32 d = dest[i];
+        CARD32 d = READ(dest + i);
         CARD16 a = d >> 24;
         CARD32 s = 0;
         if (a)
         {
-            s = src[i];
+            s = READ(src + i);
             if (a != 0xff)
             {
                 FbByteMul(s, a);
             }
         }
-        dest[i] = s;
+        WRITE(dest + i, s);
     }
 }
 
@@ -2173,17 +2174,17 @@ fbCombineInReverseC (CARD32 *dest, CARD32 *src, CARD32 *mask, int width)
     int i;
     fbCombineMaskAlphaC(src, mask, width);
     for (i = 0; i < width; ++i) {
-        CARD32 a = mask[i];
+        CARD32 a = READ(mask + i);
 
         if (a != 0xffffffff)
         {
             CARD32 d = 0;
             if (a)
             {
-                d = dest[i];
+                d = READ(dest + i);
                 FbByteMulC(d, a);
             }
-            dest[i] = d;
+            WRITE(dest + i, d);
         }
     }
 }
@@ -2194,18 +2195,18 @@ fbCombineOutC (CARD32 *dest, CARD32 *src, CARD32 *mask, int width)
     int i;
     fbCombineMaskValueC(src, mask, width);
     for (i = 0; i < width; ++i) {
-        CARD32 d = dest[i];
+        CARD32 d = READ(dest + i);
         CARD16 a = ~d >> 24;
         CARD32 s = 0;
         if (a)
         {
-            s = src[i];
+            s = READ(src + i);
             if (a != 0xff)
             {
                 FbByteMul(s, a);
             }
         }
-        dest[i] = s;
+        WRITE(dest + i, s);
     }
 }
 
@@ -2215,17 +2216,17 @@ fbCombineOutReverseC (CARD32 *dest, CARD32 *src, CARD32 *mask, int width)
     int i;
     fbCombineMaskAlphaC(src, mask, width);
     for (i = 0; i < width; ++i) {
-        CARD32 a = ~mask[i];
+        CARD32 a = ~READ(mask + i);
 
         if (a != 0xffffffff)
         {
             CARD32 d = 0;
             if (a)
             {
-                d = dest[i];
+                d = READ(dest + i);
                 FbByteMulC(d, a);
             }
-            dest[i] = d;
+            WRITE(dest + i, d);
         }
     }
 }
@@ -2236,12 +2237,12 @@ fbCombineAtopC (CARD32 *dest, CARD32 *src, CARD32 *mask, int width)
     int i;
     fbCombineMaskC(src, mask, width);
     for (i = 0; i < width; ++i) {
-        CARD32 d = dest[i];
-        CARD32 s = src[i];
-        CARD32 ad = ~mask[i];
+        CARD32 d = READ(dest + i);
+        CARD32 s = READ(src + i);
+        CARD32 ad = ~READ(mask + i);
         CARD16 as = d >> 24;
         FbByteAddMulC(d, ad, s, as);
-        dest[i] = d;
+        WRITE(dest + i, d);
     }
 }
 
@@ -2252,12 +2253,12 @@ fbCombineAtopReverseC (CARD32 *dest, CARD32 *src, CARD32 *mask, int width)
     fbCombineMaskC(src, mask, width);
     for (i = 0; i < width; ++i) {
 
-        CARD32 d = dest[i];
-        CARD32 s = src[i];
-        CARD32 ad = mask[i];
+        CARD32 d = READ(dest + i);
+        CARD32 s = READ(src + i);
+        CARD32 ad = READ(mask + i);
         CARD16 as = ~d >> 24;
         FbByteAddMulC(d, ad, s, as);
-        dest[i] = d;
+        WRITE(dest + i, d);
     }
 }
 
@@ -2267,12 +2268,12 @@ fbCombineXorC (CARD32 *dest, CARD32 *src, CARD32 *mask, int width)
     int i;
     fbCombineMaskC(src, mask, width);
     for (i = 0; i < width; ++i) {
-        CARD32 d = dest[i];
-        CARD32 s = src[i];
-        CARD32 ad = ~mask[i];
+        CARD32 d = READ(dest + i);
+        CARD32 s = READ(src + i);
+        CARD32 ad = ~READ(mask + i);
         CARD16 as = ~d >> 24;
         FbByteAddMulC(d, ad, s, as);
-        dest[i] = d;
+        WRITE(dest + i, d);
     }
 }
 
@@ -2282,10 +2283,10 @@ fbCombineAddC (CARD32 *dest, CARD32 *src, CARD32 *mask, int width)
     int i;
     fbCombineMaskValueC(src, mask, width);
     for (i = 0; i < width; ++i) {
-        CARD32 s = src[i];
-        CARD32 d = dest[i];
+        CARD32 s = READ(src + i);
+        CARD32 d = READ(dest + i);
         FbByteAdd(d, s);
-        dest[i] = d;
+        WRITE(dest + i, d);
     }
 }
 
@@ -2300,12 +2301,12 @@ fbCombineSaturateC (CARD32 *dest, CARD32 *src, CARD32 *mask, int width)
         CARD16  t, u, v;
         CARD32  m,n,o,p;
 
-        d = dest[i];
-        s = src[i];
-        sa = (mask[i] >> 24);
-        sr = (mask[i] >> 16) & 0xff;
-        sg = (mask[i] >>  8) & 0xff;
-        sb = (mask[i]      ) & 0xff;
+        d = READ(dest + i);
+        s = READ(src + i);
+        sa = (READ(mask + i) >> 24);
+        sr = (READ(mask + i) >> 16) & 0xff;
+        sg = (READ(mask + i) >>  8) & 0xff;
+        sb = (READ(mask + i)      ) & 0xff;
         da = ~d >> 24;
 
         if (sb <= da)
@@ -2328,7 +2329,7 @@ fbCombineSaturateC (CARD32 *dest, CARD32 *src, CARD32 *mask, int width)
         else
             p = FbGen (s, d, 24, (da << 8) / sa, 0xff, t, u, v);
 
-        dest[i] = m|n|o|p;
+        WRITE(dest + i, m|n|o|p);
     }
 }
 
@@ -2345,9 +2346,9 @@ fbCombineDisjointGeneralC (CARD32 *dest, CARD32 *src, CARD32 *mask, int width, C
         CARD32  sa;
         CARD8   da;
 
-        s = src[i];
-        sa = mask[i];
-        d = dest[i];
+        s = READ(src + i);
+        sa = READ(mask + i);
+        d = READ(dest + i);
         da = d >> 24;
 
         switch (combine & CombineA) {
@@ -2400,7 +2401,7 @@ fbCombineDisjointGeneralC (CARD32 *dest, CARD32 *src, CARD32 *mask, int width, C
         o = FbGen (s,d,16,FbGet8(Fa,16),FbGet8(Fb,16),t, u, v);
         p = FbGen (s,d,24,FbGet8(Fa,24),FbGet8(Fb,24),t, u, v);
         s = m|n|o|p;
-        dest[i] = s;
+        WRITE(dest + i, s);
     }
 }
 
@@ -2465,9 +2466,9 @@ fbCombineConjointGeneralC (CARD32 *dest, CARD32 *src, CARD32 *mask, int width, C
         CARD32  sa;
         CARD8   da;
 
-        s = src[i];
-        sa = mask[i];
-        d = dest[i];
+        s = READ(src + i);
+        sa = READ(mask + i);
+        d = READ(dest + i);
         da = d >> 24;
 
         switch (combine & CombineA) {
@@ -2520,7 +2521,7 @@ fbCombineConjointGeneralC (CARD32 *dest, CARD32 *src, CARD32 *mask, int width, C
         o = FbGen (s,d,16,FbGet8(Fa,16),FbGet8(Fb,16),t, u, v);
         p = FbGen (s,d,24,FbGet8(Fa,24),FbGet8(Fb,24),t, u, v);
         s = m|n|o|p;
-        dest[i] = s;
+        WRITE(dest + i, s);
     }
 }
 
@@ -2651,7 +2652,8 @@ static void fbFetchSolid(PicturePtr pict, int x, int y, int width, CARD32 *buffe
 
     end = buffer + width;
     while (buffer < end)
-        *buffer++ = color;
+        WRITE(buffer++, color);
+    fbFinishAccess (pict->pDrawable);
 }
 
 static void fbFetch(PicturePtr pict, int x, int y, int width, CARD32 *buffer)
@@ -2670,6 +2672,7 @@ static void fbFetch(PicturePtr pict, int x, int y, int width, CARD32 *buffer)
     bits += y*stride;
 
     fetch(bits, x, width, buffer, indexed);
+    fbFinishAccess (pict->pDrawable);
 }
 
 #define MOD(a,b) ((a) < 0 ? ((b) - ((-(a) - 1) % (b))) - 1 : (a) % (b))
@@ -2717,7 +2720,7 @@ static void fbFetchSourcePict(PicturePtr pict, int x, int y, int width, CARD32 *
     if (pGradient->type == SourcePictTypeSolidFill) {
         register CARD32 color = pGradient->solidFill.color;
         while (buffer < end) {
-            *buffer++ = color;
+            WRITE(buffer++, color);
         }
     } else if (pGradient->type == SourcePictTypeLinear) {
         PictVector v, unit;
@@ -2759,7 +2762,7 @@ static void fbFetchSourcePict(PicturePtr pict, int x, int y, int width, CARD32 *
                 inc = (a * unit.vector[0] + b * unit.vector[1]) >> 16;
             }
             while (buffer < end) {
-                *buffer++ = gradientPixel(pGradient, t, pict->repeatType);
+                WRITE(buffer++, gradientPixel(pGradient, t, pict->repeatType));
                 t += inc;
             }
         } else {
@@ -2774,7 +2777,7 @@ static void fbFetchSourcePict(PicturePtr pict, int x, int y, int width, CARD32 *
                     y = ((xFixed_48_16)v.vector[1] << 16) / v.vector[2];
                     t = ((a*x + b*y) >> 16) + off;
                 }
-                *buffer++ = gradientPixel(pGradient, t, pict->repeatType);
+                WRITE(buffer++, gradientPixel(pGradient, t, pict->repeatType));
                 v.vector[0] += unit.vector[0];
                 v.vector[1] += unit.vector[1];
                 v.vector[2] += unit.vector[2];
@@ -2818,9 +2821,9 @@ static void fbFetchSourcePict(PicturePtr pict, int x, int y, int width, CARD32 *
                     double c = -(rx*rx + ry*ry);
                     double det = (b * b) - (4 * pGradient->radial.a * c);
                     double s = (-b + sqrt(det))/(2. * pGradient->radial.a);
-                    *buffer = gradientPixel(pGradient,
-                                            (xFixed_48_16)((s*pGradient->radial.m + pGradient->radial.b)*65536),
-                                            pict->repeatType);
+                    WRITE(buffer, gradientPixel(pGradient,
+                                                (xFixed_48_16)((s*pGradient->radial.m + pGradient->radial.b)*65536),
+                                                pict->repeatType));
                     ++buffer;
                     rx += cx;
                     ry += cy;
@@ -2841,9 +2844,9 @@ static void fbFetchSourcePict(PicturePtr pict, int x, int y, int width, CARD32 *
                     c = -(x*x + y*y);
                     det = (b * b) - (4 * pGradient->radial.a * c);
                     s = (-b + sqrt(det))/(2. * pGradient->radial.a);
-                    *buffer = gradientPixel(pGradient,
-                                            (xFixed_48_16)((s*pGradient->radial.m + pGradient->radial.b)*65536),
-                                            pict->repeatType);
+                    WRITE(buffer, gradientPixel(pGradient,
+                                                (xFixed_48_16)((s*pGradient->radial.m + pGradient->radial.b)*65536),
+                                                pict->repeatType));
                     ++buffer;
                     rx += cx;
                     ry += cy;
@@ -2858,8 +2861,8 @@ static void fbFetchSourcePict(PicturePtr pict, int x, int y, int width, CARD32 *
 
                 while (buffer < end) {
                     double angle = atan2(ry, rx) + a;
-                    *buffer = gradientPixel(pGradient, (xFixed_48_16) (angle * (65536. / (2*M_PI))),
-                                            pict->repeatType);
+                    WRITE(buffer, gradientPixel(pGradient, (xFixed_48_16) (angle * (65536. / (2*M_PI))),
+                                                pict->repeatType));
                     ++buffer;
                     rx += cx;
                     ry += cy;
@@ -2877,8 +2880,8 @@ static void fbFetchSourcePict(PicturePtr pict, int x, int y, int width, CARD32 *
                     x -= pGradient->conical.center.x/65536.;
                     y -= pGradient->conical.center.y/65536.;
                     angle = atan2(y, x) + a;
-                    *buffer = gradientPixel(pGradient, (xFixed_48_16) (angle * (65536. / (2*M_PI))),
-                                            pict->repeatType);
+                    WRITE(buffer, gradientPixel(pGradient, (xFixed_48_16) (angle * (65536. / (2*M_PI))),
+                                                pict->repeatType));
                     ++buffer;
                     rx += cx;
                     ry += cy;
@@ -2889,7 +2892,244 @@ static void fbFetchSourcePict(PicturePtr pict, int x, int y, int width, CARD32 *
     }
 }
 
+static inline CARD32 fbBilinearInterpolate(CARD32 tl, CARD32 tr, CARD32 bl, CARD32 br, CARD32 vv0, CARD32 vv1)
+{
+    int distx, idistx, disty, idisty;
+    CARD32 ft, fb, r;
+
+    distx = (vv0 >> 8) & 0xff;
+    disty = (vv1 >> 8) & 0xff;
+    idistx = 256 - distx;
+    idisty = 256 - disty;
+
+    ft = FbGet8(tl,0) * idistx + FbGet8(tr,0) * distx;
+    fb = FbGet8(bl,0) * idistx + FbGet8(br,0) * distx;
+    r = (((ft * idisty + fb * disty) >> 16) & 0xff);
+    ft = FbGet8(tl,8) * idistx + FbGet8(tr,8) * distx;
+    fb = FbGet8(bl,8) * idistx + FbGet8(br,8) * distx;
+    r |= (((ft * idisty + fb * disty) >> 8) & 0xff00);
+    ft = FbGet8(tl,16) * idistx + FbGet8(tr,16) * distx;
+    fb = FbGet8(bl,16) * idistx + FbGet8(br,16) * distx;
+    r |= (((ft * idisty + fb * disty)) & 0xff0000);
+
+    ft = FbGet8(tl,24) * idistx + FbGet8(tr,24) * distx;
+    fb = FbGet8(bl,24) * idistx + FbGet8(br,24) * distx;
+    r |= (((ft * idisty + fb * disty) << 8) & 0xff000000);
+
+    return r;
+}
+
+static inline CARD32 fbBilinearInterpolate24(CARD32 tl, CARD32 tr, CARD32 bl, CARD32 br, CARD32 vv0, CARD32 vv1)
+{
+    int distx, idistx, disty, idisty;
+    CARD32 ft, fb, r;
+
+    distx = (vv0 >> 8) & 0xff;
+    disty = (vv1 >> 8) & 0xff;
+    idistx = 256 - distx;
+    idisty = 256 - disty;
+
+    ft = FbGet8(tl,0) * idistx + FbGet8(tr,0) * distx;
+    fb = FbGet8(bl,0) * idistx + FbGet8(br,0) * distx;
+    r = (((ft * idisty + fb * disty) >> 16) & 0xff);
+    ft = FbGet8(tl,8) * idistx + FbGet8(tr,8) * distx;
+    fb = FbGet8(bl,8) * idistx + FbGet8(br,8) * distx;
+    r |= (((ft * idisty + fb * disty) >> 8) & 0xff00);
+    ft = FbGet8(tl,16) * idistx + FbGet8(tr,16) * distx;
+    fb = FbGet8(bl,16) * idistx + FbGet8(br,16) * distx;
+    r |= (((ft * idisty + fb * disty)) & 0xff0000);
+
+    return r | 0xFF000000;
+}
+
+static inline CARD32 cvt0565to8888_low_precision(CARD32 s)
+{
+    return ((s << 3) & 0xf8) | ((s << 5) & 0xfc00) | ((s << 8) & 0xf80000);
+}
+
+void fbFetchTransformedHorizontalAffineBilinearClip1_r5g6b5(PicturePtr pict, int x, int y, int width, CARD32 *buffer,
+    FbBits     *bits, FbStride stride,
+    CARD32 vv0, CARD32 vv1, CARD32 uv0)
+{
+    int y1, y2;
+    Bool y1_out, y2_out;
+    BoxRec	box;
+    CARD32 tl, tr, bl, br;
+
+    y1 = vv1 >> 16;
+    y2 = y1 + 1;
+
+    box = pict->pCompositeClip->extents;
+
+    y1_out = (y1 < box.y1) | (y1 >= box.y2);
+    y2_out = (y2 < box.y1) | (y2 >= box.y2);
+
+    if (!y1_out && !y2_out) {
+        while (--width >= 0) {
+            int x1, x2;
+            Bool x1_out, x2_out;
+            FbBits *b;
+
+            x1 = vv0 >> 16;
+            x2 = x1 + 1;
+
+            b = bits + (y1)*stride;
+
+            x1_out = (x1 < box.x1) | (x1 >= box.x2);
+            x2_out = (x2 < box.x1) | (x2 >= box.x2);
+
+            tl = x1_out ? 0 : cvt0565to8888_low_precision(READ((CARD16 *) b + x1));
+            tr = x2_out ? 0 : cvt0565to8888_low_precision(READ((CARD16 *) b + x2));
+            b += stride;
+            bl = x1_out ? 0 : cvt0565to8888_low_precision(READ((CARD16 *) b + x1));
+            br = x2_out ? 0 : cvt0565to8888_low_precision(READ((CARD16 *) b + x2));
+
+            WRITE(buffer++, fbBilinearInterpolate24(tl, tr, bl, br, vv0, vv1));
+
+            vv0 += uv0;
+        }
+        return;
+    }
+
+    while (--width >= 0) {
+        int x1, x2;
+        Bool x1_out, x2_out;
+        FbBits *b;
+
+        x1 = vv0 >> 16;
+        x2 = x1 + 1;
+
+        b = bits + (y1)*stride;
+
+        x1_out = (x1 < box.x1) | (x1 >= box.x2);
+        x2_out = (x2 < box.x1) | (x2 >= box.x2);
+
+        tl = x1_out|y1_out ? 0 : cvt0565to8888_low_precision(READ((CARD16 *) b + x1));
+        tr = x2_out|y1_out ? 0 : cvt0565to8888_low_precision(READ((CARD16 *) b + x2));
+        b += stride;
+        bl = x1_out|y2_out ? 0 : cvt0565to8888_low_precision(READ((CARD16 *) b + x1));
+        br = x2_out|y2_out ? 0 : cvt0565to8888_low_precision(READ((CARD16 *) b + x2));
+
+        WRITE(buffer++, fbBilinearInterpolate24(tl, tr, bl, br, vv0, vv1));
+
+        vv0 += uv0;
+    }
+}
+
+void fbFetchTransformedHorizontalAffineBilinearClip1_a8r8g8b8(PicturePtr pict, int x, int y, int width, CARD32 *buffer,
+    FbBits     *bits, FbStride stride,
+    CARD32 vv0, CARD32 vv1, CARD32 uv0)
+{
+    int y1, y2;
+    Bool y1_out, y2_out;
+    BoxRec	box;
+    CARD32 tl, tr, bl, br;
+
+    y1 = vv1 >> 16;
+    y2 = y1 + 1;
 
+    box = pict->pCompositeClip->extents;
+
+    y1_out = (y1 < box.y1) | (y1 >= box.y2);
+    y2_out = (y2 < box.y1) | (y2 >= box.y2);
+
+    if (!y1_out && !y2_out) {
+        while (--width >= 0) {
+            int x1, x2;
+            Bool x1_out, x2_out;
+            FbBits *b;
+
+            x1 = vv0 >> 16;
+            x2 = x1 + 1;
+
+            b = bits + (y1)*stride;
+
+            x1_out = (x1 < box.x1) | (x1 >= box.x2);
+            x2_out = (x2 < box.x1) | (x2 >= box.x2);
+
+            tl = x1_out ? 0 : READ((CARD32 *) b + x1);
+            tr = x2_out ? 0 : READ((CARD32 *) b + x2);
+            b += stride;
+            bl = x1_out ? 0 : READ((CARD32 *) b + x1);
+            br = x2_out ? 0 : READ((CARD32 *) b + x2);
+
+            WRITE(buffer++, fbBilinearInterpolate(tl, tr, bl, br, vv0, vv1));
+
+            vv0 += uv0;
+        }
+        return;
+    }
+
+    while (--width >= 0) {
+        int x1, x2;
+        Bool x1_out, x2_out;
+        FbBits *b;
+
+        x1 = vv0 >> 16;
+        x2 = x1 + 1;
+
+        b = bits + (y1)*stride;
+
+        x1_out = (x1 < box.x1) | (x1 >= box.x2);
+        x2_out = (x2 < box.x1) | (x2 >= box.x2);
+
+        tl = x1_out|y1_out ? 0 : READ((CARD32 *) b + x1);
+        tr = x2_out|y1_out ? 0 : READ((CARD32 *) b + x2);
+        b += stride;
+        bl = x1_out|y2_out ? 0 : READ((CARD32 *) b + x1);
+        br = x2_out|y2_out ? 0 : READ((CARD32 *) b + x2);
+
+        WRITE(buffer++, fbBilinearInterpolate(tl, tr, bl, br, vv0, vv1));
+
+        vv0 += uv0;
+    }
+}
+
+static void fbFetchTransformedAffineBilinearClip1(PicturePtr pict, int x, int y, int width, CARD32 *buffer,
+    FbBits     *bits, FbStride stride, miIndexedPtr indexed,
+    CARD32 vv0, CARD32 vv1, CARD32 vv2, CARD32 uv0, CARD32 uv1, CARD32 uv2, fetchPixelProc fetch)
+{
+    BoxRec	box;
+    int         i;
+
+    box = pict->pCompositeClip->extents;
+    for (i = 0; i < width; ++i) {
+        if (!vv2) {
+            WRITE(buffer + i, 0);
+        } else {
+            int x1, x2, y1, y2, distx, idistx, disty, idisty, x_off;
+            FbBits *b;
+            CARD32 tl, tr, bl, br, r;
+            Bool x1_out, x2_out, y1_out, y2_out;
+            CARD32 ft, fb;
+
+            x1 = vv0 >> 16;
+            y1 = vv1 >> 16;
+
+            x2 = x1 + 1;
+            y2 = y1 + 1;
+
+            b = bits + (y1)*stride;
+            x_off = x1;
+
+            x1_out = (x1 < box.x1) | (x1 >= box.x2);
+            x2_out = (x2 < box.x1) | (x2 >= box.x2);
+            y1_out = (y1 < box.y1) | (y1 >= box.y2);
+            y2_out = (y2 < box.y1) | (y2 >= box.y2);
+
+            tl = x1_out|y1_out ? 0 : fetch(b, x_off, indexed);
+            tr = x2_out|y1_out ? 0 : fetch(b, x_off + 1, indexed);
+            b += stride;
+            bl = x1_out|y2_out ? 0 : fetch(b, x_off, indexed);
+            br = x2_out|y2_out ? 0 : fetch(b, x_off + 1, indexed);
+
+            WRITE(buffer + i, fbBilinearInterpolate(tl, tr, bl, br, vv0, vv1));
+        }
+        vv0 += uv0;
+        vv1 += uv1;
+        vv2 += uv2;
+    }
+}
 
 static void fbFetchTransformed(PicturePtr pict, int x, int y, int width, CARD32 *buffer)
 {
@@ -2921,8 +3161,10 @@ static void fbFetchTransformed(PicturePtr pict, int x, int y, int width, CARD32
 
     /* when using convolution filters one might get here without a transform */
     if (pict->transform) {
-        if (!PictureTransformPoint3d (pict->transform, &v))
+        if (!PictureTransformPoint3d (pict->transform, &v)) {
+            fbFinishAccess (pict->pDrawable);
             return;
+        }
         unit.vector[0] = pict->transform->matrix[0][0];
         unit.vector[1] = pict->transform->matrix[1][0];
         unit.vector[2] = pict->transform->matrix[2][0];
@@ -2939,7 +3181,7 @@ static void fbFetchTransformed(PicturePtr pict, int x, int y, int width, CARD32
             if (REGION_NUM_RECTS(pict->pCompositeClip) == 1) {
                 for (i = 0; i < width; ++i) {
                     if (!v.vector[2]) {
-                        buffer[i] = 0;
+                        WRITE(buffer + i, 0);
                     } else {
                         if (!affine) {
                             y = MOD(DIV(v.vector[1],v.vector[2]), pict->pDrawable->height);
@@ -2948,7 +3190,7 @@ static void fbFetchTransformed(PicturePtr pict, int x, int y, int width, CARD32
                             y = MOD(v.vector[1]>>16, pict->pDrawable->height);
                             x = MOD(v.vector[0]>>16, pict->pDrawable->width);
                         }
-                        buffer[i] = fetch(bits + (y + dy)*stride, x + dx, indexed);
+                        WRITE(buffer + i, fetch(bits + (y + dy)*stride, x + dx, indexed));
                     }
                     v.vector[0] += unit.vector[0];
                     v.vector[1] += unit.vector[1];
@@ -2957,7 +3199,7 @@ static void fbFetchTransformed(PicturePtr pict, int x, int y, int width, CARD32
             } else {
                 for (i = 0; i < width; ++i) {
                     if (!v.vector[2]) {
-                        buffer[i] = 0;
+                        WRITE(buffer + i, 0);
                     } else {
                         if (!affine) {
                             y = MOD(DIV(v.vector[1],v.vector[2]), pict->pDrawable->height);
@@ -2967,9 +3209,9 @@ static void fbFetchTransformed(PicturePtr pict, int x, int y, int width, CARD32
                             x = MOD(v.vector[0]>>16, pict->pDrawable->width);
                         }
                         if (POINT_IN_REGION (0, pict->pCompositeClip, x + dx, y + dy, &box))
-                            buffer[i] = fetch(bits + (y + dy)*stride, x + dx, indexed);
+                            WRITE(buffer + i, fetch(bits + (y + dy)*stride, x + dx, indexed));
                         else
-                            buffer[i] = 0;
+                            WRITE(buffer + i, 0);
                     }
                     v.vector[0] += unit.vector[0];
                     v.vector[1] += unit.vector[1];
@@ -2981,7 +3223,7 @@ static void fbFetchTransformed(PicturePtr pict, int x, int y, int width, CARD32
                 box = pict->pCompositeClip->extents;
                 for (i = 0; i < width; ++i) {
                     if (!v.vector[2]) {
-                        buffer[i] = 0;
+                        WRITE(buffer + i, 0);
                     } else {
                         if (!affine) {
                             y = DIV(v.vector[1],v.vector[2]);
@@ -2990,8 +3232,8 @@ static void fbFetchTransformed(PicturePtr pict, int x, int y, int width, CARD32
                             y = v.vector[1]>>16;
                             x = v.vector[0]>>16;
                         }
-                        buffer[i] = ((x < box.x1-dx) | (x >= box.x2-dx) | (y < box.y1-dy) | (y >= box.y2-dy)) ?
-                                    0 : fetch(bits + (y + dy)*stride, x + dx, indexed);
+                        WRITE(buffer + i, ((x < box.x1-dx) | (x >= box.x2-dx) | (y < box.y1-dy) | (y >= box.y2-dy)) ?
+                                          0 : fetch(bits + (y + dy)*stride, x + dx, indexed));
                     }
                     v.vector[0] += unit.vector[0];
                     v.vector[1] += unit.vector[1];
@@ -3000,7 +3242,7 @@ static void fbFetchTransformed(PicturePtr pict, int x, int y, int width, CARD32
             } else {
                 for (i = 0; i < width; ++i) {
                     if (!v.vector[2]) {
-                        buffer[i] = 0;
+                        WRITE(buffer + i, 0);
                     } else {
                         if (!affine) {
                             y = DIV(v.vector[1],v.vector[2]);
@@ -3010,9 +3252,9 @@ static void fbFetchTransformed(PicturePtr pict, int x, int y, int width, CARD32
                             x = v.vector[0]>>16;
                         }
                         if (POINT_IN_REGION (0, pict->pCompositeClip, x + dx, y + dy, &box))
-                            buffer[i] = fetch(bits + (y + dy)*stride, x + dx, indexed);
+                            WRITE(buffer + i, fetch(bits + (y + dy)*stride, x + dx, indexed));
                         else
-                            buffer[i] = 0;
+                            WRITE(buffer + i, 0);
                     }
                     v.vector[0] += unit.vector[0];
                     v.vector[1] += unit.vector[1];
@@ -3031,7 +3273,7 @@ static void fbFetchTransformed(PicturePtr pict, int x, int y, int width, CARD32
             if (REGION_NUM_RECTS(pict->pCompositeClip) == 1) {
                 for (i = 0; i < width; ++i) {
                     if (!v.vector[2]) {
-                        buffer[i] = 0;
+                        WRITE(buffer + i, 0);
                     } else {
                         int x1, x2, y1, y2, distx, idistx, disty, idisty;
                         FbBits *b;
@@ -3083,7 +3325,7 @@ static void fbFetchTransformed(PicturePtr pict, int x, int y, int width, CARD32
                         ft = FbGet8(tl,24) * idistx + FbGet8(tr,24) * distx;
                         fb = FbGet8(bl,24) * idistx + FbGet8(br,24) * distx;
                         r |= (((ft * idisty + fb * disty) << 8) & 0xff000000);
-                        buffer[i] = r;
+                        WRITE(buffer + i, r);
                     }
                     v.vector[0] += unit.vector[0];
                     v.vector[1] += unit.vector[1];
@@ -3092,7 +3334,7 @@ static void fbFetchTransformed(PicturePtr pict, int x, int y, int width, CARD32
             } else {
                 for (i = 0; i < width; ++i) {
                     if (!v.vector[2]) {
-                        buffer[i] = 0;
+                        WRITE(buffer + i, 0);
                     } else {
                         int x1, x2, y1, y2, distx, idistx, disty, idisty;
                         FbBits *b;
@@ -3148,7 +3390,7 @@ static void fbFetchTransformed(PicturePtr pict, int x, int y, int width, CARD32
                         ft = FbGet8(tl,24) * idistx + FbGet8(tr,24) * distx;
                         fb = FbGet8(bl,24) * idistx + FbGet8(br,24) * distx;
                         r |= (((ft * idisty + fb * disty) << 8) & 0xff000000);
-                        buffer[i] = r;
+                        WRITE(buffer + i, r);
                     }
                     v.vector[0] += unit.vector[0];
                     v.vector[1] += unit.vector[1];
@@ -3156,11 +3398,29 @@ static void fbFetchTransformed(PicturePtr pict, int x, int y, int width, CARD32
                 }
             }
         } else {
-            if (REGION_NUM_RECTS(pict->pCompositeClip) == 1) {
+            if (REGION_NUM_RECTS(pict->pCompositeClip) == 1 && affine && dx == 0 && dy == 0) {
+
+                if (unit.vector[2] == 0 && unit.vector[1] == 0 && pict->format == PICT_r5g6b5)
+                    fbFetchTransformedHorizontalAffineBilinearClip1_r5g6b5(pict, x, y, width, buffer,
+                        bits, stride,
+                        v.vector[0], v.vector[1],
+                        unit.vector[0]);
+                else if (unit.vector[2] == 0 && unit.vector[1] == 0 && pict->format == PICT_a8r8g8b8)
+                    fbFetchTransformedHorizontalAffineBilinearClip1_a8r8g8b8(pict, x, y, width, buffer,
+                        bits, stride,
+                        v.vector[0], v.vector[1],
+                        unit.vector[0]);
+                else
+                    fbFetchTransformedAffineBilinearClip1(pict, x, y, width, buffer,
+                        bits, stride, indexed,
+                        v.vector[0], v.vector[1], v.vector[2],
+                        unit.vector[0], unit.vector[1], unit.vector[2], fetch);
+
+            } else if (REGION_NUM_RECTS(pict->pCompositeClip) == 1) {
                 box = pict->pCompositeClip->extents;
                 for (i = 0; i < width; ++i) {
                     if (!v.vector[2]) {
-                        buffer[i] = 0;
+                        WRITE(buffer + i, 0);
                     } else {
                         int x1, x2, y1, y2, distx, idistx, disty, idisty, x_off;
                         FbBits *b;
@@ -3214,7 +3474,7 @@ static void fbFetchTransformed(PicturePtr pict, int x, int y, int width, CARD32
                         ft = FbGet8(tl,24) * idistx + FbGet8(tr,24) * distx;
                         fb = FbGet8(bl,24) * idistx + FbGet8(br,24) * distx;
                         r |= (((ft * idisty + fb * disty) << 8) & 0xff000000);
-                        buffer[i] = r;
+                        WRITE(buffer + i, r);
                     }
                     v.vector[0] += unit.vector[0];
                     v.vector[1] += unit.vector[1];
@@ -3223,7 +3483,7 @@ static void fbFetchTransformed(PicturePtr pict, int x, int y, int width, CARD32
             } else {
                 for (i = 0; i < width; ++i) {
                     if (!v.vector[2]) {
-                        buffer[i] = 0;
+                        WRITE(buffer + i, 0);
                     } else {
                         int x1, x2, y1, y2, distx, idistx, disty, idisty, x_off;
                         FbBits *b;
@@ -3275,7 +3535,7 @@ static void fbFetchTransformed(PicturePtr pict, int x, int y, int width, CARD32
                         ft = FbGet8(tl,24) * idistx + FbGet8(tr,24) * distx;
                         fb = FbGet8(bl,24) * idistx + FbGet8(br,24) * distx;
                         r |= (((ft * idisty + fb * disty) << 8) & 0xff000000);
-                        buffer[i] = r;
+                        WRITE(buffer + i, r);
                     }
                     v.vector[0] += unit.vector[0];
                     v.vector[1] += unit.vector[1];
@@ -3292,7 +3552,7 @@ static void fbFetchTransformed(PicturePtr pict, int x, int y, int width, CARD32
         params += 2;
         for (i = 0; i < width; ++i) {
             if (!v.vector[2]) {
-                buffer[i] = 0;
+                WRITE(buffer + i, 0);
             } else {
                 int x1, x2, y1, y2, x, y;
                 INT32 srtot, sgtot, sbtot, satot;
@@ -3342,16 +3602,18 @@ static void fbFetchTransformed(PicturePtr pict, int x, int y, int width, CARD32
                 if (sgtot < 0) sgtot = 0; else if (sgtot > 0xff) sgtot = 0xff;
                 if (sbtot < 0) sbtot = 0; else if (sbtot > 0xff) sbtot = 0xff;
 
-                buffer[i] = ((satot << 24) |
-                             (srtot << 16) |
-                             (sgtot <<  8) |
-                             (sbtot       ));
+                WRITE(buffer + i, ((satot << 24) |
+                                  (srtot << 16) |
+                                  (sgtot <<  8) |
+                                  (sbtot       )));
             }
             v.vector[0] += unit.vector[0];
             v.vector[1] += unit.vector[1];
             v.vector[2] += unit.vector[2];
         }
     }
+
+    fbFinishAccess (pict->pDrawable);
 }
 
 
@@ -3372,10 +3634,10 @@ static void fbFetchExternalAlpha(PicturePtr pict, int x, int y, int width, CARD3
     fbFetchTransformed(pict->alphaMap, x - pict->alphaOrigin.x, y - pict->alphaOrigin.y, width, alpha_buffer);
     for (i = 0; i < width; ++i) {
         int a = alpha_buffer[i]>>24;
-        buffer[i] = (a << 24)
-                 | (div_255(Red(buffer[i]) * a) << 16)
-                 | (div_255(Green(buffer[i]) * a) << 8)
-                 | (div_255(Blue(buffer[i]) * a));
+        WRITE(buffer + i, (a << 24)
+                          | (div_255(Red(READ(buffer + i)) * a) << 16)
+                          | (div_255(Green(READ(buffer + i)) * a) << 8)
+                          | (div_255(Blue(READ(buffer + i)) * a)));
     }
 
     if (alpha_buffer != _alpha_buffer)
@@ -3397,6 +3659,7 @@ static void fbStore(PicturePtr pict, int x, int y, int width, CARD32 *buffer)
 
     bits += y*stride;
     store(bits, buffer, x, width, indexed);
+    fbFinishAccess (pict->pDrawable);
 }
 
 static void fbStoreExternalAlpha(PicturePtr pict, int x, int y, int width, CARD32 *buffer)
@@ -3436,6 +3699,9 @@ static void fbStoreExternalAlpha(PicturePtr pict, int x, int y, int width, CARD3
 
     store(bits, buffer, x, width, indexed);
     astore(alpha_bits, buffer, ax - pict->alphaOrigin.x, width, aindexed);
+
+    fbFinishAccess (pict->alphaMap->pDrawable);
+    fbFinishAccess (pict->pDrawable);
 }
 
 typedef void (*scanStoreProc)(PicturePtr , int , int , int , CARD32 *);
@@ -3557,18 +3823,7 @@ fbCompositeRect (const FbComposeData *data, CARD32 *scanline_buffer)
 }
 
 void
-fbCompositeGeneral (CARD8	op,
-		    PicturePtr	pSrc,
-		    PicturePtr	pMask,
-		    PicturePtr	pDst,
-		    INT16	xSrc,
-		    INT16	ySrc,
-		    INT16	xMask,
-		    INT16	yMask,
-		    INT16	xDst,
-		    INT16	yDst,
-		    CARD16	width,
-		    CARD16	height)
+fbCompositeGeneral (FbComposeData *params)
 {
     RegionRec	    region;
     int		    n;
@@ -3576,94 +3831,96 @@ fbCompositeGeneral (CARD8	op,
     Bool	    srcRepeat = FALSE;
     Bool	    maskRepeat = FALSE;
     int		    w, h;
+    FbComposeData   nparams;
     CARD32 _scanline_buffer[SCANLINE_BUFFER_LENGTH*3];
     CARD32 *scanline_buffer = _scanline_buffer;
-    FbComposeData compose_data;
     
-    if (pSrc->pDrawable)
-        srcRepeat = pSrc->repeatType == RepeatNormal && !pSrc->transform
-                    && (pSrc->pDrawable->width != 1 || pSrc->pDrawable->height != 1);
-
-    if (pMask && pMask->pDrawable)
-	maskRepeat = pMask->repeatType == RepeatNormal && !pMask->transform
-                     && (pMask->pDrawable->width != 1 || pMask->pDrawable->height != 1);
-
-    if (op == PictOpOver && !pMask && !pSrc->transform && !PICT_FORMAT_A(pSrc->format) && !pSrc->alphaMap)
-        op = PictOpSrc;
+    if (params->src->pDrawable)
+        srcRepeat = params->src->repeatType == RepeatNormal &&
+                    !params->src->transform &&
+                    (params->src->pDrawable->width != 1 ||
+                     params->src->pDrawable->height != 1);
+
+    if (params->mask && params->mask->pDrawable)
+	maskRepeat = params->mask->repeatType == RepeatNormal &&
+                     !params->mask->transform &&
+                     (params->mask->pDrawable->width != 1 ||
+                      params->mask->pDrawable->height != 1);
 
     if (!miComputeCompositeRegion (&region,
-				   pSrc,
-				   pMask,
-				   pDst,
-				   xSrc,
-				   ySrc,
-				   xMask,
-				   yMask,
-				   xDst,
-				   yDst,
-				   width,
-				   height))
+				   params->src,
+				   params->mask,
+				   params->dest,
+				   params->xSrc,
+				   params->ySrc,
+				   params->xMask,
+				   params->yMask,
+				   params->xDest,
+				   params->yDest,
+				   params->width,
+				   params->height))
 	    return;
 
-    compose_data.op = op;
-    compose_data.src = pSrc;
-    compose_data.mask = pMask;
-    compose_data.dest = pDst;
-    if (width > SCANLINE_BUFFER_LENGTH)
-        scanline_buffer = (CARD32 *) malloc(width * 3 * sizeof(CARD32));
+    memcpy(&nparams, params, sizeof(FbComposeData));
+    if (params->width > SCANLINE_BUFFER_LENGTH)
+        scanline_buffer = (CARD32 *) malloc(params->width * 3 * sizeof(CARD32));
+
+    if (params->op == PictOpOver && !params->mask && !params->src->transform &&
+        !PICT_FORMAT_A(params->src->format) && !params->src->alphaMap)
+        nparams.op = PictOpSrc;
 
     n = REGION_NUM_RECTS (&region);
     pbox = REGION_RECTS (&region);
     while (n--)
     {
 	h = pbox->y2 - pbox->y1;
-	compose_data.ySrc = pbox->y1 - yDst + ySrc;
-	compose_data.yMask = pbox->y1 - yDst + yMask;
-	compose_data.yDest = pbox->y1;
+	nparams.ySrc = pbox->y1 - params->yDest + params->ySrc;
+	nparams.yMask = pbox->y1 - params->yDest + params->yMask;
+	nparams.yDest = pbox->y1;
 	while (h)
 	{
-	    compose_data.height = h;
+	    nparams.height = h;
 	    w = pbox->x2 - pbox->x1;
-	    compose_data.xSrc = pbox->x1 - xDst + xSrc;
-	    compose_data.xMask = pbox->x1 - xDst + xMask;
-	    compose_data.xDest = pbox->x1;
+	    nparams.xSrc = pbox->x1 - params->xDest + params->xSrc;
+	    nparams.xMask = pbox->x1 - params->xDest + params->xMask;
+	    nparams.xDest = pbox->x1;
 	    if (maskRepeat)
 	    {
-		compose_data.yMask = mod (compose_data.yMask, pMask->pDrawable->height);
-		if (compose_data.height > pMask->pDrawable->height - compose_data.yMask)
-		    compose_data.height = pMask->pDrawable->height - compose_data.yMask;
+		nparams.yMask = mod (nparams.yMask, params->mask->pDrawable->height);
+		if (nparams.height > params->mask->pDrawable->height - nparams.yMask)
+		    nparams.height = params->mask->pDrawable->height - nparams.yMask;
 	    }
 	    if (srcRepeat)
 	    {
-		compose_data.ySrc = mod (compose_data.ySrc, pSrc->pDrawable->height);
-		if (compose_data.height > pSrc->pDrawable->height - compose_data.ySrc)
-		    compose_data.height = pSrc->pDrawable->height - compose_data.ySrc;
+		nparams.ySrc = mod (nparams.ySrc, params->src->pDrawable->height);
+		if (nparams.height > params->src->pDrawable->height - nparams.ySrc)
+		    nparams.height = params->src->pDrawable->height - nparams.ySrc;
 	    }
 	    while (w)
 	    {
-		compose_data.width = w;
+		nparams.width = w;
 		if (maskRepeat)
 		{
-		    compose_data.xMask = mod (compose_data.xMask, pMask->pDrawable->width);
-		    if (compose_data.width > pMask->pDrawable->width - compose_data.xMask)
-			compose_data.width = pMask->pDrawable->width - compose_data.xMask;
+		    nparams.xMask = mod (nparams.xMask, params->mask->pDrawable->width);
+		    if (nparams.width > params->mask->pDrawable->width - nparams.xMask)
+			nparams.width = params->mask->pDrawable->width - nparams.xMask;
 		}
 		if (srcRepeat)
 		{
-		    compose_data.xSrc = mod (compose_data.xSrc, pSrc->pDrawable->width);
-		    if (compose_data.width > pSrc->pDrawable->width - compose_data.xSrc)
-			compose_data.width = pSrc->pDrawable->width - compose_data.xSrc;
+		    nparams.xSrc = mod (nparams.xSrc, params->src->pDrawable->width);
+		    if (nparams.width > params->src->pDrawable->width - nparams.xSrc)
+			nparams.width = params->src->pDrawable->width - nparams.xSrc;
 		}
-		fbCompositeRect(&compose_data, scanline_buffer);
-		w -= compose_data.width;
-		compose_data.xSrc += compose_data.width;
-		compose_data.xMask += compose_data.width;
-		compose_data.xDest += compose_data.width;
+		fbCompositeRect(&nparams, scanline_buffer);
+		w -= nparams.width;
+		nparams.xSrc += nparams.width;
+		nparams.xMask += nparams.width;
+		nparams.xDest += nparams.width;
 	    }
-	    h -= compose_data.height;
-	    compose_data.ySrc += compose_data.height;
-	    compose_data.yMask += compose_data.height;
-	    compose_data.yDest += compose_data.height;
+	    h -= nparams.height;
+	    nparams.ySrc += nparams.height;
+	    nparams.yMask += nparams.height;
+	    nparams.yDest += nparams.height;
     }
 	pbox++;
     }
diff --git a/fb/fbcopy.c b/fb/fbcopy.c
index 0d1cb7f..164cd3d 100644
--- a/fb/fbcopy.c
+++ b/fb/fbcopy.c
@@ -103,6 +103,8 @@ fbCopyNtoN (DrawablePtr	pSrcDrawable,
 #endif
 	pbox++;
     }    
+    fbFinishAccess (pDstDrawable);
+    fbFinishAccess (pSrcDrawable);
 }
 
 void
@@ -173,6 +175,9 @@ fbCopy1toN (DrawablePtr	pSrcDrawable,
 	}
 	pbox++;
     }
+
+    fbFinishAccess (pDstDrawable);
+    fbFinishAccess (pSrcDrawable);
 }
 
 void
@@ -221,6 +226,8 @@ fbCopyNto1 (DrawablePtr	pSrcDrawable,
 			(FbStip) pPriv->and, (FbStip) pPriv->xor,
 			(FbStip) pPriv->bgand, (FbStip) pPriv->bgxor,
 			bitplane);
+	    fbFinishAccess (pDstDrawable);
+	    fbFinishAccess (pSrcDrawable);
 	}
 	else
 	{
@@ -281,6 +288,9 @@ fbCopyNto1 (DrawablePtr	pSrcDrawable,
 		      pPriv->and, pPriv->xor,
 		      pPriv->bgand, pPriv->bgxor);
 	    xfree (tmp);
+
+	    fbFinishAccess (pDstDrawable);
+	    fbFinishAccess (pSrcDrawable);
 	}
 	pbox++;
     }
diff --git a/fb/fbedge.c b/fb/fbedge.c
index b6ca829..70fc423 100644
--- a/fb/fbedge.c
+++ b/fb/fbedge.c
@@ -60,9 +60,9 @@
 #define StepAlpha	((__ap += __ao), (__ao ^= 1))
 
 #define AddAlpha(a) {						\
-    CARD8   __o = *__ap;					\
+    CARD8   __o = READ(__ap);					\
     CARD8   __a = (a) + Get4(__o, __ao);			\
-    *__ap = Put4 (__o, __ao, __a | (0 - ((__a) >> 4)));		\
+    WRITE(__ap, Put4 (__o, __ao, __a | (0 - ((__a) >> 4))));	\
 }
 
 #include "fbedgeimp.h"
@@ -102,7 +102,7 @@ add_saturate_8 (CARD8 *buf, int value, int length)
 {
     while (length--)
     {
-        *buf = clip255 (*buf + value);
+        WRITE(buf, clip255 (READ(buf) + value));
         buf++;
     }
 }
@@ -164,11 +164,11 @@ fbRasterizeEdges8 (FbBits	*buf,
             /* Add coverage across row */
             if (lxi == rxi)
             {
-                ap[lxi] = clip255 (ap[lxi] + rxs - lxs);
+                WRITE(ap +lxi, clip255 (READ(ap + lxi) + rxs - lxs));
             }
             else
             {
-                ap[lxi] = clip255 (ap[lxi] + N_X_FRAC(8) - lxs);
+                WRITE(ap + lxi, clip255 (READ(ap + lxi) + N_X_FRAC(8) - lxs));
 
                 /* Move forward so that lxi/rxi is the pixel span */
                 lxi++;
@@ -238,7 +238,7 @@ fbRasterizeEdges8 (FbBits	*buf,
                  * necessary to avoid a buffer overrun, (when rx
                  * is exactly on a pixel boundary). */
                 if (rxs)
-                    ap[rxi] = clip255 (ap[rxi] + rxs);
+                    WRITE(ap + rxi, clip255 (READ(ap + rxi) + rxs));
             }
 	}
 
@@ -247,7 +247,7 @@ fbRasterizeEdges8 (FbBits	*buf,
             if (fill_start != fill_end) {
                 if (fill_size == N_Y_FRAC(8))
                 {
-                    memset (ap + fill_start, 0xff, fill_end - fill_start);
+                    MEMSET_WRAPPED (ap + fill_start, 0xff, fill_end - fill_start);
                 }
                 else
                 {
@@ -273,7 +273,7 @@ fbRasterizeEdges8 (FbBits	*buf,
             {
                 if (fill_size == N_Y_FRAC(8))
                 {
-                    memset (ap + fill_start, 0xff, fill_end - fill_start);
+                    MEMSET_WRAPPED (ap + fill_start, 0xff, fill_end - fill_start);
                 }
                 else
                 {
diff --git a/fb/fbedgeimp.h b/fb/fbedgeimp.h
index 8773935..57da31a 100644
--- a/fb/fbedgeimp.h
+++ b/fb/fbedgeimp.h
@@ -76,12 +76,14 @@ rasterizeEdges (FbBits		*buf,
 		x &= FB_MASK;
 
 		FbMaskBits (x, width, startmask, nmiddle, endmask);
-		if (startmask)
-		    *a++ |= startmask;
+		if (startmask) {
+		    WRITE(a, READ(a) | startmask);
+		    a++;
+		}
 		while (nmiddle--)
-		    *a++ = FB_ALLONES;
+		    WRITE(a++, FB_ALLONES);
 		if (endmask)
-		    *a |= endmask;
+		    WRITE(a, READ(a) | endmask);
 	    }
 #else
 	    {
diff --git a/fb/fbfill.c b/fb/fbfill.c
index ad5025c..7ef3a70 100644
--- a/fb/fbfill.c
+++ b/fb/fbfill.c
@@ -49,8 +49,10 @@ fbFill (DrawablePtr pDrawable,
     case FillSolid:
 #ifdef USE_MMX
 	if (!pPriv->and && fbHaveMMX())
-	    if (fbSolidFillmmx (pDrawable, x, y, width, height, pPriv->xor))
+	    if (fbSolidFillmmx (pDrawable, x, y, width, height, pPriv->xor)) {
+		fbFinishAccess (pDrawable);
 		return;
+	    }
 #endif	    
 	fbSolid (dst + (y + dstYoff) * dstStride, 
 		 dstStride, 
@@ -92,6 +94,7 @@ fbFill (DrawablePtr pDrawable,
 		    
 		    (pGC->patOrg.x + pDrawable->x + dstXoff),
 		    pGC->patOrg.y + pDrawable->y - y);
+	    fbFinishAccess (&pStip->drawable);
 	}
 	else
 	{
@@ -129,6 +132,7 @@ fbFill (DrawablePtr pDrawable,
 		       bgand, bgxor,
 		       pGC->patOrg.x + pDrawable->x + dstXoff,
 		       pGC->patOrg.y + pDrawable->y - y);
+	    fbFinishAccess (&pStip->drawable);
 	}
 	break;
     }
@@ -157,10 +161,12 @@ fbFill (DrawablePtr pDrawable,
 		dstBpp,
 		(pGC->patOrg.x + pDrawable->x + dstXoff) * dstBpp,
 		pGC->patOrg.y + pDrawable->y - y);
+	fbFinishAccess (&pTile->drawable);
 	break;
     }
     }
     fbValidateDrawable (pDrawable);
+    fbFinishAccess (pDrawable);
 }
 
 void
@@ -215,8 +221,10 @@ fbSolidBoxClipped (DrawablePtr	pDrawable,
 		if (fbSolidFillmmx (pDrawable,
 		                    partX1, partY1,
 				    (partX2 - partX1), (partY2 - partY1),
-				    xor))
+				    xor)) {
+			fbFinishAccess (pDrawable);
 			return;
+		}
 	}
 #endif
 	fbSolid (dst + (partY1 + dstYoff) * dstStride,
@@ -228,4 +236,5 @@ fbSolidBoxClipped (DrawablePtr	pDrawable,
 		 (partY2 - partY1),
 		 and, xor);
     }
+    fbFinishAccess (pDrawable);
 }
diff --git a/fb/fbgc.c b/fb/fbgc.c
index 5b55810..3f8bf25 100644
--- a/fb/fbgc.c
+++ b/fb/fbgc.c
@@ -106,16 +106,18 @@ fbPadPixmap (PixmapPtr pPixmap)
     mask = FbBitsMask (0, width);
     while (height--)
     {
-	b = *bits & mask;
+	b = READ(bits) & mask;
 	w = width;
 	while (w < FB_UNIT)
 	{
 	    b = b | FbScrRight(b, w);
 	    w <<= 1;
 	}
-	*bits = b;
+	WRITE(bits, b);
 	bits += stride;
     }
+
+    fbFinishAccess (&pPixmap->drawable);
 }
 
 /*
@@ -153,7 +155,7 @@ fbLineRepeat (FbBits *bits, int len, int width)
     width = (width + FB_UNIT-1) >> FB_SHIFT;
     bits++;
     while (--width)
-	if (*bits != first)
+	if (READ(bits) != first)
 	    return FALSE;
     return TRUE;
 }
@@ -183,10 +185,13 @@ fbCanEvenStipple (PixmapPtr pStipple, int bpp)
     /* check to see that the stipple repeats horizontally */
     while (h--)
     {
-	if (!fbLineRepeat (bits, len, pStipple->drawable.width))
+	if (!fbLineRepeat (bits, len, pStipple->drawable.width)) {
+	    fbFinishAccess (&pStipple->drawable);
 	    return FALSE;
+	}
 	bits += stride;
     }
+    fbFinishAccess (&pStipple->drawable);
     return TRUE;
 }
 
diff --git a/fb/fbgetsp.c b/fb/fbgetsp.c
index f77ea8c..ffd8a1d 100644
--- a/fb/fbgetsp.c
+++ b/fb/fbgetsp.c
@@ -84,4 +84,6 @@ fbGetSpans(DrawablePtr	pDrawable,
 	ppt++;
 	pwidth++;
     }
+
+    fbFinishAccess (pDrawable);
 }
diff --git a/fb/fbglyph.c b/fb/fbglyph.c
index 8e81940..2c19b74 100644
--- a/fb/fbglyph.c
+++ b/fb/fbglyph.c
@@ -62,11 +62,11 @@ fbGlyphIn (RegionPtr	pRegion,
 #ifdef FB_24BIT
 #ifndef FBNOPIXADDR
 
-#define WRITE1(d,n,fg)	((d)[n] = (CARD8) fg)
-#define WRITE2(d,n,fg)	(*(CARD16 *) &(d[n]) = (CARD16) fg)
-#define WRITE4(d,n,fg)	(*(CARD32 *) &(d[n]) = (CARD32) fg)
+#define WRITE1(d,n,fg)	WRITE((d) + (n), (CARD8) fg)
+#define WRITE2(d,n,fg)	WRITE((CARD16 *) &(d[n]), (CARD16) fg)
+#define WRITE4(d,n,fg)	WRITE((CARD32 *) &(d[n]), (CARD32) fg)
 #if FB_UNIT == 6 && IMAGE_BYTE_ORDER == LSBFirst
-#define WRITE8(d)	(*(FbBits *) &(d[0]) = fg)
+#define WRITE8(d)	WRITE((FbBits *) &(d[0]), fg)
 #else
 #define WRITE8(d)	WRITE4(d,0,_ABCA), WRITE4(d,4,_BCAB)
 #endif
@@ -157,7 +157,7 @@ fbGlyph24 (FbBits   *dstBits,
     lshift = 4 - shift;
     while (height--)
     {
-	bits = *stipple++;
+	bits = READ(stipple++);
 	n = lshift;
 	dst = dstLine;
 	while (bits)
@@ -284,7 +284,7 @@ fbPolyGlyphBlt (DrawablePtr	pDrawable,
     glyph = 0;
     if (pGC->fillStyle == FillSolid && pPriv->and == 0)
     {
-	fbGetDrawable (pDrawable, dst, dstStride, dstBpp, dstXoff, dstYoff);
+	dstBpp = pDrawable->bitsPerPixel;
 	switch (dstBpp) {
 	case 8:	    glyph = fbGlyph8; break;
 	case 16:    glyph = fbGlyph16; break;
@@ -312,6 +312,7 @@ fbPolyGlyphBlt (DrawablePtr	pDrawable,
 	    if (glyph && gWidth <= sizeof (FbStip) * 8 &&
 		fbGlyphIn (fbGetCompositeClip(pGC), gx, gy, gWidth, gHeight))
 	    {
+		fbGetDrawable (pDrawable, dst, dstStride, dstBpp, dstXoff, dstYoff);
 		(*glyph) (dst + (gy + dstYoff) * dstStride,
 			  dstStride,
 			  dstBpp,
@@ -319,6 +320,7 @@ fbPolyGlyphBlt (DrawablePtr	pDrawable,
 			  pPriv->xor,
 			  gx + dstXoff,
 			  gHeight);
+		fbFinishAccess (pDrawable);
 	    }
 	    else
 #endif
@@ -375,7 +377,7 @@ fbImageGlyphBlt (DrawablePtr	pDrawable,
     glyph = 0;
     if (pPriv->and == 0)
     {
-	fbGetDrawable (pDrawable, dst, dstStride, dstBpp, dstXoff, dstYoff);
+	dstBpp = pDrawable->bitsPerPixel;
 	switch (dstBpp) {
 	case 8:	    glyph = fbGlyph8; break;
 	case 16:    glyph = fbGlyph16; break;
@@ -443,6 +445,7 @@ fbImageGlyphBlt (DrawablePtr	pDrawable,
 	    if (glyph && gWidth <= sizeof (FbStip) * 8 &&
 		fbGlyphIn (fbGetCompositeClip(pGC), gx, gy, gWidth, gHeight))
 	    {
+		fbGetDrawable (pDrawable, dst, dstStride, dstBpp, dstXoff, dstYoff);
 		(*glyph) (dst + (gy + dstYoff) * dstStride,
 			  dstStride,
 			  dstBpp,
@@ -450,6 +453,7 @@ fbImageGlyphBlt (DrawablePtr	pDrawable,
 			  pPriv->fg,
 			  gx + dstXoff,
 			  gHeight);
+		fbFinishAccess (pDrawable);
 	    }
 	    else
 #endif
diff --git a/fb/fbimage.c b/fb/fbimage.c
index 3b4a07c..06a3c84 100644
--- a/fb/fbimage.c
+++ b/fb/fbimage.c
@@ -170,6 +170,8 @@ fbPutZImage (DrawablePtr	pDrawable,
 		   pm,
 		   dstBpp);
     }
+
+    fbFinishAccess (pDrawable);
 }
 	     
 void
@@ -277,6 +279,8 @@ fbPutXYImage (DrawablePtr	pDrawable,
 		      fgand, fgxor, bgand, bgxor);
 	}
     }
+
+    fbFinishAccess (pDrawable);
 }
 
 void
@@ -361,4 +365,6 @@ fbGetImage (DrawablePtr	    pDrawable,
 		    fbXorStip(GXcopy,0,FB_STIP_ALLONES),
 		    planeMask);
     }
+
+    fbFinishAccess (pDrawable);
 }
diff --git a/fb/fbmmx.c b/fb/fbmmx.c
index f74930a..8985bd8 100644
--- a/fb/fbmmx.c
+++ b/fb/fbmmx.c
@@ -859,42 +859,33 @@ void fbComposeSetupMMX(void)
 /* ------------------ MMX code paths called from fbpict.c ----------------------- */
 
 void
-fbCompositeSolid_nx8888mmx (CARD8	op,
-			    PicturePtr pSrc,
-			    PicturePtr pMask,
-			    PicturePtr pDst,
-			    INT16	xSrc,
-			    INT16	ySrc,
-			    INT16	xMask,
-			    INT16	yMask,
-			    INT16	xDst,
-			    INT16	yDst,
-			    CARD16	width,
-			    CARD16	height)
+fbCompositeSolid_nx8888mmx (FbComposeData *params)
 {
     CARD32	src;
     CARD32	*dstLine, *dst;
-    CARD16	w;
+    CARD16	w, h;
     FbStride	dstStride;
     __m64	vsrc, vsrca;
     
     CHECKPOINT();
     
-    fbComposeGetSolid(pSrc, src, pDst->format);
+    fbComposeGetSolid(params->src, src, params->dest->format);
     
     if (src >> 24 == 0)
 	return;
     
-    fbComposeGetStart (pDst, xDst, yDst, CARD32, dstStride, dstLine, 1);
+    fbComposeGetStart (params->dest, params->xDest, params->yDest, CARD32,
+                       dstStride, dstLine, 1);
     
     vsrc = load8888 (src);
     vsrca = expand_alpha (vsrc);
     
-    while (height--)
+    h = params->height;
+    while (h--)
     {
 	dst = dstLine;
 	dstLine += dstStride;
-	w = width;
+	w = params->width;
 	
 	CHECKPOINT();
 	
@@ -937,42 +928,33 @@ fbCompositeSolid_nx8888mmx (CARD8	op,
 }
 
 void
-fbCompositeSolid_nx0565mmx (CARD8	op,
-			    PicturePtr pSrc,
-			    PicturePtr pMask,
-			    PicturePtr pDst,
-			    INT16	xSrc,
-			    INT16	ySrc,
-			    INT16	xMask,
-			    INT16	yMask,
-			    INT16	xDst,
-			    INT16	yDst,
-			    CARD16	width,
-			    CARD16	height)
+fbCompositeSolid_nx0565mmx (FbComposeData *params)
 {
     CARD32	src;
     CARD16	*dstLine, *dst;
-    CARD16	w;
+    CARD16	w, h;
     FbStride	dstStride;
     __m64	vsrc, vsrca;
     
     CHECKPOINT();
     
-    fbComposeGetSolid(pSrc, src, pDst->format);
+    fbComposeGetSolid(params->src, src, params->dest->format);
     
     if (src >> 24 == 0)
 	return;
     
-    fbComposeGetStart (pDst, xDst, yDst, CARD16, dstStride, dstLine, 1);
+    fbComposeGetStart (params->dest, params->xDest, params->yDest, CARD16,
+                       dstStride, dstLine, 1);
     
     vsrc = load8888 (src);
     vsrca = expand_alpha (vsrc);
     
-    while (height--)
+    h = params->height;
+    while (h--)
     {
 	dst = dstLine;
 	dstLine += dstStride;
-	w = width;
+	w = params->width;
 	
 	CHECKPOINT();
 	
@@ -1022,42 +1004,35 @@ fbCompositeSolid_nx0565mmx (CARD8	op,
 }
 
 void
-fbCompositeSolidMask_nx8888x8888Cmmx (CARD8	op,
-				      PicturePtr pSrc,
-				      PicturePtr pMask,
-				      PicturePtr pDst,
-				      INT16	xSrc,
-				      INT16	ySrc,
-				      INT16	xMask,
-				      INT16	yMask,
-				      INT16	xDst,
-				      INT16	yDst,
-				      CARD16	width,
-				      CARD16	height)
+fbCompositeSolidMask_nx8888x8888Cmmx (FbComposeData *params)
 {
     CARD32	src, srca;
     CARD32	*dstLine;
     CARD32	*maskLine;
+    CARD16      h;
     FbStride	dstStride, maskStride;
     __m64	vsrc, vsrca;
     
     CHECKPOINT();
     
-    fbComposeGetSolid(pSrc, src, pDst->format);
+    fbComposeGetSolid(params->src, src, params->dest->format);
     
     srca = src >> 24;
     if (srca == 0)
 	return;
     
-    fbComposeGetStart (pDst, xDst, yDst, CARD32, dstStride, dstLine, 1);
-    fbComposeGetStart (pMask, xMask, yMask, CARD32, maskStride, maskLine, 1);
+    fbComposeGetStart (params->dest, params->xDest, params->yDest, CARD32,
+                       dstStride, dstLine, 1);
+    fbComposeGetStart (params->mask, params->xMask, params->yMask, CARD32,
+                       maskStride, maskLine, 1);
     
     vsrc = load8888(src);
     vsrca = expand_alpha(vsrc);
     
-    while (height--)
+    h = params->height;
+    while (h--)
     {
-	int twidth = width;
+	int twidth = params->width;
 	CARD32 *p = (CARD32 *)maskLine;
 	CARD32 *q = (CARD32 *)dstLine;
 	
@@ -1125,18 +1100,7 @@ fbCompositeSolidMask_nx8888x8888Cmmx (CARD8	op,
 }
 
 void
-fbCompositeSrc_8888x8x8888mmx (CARD8	op,
-			       PicturePtr pSrc,
-			       PicturePtr pMask,
-			       PicturePtr pDst,
-			       INT16	xSrc,
-			       INT16	ySrc,
-			       INT16      xMask,
-			       INT16      yMask,
-			       INT16      xDst,
-			       INT16      yDst,
-			       CARD16     width,
-			       CARD16     height)
+fbCompositeSrc_8888x8x8888mmx (FbComposeData *params)
 {
     CARD32	*dstLine, *dst;
     CARD32	*srcLine, *src;
@@ -1144,26 +1108,30 @@ fbCompositeSrc_8888x8x8888mmx (CARD8	op,
     CARD32	mask;
     __m64	vmask;
     FbStride	dstStride, srcStride, maskStride;
-    CARD16	w;
+    CARD16	w, h;
     __m64  srca;
     
     CHECKPOINT();
     
-    fbComposeGetStart (pDst, xDst, yDst, CARD32, dstStride, dstLine, 1);
-    fbComposeGetStart (pSrc, xSrc, ySrc, CARD32, srcStride, srcLine, 1);
-    fbComposeGetStart (pMask, xMask, yMask, CARD8, maskStride, maskLine, 1);
+    fbComposeGetStart (params->dest, params->xDest, params->yDest, CARD32,
+                       dstStride, dstLine, 1);
+    fbComposeGetStart (params->src, params->xSrc, params->ySrc, CARD32,
+                       srcStride, srcLine, 1);
+    fbComposeGetStart (params->mask, params->xMask, params->yMask, CARD8,
+                       maskStride, maskLine, 1);
 
     mask = *maskLine << 24 | *maskLine << 16 | *maskLine << 8 | *maskLine;
     vmask = load8888 (mask);
     srca = MC(4x00ff);
     
-    while (height--)
+    h = params->height;
+    while (h--)
     {
 	dst = dstLine;
 	dstLine += dstStride;
 	src = srcLine;
 	srcLine += srcStride;
-	w = width;
+	w = params->width;
 
 	while (w && (unsigned long)dst & 7)
 	{
@@ -1260,39 +1228,31 @@ fbCompositeSrc_8888x8x8888mmx (CARD8	op,
 }
 
 void
-fbCompositeSrc_8888x8888mmx (CARD8	op,
-			     PicturePtr pSrc,
-			     PicturePtr pMask,
-			     PicturePtr pDst,
-			     INT16	xSrc,
-			     INT16	ySrc,
-			     INT16      xMask,
-			     INT16      yMask,
-			     INT16      xDst,
-			     INT16      yDst,
-			     CARD16     width,
-			     CARD16     height)
+fbCompositeSrc_8888x8888mmx (FbComposeData *params)
 {
     CARD32	*dstLine, *dst;
     CARD32	*srcLine, *src;
     FbStride	dstStride, srcStride;
-    CARD16	w;
+    CARD16	w, h;
     __m64  srca;
     
     CHECKPOINT();
     
-    fbComposeGetStart (pDst, xDst, yDst, CARD32, dstStride, dstLine, 1);
-    fbComposeGetStart (pSrc, xSrc, ySrc, CARD32, srcStride, srcLine, 1);
+    fbComposeGetStart (params->dest, params->xDest, params->yDest, CARD32,
+                       dstStride, dstLine, 1);
+    fbComposeGetStart (params->src, params->xSrc, params->ySrc, CARD32,
+                       srcStride, srcLine, 1);
 
     srca = MC (4x00ff);
     
-    while (height--)
+    h = params->height;
+    while (h--)
     {
 	dst = dstLine;
 	dstLine += dstStride;
 	src = srcLine;
 	srcLine += srcStride;
-	w = width;
+	w = params->width;
 
 	while (w && (unsigned long)dst & 7)
 	{
@@ -1339,30 +1299,19 @@ fbCompositeSrc_8888x8888mmx (CARD8	op,
 }
 
 void
-fbCompositeSolidMask_nx8x8888mmx (CARD8      op,
-				  PicturePtr pSrc,
-				  PicturePtr pMask,
-				  PicturePtr pDst,
-				  INT16      xSrc,
-				  INT16      ySrc,
-				  INT16      xMask,
-				  INT16      yMask,
-				  INT16      xDst,
-				  INT16      yDst,
-				  CARD16     width,
-				  CARD16     height)
+fbCompositeSolidMask_nx8x8888mmx (FbComposeData *params)
 {
     CARD32	src, srca;
     CARD32	*dstLine, *dst;
     CARD8	*maskLine, *mask;
     FbStride	dstStride, maskStride;
-    CARD16	w;
+    CARD16	w, h;
     __m64	vsrc, vsrca;
     ullong	srcsrc;
     
     CHECKPOINT();
     
-    fbComposeGetSolid(pSrc, src, pDst->format);
+    fbComposeGetSolid(params->src, src, params->dest->format);
     
     srca = src >> 24;
     if (srca == 0)
@@ -1370,19 +1319,22 @@ fbCompositeSolidMask_nx8x8888mmx (CARD8      op,
     
     srcsrc = (unsigned long long)src << 32 | src;
     
-    fbComposeGetStart (pDst, xDst, yDst, CARD32, dstStride, dstLine, 1);
-    fbComposeGetStart (pMask, xMask, yMask, CARD8, maskStride, maskLine, 1);
+    fbComposeGetStart (params->dest, params->xDest, params->yDest, CARD32,
+                       dstStride, dstLine, 1);
+    fbComposeGetStart (params->mask, params->xMask, params->yMask, CARD8,
+                       maskStride, maskLine, 1);
     
     vsrc = load8888 (src);
     vsrca = expand_alpha (vsrc);
     
-    while (height--)
+    h = params->height;
+    while (h--)
     {
 	dst = dstLine;
 	dstLine += dstStride;
 	mask = maskLine;
 	maskLine += maskStride;
-	w = width;
+	w = params->width;
 	
 	CHECKPOINT();
 	
@@ -1455,37 +1407,28 @@ fbCompositeSolidMask_nx8x8888mmx (CARD8      op,
 
 
 void
-fbCompositeSolidMask_nx8x0565mmx (CARD8      op,
-				  PicturePtr pSrc,
-				  PicturePtr pMask,
-				  PicturePtr pDst,
-				  INT16      xSrc,
-				  INT16      ySrc,
-				  INT16      xMask,
-				  INT16      yMask,
-				  INT16      xDst,
-				  INT16      yDst,
-				  CARD16     width,
-				  CARD16     height)
+fbCompositeSolidMask_nx8x0565mmx (FbComposeData *params)
 {
     CARD32	src, srca;
     CARD16	*dstLine, *dst;
     CARD8	*maskLine, *mask;
     FbStride	dstStride, maskStride;
-    CARD16	w;
+    CARD16	w, h;
     __m64	vsrc, vsrca;
     unsigned long long srcsrcsrcsrc, src16;
     
     CHECKPOINT();
     
-    fbComposeGetSolid(pSrc, src, pDst->format);
+    fbComposeGetSolid(params->src, src, params->dest->format);
     
     srca = src >> 24;
     if (srca == 0)
 	return;
     
-    fbComposeGetStart (pDst, xDst, yDst, CARD16, dstStride, dstLine, 1);
-    fbComposeGetStart (pMask, xMask, yMask, CARD8, maskStride, maskLine, 1);
+    fbComposeGetStart (params->dest, params->xDest, params->yDest, CARD16,
+                       dstStride, dstLine, 1);
+    fbComposeGetStart (params->mask, params->xMask, params->yMask, CARD8,
+                       maskStride, maskLine, 1);
     
     vsrc = load8888 (src);
     vsrca = expand_alpha (vsrc);
@@ -1495,13 +1438,14 @@ fbCompositeSolidMask_nx8x0565mmx (CARD8      op,
     srcsrcsrcsrc = (ullong)src16 << 48 | (ullong)src16 << 32 |
 	(ullong)src16 << 16 | (ullong)src16;
     
-    while (height--)
+    h = params->height;
+    while (h--)
     {
 	dst = dstLine;
 	dstLine += dstStride;
 	mask = maskLine;
 	maskLine += maskStride;
-	w = width;
+	w = params->width;
 	
 	CHECKPOINT();
 	
@@ -1584,38 +1528,30 @@ fbCompositeSolidMask_nx8x0565mmx (CARD8      op,
 }
 
 void
-fbCompositeSrc_8888RevNPx0565mmx (CARD8      op,
-				  PicturePtr pSrc,
-				  PicturePtr pMask,
-				  PicturePtr pDst,
-				  INT16      xSrc,
-				  INT16      ySrc,
-				  INT16      xMask,
-				  INT16      yMask,
-				  INT16      xDst,
-				  INT16      yDst,
-				  CARD16     width,
-				  CARD16     height)
+fbCompositeSrc_8888RevNPx0565mmx (FbComposeData *params)
 {
     CARD16	*dstLine, *dst;
     CARD32	*srcLine, *src;
     FbStride	dstStride, srcStride;
-    CARD16	w;
+    CARD16	w, h;
     
     CHECKPOINT();
     
-    fbComposeGetStart (pDst, xDst, yDst, CARD16, dstStride, dstLine, 1);
-    fbComposeGetStart (pSrc, xSrc, ySrc, CARD32, srcStride, srcLine, 1);
+    fbComposeGetStart (params->dest, params->xDest, params->yDest, CARD16,
+                       dstStride, dstLine, 1);
+    fbComposeGetStart (params->src, params->xSrc, params->ySrc, CARD32,
+                       srcStride, srcLine, 1);
     
-    assert (pSrc->pDrawable == pMask->pDrawable);
+    assert (params->src->pDrawable == params->mask->pDrawable);
     
-    while (height--)
+    h = params->height;
+    while (h--)
     {
 	dst = dstLine;
 	dstLine += dstStride;
 	src = srcLine;
 	srcLine += srcStride;
-	w = width;
+	w = params->width;
 	
 	CHECKPOINT();
 	
@@ -1702,38 +1638,30 @@ fbCompositeSrc_8888RevNPx0565mmx (CARD8      op,
 /* "8888RevNP" is GdkPixbuf's format: ABGR, non premultiplied */
 
 void
-fbCompositeSrc_8888RevNPx8888mmx (CARD8      op,
-				  PicturePtr pSrc,
-				  PicturePtr pMask,
-				  PicturePtr pDst,
-				  INT16      xSrc,
-				  INT16      ySrc,
-				  INT16      xMask,
-				  INT16      yMask,
-				  INT16      xDst,
-				  INT16      yDst,
-				  CARD16     width,
-				  CARD16     height)
+fbCompositeSrc_8888RevNPx8888mmx (FbComposeData *params)
 {
     CARD32	*dstLine, *dst;
     CARD32	*srcLine, *src;
     FbStride	dstStride, srcStride;
-    CARD16	w;
+    CARD16	w, h;
     
     CHECKPOINT();
     
-    fbComposeGetStart (pDst, xDst, yDst, CARD32, dstStride, dstLine, 1);
-    fbComposeGetStart (pSrc, xSrc, ySrc, CARD32, srcStride, srcLine, 1);
+    fbComposeGetStart (params->dest, params->xDest, params->yDest, CARD32,
+                       dstStride, dstLine, 1);
+    fbComposeGetStart (params->src, params->xSrc, params->ySrc, CARD32,
+                       srcStride, srcLine, 1);
     
-    assert (pSrc->pDrawable == pMask->pDrawable);
+    assert (params->src->pDrawable == params->mask->pDrawable);
     
-    while (height--)
+    h = params->height;
+    while (h--)
     {
 	dst = dstLine;
 	dstLine += dstStride;
 	src = srcLine;
 	srcLine += srcStride;
-	w = width;
+	w = params->width;
 	
 	while (w && (unsigned long)dst & 7)
 	{
@@ -1798,42 +1726,35 @@ fbCompositeSrc_8888RevNPx8888mmx (CARD8      op,
 }
 
 void
-fbCompositeSolidMask_nx8888x0565Cmmx (CARD8      op,
-				      PicturePtr pSrc,
-				      PicturePtr pMask,
-				      PicturePtr pDst,
-				      INT16      xSrc,
-				      INT16      ySrc,
-				      INT16      xMask,
-				      INT16      yMask,
-				      INT16      xDst,
-				      INT16      yDst,
-				      CARD16     width,
-				      CARD16     height)
+fbCompositeSolidMask_nx8888x0565Cmmx (FbComposeData *params)
 {
     CARD32	src, srca;
     CARD16	*dstLine;
+    CARD16      h;
     CARD32	*maskLine;
     FbStride	dstStride, maskStride;
     __m64  vsrc, vsrca;
     
     CHECKPOINT();
     
-    fbComposeGetSolid(pSrc, src, pDst->format);
+    fbComposeGetSolid(params->src, src, params->dest->format);
     
     srca = src >> 24;
     if (srca == 0)
 	return;
     
-    fbComposeGetStart (pDst, xDst, yDst, CARD16, dstStride, dstLine, 1);
-    fbComposeGetStart (pMask, xMask, yMask, CARD32, maskStride, maskLine, 1);
+    fbComposeGetStart (params->dest, params->xDest, params->yDest, CARD16,
+                       dstStride, dstLine, 1);
+    fbComposeGetStart (params->mask, params->xMask, params->yMask, CARD32,
+                       maskStride, maskLine, 1);
     
     vsrc = load8888 (src);
     vsrca = expand_alpha (vsrc);
     
-    while (height--)
+    h = params->height;
+    while (h--)
     {
-	int twidth = width;
+	int twidth = params->width;
 	CARD32 *p = (CARD32 *)maskLine;
 	CARD16 *q = (CARD16 *)dstLine;
 	
@@ -1905,38 +1826,30 @@ fbCompositeSolidMask_nx8888x0565Cmmx (CARD8      op,
 }
 
 void
-fbCompositeSrcAdd_8000x8000mmx (CARD8	op,
-				PicturePtr pSrc,
-				PicturePtr pMask,
-				PicturePtr pDst,
-				INT16      xSrc,
-				INT16      ySrc,
-				INT16      xMask,
-				INT16      yMask,
-				INT16      xDst,
-				INT16      yDst,
-				CARD16     width,
-				CARD16     height)
+fbCompositeSrcAdd_8000x8000mmx (FbComposeData *params)
 {
     CARD8	*dstLine, *dst;
     CARD8	*srcLine, *src;
     FbStride	dstStride, srcStride;
-    CARD16	w;
+    CARD16	w, h;
     CARD8	s, d;
     CARD16	t;
     
     CHECKPOINT();
     
-    fbComposeGetStart (pSrc, xSrc, ySrc, CARD8, srcStride, srcLine, 1);
-    fbComposeGetStart (pDst, xDst, yDst, CARD8, dstStride, dstLine, 1);
+    fbComposeGetStart (params->src, params->xSrc, params->ySrc, CARD8,
+                       srcStride, srcLine, 1);
+    fbComposeGetStart (params->dest, params->xDest, params->yDest, CARD8,
+                       dstStride, dstLine, 1);
     
-    while (height--)
+    h = params->height;
+    while (h--)
     {
 	dst = dstLine;
 	dstLine += dstStride;
 	src = srcLine;
 	srcLine += srcStride;
-	w = width;
+	w = params->width;
 	
 	while (w && (unsigned long)dst & 7)
 	{
@@ -1977,36 +1890,28 @@ fbCompositeSrcAdd_8000x8000mmx (CARD8	op,
 }
 
 void
-fbCompositeSrcAdd_8888x8888mmx (CARD8		op,
-				PicturePtr	pSrc,
-				PicturePtr	pMask,
-				PicturePtr	 pDst,
-				INT16		 xSrc,
-				INT16      ySrc,
-				INT16      xMask,
-				INT16      yMask,
-				INT16      xDst,
-				INT16      yDst,
-				CARD16     width,
-				CARD16     height)
+fbCompositeSrcAdd_8888x8888mmx (FbComposeData *params)
 {
     CARD32	*dstLine, *dst;
     CARD32	*srcLine, *src;
     FbStride	dstStride, srcStride;
-    CARD16	w;
+    CARD16	w, h;
     
     CHECKPOINT();
     
-    fbComposeGetStart (pSrc, xSrc, ySrc, CARD32, srcStride, srcLine, 1);
-    fbComposeGetStart (pDst, xDst, yDst, CARD32, dstStride, dstLine, 1);
+    fbComposeGetStart (params->src, params->xSrc, params->ySrc, CARD32,
+                       srcStride, srcLine, 1);
+    fbComposeGetStart (params->dest, params->xDest, params->yDest, CARD32,
+                       dstStride, dstLine, 1);
     
-    while (height--)
+    h = params->height;
+    while (h--)
     {
 	dst = dstLine;
 	dstLine += dstStride;
 	src = srcLine;
 	srcLine += srcStride;
-	w = width;
+	w = params->width;
 	
 	while (w && (unsigned long)dst & 7)
 	{
@@ -2287,24 +2192,13 @@ fbCopyAreammx (DrawablePtr	pSrc,
 }
 
 void
-fbCompositeCopyAreammx (CARD8		op,
-			PicturePtr	pSrc,
-			PicturePtr	pMask,
-			PicturePtr	pDst,
-			INT16		xSrc,
-			INT16		ySrc,
-			INT16		xMask,
-			INT16		yMask,
-			INT16		xDst,
-			INT16		yDst,
-			CARD16		width,
-			CARD16		height)
+fbCompositeCopyAreammx (FbComposeData *params)
 {
-    fbCopyAreammx (pSrc->pDrawable,
-		   pDst->pDrawable,
-		   xSrc, ySrc,
-		   xDst, yDst,
-		   width, height);
+    fbCopyAreammx (params->src->pDrawable,
+		   params->dest->pDrawable,
+		   params->xSrc, params->ySrc,
+		   params->xDest, params->yDest,
+		   params->width, params->height);
 }
 
 
diff --git a/fb/fbmmx.h b/fb/fbmmx.h
index 34718e3..4d9400a 100644
--- a/fb/fbmmx.h
+++ b/fb/fbmmx.h
@@ -30,6 +30,8 @@
 #include <dix-config.h>
 #endif
 
+#include "fbpict.h"
+
 #ifdef USE_MMX
 
 #if !defined(__amd64__) && !defined(__x86_64__)
@@ -46,150 +48,18 @@ Bool fbHaveMMX(void);
 
 void fbComposeSetupMMX(void);
 
-void fbCompositeSolidMask_nx8888x0565Cmmx (CARD8      op,
-					   PicturePtr pSrc,
-					   PicturePtr pMask,
-					   PicturePtr pDst,
-					   INT16      xSrc,
-					   INT16      ySrc,
-					   INT16      xMask,
-					   INT16      yMask,
-					   INT16      xDst,
-					   INT16      yDst,
-					   CARD16     width,
-					   CARD16     height);
-void fbCompositeSrcAdd_8888x8888mmx (CARD8	op,
-				     PicturePtr	pSrc,
-				     PicturePtr	pMask,
-				     PicturePtr	pDst,
-				     INT16	xSrc,
-				     INT16      ySrc,
-				     INT16      xMask,
-				     INT16      yMask,
-				     INT16      xDst,
-				     INT16      yDst,
-				     CARD16     width,
-				     CARD16     height);
-void fbCompositeSrc_8888x8888mmx (CARD8		op,
-				  PicturePtr	pSrc,
-				  PicturePtr	pMask,
-				  PicturePtr	pDst,
-				  INT16		xSrc,
-				  INT16		ySrc,
-				  INT16		xMask,
-				  INT16		yMask,
-				  INT16		xDst,
-				  INT16		yDst,
-				  CARD16	width,
-				  CARD16	height);
-void fbCompositeSolidMask_nx8888x8888Cmmx (CARD8	op,
-					   PicturePtr	pSrc,
-					   PicturePtr	pMask,
-					   PicturePtr	pDst,
-					   INT16	xSrc,
-					   INT16	ySrc,
-					   INT16	xMask,
-					   INT16	yMask,
-					   INT16	xDst,
-					   INT16	yDst,
-					   CARD16	width,
-					   CARD16	height);
-void fbCompositeSolidMask_nx8x8888mmx (CARD8      op,
-				       PicturePtr pSrc,
-				       PicturePtr pMask,
-				       PicturePtr pDst,
-				       INT16      xSrc,
-				       INT16      ySrc,
-				       INT16      xMask,
-				       INT16      yMask,
-				       INT16      xDst,
-				       INT16      yDst,
-				       CARD16     width,
-				       CARD16     height);
-void fbCompositeSrcAdd_8000x8000mmx (CARD8	op,
-				     PicturePtr pSrc,
-				     PicturePtr pMask,
-				     PicturePtr pDst,
-				     INT16      xSrc,
-				     INT16      ySrc,
-				     INT16      xMask,
-				     INT16      yMask,
-				     INT16      xDst,
-				     INT16      yDst,
-				     CARD16     width,
-				     CARD16     height);
-void fbCompositeSrc_8888RevNPx8888mmx (CARD8      op,
-				       PicturePtr pSrc,
-				       PicturePtr pMask,
-				       PicturePtr pDst,
-				       INT16      xSrc,
-				       INT16      ySrc,
-				       INT16      xMask,
-				       INT16      yMask,
-				       INT16      xDst,
-				       INT16      yDst,
-				       CARD16     width,
-				       CARD16     height);
-void fbCompositeSrc_8888RevNPx0565mmx (CARD8      op,
-				       PicturePtr pSrc,
-				       PicturePtr pMask,
-				       PicturePtr pDst,
-				       INT16      xSrc,
-				       INT16      ySrc,
-				       INT16      xMask,
-				       INT16      yMask,
-				       INT16      xDst,
-				       INT16      yDst,
-				       CARD16     width,
-				       CARD16     height);
-void fbCompositeSolid_nx8888mmx (CARD8		op,
-				 PicturePtr	pSrc,
-				 PicturePtr	pMask,
-				 PicturePtr	pDst,
-				 INT16		xSrc,
-				 INT16		ySrc,
-				 INT16		xMask,
-				 INT16		yMask,
-				 INT16		xDst,
-				 INT16		yDst,
-				 CARD16		width,
-				 CARD16		height);
-void fbCompositeSolid_nx0565mmx (CARD8		op,
-				 PicturePtr	pSrc,
-				 PicturePtr	pMask,
-				 PicturePtr	pDst,
-				 INT16		xSrc,
-				 INT16		ySrc,
-				 INT16		xMask,
-				 INT16		yMask,
-				 INT16		xDst,
-				 INT16		yDst,
-				 CARD16		width,
-				 CARD16		height);
-void fbCompositeSolidMask_nx8x0565mmx (CARD8      op,
-				       PicturePtr pSrc,
-				       PicturePtr pMask,
-				       PicturePtr pDst,
-				       INT16      xSrc,
-				       INT16      ySrc,
-				       INT16      xMask,
-				       INT16      yMask,
-				       INT16      xDst,
-				       INT16      yDst,
-				       CARD16     width,
-				       CARD16     height);
-void fbCompositeSrc_8888x8x8888mmx (CARD8	op,
-				    PicturePtr  pSrc,
-				    PicturePtr  pMask,
-				    PicturePtr  pDst,
-				    INT16	xSrc,
-				    INT16	ySrc,
-				    INT16       xMask,
-				    INT16       yMask,
-				    INT16       xDst,
-				    INT16       yDst,
-				    CARD16      width,
-				    CARD16      height);
+void fbCompositeSolidMask_nx8888x0565Cmmx (FbComposeData *params);
+void fbCompositeSrcAdd_8888x8888mmx (FbComposeData *params);
+void fbCompositeSrc_8888x8888mmx (FbComposeData *params);
+void fbCompositeSolidMask_nx8888x8888Cmmx (FbComposeData *params);
+void fbCompositeSolidMask_nx8x8888mmx (FbComposeData *params);
+void fbCompositeSrcAdd_8000x8000mmx (FbComposeData *params);
+void fbCompositeSrc_8888RevNPx8888mmx (FbComposeData *params);
+void fbCompositeSrc_8888RevNPx0565mmx (FbComposeData *params);
+void fbCompositeSolid_nx8888mmx (FbComposeData *params);
+void fbCompositeSolid_nx0565mmx (FbComposeData *params);
+void fbCompositeSolidMask_nx8x0565mmx (FbComposeData *params);
+void fbCompositeSrc_8888x8x8888mmx (FbComposeData *params);
 Bool fbCopyAreammx (DrawablePtr	pSrc,
 		    DrawablePtr	pDst,
 		    int		src_x,
@@ -198,18 +68,7 @@ Bool fbCopyAreammx (DrawablePtr	pSrc,
 		    int		dst_y,
 		    int		width,
 		    int		height);
-void fbCompositeCopyAreammx (CARD8	op,
-			     PicturePtr	pSrc,
-			     PicturePtr	pMask,
-			     PicturePtr	pDst,
-			     INT16	xSrc,
-			     INT16      ySrc,
-			     INT16      xMask,
-			     INT16      yMask,
-			     INT16      xDst,
-			     INT16      yDst,
-			     CARD16     width,
-			     CARD16     height);
+void fbCompositeCopyAreammx (FbComposeData *params);
 Bool fbSolidFillmmx (DrawablePtr	pDraw,
 		     int		x,
 		     int		y,
diff --git a/fb/fbpict.c b/fb/fbpict.c
index 38afbea..c1227b0 100644
--- a/fb/fbpict.c
+++ b/fb/fbpict.c
@@ -29,26 +29,14 @@
 #include <string.h>
 
 #include "fb.h"
-
+#define USE_ARMV6
 #ifdef RENDER
 
 #include "picturestr.h"
 #include "mipict.h"
 #include "fbpict.h"
 #include "fbmmx.h"
-
-typedef void	(*CompositeFunc) (CARD8      op,
-				  PicturePtr pSrc,
-				  PicturePtr pMask,
-				  PicturePtr pDst,
-				  INT16      xSrc,
-				  INT16      ySrc,
-				  INT16      xMask,
-                                  INT16      yMask,
-				  INT16      xDst,
-				  INT16      yDst,
-				  CARD16     width,
-				  CARD16     height);
+#include "fbarmv6.h"
 
 CARD32
 fbOver (CARD32 x, CARD32 y)
@@ -98,115 +86,102 @@ fbIn (CARD32 x, CARD8 y)
  */
 
 void
-fbCompositeSolidMask_nx8x8888 (CARD8      op,
-			       PicturePtr pSrc,
-			       PicturePtr pMask,
-			       PicturePtr pDst,
-			       INT16      xSrc,
-			       INT16      ySrc,
-			       INT16      xMask,
-			       INT16      yMask,
-			       INT16      xDst,
-			       INT16      yDst,
-			       CARD16     width,
-			       CARD16     height)
+fbCompositeSolidMask_nx8x8888 (FbComposeData *params)
 {
     CARD32	src, srca;
     CARD32	*dstLine, *dst, d, dstMask;
     CARD8	*maskLine, *mask, m;
     FbStride	dstStride, maskStride;
-    CARD16	w;
+    CARD16	w, h;
 
-    fbComposeGetSolid(pSrc, src, pDst->format);
+    fbComposeGetSolid(params->src, src, params->dest->format);
 
-    dstMask = FbFullMask (pDst->pDrawable->depth);
+    dstMask = FbFullMask (params->dest->pDrawable->depth);
     srca = src >> 24;
     if (src == 0)
 	return;
 
-    fbComposeGetStart (pDst, xDst, yDst, CARD32, dstStride, dstLine, 1);
-    fbComposeGetStart (pMask, xMask, yMask, CARD8, maskStride, maskLine, 1);
+    fbComposeGetStart (params->dest, params->xDest, params->yDest, CARD32,
+                       dstStride, dstLine, 1);
+    fbComposeGetStart (params->mask, params->xMask, params->yMask, CARD8,
+                       maskStride, maskLine, 1);
 
-    while (height--)
+    h = params->height;
+    while (h--)
     {
 	dst = dstLine;
 	dstLine += dstStride;
 	mask = maskLine;
 	maskLine += maskStride;
-	w = width;
+	w = params->width;
 
 	while (w--)
 	{
-	    m = *mask++;
+	    m = READ(mask++);
 	    if (m == 0xff)
 	    {
 		if (srca == 0xff)
-		    *dst = src & dstMask;
+		    WRITE(dst, src & dstMask);
 		else
-		    *dst = fbOver (src, *dst) & dstMask;
+		    WRITE(dst, fbOver (src, READ(dst)) & dstMask);
 	    }
 	    else if (m)
 	    {
 		d = fbIn (src, m);
-		*dst = fbOver (d, *dst) & dstMask;
+		WRITE(dst, fbOver (d, READ(dst)) & dstMask);
 	    }
 	    dst++;
 	}
     }
+
+    fbFinishAccess (params->mask->pDrawable);
+    fbFinishAccess (params->dest->pDrawable);
 }
 
 void
-fbCompositeSolidMask_nx8888x8888C (CARD8      op,
-				   PicturePtr pSrc,
-				   PicturePtr pMask,
-				   PicturePtr pDst,
-				   INT16      xSrc,
-				   INT16      ySrc,
-				   INT16      xMask,
-				   INT16      yMask,
-				   INT16      xDst,
-				   INT16      yDst,
-				   CARD16     width,
-				   CARD16     height)
+fbCompositeSolidMask_nx8888x8888C (FbComposeData *params)
 {
     CARD32	src, srca;
     CARD32	*dstLine, *dst, d, dstMask;
     CARD32	*maskLine, *mask, ma;
     FbStride	dstStride, maskStride;
-    CARD16	w;
+    CARD16	w, h;
     CARD32	m, n, o, p;
 
-    fbComposeGetSolid(pSrc, src, pDst->format);
+    fbComposeGetSolid(params->src, src, params->dest->format);
 
-    dstMask = FbFullMask (pDst->pDrawable->depth);
+    dstMask = FbFullMask (params->dest->pDrawable->depth);
     srca = src >> 24;
     if (src == 0)
 	return;
 
-    fbComposeGetStart (pDst, xDst, yDst, CARD32, dstStride, dstLine, 1);
-    fbComposeGetStart (pMask, xMask, yMask, CARD32, maskStride, maskLine, 1);
+    fbComposeGetStart (params->dest, params->xDest, params->yDest, CARD32,
+                       dstStride, dstLine, 1);
+    fbComposeGetStart (params->mask, params->xMask, params->yMask, CARD32,
+                       maskStride, maskLine, 1);
 
-    while (height--)
+    h = params->height;
+    while (h--)
     {
 	dst = dstLine;
 	dstLine += dstStride;
 	mask = maskLine;
 	maskLine += maskStride;
-	w = width;
+	w = params->width;
 
 	while (w--)
 	{
-	    ma = *mask++;
+	    ma = READ(mask++);
 	    if (ma == 0xffffffff)
 	    {
 		if (srca == 0xff)
-		    *dst = src & dstMask;
+		    WRITE(dst, src & dstMask);
 		else
-		    *dst = fbOver (src, *dst) & dstMask;
+		    WRITE(dst, fbOver (src, READ(dst)) & dstMask);
 	    }
 	    else if (ma)
 	    {
-		d = *dst;
+		d = READ(dst);
 #define FbInOverC(src,srca,msk,dst,i,result) { \
     CARD16  __a = FbGet8(msk,i); \
     CARD32  __t, __ta; \
@@ -221,54 +196,49 @@ fbCompositeSolidMask_nx8888x8888C (CARD8      op,
 		FbInOverC (src, srca, ma, d, 8, n);
 		FbInOverC (src, srca, ma, d, 16, o);
 		FbInOverC (src, srca, ma, d, 24, p);
-		*dst = m|n|o|p;
+		WRITE(dst, m|n|o|p);
 	    }
 	    dst++;
 	}
     }
+
+    fbFinishAccess (params->mask->pDrawable);
+    fbFinishAccess (params->dest->pDrawable);
 }
 
 void
-fbCompositeSolidMask_nx8x0888 (CARD8      op,
-			       PicturePtr pSrc,
-			       PicturePtr pMask,
-			       PicturePtr pDst,
-			       INT16      xSrc,
-			       INT16      ySrc,
-			       INT16      xMask,
-			       INT16      yMask,
-			       INT16      xDst,
-			       INT16      yDst,
-			       CARD16     width,
-			       CARD16     height)
+fbCompositeSolidMask_nx8x0888 (FbComposeData *params)
 {
     CARD32	src, srca;
     CARD8	*dstLine, *dst;
     CARD32	d;
     CARD8	*maskLine, *mask, m;
     FbStride	dstStride, maskStride;
-    CARD16	w;
+    CARD16	w, h;
 
-    fbComposeGetSolid(pSrc, src, pDst->format);
+    fbComposeGetSolid(params->src, src, params->dest->format);
 
     srca = src >> 24;
     if (src == 0)
 	return;
 
-    fbComposeGetStart (pDst, xDst, yDst, CARD8, dstStride, dstLine, 3);
-    fbComposeGetStart (pMask, xMask, yMask, CARD8, maskStride, maskLine, 1);
+    fbComposeGetStart (params->dest, params->xDest, params->yDest, CARD8,
+                       dstStride, dstLine, 3);
+    fbComposeGetStart (params->mask, params->xMask, params->yMask, CARD8,
+                       maskStride, maskLine, 1);
 
-    while (height--)
+    h = params->height;
+    while (h--)
     {
 	dst = dstLine;
 	dstLine += dstStride;
 	mask = maskLine;
 	maskLine += maskStride;
-	w = width;
+	w = params->width;
 
 	while (w--)
 	{
-	    m = *mask++;
+	    m = READ(mask++);
 	    if (m == 0xff)
 	    {
 		if (srca == 0xff)
@@ -288,84 +258,71 @@ fbCompositeSolidMask_nx8x0888 (CARD8      op,
 	    dst += 3;
 	}
     }
+
+    fbFinishAccess (params->mask->pDrawable);
+    fbFinishAccess (params->dest->pDrawable);
 }
 
 void
-fbCompositeSolidMask_nx8x0565 (CARD8      op,
-				  PicturePtr pSrc,
-				  PicturePtr pMask,
-				  PicturePtr pDst,
-				  INT16      xSrc,
-				  INT16      ySrc,
-				  INT16      xMask,
-				  INT16      yMask,
-				  INT16      xDst,
-				  INT16      yDst,
-				  CARD16     width,
-				  CARD16     height)
+fbCompositeSolidMask_nx8x0565 (FbComposeData *params)
 {
     CARD32	src, srca;
     CARD16	*dstLine, *dst;
     CARD32	d;
     CARD8	*maskLine, *mask, m;
     FbStride	dstStride, maskStride;
-    CARD16	w;
+    CARD16	w, h;
 
-    fbComposeGetSolid(pSrc, src, pDst->format);
+    fbComposeGetSolid(params->src, src, params->dest->format);
 
     srca = src >> 24;
     if (src == 0)
 	return;
 
-    fbComposeGetStart (pDst, xDst, yDst, CARD16, dstStride, dstLine, 1);
-    fbComposeGetStart (pMask, xMask, yMask, CARD8, maskStride, maskLine, 1);
+    fbComposeGetStart (params->dest, params->xDest, params->yDest, CARD16,
+                       dstStride, dstLine, 1);
+    fbComposeGetStart (params->mask, params->xMask, params->yMask, CARD8,
+                       maskStride, maskLine, 1);
 
-    while (height--)
+    h = params->height;
+    while (h--)
     {
 	dst = dstLine;
 	dstLine += dstStride;
 	mask = maskLine;
 	maskLine += maskStride;
-	w = width;
+	w = params->width;
 
 	while (w--)
 	{
-	    m = *mask++;
+	    m = READ(mask++);
 	    if (m == 0xff)
 	    {
 		if (srca == 0xff)
 		    d = src;
 		else
 		{
-		    d = *dst;
+		    d = READ(dst);
 		    d = fbOver24 (src, cvt0565to8888(d));
 		}
-		*dst = cvt8888to0565(d);
+		WRITE(dst, cvt8888to0565(d));
 	    }
 	    else if (m)
 	    {
-		d = *dst;
+		d = READ(dst);
 		d = fbOver24 (fbIn(src,m), cvt0565to8888(d));
-		*dst = cvt8888to0565(d);
+		WRITE(dst, cvt8888to0565(d));
 	    }
 	    dst++;
 	}
     }
+
+    fbFinishAccess (params->mask->pDrawable);
+    fbFinishAccess (params->dest->pDrawable);
 }
 
 void
-fbCompositeSolidMask_nx8888x0565C (CARD8      op,
-				   PicturePtr pSrc,
-				   PicturePtr pMask,
-				   PicturePtr pDst,
-				   INT16      xSrc,
-				   INT16      ySrc,
-				   INT16      xMask,
-				   INT16      yMask,
-				   INT16      xDst,
-				   INT16      yDst,
-				   CARD16     width,
-				   CARD16     height)
+fbCompositeSolidMask_nx8888x0565C (FbComposeData *params)
 {
     CARD32	src, srca;
     CARD16	src16;
@@ -373,10 +330,10 @@ fbCompositeSolidMask_nx8888x0565C (CARD8      op,
     CARD32	d;
     CARD32	*maskLine, *mask, ma;
     FbStride	dstStride, maskStride;
-    CARD16	w;
+    CARD16	w, h;
     CARD32	m, n, o;
 
-    fbComposeGetSolid(pSrc, src, pDst->format);
+    fbComposeGetSolid (params->src, src, params->dest->format);
 
     srca = src >> 24;
     if (src == 0)
@@ -384,129 +341,122 @@ fbCompositeSolidMask_nx8888x0565C (CARD8      op,
 
     src16 = cvt8888to0565(src);
 
-    fbComposeGetStart (pDst, xDst, yDst, CARD16, dstStride, dstLine, 1);
-    fbComposeGetStart (pMask, xMask, yMask, CARD32, maskStride, maskLine, 1);
+    fbComposeGetStart (params->dest, params->xDest, params->yDest, CARD16,
+                       dstStride, dstLine, 1);
+    fbComposeGetStart (params->mask, params->xMask, params->yMask, CARD32,
+                       maskStride, maskLine, 1);
 
-    while (height--)
+    h = params->height;
+    while (h--)
     {
 	dst = dstLine;
 	dstLine += dstStride;
 	mask = maskLine;
 	maskLine += maskStride;
-	w = width;
+	w = params->width;
 
 	while (w--)
 	{
-	    ma = *mask++;
+	    ma = READ(mask++);
 	    if (ma == 0xffffffff)
 	    {
 		if (srca == 0xff)
 		{
-		    *dst = src16;
+		    WRITE(dst, src16);
 		}
 		else
 		{
-		    d = *dst;
+		    d = READ(dst);
 		    d = fbOver24 (src, cvt0565to8888(d));
-		    *dst = cvt8888to0565(d);
+		    WRITE(dst, cvt8888to0565(d));
 		}
 	    }
 	    else if (ma)
 	    {
-		d = *dst;
+		d = READ(dst);
 		d = cvt0565to8888(d);
 		FbInOverC (src, srca, ma, d, 0, m);
 		FbInOverC (src, srca, ma, d, 8, n);
 		FbInOverC (src, srca, ma, d, 16, o);
 		d = m|n|o;
-		*dst = cvt8888to0565(d);
+		WRITE(dst, cvt8888to0565(d));
 	    }
 	    dst++;
 	}
     }
+
+    fbFinishAccess (params->mask->pDrawable);
+    fbFinishAccess (params->dest->pDrawable);
 }
 
 void
-fbCompositeSrc_8888x8888 (CARD8      op,
-			 PicturePtr pSrc,
-			 PicturePtr pMask,
-			 PicturePtr pDst,
-			 INT16      xSrc,
-			 INT16      ySrc,
-			 INT16      xMask,
-			 INT16      yMask,
-			 INT16      xDst,
-			 INT16      yDst,
-			 CARD16     width,
-			 CARD16     height)
+fbCompositeSrc_8888x8888 (FbComposeData *params)
 {
     CARD32	*dstLine, *dst, dstMask;
     CARD32	*srcLine, *src, s;
     FbStride	dstStride, srcStride;
     CARD8	a;
-    CARD16	w;
+    CARD16	w, h;
 
-    fbComposeGetStart (pDst, xDst, yDst, CARD32, dstStride, dstLine, 1);
-    fbComposeGetStart (pSrc, xSrc, ySrc, CARD32, srcStride, srcLine, 1);
+    fbComposeGetStart (params->dest, params->xDest, params->yDest, CARD32,
+                       dstStride, dstLine, 1);
+    fbComposeGetStart (params->src, params->xSrc, params->ySrc, CARD32,
+                       srcStride, srcLine, 1);
 
-    dstMask = FbFullMask (pDst->pDrawable->depth);
+    dstMask = FbFullMask (params->dest->pDrawable->depth);
 
-    while (height--)
+    h = params->height;
+    while (h--)
     {
 	dst = dstLine;
 	dstLine += dstStride;
 	src = srcLine;
 	srcLine += srcStride;
-	w = width;
+	w = params->width;
 
 	while (w--)
 	{
-	    s = *src++;
+	    s = READ(src++);
 	    a = s >> 24;
 	    if (a == 0xff)
-		*dst = s & dstMask;
+		WRITE(dst, s & dstMask);
 	    else if (a)
-		*dst = fbOver (s, *dst) & dstMask;
+		WRITE(dst, fbOver (s, READ(dst)) & dstMask);
 	    dst++;
 	}
     }
+
+    fbFinishAccess (params->src->pDrawable);
+    fbFinishAccess (params->dest->pDrawable);
 }
 
 void
-fbCompositeSrc_8888x0888 (CARD8      op,
-			 PicturePtr pSrc,
-			 PicturePtr pMask,
-			 PicturePtr pDst,
-			 INT16      xSrc,
-			 INT16      ySrc,
-			 INT16      xMask,
-			 INT16      yMask,
-			 INT16      xDst,
-			 INT16      yDst,
-			 CARD16     width,
-			 CARD16     height)
+fbCompositeSrc_8888x0888 (FbComposeData *params)
 {
     CARD8	*dstLine, *dst;
     CARD32	d;
     CARD32	*srcLine, *src, s;
     CARD8	a;
     FbStride	dstStride, srcStride;
-    CARD16	w;
+    CARD16	w, h;
 
-    fbComposeGetStart (pDst, xDst, yDst, CARD8, dstStride, dstLine, 3);
-    fbComposeGetStart (pSrc, xSrc, ySrc, CARD32, srcStride, srcLine, 1);
+    fbComposeGetStart (params->dest, params->xDest, params->yDest, CARD8,
+                       dstStride, dstLine, 3);
+    fbComposeGetStart (params->src, params->xSrc, params->ySrc, CARD32,
+                       srcStride, srcLine, 1);
 
-    while (height--)
+    h = params->height;
+    while (h--)
     {
 	dst = dstLine;
 	dstLine += dstStride;
 	src = srcLine;
 	srcLine += srcStride;
-	w = width;
+	w = params->width;
 
 	while (w--)
 	{
-	    s = *src++;
+	    s = READ(src++);
 	    a = s >> 24;
 	    if (a)
 	    {
@@ -519,43 +469,38 @@ fbCompositeSrc_8888x0888 (CARD8      op,
 	    dst += 3;
 	}
     }
+
+    fbFinishAccess (params->src->pDrawable);
+    fbFinishAccess (params->dest->pDrawable);
 }
 
 void
-fbCompositeSrc_8888x0565 (CARD8      op,
-			 PicturePtr pSrc,
-			 PicturePtr pMask,
-			 PicturePtr pDst,
-			 INT16      xSrc,
-			 INT16      ySrc,
-			 INT16      xMask,
-			 INT16      yMask,
-			 INT16      xDst,
-			 INT16      yDst,
-			 CARD16     width,
-			 CARD16     height)
+fbCompositeSrc_8888x0565 (FbComposeData *params)
 {
     CARD16	*dstLine, *dst;
     CARD32	d;
     CARD32	*srcLine, *src, s;
     CARD8	a;
     FbStride	dstStride, srcStride;
-    CARD16	w;
+    CARD16	w, h;
 
-    fbComposeGetStart (pSrc, xSrc, ySrc, CARD32, srcStride, srcLine, 1);
-    fbComposeGetStart (pDst, xDst, yDst, CARD16, dstStride, dstLine, 1);
+    fbComposeGetStart (params->src, params->xSrc, params->ySrc, CARD32,
+                       srcStride, srcLine, 1);
+    fbComposeGetStart (params->dest, params->xDest, params->yDest, CARD16,
+                       dstStride, dstLine, 1);
 
-    while (height--)
+    h = params->height;
+    while (h--)
     {
 	dst = dstLine;
 	dstLine += dstStride;
 	src = srcLine;
 	srcLine += srcStride;
-	w = width;
+	w = params->width;
 
 	while (w--)
 	{
-	    s = *src++;
+	    s = READ(src++);
 	    a = s >> 24;
 	    if (a)
 	    {
@@ -563,143 +508,128 @@ fbCompositeSrc_8888x0565 (CARD8      op,
 		    d = s;
 		else
 		{
-		    d = *dst;
+		    d = READ(dst);
 		    d = fbOver24 (s, cvt0565to8888(d));
 		}
-		*dst = cvt8888to0565(d);
+		WRITE(dst, cvt8888to0565(d));
 	    }
 	    dst++;
 	}
     }
+
+    fbFinishAccess (params->dest->pDrawable);
+    fbFinishAccess (params->src->pDrawable);
 }
 
 void
-fbCompositeSrc_0565x0565 (CARD8      op,
-			  PicturePtr pSrc,
-			  PicturePtr pMask,
-			  PicturePtr pDst,
-			  INT16      xSrc,
-			  INT16      ySrc,
-			  INT16      xMask,
-			  INT16      yMask,
-			  INT16      xDst,
-			  INT16      yDst,
-			  CARD16     width,
-			  CARD16     height)
+fbCompositeSrc_0565x0565 (FbComposeData *params)
 {
     CARD16	*dstLine, *dst;
     CARD16	*srcLine, *src;
     FbStride	dstStride, srcStride;
-    CARD16	w;
+    CARD16	w, h;
 
-    fbComposeGetStart (pSrc, xSrc, ySrc, CARD16, srcStride, srcLine, 1);
+    fbComposeGetStart (params->src, params->xSrc, params->ySrc, CARD16,
+                       srcStride, srcLine, 1);
 
-    fbComposeGetStart (pDst, xDst, yDst, CARD16, dstStride, dstLine, 1);
+    fbComposeGetStart (params->dest, params->xDest, params->yDest, CARD16,
+                       dstStride, dstLine, 1);
 
-    while (height--)
+    h = params->height;
+    while (h--)
     {
 	dst = dstLine;
 	dstLine += dstStride;
 	src = srcLine;
 	srcLine += srcStride;
-	w = width;
+	w = params->width;
 
 	while (w--)
-	    *dst++ = *src++;
+	    WRITE(dst, READ(src++));
     }
+
+    fbFinishAccess (params->dest->pDrawable);
+    fbFinishAccess (params->src->pDrawable);
 }
 
 void
-fbCompositeSrcAdd_8000x8000 (CARD8	op,
-			     PicturePtr pSrc,
-			     PicturePtr pMask,
-			     PicturePtr pDst,
-			     INT16      xSrc,
-			     INT16      ySrc,
-			     INT16      xMask,
-			     INT16      yMask,
-			     INT16      xDst,
-			     INT16      yDst,
-			     CARD16     width,
-			     CARD16     height)
+fbCompositeSrcAdd_8000x8000 (FbComposeData *params)
 {
     CARD8	*dstLine, *dst;
     CARD8	*srcLine, *src;
     FbStride	dstStride, srcStride;
-    CARD16	w;
+    CARD16	w, h;
     CARD8	s, d;
     CARD16	t;
 
-    fbComposeGetStart (pSrc, xSrc, ySrc, CARD8, srcStride, srcLine, 1);
-    fbComposeGetStart (pDst, xDst, yDst, CARD8, dstStride, dstLine, 1);
+    fbComposeGetStart (params->src, params->xSrc, params->ySrc, CARD8,
+                       srcStride, srcLine, 1);
+    fbComposeGetStart (params->dest, params->xDest, params->yDest, CARD8,
+                       dstStride, dstLine, 1);
 
-    while (height--)
+    h = params->height;
+    while (h--)
     {
 	dst = dstLine;
 	dstLine += dstStride;
 	src = srcLine;
 	srcLine += srcStride;
-	w = width;
+	w = params->width;
 
 	while (w--)
 	{
-	    s = *src++;
+	    s = READ(src++);
 	    if (s)
 	    {
 		if (s != 0xff)
 		{
-		    d = *dst;
+		    d = READ(dst);
 		    t = d + s;
 		    s = t | (0 - (t >> 8));
 		}
-		*dst = s;
+		WRITE(dst, s);
 	    }
 	    dst++;
 	}
     }
+
+    fbFinishAccess (params->dest->pDrawable);
+    fbFinishAccess (params->src->pDrawable);
 }
 
 void
-fbCompositeSrcAdd_8888x8888 (CARD8	op,
-			     PicturePtr pSrc,
-			     PicturePtr pMask,
-			     PicturePtr pDst,
-			     INT16      xSrc,
-			     INT16      ySrc,
-			     INT16      xMask,
-			     INT16      yMask,
-			     INT16      xDst,
-			     INT16      yDst,
-			     CARD16     width,
-			     CARD16     height)
+fbCompositeSrcAdd_8888x8888 (FbComposeData *params)
 {
     CARD32	*dstLine, *dst;
     CARD32	*srcLine, *src;
     FbStride	dstStride, srcStride;
-    CARD16	w;
+    CARD16	w, h;
     CARD32	s, d;
     CARD16	t;
     CARD32	m,n,o,p;
 
-    fbComposeGetStart (pSrc, xSrc, ySrc, CARD32, srcStride, srcLine, 1);
-    fbComposeGetStart (pDst, xDst, yDst, CARD32, dstStride, dstLine, 1);
+    fbComposeGetStart (params->src, params->xSrc, params->ySrc, CARD32,
+                       srcStride, srcLine, 1);
+    fbComposeGetStart (params->dest, params->xDest, params->yDest, CARD32,
+                       dstStride, dstLine, 1);
 
-    while (height--)
+    h = params->height;
+    while (h--)
     {
 	dst = dstLine;
 	dstLine += dstStride;
 	src = srcLine;
 	srcLine += srcStride;
-	w = width;
+	w = params->width;
 
 	while (w--)
 	{
-	    s = *src++;
+	    s = READ(src++);
 	    if (s)
 	    {
 		if (s != 0xffffffff)
 		{
-		    d = *dst;
+		    d = READ(dst);
 		    if (d)
 		    {
 			m = FbAdd(s,d,0,t);
@@ -709,26 +639,18 @@ fbCompositeSrcAdd_8888x8888 (CARD8	op,
 			s = m|n|o|p;
 		    }
 		}
-		*dst = s;
+		WRITE(dst, s);
 	    }
 	    dst++;
 	}
     }
+
+    fbFinishAccess (params->dest->pDrawable);
+    fbFinishAccess (params->src->pDrawable);
 }
 
 void
-fbCompositeSrcAdd_1000x1000 (CARD8	op,
-			     PicturePtr pSrc,
-			     PicturePtr pMask,
-			     PicturePtr pDst,
-			     INT16      xSrc,
-			     INT16      ySrc,
-			     INT16      xMask,
-			     INT16      yMask,
-			     INT16      xDst,
-			     INT16      yDst,
-			     CARD16     width,
-			     CARD16     height)
+fbCompositeSrcAdd_1000x1000 (FbComposeData *params)
 {
     FbBits	*dstBits, *srcBits;
     FbStride	dstStride, srcStride;
@@ -736,20 +658,22 @@ fbCompositeSrcAdd_1000x1000 (CARD8	op,
     int		dstXoff, dstYoff;
     int		srcXoff, srcYoff;
 
-    fbGetDrawable(pSrc->pDrawable, srcBits, srcStride, srcBpp, srcXoff, srcYoff);
+    fbGetDrawable(params->src->pDrawable, srcBits, srcStride, srcBpp,
+                  srcXoff, srcYoff);
 
-    fbGetDrawable(pDst->pDrawable, dstBits, dstStride, dstBpp, dstXoff, dstYoff);
+    fbGetDrawable(params->dest->pDrawable, dstBits, dstStride, dstBpp,
+                  dstXoff, dstYoff);
 
-    fbBlt (srcBits + srcStride * (ySrc + srcYoff),
+    fbBlt (srcBits + srcStride * (params->ySrc + srcYoff),
 	   srcStride,
-	   xSrc + srcXoff,
+	   params->xSrc + srcXoff,
 
-	   dstBits + dstStride * (yDst + dstYoff),
+	   dstBits + dstStride * (params->yDest + dstYoff),
 	   dstStride,
-	   xDst + dstXoff,
+	   params->xDest + dstXoff,
 
-	   width,
-	   height,
+	   params->width,
+	   params->height,
 
 	   GXor,
 	   FB_ALLONES,
@@ -757,21 +681,13 @@ fbCompositeSrcAdd_1000x1000 (CARD8	op,
 
 	   FALSE,
 	   FALSE);
+
+    fbFinishAccess(params->dest->pDrawable);
+    fbFinishAccess(params->src->pDrawable);
 }
 
 void
-fbCompositeSolidMask_nx1xn (CARD8      op,
-			    PicturePtr pSrc,
-			    PicturePtr pMask,
-			    PicturePtr pDst,
-			    INT16      xSrc,
-			    INT16      ySrc,
-			    INT16      xMask,
-			    INT16      yMask,
-			    INT16      xDst,
-			    INT16      yDst,
-			    CARD16     width,
-			    CARD16     height)
+fbCompositeSolidMask_nx1xn (FbComposeData *params)
 {
     FbBits	*dstBits;
     FbStip	*maskBits;
@@ -781,17 +697,17 @@ fbCompositeSolidMask_nx1xn (CARD8      op,
     int		maskXoff, maskYoff;
     FbBits	src;
 
-    fbComposeGetSolid(pSrc, src, pDst->format);
+    fbComposeGetSolid(params->src, src, params->dest->format);
 
     if ((src & 0xff000000) != 0xff000000)
     {
-	fbCompositeGeneral  (op, pSrc, pMask, pDst,
-			     xSrc, ySrc, xMask, yMask, xDst, yDst,
-			     width, height);
+	fbCompositeGeneral (params);
 	return;
     }
-    fbGetStipDrawable (pMask->pDrawable, maskBits, maskStride, maskBpp, maskXoff, maskYoff);
-    fbGetDrawable (pDst->pDrawable, dstBits, dstStride, dstBpp, dstXoff, dstYoff);
+    fbGetStipDrawable (params->mask->pDrawable, maskBits, maskStride,
+                       maskBpp, maskXoff, maskYoff);
+    fbGetDrawable (params->dest->pDrawable, dstBits, dstStride, dstBpp,
+                   dstXoff, dstYoff);
 
     switch (dstBpp) {
     case 32:
@@ -805,51 +721,877 @@ fbCompositeSolidMask_nx1xn (CARD8      op,
 
     src = fbReplicatePixel (src, dstBpp);
 
-    fbBltOne (maskBits + maskStride * (yMask + maskYoff),
+    fbBltOne (maskBits + maskStride * (params->yMask + maskYoff),
 	      maskStride,
-	      xMask + maskXoff,
+	      params->xMask + maskXoff,
 
-	      dstBits + dstStride * (yDst + dstYoff),
+	      dstBits + dstStride * (params->yDest + dstYoff),
 	      dstStride,
-	      (xDst + dstXoff) * dstBpp,
+	      (params->xDest + dstXoff) * dstBpp,
 	      dstBpp,
 
-	      width * dstBpp,
-	      height,
+	      params->width * dstBpp,
+	      params->height,
 
 	      0x0,
 	      src,
 	      FB_ALLONES,
 	      0x0);
+
+    fbFinishAccess (params->dest->pDrawable);
+    fbFinishAccess (params->mask->pDrawable);
+}
+
+static Bool
+fbCompositeCopyArea_internal (DrawablePtr  pSrc,
+           DrawablePtr  pDst,
+           int      src_x,
+           int      src_y,
+           int      dst_x,
+           int      dst_y,
+           int      width,
+           int      height)
+{
+    FbBits *    src_bits;
+    FbStride    src_stride;
+    int     src_bpp;
+    int     src_xoff;
+    int     src_yoff;
+
+    FbBits *    dst_bits;
+    FbStride    dst_stride;
+    int     dst_bpp;
+    int     dst_xoff;
+    int     dst_yoff;
+
+    CARD8 * src_bytes;
+    CARD8 * dst_bytes;
+    int     byte_width;
+
+    fbGetDrawable(pSrc, src_bits, src_stride, src_bpp, src_xoff, src_yoff);
+    fbGetDrawable(pDst, dst_bits, dst_stride, dst_bpp, dst_xoff, dst_yoff);
+
+    if (src_bpp != dst_bpp) return FALSE;
+
+    if (src_bpp == 8)
+    {
+        src_stride = src_stride * sizeof (FbBits) / 1;
+        dst_stride = dst_stride * sizeof (FbBits) / 1;
+        src_bytes = (CARD8 *)(((CARD8 *)src_bits) + src_stride * (src_y + src_yoff) + (src_x + src_xoff));
+        dst_bytes = (CARD8 *)(((CARD8 *)dst_bits) + dst_stride * (dst_y + dst_yoff) + (dst_x + dst_xoff));
+        byte_width = 1 * width;
+        src_stride *= 1;
+        dst_stride *= 1;
+    } else if (src_bpp == 16)
+    {
+        src_stride = src_stride * sizeof (FbBits) / 2;
+        dst_stride = dst_stride * sizeof (FbBits) / 2;
+        src_bytes = (CARD8 *)(((CARD16 *)src_bits) + src_stride * (src_y + src_yoff) + (src_x + src_xoff));
+        dst_bytes = (CARD8 *)(((CARD16 *)dst_bits) + dst_stride * (dst_y + dst_yoff) + (dst_x + dst_xoff));
+        byte_width = 2 * width;
+        src_stride *= 2;
+        dst_stride *= 2;
+    } else if (src_bpp == 32) {
+        src_stride = src_stride * sizeof (FbBits) / 4;
+        dst_stride = dst_stride * sizeof (FbBits) / 4;
+        src_bytes = (CARD8 *)(((CARD32 *)src_bits) + src_stride * (src_y + src_yoff) + (src_x + src_xoff));
+        dst_bytes = (CARD8 *)(((CARD32 *)dst_bits) + dst_stride * (dst_y + dst_yoff) + (dst_x + dst_xoff));
+        byte_width = 4 * width;
+        src_stride *= 4;
+        dst_stride *= 4;
+    } else {
+        return FALSE;
+    }
+
+    while (height--)
+    {
+        int w;
+        CARD8 *s = src_bytes;
+        CARD8 *d = dst_bytes;
+        src_bytes += src_stride;
+        dst_bytes += dst_stride;
+        w = byte_width;
+
+        MEMCPY_WRAPPED(d, s, w);
+    }
+
+    return TRUE;
+}
+
+static void
+fbCompositeCopyArea (FbComposeData *params)
+{
+    fbCompositeCopyArea_internal (params->src->pDrawable,
+           params->dest->pDrawable,
+           params->xSrc, params->ySrc,
+           params->xDest, params->yDest,
+           params->width, params->height);
+}
+
+void
+fbCompositeSrc_8888RevNPx0565 (FbComposeData *params)
+{
+    CARD16	*dstLine, *dst;
+    CARD32	d;
+    CARD32	*srcLine, *src, s;
+    CARD8	a;
+    FbStride	dstStride, srcStride;
+    CARD16	w, h;
+
+    fbComposeGetStart (params->src, params->xSrc, params->ySrc, CARD32,
+                       srcStride, srcLine, 1);
+    fbComposeGetStart (params->dest, params->xDest, params->yDest, CARD16,
+                       dstStride, dstLine, 1);
+
+    h = params->height;
+    while (h--)
+    {
+        dst = dstLine;
+        dstLine += dstStride;
+        src = srcLine;
+        srcLine += srcStride;
+        w = params->width;
+
+        while (w--)
+        {
+            s = READ(src++);
+            a = s >> 24;
+            if (a)
+            {
+                if (a == 0xff)
+                    d = ((s & 0xFF) << 16) | (s & 0xFF00) | ((s & 0xFF0000) >> 16);
+                else
+                {
+                    s = fbIn(((s & 0xFF) << 16) | (s & 0xFF00) | ((s & 0xFF0000) >> 16), a) | (a << 24);
+                    d = READ(dst);
+                    d = fbOver24 (s, cvt0565to8888(d));
+                }
+                WRITE(dst, cvt8888to0565(d));
+            }
+            dst++;
+        }
+    }
+
+    fbFinishAccess (params->dest->pDrawable);
+    fbFinishAccess (params->src->pDrawable);
+}
+
+/* Check if we have faster ARMv6 optimized versions of these macros */
+#ifdef FbByteMulAdd_store_r5g6b5_armv6
+#undef FbByteMulAdd_store_r5g6b5
+#define FbByteMulAdd_store_r5g6b5(x, a, y) FbByteMulAdd_store_r5g6b5_armv6(x, a, y)
+#endif
+
+#ifdef FbByteMulAdd_store_x8r8g8b8_armv6
+#undef FbByteMulAdd_store_x8r8g8b8
+#define FbByteMulAdd_store_x8r8g8b8(x, a, y) FbByteMulAdd_store_x8r8g8b8_armv6(x, a, y)
+#endif
+
+void
+fbComposite_a8r8g8b8_over_x8r8g8b8 (FbComposeData *params)
+{
+    CARD32	*dstLine, *dst;
+    CARD32	*srcLine, *src, s1, s2, d;
+    FbStride	dstStride, srcStride;
+    CARD8	a1, a2;
+    int	w, h;
+
+    fbComposeGetStart (params->dest, params->xDest, params->yDest, CARD32,
+                       dstStride, dstLine, 1);
+    fbComposeGetStart (params->src, params->xSrc, params->ySrc, CARD32,
+                       srcStride, srcLine, 1);
+
+    h = params->height;
+    while (h--)
+    {
+        dst = dstLine;
+        dstLine += dstStride;
+        src = srcLine;
+        srcLine += srcStride;
+        w = params->width;
+
+        while ((w -= 2) >= 0)
+        {
+            s1 = READ(src++);
+            s2 = READ(src++);
+            a1 = s1 >> 24;
+            a2 = s2 >> 24;
+            if (a1)
+            {
+                if (a1 == 0xff)
+                    WRITE(dst, s1 & 0xffffff);
+                else if (a1) {
+                    d = READ(dst);
+                    a1 ^= 0xff;
+                    FbByteMulAdd_store_x8r8g8b8(d, a1, s1);
+                    WRITE(dst, d);
+                }
+            }
+            dst++;
+            if (a2)
+            {
+                if (a2 == 0xff)
+                    WRITE(dst, s2 & 0xffffff);
+                else if (a2) {
+                    d = READ(dst);
+                    a2 ^= 0xff;
+                    FbByteMulAdd_store_x8r8g8b8(d, a2, s2);
+                    WRITE(dst, d);
+                }
+            }
+            dst++;
+        }
+        if (w & 1)
+        {
+            s1 = READ(src++);
+            a1 = s1 >> 24;
+            if (a1)
+            {
+                if (a1 == 0xff)
+                    WRITE(dst, s1 & 0xffffff);
+                else if (a1) {
+                    d = READ(dst);
+                    a1 ^= 0xff;
+                    FbByteMulAdd_store_x8r8g8b8(d, a1, s1);
+                    WRITE(dst, d);
+                }
+            }
+            dst++;
+        }
+    }
+
+    fbFinishAccess (params->src->pDrawable);
+    fbFinishAccess (params->dest->pDrawable);
+}
+
+void
+fbComposite_a8r8g8b8_over_r5g6b5 (FbComposeData *params)
+{
+    CARD16	*dstLine, *dst;
+    CARD32	d;
+    CARD32	*srcLine, *src, s1, s2;
+    CARD8	a1, a2;
+    FbStride	dstStride, srcStride;
+    int 	w, h;
+
+    fbComposeGetStart (params->src, params->xSrc, params->ySrc, CARD32,
+                       srcStride, srcLine, 1);
+    fbComposeGetStart (params->dest, params->xDest, params->yDest, CARD16,
+                       dstStride, dstLine, 1);
+
+    h = params->height;
+    while (h--)
+    {
+        dst = dstLine;
+        dstLine += dstStride;
+        src = srcLine;
+        srcLine += srcStride;
+        w = params->width;
+
+        while ((w -= 2) >= 0)
+        {
+            s1 = READ(src++);
+            s2 = READ(src++);
+            a1 = s1 >> 24;
+            a2 = s2 >> 24;
+            if (a1)
+            {
+                if (a1 == 0xff)
+                    d = cvt8888to0565(s1);
+                else
+                {
+                    d = cvt0565to8888(READ(dst));
+                    a1 ^= 0xff;
+                    FbByteMulAdd_store_r5g6b5(d, a1, s1);
+                }
+                WRITE(dst, d);
+            }
+            dst++;
+            if (a2)
+            {
+                if (a2 == 0xff)
+                    d = cvt8888to0565(s2);
+                else
+                {
+                    d = cvt0565to8888(READ(dst));
+                    a2 ^= 0xff;
+                    FbByteMulAdd_store_r5g6b5(d, a2, s2);
+                }
+                WRITE(dst, d);
+            }
+            dst++;
+        }
+        if (w & 1)
+        {
+            s1 = READ(src++);
+            a1 = s1 >> 24;
+            if (a1)
+            {
+                if (a1 == 0xff)
+                    d = cvt8888to0565(s1);
+                else
+                {
+                    d = cvt0565to8888(READ(dst));
+                    a1 ^= 0xff;
+                    FbByteMulAdd_store_r5g6b5(d, a1, s1);
+                }
+                WRITE(dst, d);
+            }
+            dst++;
+        }
+    }
+
+    fbFinishAccess (params->dest->pDrawable);
+    fbFinishAccess (params->src->pDrawable);
+}
+
+void fbCompositeTransformNearestNonrotatedAffineTrivialclip_a8r8g8b8_over_x8r8g8b8 (FbComposeData *params,
+    FbBits *bits, int stride, CARD32 vv0, CARD32 vv1, CARD32 uv0, CARD32 uv1)
+{
+    CARD32  *dstLine, *dst;
+    CARD32  d;
+    CARD32  s1, s2;
+    FbStride    dstStride;
+    CARD8   a1, a2;
+    int w, h;
+    FbBits *xbits;
+    int x1, x2, y;
+    CARD32 orig_vv0 = vv0;
+
+    BoxRec box = params->src->pCompositeClip->extents;
+
+    fbComposeGetStart (params->dest, params->xDest, params->yDest, CARD32, dstStride, dstLine, 1);
+
+    h = params->height;
+    while (h--)
+    {
+        dst = dstLine;
+        dstLine += dstStride;
+
+        y = vv1 >> 16;
+        vv1 += uv1;
+
+        if ((y < box.y1) || (y >= box.y2)) {
+            continue;
+        }
+
+        xbits = bits + stride * y;
+
+        w = params->width;
+        vv0 = orig_vv0;
+        while ((w -= 2) >= 0)
+        {
+            x1 = vv0 >> 16;
+            vv0 += uv0;
+            s1 = READ((CARD32 *)xbits + x1);
+
+            x2 = vv0 >> 16;
+            vv0 += uv0;
+            s2 = READ((CARD32 *)xbits + x2);
+
+            a1 = s1 >> 24;
+            a2 = s2 >> 24;
+
+            if (a1 == 0xff)
+                WRITE(dst, s1 & 0xffffff);
+            else if (a1) {
+                d = READ(dst);
+                a1 ^= 0xff;
+                FbByteMulAdd_store_x8r8g8b8(d, a1, s1);
+                WRITE(dst, d);
+            }
+            dst++;
+
+            if (a2 == 0xff)
+                WRITE(dst, s2 & 0xffffff);
+            else if (a2) {
+                d = READ(dst);
+                a2 ^= 0xff;
+                FbByteMulAdd_store_x8r8g8b8(d, a2, s2);
+                WRITE(dst, d);
+            }
+            dst++;
+        }
+        if (w & 1) {
+            x1 = vv0 >> 16;
+            vv0 += uv0;
+            s1 = READ((CARD32 *)xbits + x1);
+
+            a1 = s1 >> 24;
+            if (a1 == 0xff)
+                WRITE(dst, s1 & 0xffffff);
+            else if (a1) {
+                d = READ(dst);
+                a1 ^= 0xff;
+                FbByteMulAdd_store_x8r8g8b8(d, a1, s1);
+                WRITE(dst, d);
+            }
+            dst++;
+        }
+    }
+
+    fbFinishAccess (params->src->pDrawable);
+    fbFinishAccess (params->dest->pDrawable);
+}
+
+void fbCompositeTransformNearestNonrotatedAffineTrivialclipRepeat_a8r8g8b8_over_x8r8g8b8 (FbComposeData *params,
+    FbBits *bits, int stride, CARD32 vv0, CARD32 vv1, CARD32 uv0, CARD32 uv1)
+{
+    CARD32  *dstLine, *dst;
+    CARD32 d;
+    CARD32  s;
+    FbStride    dstStride;
+    CARD8   a;
+    CARD16  w, h;
+    FbBits *xbits;
+    int x, y;
+    CARD32 orig_vv0 = vv0;
+    CARD32 max_vv0, max_vv1;
+
+    fbComposeGetStart (params->dest, params->xDest, params->yDest, CARD32, dstStride, dstLine, 1);
+
+    max_vv0 = params->src->pDrawable->width << 16;
+    max_vv1 = params->src->pDrawable->height << 16;
+
+    while (orig_vv0 >= max_vv0) orig_vv0 -= max_vv0;
+    while (vv1 >= max_vv1) vv1 -= max_vv1;
+
+    h = params->height;
+    while (h--)
+    {
+        dst = dstLine;
+        dstLine += dstStride;
+
+        y = vv1 >> 16;
+        vv1 += uv1;
+        while (vv1 >= max_vv1) vv1 -= max_vv1;
+
+        xbits = bits + stride * y;
+
+        w = params->width;
+        vv0 = orig_vv0;
+        while (w--)
+        {
+            x = vv0 >> 16;
+            s = READ((CARD32 *)xbits + x);
+            vv0 += uv0;
+            while (vv0 >= max_vv0) vv0 -= max_vv0;
+
+            a = s >> 24;
+            if (a == 0xff)
+                WRITE(dst, s & 0xffffff);
+            else if (a) {
+                d = READ(dst);
+                a ^= 0xff;
+                FbByteMulAdd_store_x8r8g8b8(d, a, s);
+                WRITE(dst, d);
+            }
+            dst++;
+        }
+    }
+
+    fbFinishAccess (params->src->pDrawable);
+    fbFinishAccess (params->dest->pDrawable);
+}
+
+void fbCompositeTransformNearestNonrotatedAffineTrivialclip_a8r8g8b8_over_r5g6b5 (FbComposeData *params,
+    FbBits *bits, int stride, CARD32 vv0, CARD32 vv1, CARD32 uv0, CARD32 uv1)
+{
+    CARD16  *dstLine, *dst;
+    CARD32 d;
+    CARD32  s1, s2;
+    FbStride    dstStride;
+    CARD8   a1, a2;
+    int  w, h;
+    FbBits *xbits;
+    int x1, x2, y;
+    CARD32 orig_vv0 = vv0;
+
+    BoxRec box = params->src->pCompositeClip->extents;
+
+    fbComposeGetStart (params->dest, params->xDest, params->yDest, CARD16, dstStride, dstLine, 1);
+
+    h = params->height;
+    while (h--)
+    {
+        dst = dstLine;
+        dstLine += dstStride;
+
+        y = vv1 >> 16;
+        vv1 += uv1;
+
+        if ((y < box.y1) || (y >= box.y2)) {
+            continue;
+        }
+
+        xbits = bits + stride * y;
+
+        w = params->width;
+        vv0 = orig_vv0;
+        while ((w -= 2) >= 0)
+        {
+            x1 = vv0 >> 16;
+            vv0 += uv0;
+            s1 = READ((CARD32 *)xbits + x1);
+            x2 = vv0 >> 16;
+            vv0 += uv0;
+            s2 = READ((CARD32 *)xbits + x2);
+
+            a1 = s1 >> 24;
+            a2 = s2 >> 24;
+
+            if (a1)
+            {
+                if (a1 == 0xff)
+                    d = cvt8888to0565(s1);
+                else
+                {
+                    d = cvt0565to8888(READ(dst));
+                    a1 ^= 0xff;
+                    FbByteMulAdd_store_r5g6b5(d, a1, s1);
+                }
+                WRITE(dst, d);
+            }
+            dst++;
+
+            if (a2)
+            {
+                if (a2 == 0xff)
+                    d = cvt8888to0565(s2);
+                else
+                {
+                    d = cvt0565to8888(READ(dst));
+                    a2 ^= 0xff;
+                    FbByteMulAdd_store_r5g6b5(d, a2, s2);
+                }
+                WRITE(dst, d);
+            }
+            dst++;
+        }
+        if (w & 1)
+        {
+            x1 = vv0 >> 16;
+            s1 = READ((CARD32 *)xbits + x1);
+            vv0 += uv0;
+
+            a1 = s1 >> 24;
+            if (a1)
+            {
+                if (a1 == 0xff)
+                    d = cvt8888to0565(s1);
+                else
+                {
+                    d = cvt0565to8888(READ(dst));
+                    a1 ^= 0xff;
+                    FbByteMulAdd_store_r5g6b5(d, a1, s1);
+                }
+                WRITE(dst, d);
+            }
+            dst++;
+        }
+    }
+
+    fbFinishAccess (params->src->pDrawable);
+    fbFinishAccess (params->dest->pDrawable);
+}
+
+void fbCompositeTransformNearestNonrotatedAffineTrivialclipRepeat_a8r8g8b8_over_r5g6b5 (FbComposeData *params,
+    FbBits *bits, int stride, CARD32 vv0, CARD32 vv1, CARD32 uv0, CARD32 uv1)
+{
+    CARD16  *dstLine, *dst;
+    CARD32 d;
+    CARD32  s;
+    FbStride    dstStride;
+    CARD8   a;
+    CARD16  w, h;
+    FbBits *xbits;
+    int x, y;
+    CARD32 orig_vv0 = vv0;
+    CARD32 max_vv0, max_vv1;
+
+    fbComposeGetStart (params->dest, params->xDest, params->yDest, CARD16, dstStride, dstLine, 1);
+
+    max_vv0 = params->src->pDrawable->width << 16;
+    max_vv1 = params->src->pDrawable->height << 16;
+
+    while (orig_vv0 >= max_vv0) orig_vv0 -= max_vv0;
+    while (vv1 >= max_vv1) vv1 -= max_vv1;
+
+    h = params->height;
+    while (h--)
+    {
+        dst = dstLine;
+        dstLine += dstStride;
+
+        y = vv1 >> 16;
+        vv1 += uv1;
+        while (vv1 >= max_vv1) vv1 -= max_vv1;
+
+        xbits = bits + stride * y;
+
+        w = params->width;
+        vv0 = orig_vv0;
+        while (w--)
+        {
+            x = vv0 >> 16;
+            s = READ((CARD32 *)xbits + x);
+            vv0 += uv0;
+            while (vv0 >= max_vv0) vv0 -= max_vv0;
+
+            a = s >> 24;
+            if (a)
+            {
+                if (a == 0xff)
+                    d = cvt8888to0565(s);
+                else
+                {
+                    d = cvt0565to8888(READ(dst));
+                    a ^= 0xff;
+                    FbByteMulAdd_store_r5g6b5(d, a, s);
+                }
+                WRITE(dst, d);
+            }
+            dst++;
+        }
+    }
+
+    fbFinishAccess (params->src->pDrawable);
+    fbFinishAccess (params->dest->pDrawable);
+}
+
+void fbCompositeTransformNearestNonrotatedAffineTrivialclip_r5g6b5_src_r5g6b5 (FbComposeData *params,
+    FbBits *bits, int stride, CARD32 vv0, CARD32 vv1, CARD32 uv0, CARD32 uv1)
+{
+    CARD16  *dstLine, *dst;
+    CARD16 d1, d2;
+    FbStride    dstStride;
+    int  w, h;
+    FbBits *xbits;
+    int x1, x2, y;
+    CARD32 orig_vv0 = vv0;
+
+    BoxRec box = params->src->pCompositeClip->extents;
+
+    fbComposeGetStart (params->dest, params->xDest, params->yDest, CARD16, dstStride, dstLine, 1);
+
+    h = params->height;
+    while (h--)
+    {
+        dst = dstLine;
+        dstLine += dstStride;
+
+        y = vv1 >> 16;
+        vv1 += uv1;
+
+        if ((y < box.y1) || (y >= box.y2)) {
+            continue;
+        }
+
+        xbits = bits + stride * y;
+
+        w = params->width;
+        vv0 = orig_vv0;
+
+        while ((w -= 2) >= 0)
+        {
+            x1 = vv0 >> 16;
+            vv0 += uv0;
+            d1 = READ((CARD16 *)xbits + x1);
+            x2 = vv0 >> 16;
+            vv0 += uv0;
+            d2 = READ((CARD16 *)xbits + x2);
+            WRITE(dst++, d1);
+            WRITE(dst++, d2);
+        }
+        if (w & 1)
+        {
+            x1 = vv0 >> 16;
+            vv0 += uv0;
+            WRITE(dst++, READ((CARD16 *)xbits + x1));
+        }
+    }
+
+    fbFinishAccess (params->src->pDrawable);
+    fbFinishAccess (params->dest->pDrawable);
+}
+
+void fbCompositeTransformNearestNonrotatedAffineTrivialclipRepeat_r5g6b5_src_r5g6b5 (FbComposeData *params,
+    FbBits *bits, int stride, CARD32 vv0, CARD32 vv1, CARD32 uv0, CARD32 uv1)
+{
+    CARD16  *dstLine, *dst;
+    FbStride    dstStride;
+    CARD16  w, h;
+    FbBits *xbits;
+    int x, y;
+    CARD32 orig_vv0 = vv0;
+    CARD32 max_vv0, max_vv1;
+
+    fbComposeGetStart (params->dest, params->xDest, params->yDest, CARD16, dstStride, dstLine, 1);
+
+    max_vv0 = params->src->pDrawable->width << 16;
+    max_vv1 = params->src->pDrawable->height << 16;
+
+    while (orig_vv0 >= max_vv0) orig_vv0 -= max_vv0;
+    while (vv1 >= max_vv1) vv1 -= max_vv1;
+
+    h = params->height;
+    while (h--)
+    {
+        dst = dstLine;
+        dstLine += dstStride;
+
+        y = vv1 >> 16;
+        vv1 += uv1;
+        while (vv1 >= max_vv1) vv1 -= max_vv1;
+
+        xbits = bits + stride * y;
+
+        w = params->width;
+        vv0 = orig_vv0;
+        while (w--)
+        {
+            x = vv0 >> 16;
+            vv0 += uv0;
+            while (vv0 >= max_vv0) vv0 -= max_vv0;
+            WRITE(dst++, READ((CARD16 *)xbits + x));
+        }
+    }
+
+    fbFinishAccess (params->src->pDrawable);
+    fbFinishAccess (params->dest->pDrawable);
+}
+
+/**
+ * Check if the clipping boundary is crossed on horizontal scaling
+ */
+static int fbTransformVerifyHorizontalClipping(PicturePtr pict, int width, CARD32 vv0, CARD32 uv0)
+{
+    BoxRec box = pict->pCompositeClip->extents;
+
+    while (--width >= 0) {
+        int x = vv0 >> 16;
+        if ((x < box.x1) || (x >= box.x2)) return 1;
+        vv0 += uv0;
+    }
+
+    return 0;
+}
+
+/**
+ * Easy case of transform without rotation or complicated clipping
+ */
+void fbCompositeTransformNonrotatedAffineTrivialclip (FbComposeData *params)
+{
+    PictVector  v;
+    PictVector  unit;
+    int         bpp;
+    int         xoff, yoff, x = params->xSrc, y = params->ySrc;
+    FbBits     *bits;
+    FbStride    stride;
+
+    if (params->src->pDrawable->x || params->src->pDrawable->y) {
+        /* fallback to general case */
+        fbCompositeGeneral(params);
+        return;
+    }
+
+    fbGetDrawable(params->src->pDrawable, bits, stride, bpp, xoff, yoff);
+    x += xoff;
+    y += yoff;
+
+    /* reference point is the center of the pixel */
+    v.vector[0] = IntToxFixed(x) + xFixed1/2;
+    v.vector[1] = IntToxFixed(y) + xFixed1/2;
+    v.vector[2] = xFixed1;
+
+    PictureTransformPoint3d (params->src->transform, &v);
+    
+    if (v.vector[2] != xFixed1) {
+        fbFinishAccess (params->src->pDrawable);
+        fbCompositeGeneral(params);
+        return;
+    }
+
+    unit.vector[0] = params->src->transform->matrix[0][0];
+    unit.vector[1] = params->src->transform->matrix[1][1];
+
+    if (params->src->repeat == RepeatNone
+        && fbTransformVerifyHorizontalClipping(params->src, params->width, v.vector[0], unit.vector[0])) {
+        fbFinishAccess (params->src->pDrawable);
+        fbCompositeGeneral(params);
+        return;
+    }
+
+    if (params->op == PictOpSrc && params->src->format == PICT_r5g6b5 && params->dest->format == PICT_r5g6b5) {
+        if (params->src->filter == PictFilterNearest && params->src->repeat == RepeatNone) {
+            fbCompositeTransformNearestNonrotatedAffineTrivialclip_r5g6b5_src_r5g6b5(params,
+                bits, stride, v.vector[0], v.vector[1], unit.vector[0], unit.vector[1]);
+            return;
+        }
+        if (params->src->filter == PictFilterNearest && params->src->repeat == RepeatNormal) {
+            fbCompositeTransformNearestNonrotatedAffineTrivialclipRepeat_r5g6b5_src_r5g6b5(params,
+                bits, stride, v.vector[0], v.vector[1], unit.vector[0], unit.vector[1]);
+            return;
+        }
+    }
+
+    if (params->op == PictOpOver && params->src->format == PICT_a8r8g8b8 && params->dest->format == PICT_r5g6b5) {
+        if (params->src->filter == PictFilterNearest && params->src->repeat == RepeatNone) {
+            fbCompositeTransformNearestNonrotatedAffineTrivialclip_a8r8g8b8_over_r5g6b5(params,
+                bits, stride, v.vector[0], v.vector[1], unit.vector[0], unit.vector[1]);
+            return;
+        }
+        if (params->src->filter == PictFilterNearest && params->src->repeat == RepeatNormal) {
+            fbCompositeTransformNearestNonrotatedAffineTrivialclipRepeat_a8r8g8b8_over_r5g6b5(params,
+                bits, stride, v.vector[0], v.vector[1], unit.vector[0], unit.vector[1]);
+            return;
+        }
+    }
+
+    if (params->op == PictOpOver && params->src->format == PICT_a8r8g8b8 && params->dest->format == PICT_x8r8g8b8) {
+        if (params->src->filter == PictFilterNearest && params->src->repeat == RepeatNone) {
+            fbCompositeTransformNearestNonrotatedAffineTrivialclip_a8r8g8b8_over_x8r8g8b8(params,
+                bits, stride, v.vector[0], v.vector[1], unit.vector[0], unit.vector[1]);
+            return;
+        }
+        if (params->src->filter == PictFilterNearest && params->src->repeat == RepeatNormal) {
+            fbCompositeTransformNearestNonrotatedAffineTrivialclipRepeat_a8r8g8b8_over_x8r8g8b8(params,
+                bits, stride, v.vector[0], v.vector[1], unit.vector[0], unit.vector[1]);
+            return;
+        }
+    }
+
+    fbFinishAccess (params->src->pDrawable);
+    fbCompositeGeneral(params);
 }
 
 # define mod(a,b)	((b) == 1 ? 0 : (a) >= 0 ? (a) % (b) : (b) - (-a) % (b))
 
 void
-fbComposite (CARD8      op,
+fbComposite (int      op,
 	     PicturePtr pSrc,
 	     PicturePtr pMask,
 	     PicturePtr pDst,
-	     INT16      xSrc,
-	     INT16      ySrc,
-	     INT16      xMask,
-	     INT16      yMask,
-	     INT16      xDst,
-	     INT16      yDst,
-	     CARD16     width,
-	     CARD16     height)
+	     int      xSrc,
+	     int      ySrc,
+	     int      xMask,
+	     int      yMask,
+	     int      xDst,
+	     int      yDst,
+	     int     width,
+	     int     height)
 {
     RegionRec	    region;
     int		    n;
     BoxPtr	    pbox;
     CompositeFunc   func = NULL;
+    FbComposeData   params;
     Bool	    srcRepeat = pSrc->pDrawable && pSrc->repeat;
     Bool	    maskRepeat = FALSE;
     Bool	    srcAlphaMap = pSrc->alphaMap != 0;
     Bool	    maskAlphaMap = FALSE;
     Bool	    dstAlphaMap = pDst->alphaMap != 0;
-    int		    x_msk, y_msk, x_src, y_src, x_dst, y_dst;
-    int		    w, h, w_this, h_this;
+    int		    w, h;
 
 #ifdef USE_MMX
     static Bool mmx_setup = FALSE;
@@ -880,6 +1622,10 @@ fbComposite (CARD8      op,
         && (!pMask || pMask->filter != PictFilterConvolution))
     switch (op) {
     case PictOpSrc:
+	if (!pMask && pSrc->format == pDst->format && pSrc->pDrawable != pDst->pDrawable)
+	{
+	    func = fbCompositeCopyArea;
+	}
 #ifdef USE_MMX
 	if (!pMask && pSrc->format == pDst->format &&
 	    pSrc->format != PICT_a8 && pSrc->pDrawable != pDst->pDrawable)
@@ -887,6 +1633,12 @@ fbComposite (CARD8      op,
 	    func = fbCompositeCopyAreammx;
 	}
 #endif
+#ifdef USE_ARMV6
+	if (!pMask && pSrc->format == PICT_x8r8g8b8 && pDst->format == PICT_r5g6b5)
+	{
+        func = fbComposite_x8r8g8b8_src_r5g6b5_armv6;
+    }
+#endif
 	break;
     case PictOpOver:
 	if (pMask)
@@ -901,12 +1653,14 @@ fbComposite (CARD8      op,
 			switch (pDst->format) {
 			case PICT_r5g6b5:
 			case PICT_b5g6r5:
+			    func = fbCompositeSolidMask_nx8x0565;
 #ifdef USE_MMX
 			    if (fbHaveMMX())
 				func = fbCompositeSolidMask_nx8x0565mmx;
-			    else
 #endif
-				func = fbCompositeSolidMask_nx8x0565;
+#ifdef USE_ARMV6
+			    func = fbCompositeSolidMask_nx8x0565_armv6;
+#endif
 			    break;
 			case PICT_r8g8b8:
 			case PICT_b8g8r8:
@@ -1021,6 +1775,7 @@ fbComposite (CARD8      op,
 #endif
 				break;
 			    case PICT_r5g6b5:
+				func = fbCompositeSrc_8888RevNPx0565;
 #ifdef USE_MMX
 				if (fbHaveMMX())
 				    func = fbCompositeSrc_8888RevNPx0565mmx;
@@ -1118,7 +1873,7 @@ fbComposite (CARD8      op,
 		    break;
 		}
 	    }
-	    else if (! srcRepeat)
+	    else
 	    {
 		switch (pSrc->format) {
 		case PICT_a8r8g8b8:
@@ -1130,13 +1885,13 @@ fbComposite (CARD8      op,
 			    func = fbCompositeSrc_8888x8888mmx;
 			else
 #endif
-			    func = fbCompositeSrc_8888x8888;
+			    func = fbComposite_a8r8g8b8_over_x8r8g8b8;
 			break;
 		    case PICT_r8g8b8:
 			func = fbCompositeSrc_8888x0888;
 			break;
 		    case PICT_r5g6b5:
-			func = fbCompositeSrc_8888x0565;
+			func = fbComposite_a8r8g8b8_over_r5g6b5;
 			break;
 		    default:
 			break;
@@ -1176,13 +1931,13 @@ fbComposite (CARD8      op,
 			    func = fbCompositeSrc_8888x8888mmx;
 			else
 #endif
-			    func = fbCompositeSrc_8888x8888;
+			    func = fbComposite_a8r8g8b8_over_x8r8g8b8;
 			break;
 		    case PICT_b8g8r8:
 			func = fbCompositeSrc_8888x0888;
 			break;
 		    case PICT_b5g6r5:
-			func = fbCompositeSrc_8888x0565;
+			func = fbComposite_a8r8g8b8_over_r5g6b5;
 			break;
 		    default:
 			break;
@@ -1247,12 +2002,12 @@ fbComposite (CARD8      op,
 	    case PICT_a8:
 		switch (pDst->format) {
 		case PICT_a8:
+		    func = fbCompositeSrcAdd_8000x8000_armv6;
 #ifdef USE_MMX
 		    if (fbHaveMMX())
 			func = fbCompositeSrcAdd_8000x8000mmx;
-		    else
 #endif
-			func = fbCompositeSrcAdd_8000x8000;
+
 		    break;
 		default:
 		    break;
@@ -1274,9 +2029,34 @@ fbComposite (CARD8      op,
 	break;
     }
 
+    /* Support for some simple, but quite common cases of scaling (assume affine transform and no rotation) */
+    if (pSrc->pDrawable && !pMask
+        && pSrc->transform && pSrc->filter == PictFilterNearest
+        && pSrc->transform->matrix[1][0] == 0
+        && pSrc->transform->matrix[2][0] == 0
+        && REGION_NUM_RECTS(pSrc->pCompositeClip) == 1
+        && !srcAlphaMap && !dstAlphaMap)
+    {
+        func = fbCompositeTransformNonrotatedAffineTrivialclip;
+        srcRepeat = 0; /* XXX this is needed in order to prevent the code below from screwing up source picture data */
+    }
+
+    params.op = op;
+    params.src = pSrc;
+    params.mask = pMask;
+    params.dest = pDst;
+    params.xSrc = xSrc;
+    params.ySrc = ySrc;
+    params.xMask = xMask;
+    params.yMask = yMask;
+    params.xDest = xDst;
+    params.yDest = yDst;
+    params.width = width;
+    params.height = height;
+
     if (!func) {
          /* no fast path, use the general code */
-         fbCompositeGeneral(op, pSrc, pMask, pDst, xSrc, ySrc, xMask, yMask, xDst, yDst, width, height);
+         fbCompositeGeneral(&params);
          return;
     }
 
@@ -1299,59 +2079,63 @@ fbComposite (CARD8      op,
     while (n--)
     {
 	h = pbox->y2 - pbox->y1;
-	y_src = pbox->y1 - yDst + ySrc;
-	y_msk = pbox->y1 - yDst + yMask;
-	y_dst = pbox->y1;
+	params.ySrc = pbox->y1 - yDst + ySrc;
+	params.yMask = pbox->y1 - yDst + yMask;
+	params.yDest = pbox->y1;
 	while (h)
 	{
-	    h_this = h;
+	    params.height = h;
 	    w = pbox->x2 - pbox->x1;
-	    x_src = pbox->x1 - xDst + xSrc;
-	    x_msk = pbox->x1 - xDst + xMask;
-	    x_dst = pbox->x1;
+	    params.xSrc = pbox->x1 - xDst + xSrc;
+	    params.xMask = pbox->x1 - xDst + xMask;
+	    params.xDest = pbox->x1;
 	    if (maskRepeat)
 	    {
-		y_msk = mod (y_msk - pMask->pDrawable->y, pMask->pDrawable->height);
-		if (h_this > pMask->pDrawable->height - y_msk)
-		    h_this = pMask->pDrawable->height - y_msk;
-		y_msk += pMask->pDrawable->y;
+		params.yMask = mod (params.yMask - pMask->pDrawable->y,
+                                    pMask->pDrawable->height);
+		if (params.height > pMask->pDrawable->height - params.yMask)
+		    params.height = pMask->pDrawable->height - params.yMask;
+		params.yMask += pMask->pDrawable->y;
 	    }
 	    if (srcRepeat)
 	    {
-		y_src = mod (y_src - pSrc->pDrawable->y, pSrc->pDrawable->height);
-		if (h_this > pSrc->pDrawable->height - y_src)
-		    h_this = pSrc->pDrawable->height - y_src;
-		y_src += pSrc->pDrawable->y;
+		params.ySrc = mod (params.ySrc - pSrc->pDrawable->y,
+                                   pSrc->pDrawable->height);
+		if (params.height > pSrc->pDrawable->height - params.ySrc)
+		    params.height = pSrc->pDrawable->height - params.ySrc;
+		params.ySrc += pSrc->pDrawable->y;
 	    }
 	    while (w)
 	    {
-		w_this = w;
+		params.width = w;
 		if (maskRepeat)
 		{
-		    x_msk = mod (x_msk - pMask->pDrawable->x, pMask->pDrawable->width);
-		    if (w_this > pMask->pDrawable->width - x_msk)
-			w_this = pMask->pDrawable->width - x_msk;
-		    x_msk += pMask->pDrawable->x;
+		    params.xMask = mod (params.xMask - pMask->pDrawable->x,
+                                        pMask->pDrawable->width);
+		    if (params.width > pMask->pDrawable->width - params.xMask)
+			params.width = pMask->pDrawable->width - params.xMask;
+		    params.xMask += pMask->pDrawable->x;
 		}
 		if (srcRepeat)
 		{
-		    x_src = mod (x_src - pSrc->pDrawable->x, pSrc->pDrawable->width);
-		    if (w_this > pSrc->pDrawable->width - x_src)
-			w_this = pSrc->pDrawable->width - x_src;
-		    x_src += pSrc->pDrawable->x;
+		    params.xSrc = mod (params.xSrc - pSrc->pDrawable->x,
+                                       pSrc->pDrawable->width);
+		    if (params.width > pSrc->pDrawable->width - params.xSrc)
+			params.width = pSrc->pDrawable->width - params.xSrc;
+		    params.xSrc += pSrc->pDrawable->x;
 		}
-		(*func) (op, pSrc, pMask, pDst,
-			 x_src, y_src, x_msk, y_msk, x_dst, y_dst,
-			 w_this, h_this);
-		w -= w_this;
-		x_src += w_this;
-		x_msk += w_this;
-		x_dst += w_this;
+
+		(*func) (&params);
+
+		w -= params.width;
+		params.xSrc += params.width;
+		params.xMask += params.width;
+		params.xDest += params.width;
 	    }
-	    h -= h_this;
-	    y_src += h_this;
-	    y_msk += h_this;
-	    y_dst += h_this;
+	    h -= params.height;
+	    params.ySrc += params.height;
+	    params.yMask += params.height;
+	    params.yDest += params.height;
 	}
 	pbox++;
     }
@@ -1477,7 +2261,9 @@ static unsigned int detectCPUFeatures(void) {
             features |= SSE;
         if (result & (1 << 26))
             features |= SSE2;
-        if ((result & MMX) && !(result & SSE) && (strcmp(vendor, "AuthenticAMD") == 0)) {
+        if ((features & MMX) && !(features & SSE) &&
+            (strcmp(vendor, "AuthenticAMD") == 0 ||
+             strcmp(vendor, "Geode by NSC") == 0)) {
             /* check for AMD MMX extensions */
 
             unsigned int result;            
diff --git a/fb/fbpict.h b/fb/fbpict.h
index bfcb38e..de840b0 100644
--- a/fb/fbpict.h
+++ b/fb/fbpict.h
@@ -114,13 +114,13 @@ fbCanGetSolid(PicturePtr pict)
     fbGetDrawable((pict)->pDrawable,__bits__,__stride__,__bpp__,__xoff__,__yoff__); \
     switch (__bpp__) { \
     case 32: \
-	(bits) = *(CARD32 *) __bits__; \
+	(bits) = READ((CARD32 *) __bits__); \
 	break; \
     case 24: \
 	(bits) = Fetch24 ((CARD8 *) __bits__); \
 	break; \
     case 16: \
-	(bits) = *(CARD16 *) __bits__; \
+	(bits) = READ((CARD16 *) __bits__); \
 	(bits) = cvt0565to8888(bits); \
 	break; \
     default: \
@@ -137,6 +137,7 @@ fbCanGetSolid(PicturePtr pict)
     /* manage missing src alpha */ \
     if ((pict)->pFormat->direct.alphaMask == 0) \
 	(bits) |= 0xff000000; \
+    fbFinishAccess ((pict)->pDrawable); \
 }
 
 #define fbComposeGetStart(pict,x,y,type,stride,line,mul) {\
@@ -158,22 +159,22 @@ fbCanGetSolid(PicturePtr pict)
 
 #if IMAGE_BYTE_ORDER == MSBFirst
 #define Fetch24(a)  ((unsigned long) (a) & 1 ? \
-		     ((*(a) << 16) | *((CARD16 *) ((a)+1))) : \
-		     ((*((CARD16 *) (a)) << 8) | *((a)+2)))
+		     ((READ(a) << 16) | READ((CARD16 *) ((a)+1))) : \
+		     ((READ((CARD16 *) (a)) << 8) | READ((a)+2)))
 #define Store24(a,v) ((unsigned long) (a) & 1 ? \
-		      ((*(a) = (CARD8) ((v) >> 16)), \
-		       (*((CARD16 *) ((a)+1)) = (CARD16) (v))) : \
-		      ((*((CARD16 *) (a)) = (CARD16) ((v) >> 8)), \
-		       (*((a)+2) = (CARD8) (v))))
+		      (WRITE(a, (CARD8) ((v) >> 16)), \
+		       WRITE((CARD16 *) ((a)+1), (CARD16) (v))) : \
+		      (WRITE((CARD16 *) (a), (CARD16) ((v) >> 8)), \
+		       WRITE((a)+2, (CARD8) (v))))
 #else
 #define Fetch24(a)  ((unsigned long) (a) & 1 ? \
-		     ((*(a)) | (*((CARD16 *) ((a)+1)) << 8)) : \
-		     ((*((CARD16 *) (a))) | (*((a)+2) << 16)))
+		     (READ(a) | (READ((CARD16 *) ((a)+1)) << 8)) : \
+		     (READ((CARD16 *) (a)) | (READ((a)+2) << 16)))
 #define Store24(a,v) ((unsigned long) (a) & 1 ? \
-		      ((*(a) = (CARD8) (v)), \
-		       (*((CARD16 *) ((a)+1)) = (CARD16) ((v) >> 8))) : \
-		      ((*((CARD16 *) (a)) = (CARD16) (v)),\
-		       (*((a)+2) = (CARD8) ((v) >> 16))))
+		      (WRITE(a, (CARD8) (v)), \
+		       WRITE((CARD16 *) ((a)+1), (CARD16) ((v) >> 8))) : \
+		      (WRITE((CARD16 *) (a), (CARD16) (v)),\
+		       WRITE((a)+2, (CARD8) ((v) >> 16))))
 #endif
 		      
 /*
@@ -216,6 +217,43 @@ fbCanGetSolid(PicturePtr pict)
         x += t;                                                     \
     } while (0)
 
+#define FbByteMulAdd_store_r5g6b5(x, a, y) do {                   \
+        CARD32 t = ((x & 0xff00ff) * a) + 0x800080;               \
+        t = (t + ((t >> 8) & 0xff00ff)) >> 8;                     \
+        t &= 0xff00ff;                                            \
+        t += y & 0xff00ff;                                        \
+        t |= 0x1000100 - ((t >> 8) & 0xff00ff);                   \
+        t &= 0xff00ff;                                            \
+                                                                  \
+        x = (((x >> 8) & 0xff00ff) * a) + 0x800080;                 \
+        x = (x + ((x >> 8) & 0xff00ff)) >> 8;                       \
+        x &= 0xff00ff;                                              \
+        x += (y >> 8) & 0xff00ff;                                   \
+        x |= 0x1000100 - ((x >> 8) & 0xff00ff);                     \
+        x &= 0xff00ff;                                              \
+        x <<= 8;                                                    \
+        x += t;                                                     \
+        x = cvt8888to0565(x);                                       \
+    } while (0)
+
+#define FbByteMulAdd_store_x8r8g8b8(x, a, y) do {                 \
+        CARD32 t = ((x & 0xff00ff) * a) + 0x800080;               \
+        t = (t + ((t >> 8) & 0xff00ff)) >> 8;                     \
+        t &= 0xff00ff;                                            \
+        t += y & 0xff00ff;                                        \
+        t |= 0x1000100 - ((t >> 8) & 0xff00ff);                   \
+        t &= 0xff00ff;                                            \
+                                                                  \
+        x = (((x >> 8) & 0xff00ff) * a) + 0x800080;                 \
+        x = (x + ((x >> 8) & 0xff00ff)) >> 8;                       \
+        x &= 0xff00ff;                                              \
+        x += (y >> 8) & 0xff00ff;                                   \
+        x |= 0x1000100 - ((x >> 8) & 0xff00ff);                     \
+        x &= 0xff;                                                  \
+        x <<= 8;                                                    \
+        x += t;                                                     \
+    } while (0)
+
 /*
   x_c = (x_c * a + y_c * b) / 255
 */
@@ -359,20 +397,7 @@ fbCanGetSolid(PicturePtr pict)
 #define FASTCALL
 #endif
 
-typedef struct _FbComposeData {
-    CARD8	op;
-    PicturePtr	src;
-    PicturePtr	mask;
-    PicturePtr	dest;
-    INT16	xSrc;
-    INT16	ySrc;
-    INT16	xMask;
-    INT16	yMask;
-    INT16	xDest;
-    INT16	yDest;
-    CARD16	width;
-    CARD16	height;
-} FbComposeData;
+typedef void  (*CompositeFunc) (FbComposeData *params);
 
 typedef FASTCALL void (*CombineMaskU) (CARD32 *src, const CARD32 *mask, int width);
 typedef FASTCALL void (*CombineFuncU) (CARD32 *dest, const CARD32 *src, int width);
@@ -387,18 +412,7 @@ typedef struct _FbComposeFunctions {
 /* fbcompose.c */
 
 void
-fbCompositeGeneral (CARD8	op,
-		    PicturePtr	pSrc,
-		    PicturePtr	pMask,
-		    PicturePtr	pDst,
-		    INT16	xSrc,
-		    INT16	ySrc,
-		    INT16	xMask,
-		    INT16	yMask,
-		    INT16	xDst,
-		    INT16	yDst,
-		    CARD16	width,
-		    CARD16	height);
+fbCompositeGeneral (FbComposeData *params);
 
 
 /* fbedge.c */
@@ -423,200 +437,57 @@ CARD32
 fbIn (CARD32 x, CARD8 y);
 
 void
-fbCompositeSolidMask_nx8x8888 (CARD8      op,
-			       PicturePtr pSrc,
-			       PicturePtr pMask,
-			       PicturePtr pDst,
-			       INT16      xSrc,
-			       INT16      ySrc,
-			       INT16      xMask,
-			       INT16      yMask,
-			       INT16      xDst,
-			       INT16      yDst,
-			       CARD16     width,
-			       CARD16     height);
+fbCompositeSolidMask_nx8x8888 (FbComposeData *params);
 
 void
-fbCompositeSolidMask_nx8x0888 (CARD8      op,
-			       PicturePtr pSrc,
-			       PicturePtr pMask,
-			       PicturePtr pDst,
-			       INT16      xSrc,
-			       INT16      ySrc,
-			       INT16      xMask,
-			       INT16      yMask,
-			       INT16      xDst,
-			       INT16      yDst,
-			       CARD16     width,
-			       CARD16     height);
+fbCompositeSolidMask_nx8x0888 (FbComposeData *params);
 
 void
-fbCompositeSolidMask_nx8888x8888C (CARD8      op,
-				   PicturePtr pSrc,
-				   PicturePtr pMask,
-				   PicturePtr pDst,
-				   INT16      xSrc,
-				   INT16      ySrc,
-				   INT16      xMask,
-				   INT16      yMask,
-				   INT16      xDst,
-				   INT16      yDst,
-				   CARD16     width,
-				   CARD16     height);
+fbCompositeSolidMask_nx8888x8888C (FbComposeData *params);
 
 void
-fbCompositeSolidMask_nx8x0565 (CARD8      op,
-			       PicturePtr pSrc,
-			       PicturePtr pMask,
-			       PicturePtr pDst,
-			       INT16      xSrc,
-			       INT16      ySrc,
-			       INT16      xMask,
-			       INT16      yMask,
-			       INT16      xDst,
-			       INT16      yDst,
-			       CARD16     width,
-			       CARD16     height);
+fbCompositeSolidMask_nx8x0565 (FbComposeData *params);
 
 void
-fbCompositeSolidMask_nx8888x0565C (CARD8      op,
-				   PicturePtr pSrc,
-				   PicturePtr pMask,
-				   PicturePtr pDst,
-				   INT16      xSrc,
-				   INT16      ySrc,
-				   INT16      xMask,
-				   INT16      yMask,
-				   INT16      xDst,
-				   INT16      yDst,
-				   CARD16     width,
-				   CARD16     height);
+fbCompositeSolidMask_nx8888x0565C (FbComposeData *params);
 
 void
-fbCompositeSrc_8888x8888 (CARD8      op,
-			  PicturePtr pSrc,
-			  PicturePtr pMask,
-			  PicturePtr pDst,
-			  INT16      xSrc,
-			  INT16      ySrc,
-			  INT16      xMask,
-			  INT16      yMask,
-			  INT16      xDst,
-			  INT16      yDst,
-			  CARD16     width,
-			  CARD16     height);
+fbCompositeSrc_8888x8888 (FbComposeData *params);
 
 void
-fbCompositeSrc_8888x0888 (CARD8      op,
-			 PicturePtr pSrc,
-			 PicturePtr pMask,
-			 PicturePtr pDst,
-			 INT16      xSrc,
-			 INT16      ySrc,
-			 INT16      xMask,
-			 INT16      yMask,
-			 INT16      xDst,
-			 INT16      yDst,
-			 CARD16     width,
-			 CARD16     height);
+fbCompositeSrc_8888x0888 (FbComposeData *params);
 
 void
-fbCompositeSrc_8888x0565 (CARD8      op,
-			  PicturePtr pSrc,
-			  PicturePtr pMask,
-			  PicturePtr pDst,
-			  INT16      xSrc,
-			  INT16      ySrc,
-			  INT16      xMask,
-			  INT16      yMask,
-			  INT16      xDst,
-			  INT16      yDst,
-			  CARD16     width,
-			  CARD16     height);
+fbCompositeSrc_8888x0565 (FbComposeData *params);
 
 void
-fbCompositeSrc_0565x0565 (CARD8      op,
-			  PicturePtr pSrc,
-			  PicturePtr pMask,
-			  PicturePtr pDst,
-			  INT16      xSrc,
-			  INT16      ySrc,
-			  INT16      xMask,
-			  INT16      yMask,
-			  INT16      xDst,
-			  INT16      yDst,
-			  CARD16     width,
-			  CARD16     height);
+fbCompositeSrc_0565x0565 (FbComposeData *params);
 
 void
-fbCompositeSrcAdd_8000x8000 (CARD8	op,
-			     PicturePtr pSrc,
-			     PicturePtr pMask,
-			     PicturePtr pDst,
-			     INT16      xSrc,
-			     INT16      ySrc,
-			     INT16      xMask,
-			     INT16      yMask,
-			     INT16      xDst,
-			     INT16      yDst,
-			     CARD16     width,
-			     CARD16     height);
+fbCompositeSrcAdd_8000x8000 (FbComposeData *params);
 
 void
-fbCompositeSrcAdd_8888x8888 (CARD8	op,
-			     PicturePtr pSrc,
-			     PicturePtr pMask,
-			     PicturePtr pDst,
-			     INT16      xSrc,
-			     INT16      ySrc,
-			     INT16      xMask,
-			     INT16      yMask,
-			     INT16      xDst,
-			     INT16      yDst,
-			     CARD16     width,
-			     CARD16     height);
+fbCompositeSrcAdd_8888x8888 (FbComposeData *params);
 
 void
-fbCompositeSrcAdd_1000x1000 (CARD8	op,
-			     PicturePtr pSrc,
-			     PicturePtr pMask,
-			     PicturePtr pDst,
-			     INT16      xSrc,
-			     INT16      ySrc,
-			     INT16      xMask,
-			     INT16      yMask,
-			     INT16      xDst,
-			     INT16      yDst,
-			     CARD16     width,
-			     CARD16     height);
+fbCompositeSrcAdd_1000x1000 (FbComposeData *params);
 
 void
-fbCompositeSolidMask_nx1xn (CARD8      op,
-			    PicturePtr pSrc,
-			    PicturePtr pMask,
-			    PicturePtr pDst,
-			    INT16      xSrc,
-			    INT16      ySrc,
-			    INT16      xMask,
-			    INT16      yMask,
-			    INT16      xDst,
-			    INT16      yDst,
-			    CARD16     width,
-			    CARD16     height);
+fbCompositeSolidMask_nx1xn (FbComposeData *params);
 
 void
-fbComposite (CARD8      op,
+fbComposite (int      op,
 	     PicturePtr pSrc,
 	     PicturePtr pMask,
 	     PicturePtr pDst,
-	     INT16      xSrc,
-	     INT16      ySrc,
-	     INT16      xMask,
-	     INT16      yMask,
-	     INT16      xDst,
-	     INT16      yDst,
-	     CARD16     width,
-	     CARD16     height);
+	     int      xSrc,
+	     int      ySrc,
+	     int      xMask,
+	     int      yMask,
+	     int      xDst,
+	     int      yDst,
+	     int     width,
+	     int     height);
 
 /* fbtrap.c */
 
diff --git a/fb/fbpixmap.c b/fb/fbpixmap.c
index f79f701..18c1204 100644
--- a/fb/fbpixmap.c
+++ b/fb/fbpixmap.c
@@ -43,11 +43,7 @@ fbCreatePixmapBpp (ScreenPtr pScreen, int width, int height, int depth, int bpp)
     if (paddedWidth / 4 > 32767 || height > 32767)
 	return NullPixmap;
     datasize = height * paddedWidth;
-#ifdef PIXPRIV
     base = pScreen->totalPixmapSize;
-#else
-    base = sizeof (PixmapRec);
-#endif
     adjust = 0;
     if (base & 7)
 	adjust = 8 - (base & 7);
@@ -160,6 +156,8 @@ fbPixmapToRegion(PixmapPtr pPix)
     FirstRect = REGION_BOXPTR(pReg);
     rects = FirstRect;
 
+    fbPrepareAccess(&pPix->drawable);
+
     pwLine = (FbBits *) pPix->devPrivate.ptr;
     nWidth = pPix->devKind >> (FB_SHIFT-3);
 
@@ -174,7 +172,7 @@ fbPixmapToRegion(PixmapPtr pPix)
 	irectLineStart = rects - FirstRect;
 	/* If the Screen left most bit of the word is set, we're starting in
 	 * a box */
-	if(*pw & mask0)
+	if(READ(pw) & mask0)
 	{
 	    fInBox = TRUE;
 	    rx1 = 0;
@@ -185,7 +183,7 @@ fbPixmapToRegion(PixmapPtr pPix)
 	pwLineEnd = pw + (width >> FB_SHIFT);
 	for (base = 0; pw < pwLineEnd; base += FB_UNIT)
 	{
-	    w = *pw++;
+	    w = READ(pw++);
 	    if (fInBox)
 	    {
 		if (!~w)
@@ -226,7 +224,7 @@ fbPixmapToRegion(PixmapPtr pPix)
 	if(width & FB_MASK)
 	{
 	    /* Process final partial word on line */
-	    w = *pw++;
+	    w = READ(pw++);
 	    for(ib = 0; ib < (width & FB_MASK); ib++)
 	    {
 	        /* If the Screen left most bit of the word is set, we're
@@ -311,6 +309,8 @@ fbPixmapToRegion(PixmapPtr pPix)
 	    pReg->data = (RegDataPtr)NULL;
 	}
     }
+
+    fbFinishAccess(&pPix->drawable);
 #ifdef DEBUG
     if (!miValidRegion(pReg))
 	FatalError("Assertion failed file %s, line %d: expr\n", __FILE__, __LINE__);
@@ -362,6 +362,7 @@ fbValidateDrawable (DrawablePtr pDrawable)
     if (!fbValidateBits (first, stride, FB_HEAD_BITS) ||
 	!fbValidateBits (last, stride, FB_TAIL_BITS))
 	fbInitializeDrawable(pDrawable);
+    fbFinishAccess (pDrawable);
 }
 
 void
@@ -383,5 +384,6 @@ fbInitializeDrawable (DrawablePtr pDrawable)
     last = bits + stride * pDrawable->height;
     fbSetBits (first, stride, FB_HEAD_BITS);
     fbSetBits (last, stride, FB_TAIL_BITS);
+    fbFinishAccess (pDrawable);
 }
 #endif /* FB_DEBUG */
diff --git a/fb/fbpoint.c b/fb/fbpoint.c
index 7154b53..c03ea18 100644
--- a/fb/fbpoint.c
+++ b/fb/fbpoint.c
@@ -90,20 +90,20 @@ fbDots (FbBits	    *dstOrig,
 		FbMaskStip (x, 24, leftMask, n, rightMask);
 		if (leftMask)
 		{
-		    *d = FbDoMaskRRop (*d, andT, xorT, leftMask);
+		    WRITE(d, FbDoMaskRRop (READ(d), andT, xorT, leftMask));
 		    andT = FbNext24Stip(andT);
 		    xorT = FbNext24Stip(xorT);
 		    d++;
 		}
 		if (rightMask)
-		    *d = FbDoMaskRRop(*d, andT, xorT, rightMask);
+		    WRITE(d, FbDoMaskRRop(READ(d), andT, xorT, rightMask));
 	    }
 	    else
 #endif
 	    {
 		FbStip	mask;
 		mask = FbStipMask(x, dstBpp);
-		*d = FbDoMaskRRop (*d, and, xor, mask);
+		WRITE(d, FbDoMaskRRop (READ(d), and, xor, mask));
 	    }
 	}
     }
@@ -160,4 +160,5 @@ fbPolyPoint (DrawablePtr    pDrawable,
 	 nBox--; pBox++)
 	(*dots) (dst, dstStride, dstBpp, pBox, pptInit, nptInit, 
 		 pDrawable->x, pDrawable->y, dstXoff, dstYoff, and, xor);
+    fbFinishAccess (pDrawable);
 }
diff --git a/fb/fbpseudocolor.c b/fb/fbpseudocolor.c
index 2233f95..271e981 100644
--- a/fb/fbpseudocolor.c
+++ b/fb/fbpseudocolor.c
@@ -875,6 +875,8 @@ xxCopyPseudocolorRegion(ScreenPtr pScreen, RegionPtr pReg,
     register CARD16     *d;
     int w;
 
+    fbPrepareAccess((DrawablePtr)pScreen->devPrivate);
+
     dst_base = (CARD16*) ((PixmapPtr)pScreen->devPrivate)->devPrivate.ptr;
     dst_stride = (int)((PixmapPtr)pScreen->devPrivate)->devKind
 	/ sizeof (CARD16);
@@ -899,6 +901,8 @@ xxCopyPseudocolorRegion(ScreenPtr pScreen, RegionPtr pReg,
 	}
 	pbox++;
     }
+
+    fbFinishAccess(&((PixmapPtr)pScreen->devPrivate)->drawable);
 }
 
 static void
@@ -1200,7 +1204,7 @@ GCFuncs xxGCFuncs = {
     xxChangeClip, xxDestroyClip, xxCopyClip
 };
 
-GCOps xxGCOps = {
+static GCOps xxGCOps = {
     xxFillSpans, xxSetSpans, 
     xxPutImage, xxCopyArea, 
     xxCopyPlane, xxPolyPoint, 
diff --git a/fb/fbpush.c b/fb/fbpush.c
index 0632766..bb7bcef 100644
--- a/fb/fbpush.c
+++ b/fb/fbpush.c
@@ -58,7 +58,7 @@ fbPushPattern (DrawablePtr  pDrawable,
 	w = width;
 	s = src;
 	src += srcStride;
-	bits = *s++;
+	bits = READ(s++);
 	xspan = x;
 	while (w)
 	{
@@ -73,7 +73,7 @@ fbPushPattern (DrawablePtr  pDrawable,
 		    bitsMask = FbStipRight (bitsMask, 1);
 		    if (!bitsMask)
 		    {
-			bits = *s++;
+			bits = READ(s++);
 			bitsMask = FbBitsMask(0,1);
 		    }
 		} while (bits & bitsMask);
@@ -92,7 +92,7 @@ fbPushPattern (DrawablePtr  pDrawable,
 		    bitsMask = FbStipRight (bitsMask, 1);
 		    if (!bitsMask)
 		    {
-			bits = *s++;
+			bits = READ(s++);
 			bitsMask = FbBitsMask(0,1);
 		    }
 		} while (!(bits & bitsMask));
@@ -165,6 +165,7 @@ fbPushFill (DrawablePtr	pDrawable,
 		      fbAnd(GXnoop,(FbBits) 0,FB_ALLONES),
 		      fbXor(GXnoop,(FbBits) 0,FB_ALLONES));
 	}
+	fbFinishAccess (pDrawable);
     }
     else
     {
diff --git a/fb/fbscreen.c b/fb/fbscreen.c
index b883758..045ca8f 100644
--- a/fb/fbscreen.c
+++ b/fb/fbscreen.c
@@ -155,6 +155,19 @@ fbSetupScreen(ScreenPtr	pScreen,
     return TRUE;
 }
 
+#ifdef FB_ACCESS_WRAPPER
+Bool
+wfbFinishScreenInit(ScreenPtr		pScreen,
+		    pointer		pbits,
+		    int			xsize,
+		    int			ysize,
+		    int			dpix,
+		    int			dpiy,
+		    int			width,
+		    int			bpp,
+		    SetupWrapProcPtr	setupWrap,
+		    FinishWrapProcPtr	finishWrap)
+#else
 Bool
 fbFinishScreenInit(ScreenPtr	pScreen,
 		   pointer	pbits,
@@ -164,6 +177,7 @@ fbFinishScreenInit(ScreenPtr	pScreen,
 		   int		dpiy,
 		   int		width,
 		   int		bpp)
+#endif
 {
     VisualPtr	visuals;
     DepthPtr	depths;
@@ -222,6 +236,10 @@ fbFinishScreenInit(ScreenPtr	pScreen,
 	fbGetScreenPrivate(pScreen)->win32bpp = 32;
 	fbGetScreenPrivate(pScreen)->pix32bpp = 32;
     }
+#ifdef FB_ACCESS_WRAPPER
+    fbGetScreenPrivate(pScreen)->setupWrap = setupWrap;
+    fbGetScreenPrivate(pScreen)->finishWrap = finishWrap;
+#endif
 #endif
     rootdepth = 0;
     if (!fbInitVisuals (&visuals, &depths, &nvisuals, &ndepths, &rootdepth,
@@ -256,6 +274,27 @@ fbFinishScreenInit(ScreenPtr	pScreen,
 }
 
 /* dts * (inch/dot) * (25.4 mm / inch) = mm */
+#ifdef FB_ACCESS_WRAPPER
+Bool
+wfbScreenInit(ScreenPtr		pScreen,
+	      pointer		pbits,
+	      int		xsize,
+	      int		ysize,
+	      int		dpix,
+	      int		dpiy,
+	      int		width,
+	      int		bpp,
+	      SetupWrapProcPtr	setupWrap,
+	      FinishWrapProcPtr	finishWrap)
+{
+    if (!fbSetupScreen(pScreen, pbits, xsize, ysize, dpix, dpiy, width, bpp))
+	return FALSE;
+    if (!wfbFinishScreenInit(pScreen, pbits, xsize, ysize, dpix, dpiy,
+			     width, bpp, setupWrap, finishWrap))
+	return FALSE;
+    return TRUE;
+}
+#else
 Bool
 fbScreenInit(ScreenPtr	pScreen,
 	     pointer	pbits,
@@ -273,6 +312,7 @@ fbScreenInit(ScreenPtr	pScreen,
 	return FALSE;
     return TRUE;
 }
+#endif
 
 
 #ifdef FB_OLD_SCREEN
diff --git a/fb/fbseg.c b/fb/fbseg.c
index d66e424..3107637 100644
--- a/fb/fbseg.c
+++ b/fb/fbseg.c
@@ -79,7 +79,7 @@ fbBresSolid (DrawablePtr    pDrawable,
 	    mask = fbBresShiftMask(mask,signdx,dstBpp);
 	    if (!mask)
 	    {
-		*dst = FbDoMaskRRop (*dst, and, xor, bits);
+		WRITE(dst, FbDoMaskRRop (READ(dst), and, xor, bits));
 		bits = 0;
 		dst += signdx;
 		mask = mask0;
@@ -87,20 +87,20 @@ fbBresSolid (DrawablePtr    pDrawable,
 	    e += e1;
 	    if (e >= 0)
 	    {
-		*dst = FbDoMaskRRop (*dst, and, xor, bits);
+		WRITE(dst, FbDoMaskRRop (READ(dst), and, xor, bits));
 		bits = 0;
 		dst += dstStride;
 		e += e3;
 	    }
 	}
 	if (bits)
-	    *dst = FbDoMaskRRop (*dst, and, xor, bits);
+	    WRITE(dst, FbDoMaskRRop (READ(dst), and, xor, bits));
     }
     else
     {
 	while (len--)
 	{
-	    *dst = FbDoMaskRRop (*dst, and, xor, mask);
+	    WRITE(dst, FbDoMaskRRop (READ(dst), and, xor, mask));
 	    dst += dstStride;
 	    e += e1;
 	    if (e >= 0)
@@ -115,6 +115,8 @@ fbBresSolid (DrawablePtr    pDrawable,
 	    }
 	}
     }
+
+    fbFinishAccess (pDrawable);
 }
 
 void
@@ -164,9 +166,9 @@ fbBresDash (DrawablePtr	pDrawable,
     while (len--)
     {
 	if (even)
-	    *dst = FbDoMaskRRop (*dst, and, xor, mask);
+	    WRITE(dst, FbDoMaskRRop (READ(dst), and, xor, mask));
 	else if (doOdd)
-	    *dst = FbDoMaskRRop (*dst, bgand, bgxor, mask);
+	    WRITE(dst, FbDoMaskRRop (READ(dst), bgand, bgxor, mask));
 	if (axis == X_AXIS)
 	{
 	    mask = fbBresShiftMask(mask,signdx,dstBpp);
@@ -199,6 +201,8 @@ fbBresDash (DrawablePtr	pDrawable,
 	}
 	FbDashStep (dashlen, even);
     }
+
+    fbFinishAccess (pDrawable);
 }
 
 void
@@ -371,13 +375,13 @@ fbBresSolid24RRop (DrawablePtr  pDrawable,
 	FbMaskStip (x, 24, leftMask, nl, rightMask);
 	if (leftMask)
 	{
-	    *d = FbDoMaskRRop (*d, andT, xorT, leftMask);
+	    WRITE(d, FbDoMaskRRop (READ(d), andT, xorT, leftMask));
 	    d++;
 	    andT = FbNext24Stip (andT);
 	    xorT = FbNext24Stip (xorT);
 	}
 	if (rightMask)
-	    *d = FbDoMaskRRop (*d, andT, xorT, rightMask);
+	    WRITE(d, FbDoMaskRRop (READ(d), andT, xorT, rightMask));
 	if (axis == X_AXIS)
 	{
 	    x1 += signdx;
@@ -399,6 +403,8 @@ fbBresSolid24RRop (DrawablePtr  pDrawable,
 	    }
 	}
     }
+
+    fbFinishAccess (pDrawable);
 }
 
 static void
@@ -468,13 +474,13 @@ fbBresDash24RRop (DrawablePtr	pDrawable,
 	    FbMaskStip (x, 24, leftMask, nl, rightMask);
 	    if (leftMask)
 	    {
-		*d = FbDoMaskRRop (*d, andT, xorT, leftMask);
+		WRITE(d, FbDoMaskRRop (READ(d), andT, xorT, leftMask));
 		d++;
 		andT = FbNext24Stip (andT);
 		xorT = FbNext24Stip (xorT);
 	    }
 	    if (rightMask)
-		*d = FbDoMaskRRop (*d, andT, xorT, rightMask);
+		WRITE(d, FbDoMaskRRop (READ(d), andT, xorT, rightMask));
 	}
 	if (axis == X_AXIS)
 	{
@@ -498,6 +504,8 @@ fbBresDash24RRop (DrawablePtr	pDrawable,
 	}
 	FbDashStep (dashlen, even);
     }
+
+    fbFinishAccess (pDrawable);
 }
 #endif
 
diff --git a/fb/fbsetsp.c b/fb/fbsetsp.c
index c59c13c..0633256 100644
--- a/fb/fbsetsp.c
+++ b/fb/fbsetsp.c
@@ -99,5 +99,6 @@ fbSetSpans (DrawablePtr	    pDrawable,
 	pwidth++;
     }
     fbValidateDrawable (pDrawable);
+    fbFinishAccess (pDrawable);
 }
 	    
diff --git a/fb/fbsolid.c b/fb/fbsolid.c
index 89effe6..f079385 100644
--- a/fb/fbsolid.c
+++ b/fb/fbsolid.c
@@ -30,6 +30,58 @@
 
 #include "fb.h"
 
+#if defined(__arm__)
+
+static inline void memset_fbbits(FbBits *dst, FbBits xc, int count)
+{
+    if (sizeof(FbBits) != 4) {
+        while (count--) *dst++ = xc;
+        return;
+    }
+
+    FbBits dummy0, dummy1, dummy2;
+    __asm__ __volatile__ (
+        "      cmp   %[count], #4\n"
+        "      blt   2f\n"
+        /* Alignment is known to be at least 32-bit */
+        "      mov   %[dummy0], %[xxc]\n"
+        "      tst   %[dst], #4\n"
+        "      strne %[xxc], [%[dst]], #4\n"
+        "      subne %[count], %[count], #1\n"
+        "      tst   %[dst], #8\n"
+        "      stmneia %[dst]!, {%[dummy0], %[xxc]}\n"
+        "      subne %[count], %[count], #2\n"
+        /* Now we are 128-bit aligned */
+        "      mov   %[dummy1], %[xxc]\n"
+        "      mov   %[dummy2], %[xxc]\n"
+        "1:\n" /* Copy 4 32-bit values per loop iteration */
+        "      subs  %[count], %[count], #4\n"
+        "      stmgeia %[dst]!, {%[dummy0], %[dummy1], %[dummy2], %[xxc]}\n"
+        "      bge   1b\n"
+        "      add   %[count], %[count], #4\n"
+        "2:\n" /* Copy up to 3 remaining 32-bit values */
+        "      subs  %[count], %[count], #1\n"
+        "      strge %[xxc], [%[dst]], #4\n"
+        "      subs  %[count], %[count], #1\n"
+        "      strge %[xxc], [%[dst]], #4\n"
+        "      subs  %[count], %[count], #1\n"
+        "      strge %[xxc], [%[dst]], #4\n"
+        "\n"
+        : [dst] "+&r" (dst), [count] "+&r" (count), [dummy0] "=&r" (dummy0), [dummy1] "=&r" (dummy1), [dummy2] "=&r" (dummy2), [xxc] "+&r" (xc)
+        :
+        : "cc", "memory"
+    );
+}
+
+#else
+
+static inline void memset_fbbits(FbBits *dst, FbBits xc, int count)
+{
+    while (count--) *dst++ = xc;
+}
+
+#endif
+
 void
 fbSolid (FbBits	    *dst,
 	 FbStride   dstStride,
@@ -57,29 +109,39 @@ fbSolid (FbBits	    *dst,
     dstX &= FB_MASK;
     FbMaskBitsBytes(dstX, width, and == 0, startmask, startbyte, 
 		    nmiddle, endmask, endbyte);
-    if (startmask)
-	dstStride--;
-    dstStride -= nmiddle;
-    while (height--)
-    {
-	if (startmask)
-	{
-	    FbDoLeftMaskByteRRop(dst,startbyte,startmask,and,xor);
-	    dst++;
-	}
-	n = nmiddle;
-	if (!and)
-	    while (n--)
-		*dst++ = xor;
-	else
-	    while (n--)
-	    {
-		*dst = FbDoRRop (*dst, and, xor);
-		dst++;
-	    }
-	if (endmask)
-	    FbDoRightMaskByteRRop(dst,endbyte,endmask,and,xor);
-	dst += dstStride;
+    if (!startmask && !and && !endmask) {
+        while (height--) {
+            memset_fbbits(dst, xor, nmiddle);
+            dst += dstStride;
+        }
+    }
+    else {
+        if (startmask)
+            dstStride--;
+        dstStride -= nmiddle;
+        while (height--)
+        {
+            if (startmask)
+            {
+                FbDoLeftMaskByteRRop(dst,startbyte,startmask,and,xor);
+                dst++;
+            }
+            n = nmiddle;
+            if (!and) {
+                memset_fbbits(dst, xor, n);
+                dst += n;
+            }
+            else {
+                while (n--)
+                {
+                    *dst = FbDoRRop (*dst, and, xor);
+                    dst++;
+                }
+            }
+            if (endmask)
+                FbDoRightMaskByteRRop(dst,endbyte,endmask,and,xor);
+            dst += dstStride;
+        }
     }
 }
 
@@ -160,26 +222,26 @@ fbSolid24 (FbBits   *dst,
     {
 	if (startmask)
 	{
-	    *dst = FbDoMaskRRop(*dst, andS, xorS, startmask);
-	    dst++;
+	    WRITE(dst, FbDoMaskRRop(READ(dst), andS, xorS, startmask));
+            dst++;
 	}
 	n = nmiddle;
 	if (!and0)
 	{
 	    while (n >= 3)
 	    {
-		*dst++ = xor0;
-		*dst++ = xor1;
-		*dst++ = xor2;
+		WRITE(dst++, xor0);
+		WRITE(dst++, xor1);
+		WRITE(dst++, xor2);
 		n -= 3;
 	    }
 	    if (n)
 	    {
-		*dst++ = xor0;
+		WRITE(dst++, xor0);
 		n--;
 		if (n)
 		{
-		    *dst++ = xor1;
+		    WRITE(dst++, xor1);
 		}
 	    }
 	}
@@ -187,28 +249,28 @@ fbSolid24 (FbBits   *dst,
 	{
 	    while (n >= 3)
 	    {
-		*dst = FbDoRRop (*dst, and0, xor0);
-		dst++;
-		*dst = FbDoRRop (*dst, and1, xor1);
-		dst++;
-		*dst = FbDoRRop (*dst, and2, xor2);
-		dst++;
+		WRITE(dst, FbDoRRop (READ(dst), and0, xor0));
+                dst++;
+		WRITE(dst, FbDoRRop (READ(dst), and1, xor1));
+                dst++;
+		WRITE(dst, FbDoRRop (READ(dst), and2, xor2));
+                dst++;
 		n -= 3;
 	    }
 	    if (n)
 	    {
-		*dst = FbDoRRop (*dst, and0, xor0);
-		dst++;
+		WRITE(dst, FbDoRRop (READ(dst), and0, xor0));
+                dst++;
 		n--;
 		if (n)
 		{
-		    *dst = FbDoRRop (*dst, and1, xor1);
-		    dst++;
+		    WRITE(dst, FbDoRRop (READ(dst), and1, xor1));
+                    dst++;
 		}
 	    }
 	}
 	if (endmask)
-	    *dst = FbDoMaskRRop (*dst, andE, xorE, endmask);
+	    WRITE(dst, FbDoMaskRRop (READ(dst), andE, xorE, endmask));
 	dst += dstStride;
     }
 }
diff --git a/fb/fbstipple.c b/fb/fbstipple.c
index ce97148..de8d1f8 100644
--- a/fb/fbstipple.c
+++ b/fb/fbstipple.c
@@ -155,7 +155,7 @@ fbEvenStipple (FbBits	*dst,
 	/*
 	 * Extract stipple bits for this scanline;
 	 */
-	bits = *s;
+	bits = READ(s);
 	s += stipStride;
 	if (s == stipEnd)
 	    s = stip;
@@ -199,12 +199,12 @@ fbEvenStipple (FbBits	*dst,
 	    n = nmiddle;
 	    if (!and)
 		while (n--)
-		    *dst++ = xor;
+		    WRITE(dst++, xor);
 	    else
 	    {
 		while (n--)
 		{
-		    *dst = FbDoRRop (*dst, and, xor);
+		    WRITE(dst, FbDoRRop (READ(dst), and, xor));
 		    dst++;
 		}
 	    }
diff --git a/fb/fbtile.c b/fb/fbtile.c
index 0d0cfe1..e7df1af 100644
--- a/fb/fbtile.c
+++ b/fb/fbtile.c
@@ -80,7 +80,7 @@ fbEvenTile (FbBits	*dst,
 	/*
 	 * Pick up bits for this scanline
 	 */
-	bits = *t++;
+	bits = READ(t++);
 	if (t == tileEnd) t = tile;
 	bits = FbRotLeft(bits,rot);
 	and = fbAnd(alu,bits,pm);
@@ -94,11 +94,11 @@ fbEvenTile (FbBits	*dst,
 	n = nmiddle;
 	if (!and)
 	    while (n--)
-		*dst++ = xor;
+		WRITE(dst++, xor);
 	else
 	    while (n--)
 	    {
-		*dst = FbDoRRop (*dst, and, xor);
+		WRITE(dst, FbDoRRop (READ(dst), and, xor));
 		dst++;
 	    }
 	if (endmask)
diff --git a/fb/fbtrap.c b/fb/fbtrap.c
index 8639695..478a80f 100644
--- a/fb/fbtrap.c
+++ b/fb/fbtrap.c
@@ -95,6 +95,8 @@ fbAddTraps (PicturePtr	pPicture,
 	}
 	traps++;
     }
+
+    fbFinishAccess (pPicture->pDrawable);
 }
 
 void
@@ -115,6 +117,9 @@ fbRasterizeTrapezoid (PicturePtr    pPicture,
     RenderEdge	l, r;
     xFixed	t, b;
     
+    if (!xTrapezoidValid (trap))
+	return;
+
     fbGetDrawable (pPicture->pDrawable, buf, stride, bpp, pxoff, pyoff);
 
     width = pPicture->pDrawable->width;
@@ -142,6 +147,8 @@ fbRasterizeTrapezoid (PicturePtr    pPicture,
 	
 	fbRasterizeEdges (buf, bpp, width, stride, &l, &r, t, b);
     }
+
+    fbFinishAccess (pPicture->pDrawable);
 }
 
 static int
diff --git a/fb/fbwindow.c b/fb/fbwindow.c
index 968b5a6..cac662c 100644
--- a/fb/fbwindow.c
+++ b/fb/fbwindow.c
@@ -118,6 +118,9 @@ fbCopyWindowProc (DrawablePtr	pSrcDrawable,
 	       upsidedown);
 	pbox++;
     }
+
+    fbFinishAccess (pDstDrawable);
+    fbFinishAccess (pSrcDrawable);
 }
 
 void 
@@ -249,6 +252,8 @@ fbFillRegionSolid (DrawablePtr	pDrawable,
 	fbValidateDrawable (pDrawable);
 	pbox++;
     }
+
+    fbFinishAccess (pDrawable);
 }
 
 #ifdef PANORAMIX
@@ -311,6 +316,9 @@ fbFillRegionTiled (DrawablePtr	pDrawable,
 		yRot - (pbox->y1 + dstYoff));
 	pbox++;
     }
+
+    fbFinishAccess (&pTile->drawable);
+    fbFinishAccess (pDrawable);
 }
 
 void
diff --git a/fb/wfbrename.h b/fb/wfbrename.h
new file mode 100644
index 0000000..8f875c8
--- /dev/null
+++ b/fb/wfbrename.h
@@ -0,0 +1,198 @@
+#define fb16Lane wfb16Lane
+#define fb24_32CopyMtoN wfb24_32CopyMtoN
+#define fb24_32CreateScreenResources wfb24_32CreateScreenResources
+#define fb24_32GetImage wfb24_32GetImage
+#define fb24_32GetSpans wfb24_32GetSpans
+#define fb24_32ModifyPixmapHeader wfb24_32ModifyPixmapHeader
+#define fb24_32PutZImage wfb24_32PutZImage
+#define fb24_32ReformatTile wfb24_32ReformatTile
+#define fb24_32SetSpans wfb24_32SetSpans
+#define fb32Lane wfb32Lane
+#define fb8Lane wfb8Lane
+#define fbAddTraps wfbAddTraps
+#define fbAddTriangles wfbAddTriangles
+#define fbAllocatePrivates wfbAllocatePrivates
+#define fbArc16 wfbArc16
+#define fbArc24 wfbArc24
+#define fbArc32 wfbArc32
+#define fbArc8 wfbArc8
+#define fbBlt wfbBlt
+#define fbBlt24 wfbBlt24
+#define fbBltOne wfbBltOne
+#define fbBltOne24 wfbBltOne24
+#define fbBltPlane wfbBltPlane
+#define fbBltStip wfbBltStip
+#define fbBres wfbBres
+#define fbBresDash wfbBresDash
+#define fbBresDash16 wfbBresDash16
+#define fbBresDash24 wfbBresDash24
+#define fbBresDash32 wfbBresDash32
+#define fbBresDash8 wfbBresDash8
+#define fbBresFill wfbBresFill
+#define fbBresFillDash wfbBresFillDash
+#define fbBresSolid wfbBresSolid
+#define fbBresSolid16 wfbBresSolid16
+#define fbBresSolid24 wfbBresSolid24
+#define fbBresSolid32 wfbBresSolid32
+#define fbBresSolid8 wfbBresSolid8
+#define fbChangeWindowAttributes wfbChangeWindowAttributes
+#define fbClearVisualTypes wfbClearVisualTypes
+#define fbCloseScreen wfbCloseScreen
+#define fbComposite wfbComposite
+#define fbCompositeGeneral wfbCompositeGeneral
+#define fbCompositeSolidMask_nx1xn wfbCompositeSolidMask_nx1xn
+#define fbCompositeSolidMask_nx8888x0565C wfbCompositeSolidMask_nx8888x0565C
+#define fbCompositeSolidMask_nx8888x8888C wfbCompositeSolidMask_nx8888x8888C
+#define fbCompositeSolidMask_nx8x0565 wfbCompositeSolidMask_nx8x0565
+#define fbCompositeSolidMask_nx8x0888 wfbCompositeSolidMask_nx8x0888
+#define fbCompositeSolidMask_nx8x8888 wfbCompositeSolidMask_nx8x8888
+#define fbCompositeSrc_0565x0565 wfbCompositeSrc_0565x0565
+#define fbCompositeSrc_8888x0565 wfbCompositeSrc_8888x0565
+#define fbCompositeSrc_8888x0888 wfbCompositeSrc_8888x0888
+#define fbCompositeSrc_8888x8888 wfbCompositeSrc_8888x8888
+#define fbCompositeSrcAdd_1000x1000 wfbCompositeSrcAdd_1000x1000
+#define fbCompositeSrcAdd_8000x8000 wfbCompositeSrcAdd_8000x8000
+#define fbCompositeSrcAdd_8888x8888 wfbCompositeSrcAdd_8888x8888
+#define fbCopy1toN wfbCopy1toN
+#define fbCopyArea wfbCopyArea
+#define fbCopyNto1 wfbCopyNto1
+#define fbCopyNtoN wfbCopyNtoN
+#define fbCopyPlane wfbCopyPlane
+#define fbCopyRegion wfbCopyRegion
+#define fbCopyWindow wfbCopyWindow
+#define fbCopyWindowProc wfbCopyWindowProc
+#define fbCreateDefColormap wfbCreateDefColormap
+#define fbCreateGC wfbCreateGC
+#define fbCreatePixmap wfbCreatePixmap
+#define fbCreatePixmapBpp wfbCreatePixmapBpp
+#define fbCreateWindow wfbCreateWindow
+#define fbDestroyPixmap wfbDestroyPixmap
+#define fbDestroyWindow wfbDestroyWindow
+#define fbDoCopy wfbDoCopy
+#define fbDots wfbDots
+#define fbDots16 wfbDots16
+#define fbDots24 wfbDots24
+#define fbDots32 wfbDots32
+#define fbDots8 wfbDots8
+#define fbEvenStipple wfbEvenStipple
+#define fbEvenTile wfbEvenTile
+#define fbExpandDirectColors wfbExpandDirectColors
+#define fbFill wfbFill
+#define fbFillRegionSolid wfbFillRegionSolid
+#define fbFillRegionTiled wfbFillRegionTiled
+#define fbFillSpans wfbFillSpans
+#define fbFixCoordModePrevious wfbFixCoordModePrevious
+#define fbGCFuncs wfbGCFuncs
+#define fbGCOps wfbGCOps
+#define fbGCPrivateIndex wfbGCPrivateIndex
+#define fbGeneration wfbGeneration
+#define fbGetGCPrivateIndex wfbGetGCPrivateIndex
+#define fbGetImage wfbGetImage
+#define fbGetScreenPrivateIndex wfbGetScreenPrivateIndex
+#define fbGetSpans wfbGetSpans
+#define _fbGetWindowPixmap _wfbGetWindowPixmap
+#define fbGetWinPrivateIndex wfbGetWinPrivateIndex
+#define fbGlyph16 wfbGlyph16
+#define fbGlyph24 wfbGlyph24
+#define fbGlyph32 wfbGlyph32
+#define fbGlyph8 wfbGlyph8
+#define fbGlyphIn wfbGlyphIn
+#define fbHasVisualTypes wfbHasVisualTypes
+#define fbImageGlyphBlt wfbImageGlyphBlt
+#define fbIn wfbIn
+#define fbInitializeColormap wfbInitializeColormap
+#define fbInitVisuals wfbInitVisuals
+#define fbInstallColormap wfbInstallColormap
+#define fbLaneTable wfbLaneTable
+#define fbListInstalledColormaps wfbListInstalledColormaps
+#define fbMapWindow wfbMapWindow
+#define FbMergeRopBits wFbMergeRopBits
+#define fbOddStipple wfbOddStipple
+#define fbOddTile wfbOddTile
+#define fbOver wfbOver
+#define fbOver24 wfbOver24
+#define fbOverlayCloseScreen wfbOverlayCloseScreen
+#define fbOverlayCopyWindow wfbOverlayCopyWindow
+#define fbOverlayCreateScreenResources wfbOverlayCreateScreenResources
+#define fbOverlayCreateWindow wfbOverlayCreateWindow
+#define fbOverlayFinishScreenInit wfbOverlayFinishScreenInit
+#define fbOverlayGeneration wfbOverlayGeneration
+#define fbOverlayGetScreenPrivateIndex wfbOverlayGetScreenPrivateIndex
+#define fbOverlayPaintKey wfbOverlayPaintKey
+#define fbOverlayPaintWindow wfbOverlayPaintWindow
+#define fbOverlayScreenPrivateIndex wfbOverlayScreenPrivateIndex
+#define fbOverlaySetupScreen wfbOverlaySetupScreen
+#define fbOverlayUpdateLayerRegion wfbOverlayUpdateLayerRegion
+#define fbOverlayWindowExposures wfbOverlayWindowExposures
+#define fbOverlayWindowLayer wfbOverlayWindowLayer
+#define fbPadPixmap wfbPadPixmap
+#define fbPaintWindow wfbPaintWindow
+#define fbPictureInit wfbPictureInit
+#define fbPixmapToRegion wfbPixmapToRegion
+#define fbPolyArc wfbPolyArc
+#define fbPolyFillRect wfbPolyFillRect
+#define fbPolyGlyphBlt wfbPolyGlyphBlt
+#define fbPolyLine wfbPolyLine
+#define fbPolyline16 wfbPolyline16
+#define fbPolyline24 wfbPolyline24
+#define fbPolyline32 wfbPolyline32
+#define fbPolyline8 wfbPolyline8
+#define fbPolyPoint wfbPolyPoint
+#define fbPolySegment wfbPolySegment
+#define fbPolySegment16 wfbPolySegment16
+#define fbPolySegment24 wfbPolySegment24
+#define fbPolySegment32 wfbPolySegment32
+#define fbPolySegment8 wfbPolySegment8
+#define fbPositionWindow wfbPositionWindow
+#define fbPushFill wfbPushFill
+#define fbPushImage wfbPushImage
+#define fbPushPattern wfbPushPattern
+#define fbPushPixels wfbPushPixels
+#define fbPutImage wfbPutImage
+#define fbPutXYImage wfbPutXYImage
+#define fbPutZImage wfbPutZImage
+#define fbQueryBestSize wfbQueryBestSize
+#define fbRasterizeEdges wfbRasterizeEdges
+#define fbRasterizeTrapezoid wfbRasterizeTrapezoid
+#define fbRealizeFont wfbRealizeFont
+#define fbReduceRasterOp wfbReduceRasterOp
+#define fbReplicatePixel wfbReplicatePixel
+#define fbResolveColor wfbResolveColor
+#define fbRestoreAreas wfbRestoreAreas
+#define fbSaveAreas wfbSaveAreas
+#define fbScreenPrivateIndex wfbScreenPrivateIndex
+#define fbSegment wfbSegment
+#define fbSelectBres wfbSelectBres
+#define fbSetSpans wfbSetSpans
+#define fbSetupScreen wfbSetupScreen
+#define fbSetVisualTypes wfbSetVisualTypes
+#define fbSetVisualTypesAndMasks wfbSetVisualTypesAndMasks
+#define _fbSetWindowPixmap _wfbSetWindowPixmap
+#define fbSolid wfbSolid
+#define fbSolid24 wfbSolid24
+#define fbSolidBoxClipped wfbSolidBoxClipped
+#define fbStipple wfbStipple
+#define fbStipple1Bits wfbStipple1Bits
+#define fbStipple24Bits wfbStipple24Bits
+#define fbStipple2Bits wfbStipple2Bits
+#define fbStipple4Bits wfbStipple4Bits
+#define fbStipple8Bits wfbStipple8Bits
+#define fbStippleTable wfbStippleTable
+#define fbTile wfbTile
+#define fbTransparentSpan wfbTransparentSpan
+#define fbUninstallColormap wfbUninstallColormap
+#define fbUnmapWindow wfbUnmapWindow
+#define fbUnrealizeFont wfbUnrealizeFont
+#define fbValidateGC wfbValidateGC
+#define fbWinPrivateIndex wfbWinPrivateIndex
+#define fbZeroLine wfbZeroLine
+#define fbZeroSegment wfbZeroSegment
+#define xxScrPrivateIndex wfbxxScrPrivateIndex
+#define xxGCPrivateIndex wfbxxGCPrivateIndex
+#define xxColormapPrivateIndex wfbxxColormapPrivateIndex
+#define xxGeneration wfbxxGeneration
+#define xxPrintVisuals wfbxxPrintVisuals
+#define xxGCFuncs wfbxxGCFuncs
+#define xxGCOps wfbxxGCOps
+#define xxSetup wfbxxSetup
+#define composeFunctions wfbComposeFunctions
diff --git a/hw/kdrive/fbdev/fbdev.c b/hw/kdrive/fbdev/fbdev.c
index 20bf758..03cde55 100644
--- a/hw/kdrive/fbdev/fbdev.c
+++ b/hw/kdrive/fbdev/fbdev.c
@@ -1,7 +1,7 @@
 /*
  * Id: fbdev.c,v 1.1 1999/11/02 03:54:46 keithp Exp $
  *
- * Copyright  1999 Keith Packard
+ * Copyright  1999 Keith Packard
  *
  * Permission to use, copy, modify, distribute, and sell this software and its
  * documentation for any purpose is hereby granted without fee, provided that
@@ -66,15 +66,11 @@ fbdevInitialize (KdCardInfo *card, FbdevPriv *priv)
 	return FALSE;
     }
 
-    priv->fb_base = (char *) mmap ((caddr_t) NULL,
-				   priv->fix.smem_len,
-				   PROT_READ|PROT_WRITE,
-				   MAP_SHARED,
-				   priv->fd, 0);
+    priv->fb_base = (char *) ioctl(priv->fd, FBIOGET_VRAM_START_ADDRESS, 0);
     
     if (priv->fb_base == (char *)-1) 
     {
-        perror("ERROR: mmap framebuffer fails!");
+        perror("ERROR: FBIOGET_VRAM_START_ADDRESS ioctl fails!");
 	close (priv->fd);
 	return FALSE;
     }
@@ -745,7 +741,6 @@ fbdevCardFini (KdCardInfo *card)
 {
     FbdevPriv	*priv = card->driver;
     
-    munmap (priv->fb_base, priv->fix.smem_len);
     close (priv->fd);
     xfree (priv);
 }
diff --git a/hw/kdrive/src/kshadow.c b/hw/kdrive/src/kshadow.c
index 34e1d5d..cf38016 100644
--- a/hw/kdrive/src/kshadow.c
+++ b/hw/kdrive/src/kshadow.c
@@ -1,7 +1,7 @@
 /*
  * $RCSId: $
  *
- * Copyright  1999 Keith Packard
+ * Copyright  1999 Keith Packard
  *
  * Permission to use, copy, modify, distribute, and sell this software and its
  * documentation for any purpose is hereby granted without fee, provided that
@@ -26,21 +26,24 @@
 #include <kdrive-config.h>
 #endif
 #include "kdrive.h"
-
+#include "../fbdev/fbdev.h"
 Bool
 KdShadowFbAlloc (KdScreenInfo *screen, int fb, Bool rotate)
 {
     int	    paddedWidth;
+    int 	fd;
     void    *buf;
     int	    width = rotate ? screen->height : screen->width;
     int	    height = rotate ? screen->width : screen->height;
     int	    bpp = screen->fb[fb].bitsPerPixel;
 
+    fd = open("/dev/fb0", O_RDWR);
     /* use fb computation for width */
     paddedWidth = ((width * bpp + FB_MASK) >> FB_SHIFT) * sizeof (FbBits);
-    buf = xalloc (paddedWidth * height);
+    buf = (char *) ioctl(fd, FBIOGET_VRAM_END_ADDRESS, 0) - (paddedWidth * height);
     if (!buf)
-	return FALSE;
+    	return FALSE;
+    close(fd);
     if (screen->fb[fb].shadow)
 	xfree (screen->fb[fb].frameBuffer);
     screen->fb[fb].shadow = TRUE;
diff --git a/hw/xfree86/modes/xf86Rotate.c b/hw/xfree86/modes/xf86Rotate.c
index 359501e..fda9bae 100644
--- a/hw/xfree86/modes/xf86Rotate.c
+++ b/hw/xfree86/modes/xf86Rotate.c
@@ -205,11 +205,18 @@ xf86RotateCrtcRedisplay (xf86CrtcPtr crtc, RegionPtr region)
 	xf86TransformBox (&dst_box, b, crtc->rotation,
 			  crtc->x, crtc->y,
 			  crtc->mode.HDisplay, crtc->mode.VDisplay);
-	CompositePicture (PictOpSrc,
-			  src, NULL, dst,
-			  dst_box.x1, dst_box.y1, 0, 0, dst_box.x1, dst_box.y1,
-			  dst_box.x2 - dst_box.x1,
-			  dst_box.y2 - dst_box.y1);
+	 FbComposeData params = {
+	    		.op = PictOpSrc,
+	    		.xSrc = dst_box.x,
+	    		.ySrc = dst_box.y1,
+	    		.xMask = 0,
+	    		.yMask = 0,
+	    		.xDest = dst_box.x1,
+	    		.yDest = dst_box.y1,
+	    		.width = dst_box.x2 - dst_box.x1,
+	    		.height = dst_box.y2 - dst_box.y1
+	 };
+	CompositePicture (&params, src, NULL, dst);
 	b++;
     }
     FreePicture (src, None);
diff --git a/mi/midispcur.c b/mi/midispcur.c
index de009cb..977343f 100644
--- a/mi/midispcur.c
+++ b/mi/midispcur.c
@@ -483,14 +483,23 @@ miDCPutUpCursor (pScreen, pCursor, x, y, source, mask)
     {
 	if (!EnsurePicture(pScreenPriv->pRootPicture, &pWin->drawable, pWin))
 	    return FALSE;
-	CompositePicture (PictOpOver,
+
+	 FbComposeData params = {
+	    		.op = PictOpOver,
+	    		.xSrc = 0,
+	    		.ySrc = 0,
+	    		.xMask = 0,
+	    		.yMask = 0,
+	    		.xDest = x,
+	    		.yDest = y,
+	    		.width = pCursor->bits->width,
+	    		.height = pCursor->bits->height
+	 };
+
+	CompositePicture (&params,
 			  pPriv->pPicture,
 			  NULL,
-			  pScreenPriv->pRootPicture,
-			  0, 0, 0, 0, 
-			  x, y, 
-			  pCursor->bits->width,
-			  pCursor->bits->height);
+			  pScreenPriv->pRootPicture);
     }
     else
 #endif
@@ -767,14 +776,23 @@ miDCMoveCursor (pScreen, pCursor, x, y, w, h, dx, dy, source, mask)
     {
 	if (!EnsurePicture(pScreenPriv->pTempPicture, &pTemp->drawable, pWin))
 	    return FALSE;
-	CompositePicture (PictOpOver,
+
+	 FbComposeData params = {
+	    		.op = PictOpOver,
+	    		.xSrc = 0,
+	    		.ySrc = 0,
+	    		.xMask = 0,
+	    		.yMask = 0,
+	    		.xDest = dx,
+	    		.yDest = dy,
+	    		.width = pCursor->bits->width,
+	    		.height = pCursor->bits->height
+	 };
+
+	CompositePicture (&params,
 			  pPriv->pPicture,
 			  NULL,
-			  pScreenPriv->pTempPicture,
-			  0, 0, 0, 0, 
-			  dx, dy, 
-			  pCursor->bits->width,
-			  pCursor->bits->height);
+			  pScreenPriv->pTempPicture);
     }
     else
 #endif
diff --git a/miext/damage/damage.c b/miext/damage/damage.c
index cd66b54..dece1ca 100755
--- a/miext/damage/damage.c
+++ b/miext/damage/damage.c
@@ -542,19 +542,12 @@ damageDestroyClip(GCPtr pGC)
 #define checkPictureDamage(p)	(getDrawableDamage(p->pDrawable) && \
 				 REGION_NOTEMPTY(pScreen, p->pCompositeClip))
 
-static void
-damageComposite (CARD8      op,
+
+
+void damageComposite (FbComposeData *params,
 		   PicturePtr pSrc,
 		   PicturePtr pMask,
-		   PicturePtr pDst,
-		   INT16      xSrc,
-		   INT16      ySrc,
-		   INT16      xMask,
-		   INT16      yMask,
-		   INT16      xDst,
-		   INT16      yDst,
-		   CARD16     width,
-		   CARD16     height)
+		   PicturePtr pDst)
 {
     ScreenPtr		pScreen = pDst->pDrawable->pScreen;
     PictureScreenPtr	ps = GetPictureScreen(pScreen);
@@ -564,27 +557,27 @@ damageComposite (CARD8      op,
     {
 	BoxRec	box;
 
-	box.x1 = xDst + pDst->pDrawable->x;
-	box.y1 = yDst + pDst->pDrawable->y;
-	box.x2 = box.x1 + width;
-	box.y2 = box.y1 + height;
+	box.x1 = params->xDest + pDst->pDrawable->x;
+	box.y1 = params->yDest + pDst->pDrawable->y;
+	box.x2 = box.x1 + params->width;
+	box.y2 = box.y1 + params->height;
 	TRIM_PICTURE_BOX(box, pDst);
 	if (BOX_NOT_EMPTY(box))
 	    damageDamageBox (pDst->pDrawable, &box, pDst->subWindowMode);
     }
     unwrap (pScrPriv, ps, Composite);
-    (*ps->Composite) (op,
+    (*ps->Composite) (params->op,
 		       pSrc,
 		       pMask,
 		       pDst,
-		       xSrc,
-		       ySrc,
-		       xMask,
-		       yMask,
-		       xDst,
-		       yDst,
-		       width,
-		       height);
+		       params->xSrc,
+		       params->ySrc,
+		       params->xMask,
+		       params->yMask,
+		       params->xDest,
+		       params->yDest,
+		       params->width,
+		       params->height);
     damageReportPostOp (pDst->pDrawable);
     wrap (pScrPriv, ps, Composite, damageComposite);
 }
diff --git a/render/miglyph.c b/render/miglyph.c
index 7968c90..80e0b3f 100644
--- a/render/miglyph.c
+++ b/render/miglyph.c
@@ -197,32 +197,42 @@ miGlyphs (CARD8		op,
 					    glyph->info.width, glyph->info.height,
 					    0, 0, -1, (pointer) (glyph + 1));
 	    pPixmap->drawable.serialNumber = NEXT_SERIAL_NUMBER;
+
 	    if (maskFormat)
 	    {
-		CompositePicture (PictOpAdd,
+		FbComposeData params = {
+		    		.op = PictOpAdd,
+		    		.xSrc = 0,
+		    		.ySrc = 0,
+		    		.xMask = 0,
+		    		.yMask = 0,
+		    		.xDest = x - glyph->info.x,
+		    		.yDest = y - glyph->info.y,
+		    		.width = glyph->info.width,
+		    		.height = glyph->info.height
+		    };
+		CompositePicture (&params,
 				  pPicture,
 				  None,
-				  pMask,
-				  0, 0,
-				  0, 0,
-				  x - glyph->info.x,
-				  y - glyph->info.y,
-				  glyph->info.width,
-				  glyph->info.height);
+				  pMask);
 	    }
 	    else
 	    {
-		CompositePicture (op,
+		 FbComposeData params = {
+		    		.op = op,
+		    		.xSrc = xSrc + (x - glyph->info.x) - xDst,
+		    		.ySrc = ySrc + (y - glyph->info.y) - yDst,
+		    		.xMask = 0,
+		    		.yMask = 0,
+		    		.xDest = x - glyph->info.x,
+		    		.yDest = y - glyph->info.y,
+		    		.width = glyph->info.width,
+		    		.height = glyph->info.height
+		    };
+		CompositePicture (&params,
 				  pSrc,
 				  pPicture,
-				  pDst,
-				  xSrc + (x - glyph->info.x) - xDst,
-				  ySrc + (y - glyph->info.y) - yDst,
-				  0, 0,
-				  x - glyph->info.x,
-				  y - glyph->info.y,
-				  glyph->info.width,
-				  glyph->info.height);
+				  pDst);
 	    }
 	    x += glyph->info.xOff;
 	    y += glyph->info.yOff;
@@ -240,15 +250,21 @@ miGlyphs (CARD8		op,
     {
 	x = extents.x1;
 	y = extents.y1;
-	CompositePicture (op,
+	 FbComposeData params = {
+	    		.op = op,
+	    		.xSrc = xSrc + x - xDst,
+	    		.ySrc = ySrc + y - yDst,
+	    		.xMask = 0,
+	    		.yMask = 0,
+	    		.xDest = x,
+	    		.yDest = y,
+	    		.width = width,
+	    		.height = height
+	    };
+	CompositePicture (&params,
 			  pSrc,
 			  pMask,
-			  pDst,
-			  xSrc + x - xDst,
-			  ySrc + y - yDst,
-			  0, 0,
-			  x, y,
-			  width, height);
+			  pDst);
 	FreePicture ((pointer) pMask, (XID) 0);
 	(*pScreen->DestroyPixmap) (pMaskPixmap);
     }
diff --git a/render/mirect.c b/render/mirect.c
index 87767a7..38af8d8 100644
--- a/render/mirect.c
+++ b/render/mirect.c
@@ -162,14 +162,20 @@ miCompositeRects (CARD8		op,
 			      
 	if (!pSrc)
 	    goto bail4;
-
+    FbComposeData params = {
+    		.op = op,
+    		.xSrc = 0,
+    		.ySrc = 0,
+    		.xMask = 0,
+    		.yMask = 0,
+    		.xDest = rects->x,
+    		.yDest = rects->y,
+    		.width = rects->width,
+    		.height = rects->height
+    };
 	while (nRect--)
 	{
-	    CompositePicture (op, pSrc, 0, pDst, 0, 0, 0, 0, 
-			      rects->x,
-			      rects->y,
-			      rects->width,
-			      rects->height);
+	    CompositePicture (&params, pSrc, 0, pDst);
 	    rects++;
 	}
 
diff --git a/render/mitrap.c b/render/mitrap.c
index c618806..cdf5bfa 100644
--- a/render/mitrap.c
+++ b/render/mitrap.c
@@ -171,10 +171,18 @@ miTrapezoids (CARD8	    op,
 				       -bounds.x1, -bounds.y1);
 	xRel = bounds.x1 + xSrc - xDst;
 	yRel = bounds.y1 + ySrc - yDst;
-	CompositePicture (op, pSrc, pPicture, pDst,
-			  xRel, yRel, 0, 0, bounds.x1, bounds.y1,
-			  bounds.x2 - bounds.x1,
-			  bounds.y2 - bounds.y1);
+	 FbComposeData params = {
+	    		.op = op,
+	    		.xSrc = xRel,
+	    		.ySrc = yRel,
+	    		.xMask = 0,
+	    		.yMask = 0,
+	    		.xDest = bounds.x1,
+	    		.yDest = bounds.y1,
+	    		.width = bounds.x2 - bounds.x1,
+	    		.height = bounds.y2 - bounds.y1
+	    };
+	CompositePicture (&params, pSrc, pPicture, pDst);
 	FreePicture (pPicture, 0);
     }
     else
diff --git a/render/mitri.c b/render/mitri.c
index 374e2fd..87a6cd2 100644
--- a/render/mitri.c
+++ b/render/mitri.c
@@ -109,9 +109,18 @@ miTriangles (CARD8	    op,
 	
 	xRel = bounds.x1 + xSrc - xDst;
 	yRel = bounds.y1 + ySrc - yDst;
-	CompositePicture (op, pSrc, pPicture, pDst,
-			  xRel, yRel, 0, 0, bounds.x1, bounds.y1,
-			  bounds.x2 - bounds.x1, bounds.y2 - bounds.y1);
+	 FbComposeData params = {
+	    		.op = op,
+	    		.xSrc = xRel,
+	    		.ySrc = yRel,
+	    		.xMask = 0,
+	    		.yMask = 0,
+	    		.xDest = bounds.x1,
+	    		.yDest = bounds.y1,
+	    		.width = bounds.x2 - bounds.x1,
+	    		.height = bounds.y2 - bounds.y1
+	 };
+	CompositePicture (&params, pSrc, pPicture, pDst);
 	FreePicture (pPicture, 0);
     }
     else
diff --git a/render/picture.c b/render/picture.c
index a3443c2..2340027 100644
--- a/render/picture.c
+++ b/render/picture.c
@@ -1767,19 +1767,10 @@ ReduceCompositeOp (CARD8 op, PicturePtr pSrc, PicturePtr pMask, PicturePtr pDst)
     return op;
 }
 
-void
-CompositePicture (CARD8		op,
+CompositePicture (FbComposeData *params,
 		  PicturePtr	pSrc,
 		  PicturePtr	pMask,
-		  PicturePtr	pDst,
-		  INT16		xSrc,
-		  INT16		ySrc,
-		  INT16		xMask,
-		  INT16		yMask,
-		  INT16		xDst,
-		  INT16		yDst,
-		  CARD16	width,
-		  CARD16	height)
+		  PicturePtr	pDst)
 {
     PictureScreenPtr	ps = GetPictureScreen(pDst->pDrawable->pScreen);
     
@@ -1788,22 +1779,14 @@ CompositePicture (CARD8		op,
 	ValidatePicture (pMask);
     ValidatePicture (pDst);
 
-    op = ReduceCompositeOp (op, pSrc, pMask, pDst);
-    if (op == PictOpDst)
+    params->op = ReduceCompositeOp (params->op, pSrc, pMask, pDst);
+    if (params->op == PictOpDst)
 	return;
 
-    (*ps->Composite) (op,
+    damageComposite (params,
 		       pSrc,
 		       pMask,
-		       pDst,
-		       xSrc,
-		       ySrc,
-		       xMask,
-		       yMask,
-		       xDst,
-		       yDst,
-		       width,
-		       height);
+		       pDst);
 }
 
 void
diff --git a/render/picturestr.h b/render/picturestr.h
index f1617f6..99af12a 100644
--- a/render/picturestr.h
+++ b/render/picturestr.h
@@ -62,6 +62,21 @@ typedef struct _PictTransform {
     xFixed	    matrix[3][3];
 } PictTransform, *PictTransformPtr;
 
+typedef struct _FbComposeData {
+    int	op;
+    PicturePtr	src;
+    PicturePtr	mask;
+    PicturePtr	dest;
+    int	xSrc;
+    int	ySrc;
+    int	xMask;
+    int	yMask;
+    int	xDest;
+    int	yDest;
+    int	width;
+    int	height;
+} FbComposeData;
+
 #define PICT_GRADIENT_STOPTABLE_SIZE 1024
 #define SourcePictTypeSolidFill 0
 #define SourcePictTypeLinear 1
@@ -545,18 +560,10 @@ FreePictFormat (pointer	pPictFormat,
 		XID     pid);
 
 void
-CompositePicture (CARD8		op,
+CompositePicture (FbComposeData *params,
 		  PicturePtr	pSrc,
 		  PicturePtr	pMask,
-		  PicturePtr	pDst,
-		  INT16		xSrc,
-		  INT16		ySrc,
-		  INT16		xMask,
-		  INT16		yMask,
-		  INT16		xDst,
-		  INT16		yDst,
-		  CARD16	width,
-		  CARD16	height);
+		  PicturePtr	pDst);
 
 void
 CompositeGlyphs (CARD8		op,
diff --git a/render/render.c b/render/render.c
index 55f360a..599d2c6 100644
--- a/render/render.c
+++ b/render/render.c
@@ -753,18 +753,21 @@ ProcRenderComposite (ClientPtr client)
     if ((pSrc->pDrawable && pSrc->pDrawable->pScreen != pDst->pDrawable->pScreen) ||
 	(pMask && pMask->pDrawable && pDst->pDrawable->pScreen != pMask->pDrawable->pScreen))
 	return BadMatch;
-    CompositePicture (stuff->op,
+	 FbComposeData params = {
+	    		.op = stuff->op,
+	    		.xSrc = stuff->xSrc,
+	    		.ySrc = stuff->ySrc,
+	    		.xMask = stuff->xMask,
+	    		.yMask = stuff->yMask,
+	    		.xDest = stuff->xDst,
+	    		.yDest = stuff->yDst,
+	    		.width = stuff->width,
+	    		.height = stuff->height
+	 };
+    CompositePicture (&params,
 		      pSrc,
 		      pMask,
-		      pDst,
-		      stuff->xSrc,
-		      stuff->ySrc,
-		      stuff->xMask,
-		      stuff->yMask,
-		      stuff->xDst,
-		      stuff->yDst,
-		      stuff->width,
-		      stuff->height);
+		      pDst);
     return Success;
 }
 
@@ -1566,9 +1569,18 @@ ProcRenderCreateCursor (ClientPtr client)
 	    return error;
 	}
 	(*pScreen->DestroyPixmap) (pPixmap);
-	CompositePicture (PictOpSrc,
-			  pSrc, 0, pPicture,
-			  0, 0, 0, 0, 0, 0, width, height);
+	 FbComposeData params = {
+	    		.op = PictOpSrc,
+	    		.xSrc = 0,
+	    		.ySrc = 0,
+	    		.xMask = 0,
+	    		.yMask = 0,
+	    		.xDest = 0,
+	    		.yDest = 0,
+	    		.width = width,
+	    		.height = height
+	 };
+	CompositePicture (&params, pSrc, 0, pPicture);
 	(*pScreen->GetImage) (pPicture->pDrawable,
 			      0, 0, width, height, ZPixmap,
 			      0xffffffff, (pointer) argbbits);
